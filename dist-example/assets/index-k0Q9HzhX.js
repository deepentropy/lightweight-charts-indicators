var al=Object.defineProperty;var hl=(i,t,e)=>t in i?al(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var V=(i,t,e)=>hl(i,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();function cl(i){const t=new Date(i);return Math.floor(t.getTime()/1e3)}function ul(i){var s;const t=i.trim().split(`
`),e=[];for(let n=1;n<t.length;n++){const o=(s=t[n])==null?void 0:s.trim();if(!o)continue;const r=o.split(",");if(r.length<6)continue;const l=r[0],a=r[1],h=r[2],c=r[3],u=r[4],f=r[5];if(!l||!a||!h||!c||!u)continue;const d=cl(l),p=parseFloat(a),m=parseFloat(h),g=parseFloat(c),v=parseFloat(u),w=f?parseFloat(f):0;!isNaN(d)&&!isNaN(p)&&!isNaN(m)&&!isNaN(g)&&!isNaN(v)&&e.push({time:d,open:p,high:m,low:g,close:v,volume:w||0})}return e.sort((n,o)=>n.time-o.time),e}function fl(i){return i.map(t=>({time:t.time,open:t.open,high:t.high,low:t.low,close:t.close}))}async function dl(i){const t=await fetch(i);if(!t.ok)throw new Error(`Failed to load CSV: ${t.statusText}`);const e=await t.text();return ul(e)}function E(i){var t=i.width,e=i.height;if(t<0)throw new Error("Negative width is not allowed for Size");if(e<0)throw new Error("Negative height is not allowed for Size");return{width:t,height:e}}function at(i,t){return i.width===t.width&&i.height===t.height}var pl=function(){function i(t){var e=this;this._resolutionListener=function(){return e._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return i.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(i.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),i.prototype.subscribe=function(t){var e=this,s={next:t};return this._observers.push(s),{unsubscribe:function(){e._observers=e._observers.filter(function(n){return n!==s})}}},i.prototype._installResolutionListener=function(){if(this._resolutionMediaQueryList!==null)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},i.prototype._uninstallResolutionListener=function(){this._resolutionMediaQueryList!==null&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},i.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},i.prototype._onResolutionChanged=function(){var t=this;this._observers.forEach(function(e){return e.next(t._window.devicePixelRatio)}),this._reinstallResolutionListener()},i}();function ml(i){return new pl(i)}var gl=function(){function i(t,e,s){var n;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=E({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=e??function(o){return o},this._allowResizeObserver=(n=s==null?void 0:s.allowResizeObserver)!==null&&n!==void 0?n:!0,this._chooseAndInitObserver()}return i.prototype.dispose=function(){var t,e;if(this._canvasElement===null)throw new Error("Object is disposed");(t=this._canvasElementResizeObserver)===null||t===void 0||t.disconnect(),this._canvasElementResizeObserver=null,(e=this._devicePixelRatioObservable)===null||e===void 0||e.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(i.prototype,"canvasElement",{get:function(){if(this._canvasElement===null)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bitmapSize",{get:function(){return E({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),i.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=E(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},i.prototype.subscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners.push(t)},i.prototype.unsubscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(e){return e!==t})},Object.defineProperty(i.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),i.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},i.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(e){return e!==t})},i.prototype.applySuggestedBitmapSize=function(){if(this._suggestedBitmapSize!==null){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},i.prototype._resizeBitmap=function(t){var e=this.bitmapSize;at(e,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(e,t))},i.prototype._emitBitmapSizeChanged=function(t,e){var s=this;this._bitmapSizeChangedListeners.forEach(function(n){return n.call(s,t,e)})},i.prototype._suggestNewBitmapSize=function(t){var e=this._suggestedBitmapSize,s=E(this._transformBitmapSize(t,this._canvasElementClientSize)),n=at(this.bitmapSize,s)?null:s;e===null&&n===null||e!==null&&n!==null&&at(e,n)||(this._suggestedBitmapSize=n,this._emitSuggestedBitmapSizeChanged(e,n))},i.prototype._emitSuggestedBitmapSizeChanged=function(t,e){var s=this;this._suggestedBitmapSizeChangedListeners.forEach(function(n){return n.call(s,t,e)})},i.prototype._chooseAndInitObserver=function(){var t=this;if(!this._allowResizeObserver){this._initDevicePixelRatioObservable();return}wl().then(function(e){return e?t._initResizeObserver():t._initDevicePixelRatioObservable()})},i.prototype._initDevicePixelRatioObservable=function(){var t=this;if(this._canvasElement!==null){var e=cs(this._canvasElement);if(e===null)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=ml(e),this._devicePixelRatioObservable.subscribe(function(){return t._invalidateBitmapSize()}),this._invalidateBitmapSize()}},i.prototype._invalidateBitmapSize=function(){var t,e;if(this._canvasElement!==null){var s=cs(this._canvasElement);if(s!==null){var n=(e=(t=this._devicePixelRatioObservable)===null||t===void 0?void 0:t.value)!==null&&e!==void 0?e:s.devicePixelRatio,o=this._canvasElement.getClientRects(),r=o[0]!==void 0?yl(o[0],n):E({width:this._canvasElementClientSize.width*n,height:this._canvasElementClientSize.height*n});this._suggestNewBitmapSize(r)}}},i.prototype._initResizeObserver=function(){var t=this;this._canvasElement!==null&&(this._canvasElementResizeObserver=new ResizeObserver(function(e){var s=e.find(function(r){return r.target===t._canvasElement});if(!(!s||!s.devicePixelContentBoxSize||!s.devicePixelContentBoxSize[0])){var n=s.devicePixelContentBoxSize[0],o=E({width:n.inlineSize,height:n.blockSize});t._suggestNewBitmapSize(o)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},i}();function vl(i,t){return new gl(i,t.transform,t.options)}function cs(i){return i.ownerDocument.defaultView}function wl(){return new Promise(function(i){var t=new ResizeObserver(function(e){i(e.every(function(s){return"devicePixelContentBoxSize"in s})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1})}function yl(i,t){return E({width:Math.round(i.left*t+i.width*t)-Math.round(i.left*t),height:Math.round(i.top*t+i.height*t)-Math.round(i.top*t)})}var Nl=function(){function i(t,e,s){if(e.width===0||e.height===0)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=e,s.width===0||s.height===0)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=s,this._context=t}return i.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},i.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(i.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),i}();function ht(i,t){var e=i.canvasElementClientSize;if(e.width===0||e.height===0)return null;var s=i.bitmapSize;if(s.width===0||s.height===0)return null;var n=i.canvasElement.getContext("2d",t);return n===null?null:new Nl(n,e,s)}/*!
 * @license
 * TradingView Lightweight Charts™ v5.0.9
 * Copyright (c) 2025 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */const gn={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};var us,Ji;function ct(i,t){const e={0:[],1:[i.lineWidth,i.lineWidth],2:[2*i.lineWidth,2*i.lineWidth],3:[6*i.lineWidth,6*i.lineWidth],4:[i.lineWidth,4*i.lineWidth]}[t];i.setLineDash(e)}function vn(i,t,e,s){i.beginPath();const n=i.lineWidth%2?.5:0;i.moveTo(e,t+n),i.lineTo(s,t+n),i.stroke()}function W(i,t){if(!i)throw new Error("Assertion failed"+(t?": "+t:""))}function Y(i){if(i===void 0)throw new Error("Value is undefined");return i}function S(i){if(i===null)throw new Error("Value is null");return i}function ot(i){return S(Y(i))}(function(i){i[i.Simple=0]="Simple",i[i.WithSteps=1]="WithSteps",i[i.Curved=2]="Curved"})(us||(us={})),function(i){i[i.Solid=0]="Solid",i[i.Dotted=1]="Dotted",i[i.Dashed=2]="Dashed",i[i.LargeDashed=3]="LargeDashed",i[i.SparseDotted=4]="SparseDotted"}(Ji||(Ji={}));class k{constructor(){this.t=[]}i(t,e,s){const n={h:t,l:e,o:s===!0};this.t.push(n)}_(t){const e=this.t.findIndex(s=>t===s.h);e>-1&&this.t.splice(e,1)}u(t){this.t=this.t.filter(e=>e.l!==t)}p(t,e,s){const n=[...this.t];this.t=this.t.filter(o=>!o.o),n.forEach(o=>o.h(t,e,s))}v(){return this.t.length>0}m(){this.t=[]}}function H(i,...t){for(const e of t)for(const s in e)e[s]!==void 0&&Object.prototype.hasOwnProperty.call(e,s)&&!["__proto__","constructor","prototype"].includes(s)&&(typeof e[s]!="object"||i[s]===void 0||Array.isArray(e[s])?i[s]=e[s]:H(i[s],e[s]));return i}function xt(i){return typeof i=="number"&&isFinite(i)}function Vt(i){return typeof i=="number"&&i%1==0}function Rt(i){return typeof i=="string"}function Wt(i){return typeof i=="boolean"}function X(i){const t=i;if(!t||typeof t!="object")return t;let e,s,n;for(s in e=Array.isArray(t)?[]:{},t)t.hasOwnProperty(s)&&(n=t[s],e[s]=n&&typeof n=="object"?X(n):n);return e}function Ml(i){return i!==null}function Dt(i){return i===null?void 0:i}const wn="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function fi(i,t,e){return t===void 0&&(t=wn),`${e=e!==void 0?`${e} `:""}${i}px ${t}`}class bl{constructor(t){this.M={S:1,C:5,P:NaN,k:"",T:"",R:"",D:"",V:0,B:0,I:0,A:0,L:0},this.O=t}N(){const t=this.M,e=this.F(),s=this.W();return t.P===e&&t.T===s||(t.P=e,t.T=s,t.k=fi(e,s),t.A=2.5/12*e,t.V=t.A,t.B=e/12*t.C,t.I=e/12*t.C,t.L=0),t.R=this.H(),t.D=this.U(),this.M}H(){return this.O.N().layout.textColor}U(){return this.O.$()}F(){return this.O.N().layout.fontSize}W(){return this.O.N().layout.fontFamily}}function Pi(i){return i<0?0:i>255?255:Math.round(i)||0}function fs(i){return .199*i[0]+.687*i[1]+.114*i[2]}class xl{constructor(t,e){this.q=new Map,this.Y=t,e&&(this.q=e)}j(t,e){if(t==="transparent")return t;const s=this.K(t),n=s[3];return`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${e*n})`}X(t){const e=this.K(t);return{Z:`rgb(${e[0]}, ${e[1]}, ${e[2]})`,G:fs(e)>160?"black":"white"}}J(t){return fs(this.K(t))}tt(t,e,s){const[n,o,r,l]=this.K(t),[a,h,c,u]=this.K(e),f=[Pi(n+s*(a-n)),Pi(o+s*(h-o)),Pi(r+s*(c-r)),(d=l+s*(u-l),d<=0||d>1?Math.min(Math.max(d,0),1):Math.round(1e4*d)/1e4)];var d;return`rgba(${f[0]}, ${f[1]}, ${f[2]}, ${f[3]})`}K(t){const e=this.q.get(t);if(e)return e;const s=function(r){const l=document.createElement("div");l.style.display="none",document.body.appendChild(l),l.style.color=r;const a=window.getComputedStyle(l).color;return document.body.removeChild(l),a}(t),n=s.match(/^rgba?\s*\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d+))?\)$/);if(!n){if(this.Y.length)for(const r of this.Y){const l=r(t);if(l)return this.q.set(t,l),l}throw new Error(`Failed to parse color: ${t}`)}const o=[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),n[4]?parseFloat(n[4]):1];return this.q.set(t,o),o}}class _l{constructor(){this.it=[]}st(t){this.it=t}nt(t,e,s){this.it.forEach(n=>{n.nt(t,e,s)})}}class pt{nt(t,e,s){t.useBitmapCoordinateSpace(n=>this.et(n,e,s))}}class Cl extends pt{constructor(){super(...arguments),this.rt=null}ht(t){this.rt=t}et({context:t,horizontalPixelRatio:e,verticalPixelRatio:s}){if(this.rt===null||this.rt.lt===null)return;const n=this.rt.lt,o=this.rt,r=Math.max(1,Math.floor(e))%2/2,l=a=>{t.beginPath();for(let h=n.to-1;h>=n.from;--h){const c=o.ot[h],u=Math.round(c._t*e)+r,f=c.ut*s,d=a*s+r;t.moveTo(u,f),t.arc(u,f,d,0,2*Math.PI)}t.fill()};o.ct>0&&(t.fillStyle=o.dt,l(o.ft+o.ct)),t.fillStyle=o.vt,l(o.ft)}}function Sl(){return{ot:[{_t:0,ut:0,wt:0,gt:0}],vt:"",dt:"",ft:0,ct:0,lt:null}}const Al={from:0,to:1};class Pl{constructor(t,e,s){this.Mt=new _l,this.bt=[],this.St=[],this.xt=!0,this.O=t,this.Ct=e,this.Pt=s,this.Mt.st(this.bt)}yt(t){this.kt(),this.xt=!0}Tt(){return this.xt&&(this.Rt(),this.xt=!1),this.Mt}kt(){const t=this.Pt.Dt();t.length!==this.bt.length&&(this.St=t.map(Sl),this.bt=this.St.map(e=>{const s=new Cl;return s.ht(e),s}),this.Mt.st(this.bt))}Rt(){const t=this.Ct.N().mode===2||!this.Ct.Vt(),e=this.Pt.Bt(),s=this.Ct.It(),n=this.O.Et();this.kt(),e.forEach((o,r)=>{const l=this.St[r],a=o.At(s),h=o.zt();!t&&a!==null&&o.Vt()&&h!==null?(l.vt=a.Lt,l.ft=a.ft,l.ct=a.Ot,l.ot[0].gt=a.gt,l.ot[0].ut=o.Ft().Nt(a.gt,h.Wt),l.dt=a.Ht??this.O.Ut(l.ot[0].ut/o.Ft().$t()),l.ot[0].wt=s,l.ot[0]._t=n.qt(s),l.lt=Al):l.lt=null})}}class Il extends pt{constructor(t){super(),this.Yt=t}et({context:t,bitmapSize:e,horizontalPixelRatio:s,verticalPixelRatio:n}){if(this.Yt===null)return;const o=this.Yt.jt.Vt,r=this.Yt.Kt.Vt;if(!o&&!r)return;const l=Math.round(this.Yt._t*s),a=Math.round(this.Yt.ut*n);t.lineCap="butt",o&&l>=0&&(t.lineWidth=Math.floor(this.Yt.jt.ct*s),t.strokeStyle=this.Yt.jt.R,t.fillStyle=this.Yt.jt.R,ct(t,this.Yt.jt.Xt),function(h,c,u,f){h.beginPath();const d=h.lineWidth%2?.5:0;h.moveTo(c+d,u),h.lineTo(c+d,f),h.stroke()}(t,l,0,e.height)),r&&a>=0&&(t.lineWidth=Math.floor(this.Yt.Kt.ct*n),t.strokeStyle=this.Yt.Kt.R,t.fillStyle=this.Yt.Kt.R,ct(t,this.Yt.Kt.Xt),vn(t,a,0,e.width))}}class $l{constructor(t,e){this.xt=!0,this.Zt={jt:{ct:1,Xt:0,R:"",Vt:!1},Kt:{ct:1,Xt:0,R:"",Vt:!1},_t:0,ut:0},this.Gt=new Il(this.Zt),this.Jt=t,this.Pt=e}yt(){this.xt=!0}Tt(t){return this.xt&&(this.Rt(),this.xt=!1),this.Gt}Rt(){const t=this.Jt.Vt(),e=this.Pt.Qt().N().crosshair,s=this.Zt;if(e.mode===2)return s.Kt.Vt=!1,void(s.jt.Vt=!1);s.Kt.Vt=t&&this.Jt.ti(this.Pt),s.jt.Vt=t&&this.Jt.ii(),s.Kt.ct=e.horzLine.width,s.Kt.Xt=e.horzLine.style,s.Kt.R=e.horzLine.color,s.jt.ct=e.vertLine.width,s.jt.Xt=e.vertLine.style,s.jt.R=e.vertLine.color,s._t=this.Jt.si(),s.ut=this.Jt.ni()}}function Tl(i,t,e,s,n,o){i.fillRect(t+o,e,s-2*o,o),i.fillRect(t+o,e+n-o,s-2*o,o),i.fillRect(t,e,o,n),i.fillRect(t+s-o,e,o,n)}function vi(i,t,e,s,n,o){i.save(),i.globalCompositeOperation="copy",i.fillStyle=o,i.fillRect(t,e,s,n),i.restore()}function ds(i,t,e,s,n,o){i.beginPath(),i.roundRect?i.roundRect(t,e,s,n,o):(i.lineTo(t+s-o[1],e),o[1]!==0&&i.arcTo(t+s,e,t+s,e+o[1],o[1]),i.lineTo(t+s,e+n-o[2]),o[2]!==0&&i.arcTo(t+s,e+n,t+s-o[2],e+n,o[2]),i.lineTo(t+o[3],e+n),o[3]!==0&&i.arcTo(t,e+n,t,e+n-o[3],o[3]),i.lineTo(t,e+o[0]),o[0]!==0&&i.arcTo(t,e,t+o[0],e,o[0]))}function ps(i,t,e,s,n,o,r=0,l=[0,0,0,0],a=""){if(i.save(),!r||!a||a===o)return ds(i,t,e,s,n,l),i.fillStyle=o,i.fill(),void i.restore();const h=r/2;var c;ds(i,t+h,e+h,s-r,n-r,(c=-h,l.map(u=>u===0?u:u+c))),o!=="transparent"&&(i.fillStyle=o,i.fill()),a!=="transparent"&&(i.lineWidth=r,i.strokeStyle=a,i.closePath(),i.stroke()),i.restore()}function yn(i,t,e,s,n,o,r){i.save(),i.globalCompositeOperation="copy";const l=i.createLinearGradient(0,0,0,n);l.addColorStop(0,o),l.addColorStop(1,r),i.fillStyle=l,i.fillRect(t,e,s,n),i.restore()}class ms{constructor(t,e){this.ht(t,e)}ht(t,e){this.Yt=t,this.ei=e}$t(t,e){return this.Yt.Vt?t.P+t.A+t.V:0}nt(t,e,s,n){if(!this.Yt.Vt||this.Yt.ri.length===0)return;const o=this.Yt.R,r=this.ei.Z,l=t.useBitmapCoordinateSpace(a=>{const h=a.context;h.font=e.k;const c=this.hi(a,e,s,n),u=c.ai;return c.li?ps(h,u.oi,u._i,u.ui,u.ci,r,u.di,[u.ft,0,0,u.ft],r):ps(h,u.fi,u._i,u.ui,u.ci,r,u.di,[0,u.ft,u.ft,0],r),this.Yt.pi&&(h.fillStyle=o,h.fillRect(u.fi,u.mi,u.wi-u.fi,u.gi)),this.Yt.Mi&&(h.fillStyle=e.D,h.fillRect(c.li?u.bi-u.di:0,u._i,u.di,u.Si-u._i)),c});t.useMediaCoordinateSpace(({context:a})=>{const h=l.xi;a.font=e.k,a.textAlign=l.li?"right":"left",a.textBaseline="middle",a.fillStyle=o,a.fillText(this.Yt.ri,h.Ci,(h._i+h.Si)/2+h.Pi)})}hi(t,e,s,n){const{context:o,bitmapSize:r,mediaSize:l,horizontalPixelRatio:a,verticalPixelRatio:h}=t,c=this.Yt.pi||!this.Yt.yi?e.C:0,u=this.Yt.ki?e.S:0,f=e.A+this.ei.Ti,d=e.V+this.ei.Ri,p=e.B,m=e.I,g=this.Yt.ri,v=e.P,w=s.Di(o,g),N=Math.ceil(s.Vi(o,g)),x=v+f+d,M=e.S+p+m+N+c,_=Math.max(1,Math.floor(h));let C=Math.round(x*h);C%2!=_%2&&(C+=1);const A=u>0?Math.max(1,Math.floor(u*a)):0,L=Math.round(M*a),P=Math.round(c*a),R=this.ei.Bi??this.ei.Ii,q=Math.round(R*h)-Math.floor(.5*h),I=Math.floor(q+_/2-C/2),$=I+C,T=n==="right",st=T?l.width-u:u,J=T?r.width-A:A;let Ci,Si,Ai;return T?(Ci=J-L,Si=J-P,Ai=st-c-p-u):(Ci=J+L,Si=J+P,Ai=st+c+p),{li:T,ai:{_i:I,mi:q,Si:$,ui:L,ci:C,ft:2*a,di:A,oi:Ci,fi:J,wi:Si,gi:_,bi:r.width},xi:{_i:I/h,Si:$/h,Ci:Ai,Pi:w}}}}class wi{constructor(t){this.Ei={Ii:0,Z:"#000",Ri:0,Ti:0},this.Ai={ri:"",Vt:!1,pi:!0,yi:!1,Ht:"",R:"#FFF",Mi:!1,ki:!1},this.zi={ri:"",Vt:!1,pi:!1,yi:!0,Ht:"",R:"#FFF",Mi:!0,ki:!0},this.xt=!0,this.Li=new(t||ms)(this.Ai,this.Ei),this.Oi=new(t||ms)(this.zi,this.Ei)}ri(){return this.Ni(),this.Ai.ri}Ii(){return this.Ni(),this.Ei.Ii}yt(){this.xt=!0}$t(t,e=!1){return Math.max(this.Li.$t(t,e),this.Oi.$t(t,e))}Fi(){return this.Ei.Bi||0}Wi(t){this.Ei.Bi=t}Hi(){return this.Ni(),this.Ai.Vt||this.zi.Vt}Ui(){return this.Ni(),this.Ai.Vt}Tt(t){return this.Ni(),this.Ai.pi=this.Ai.pi&&t.N().ticksVisible,this.zi.pi=this.zi.pi&&t.N().ticksVisible,this.Li.ht(this.Ai,this.Ei),this.Oi.ht(this.zi,this.Ei),this.Li}$i(){return this.Ni(),this.Li.ht(this.Ai,this.Ei),this.Oi.ht(this.zi,this.Ei),this.Oi}Ni(){this.xt&&(this.Ai.pi=!0,this.zi.pi=!1,this.qi(this.Ai,this.zi,this.Ei))}}class Ll extends wi{constructor(t,e,s){super(),this.Jt=t,this.Yi=e,this.ji=s}qi(t,e,s){if(t.Vt=!1,this.Jt.N().mode===2)return;const n=this.Jt.N().horzLine;if(!n.labelVisible)return;const o=this.Yi.zt();if(!this.Jt.Vt()||this.Yi.Ki()||o===null)return;const r=this.Yi.Xi().X(n.labelBackgroundColor);s.Z=r.Z,t.R=r.G;const l=2/12*this.Yi.P();s.Ti=l,s.Ri=l;const a=this.ji(this.Yi);s.Ii=a.Ii,t.ri=this.Yi.Zi(a.gt,o),t.Vt=!0}}const El=/[1-9]/g;class Nn{constructor(){this.Yt=null}ht(t){this.Yt=t}nt(t,e){if(this.Yt===null||this.Yt.Vt===!1||this.Yt.ri.length===0)return;const s=t.useMediaCoordinateSpace(({context:f})=>(f.font=e.k,Math.round(e.Gi.Vi(f,S(this.Yt).ri,El))));if(s<=0)return;const n=e.Ji,o=s+2*n,r=o/2,l=this.Yt.Qi;let a=this.Yt.Ii,h=Math.floor(a-r)+.5;h<0?(a+=Math.abs(0-h),h=Math.floor(a-r)+.5):h+o>l&&(a-=Math.abs(l-(h+o)),h=Math.floor(a-r)+.5);const c=h+o,u=Math.ceil(0+e.S+e.C+e.A+e.P+e.V);t.useBitmapCoordinateSpace(({context:f,horizontalPixelRatio:d,verticalPixelRatio:p})=>{const m=S(this.Yt);f.fillStyle=m.Z;const g=Math.round(h*d),v=Math.round(0*p),w=Math.round(c*d),N=Math.round(u*p),x=Math.round(2*d);if(f.beginPath(),f.moveTo(g,v),f.lineTo(g,N-x),f.arcTo(g,N,g+x,N,x),f.lineTo(w-x,N),f.arcTo(w,N,w,N-x,x),f.lineTo(w,v),f.fill(),m.pi){const M=Math.round(m.Ii*d),_=v,C=Math.round((_+e.C)*p);f.fillStyle=m.R;const A=Math.max(1,Math.floor(d)),L=Math.floor(.5*d);f.fillRect(M-L,_,A,C-_)}}),t.useMediaCoordinateSpace(({context:f})=>{const d=S(this.Yt),p=0+e.S+e.C+e.A+e.P/2;f.font=e.k,f.textAlign="left",f.textBaseline="middle",f.fillStyle=d.R;const m=e.Gi.Di(f,"Apr0");f.translate(h+n,p+m),f.fillText(d.ri,0,0)})}}class Vl{constructor(t,e,s){this.xt=!0,this.Gt=new Nn,this.Zt={Vt:!1,Z:"#4c525e",R:"white",ri:"",Qi:0,Ii:NaN,pi:!0},this.Ct=t,this.ts=e,this.ji=s}yt(){this.xt=!0}Tt(){return this.xt&&(this.Rt(),this.xt=!1),this.Gt.ht(this.Zt),this.Gt}Rt(){const t=this.Zt;if(t.Vt=!1,this.Ct.N().mode===2)return;const e=this.Ct.N().vertLine;if(!e.labelVisible)return;const s=this.ts.Et();if(s.Ki())return;t.Qi=s.Qi();const n=this.ji();if(n===null)return;t.Ii=n.Ii;const o=s.ss(this.Ct.It());t.ri=s.ns(S(o)),t.Vt=!0;const r=this.ts.Xi().X(e.labelBackgroundColor);t.Z=r.Z,t.R=r.G,t.pi=s.N().ticksVisible}}class Mn{constructor(){this.es=null,this.rs=0}hs(){return this.rs}ls(t){this.rs=t}Ft(){return this.es}_s(t){this.es=t}us(t){return[]}cs(){return[]}Vt(){return!0}}var gs;(function(i){i[i.Normal=0]="Normal",i[i.Magnet=1]="Magnet",i[i.Hidden=2]="Hidden",i[i.MagnetOHLC=3]="MagnetOHLC"})(gs||(gs={}));class Dl extends Mn{constructor(t,e){super(),this.Pt=null,this.ds=NaN,this.fs=0,this.ps=!1,this.vs=new Map,this.ws=!1,this.gs=new WeakMap,this.Ms=new WeakMap,this.bs=NaN,this.Ss=NaN,this.xs=NaN,this.Cs=NaN,this.ts=t,this.Ps=e,this.ys=((n,o)=>r=>{const l=o(),a=n();if(r===S(this.Pt).ks())return{gt:a,Ii:l};{const h=S(r.zt());return{gt:r.Ts(l,h),Ii:l}}})(()=>this.ds,()=>this.Ss);const s=((n,o)=>()=>{const r=this.ts.Et().Rs(n()),l=o();return r&&Number.isFinite(l)?{wt:r,Ii:l}:null})(()=>this.fs,()=>this.si());this.Ds=new Vl(this,t,s)}N(){return this.Ps}Vs(t,e){this.xs=t,this.Cs=e}Bs(){this.xs=NaN,this.Cs=NaN}Is(){return this.xs}Es(){return this.Cs}As(t,e,s){this.ws||(this.ws=!0),this.ps=!0,this.zs(t,e,s)}It(){return this.fs}si(){return this.bs}ni(){return this.Ss}Vt(){return this.ps}Ls(){this.ps=!1,this.Os(),this.ds=NaN,this.bs=NaN,this.Ss=NaN,this.Pt=null,this.Bs(),this.Ns()}Fs(t){let e=this.gs.get(t);e||(e=new $l(this,t),this.gs.set(t,e));let s=this.Ms.get(t);return s||(s=new Pl(this.ts,this,t),this.Ms.set(t,s)),[e,s]}ti(t){return t===this.Pt&&this.Ps.horzLine.visible}ii(){return this.Ps.vertLine.visible}Ws(t,e){this.ps&&this.Pt===t||this.vs.clear();const s=[];return this.Pt===t&&s.push(this.Hs(this.vs,e,this.ys)),s}cs(){return this.ps?[this.Ds]:[]}Us(){return this.Pt}Ns(){this.ts.$s().forEach(t=>{var e,s;(e=this.gs.get(t))==null||e.yt(),(s=this.Ms.get(t))==null||s.yt()}),this.vs.forEach(t=>t.yt()),this.Ds.yt()}qs(t){return t&&!t.ks().Ki()?t.ks():null}zs(t,e,s){this.Ys(t,e,s)&&this.Ns()}Ys(t,e,s){const n=this.bs,o=this.Ss,r=this.ds,l=this.fs,a=this.Pt,h=this.qs(s);this.fs=t,this.bs=isNaN(t)?NaN:this.ts.Et().qt(t),this.Pt=s;const c=h!==null?h.zt():null;return h!==null&&c!==null?(this.ds=e,this.Ss=h.Nt(e,c)):(this.ds=NaN,this.Ss=NaN),n!==this.bs||o!==this.Ss||l!==this.fs||r!==this.ds||a!==this.Pt}Os(){const t=this.ts.js().map(s=>s.Xs().Ks()).filter(Ml),e=t.length===0?null:Math.max(...t);this.fs=e!==null?e:NaN}Hs(t,e,s){let n=t.get(e);return n===void 0&&(n=new Ll(this,e,s),t.set(e,n)),n}}function yi(i){return i==="left"||i==="right"}class z{constructor(t){this.Zs=new Map,this.Gs=[],this.Js=t}Qs(t,e){const s=function(n,o){return n===void 0?o:{tn:Math.max(n.tn,o.tn),sn:n.sn||o.sn}}(this.Zs.get(t),e);this.Zs.set(t,s)}nn(){return this.Js}en(t){const e=this.Zs.get(t);return e===void 0?{tn:this.Js}:{tn:Math.max(this.Js,e.tn),sn:e.sn}}rn(){this.hn(),this.Gs=[{an:0}]}ln(t){this.hn(),this.Gs=[{an:1,Wt:t}]}_n(t){this.un(),this.Gs.push({an:5,Wt:t})}hn(){this.un(),this.Gs.push({an:6})}cn(){this.hn(),this.Gs=[{an:4}]}dn(t){this.hn(),this.Gs.push({an:2,Wt:t})}fn(t){this.hn(),this.Gs.push({an:3,Wt:t})}pn(){return this.Gs}vn(t){for(const e of t.Gs)this.mn(e);this.Js=Math.max(this.Js,t.Js),t.Zs.forEach((e,s)=>{this.Qs(s,e)})}static wn(){return new z(2)}static gn(){return new z(3)}mn(t){switch(t.an){case 0:this.rn();break;case 1:this.ln(t.Wt);break;case 2:this.dn(t.Wt);break;case 3:this.fn(t.Wt);break;case 4:this.cn();break;case 5:this._n(t.Wt);break;case 6:this.un()}}un(){const t=this.Gs.findIndex(e=>e.an===5);t!==-1&&this.Gs.splice(t,1)}}class bn{formatTickmarks(t){return t.map(e=>this.format(e))}}const vs=".";function tt(i,t){if(!xt(i))return"n/a";if(!Vt(t))throw new TypeError("invalid length");if(t<0||t>16)throw new TypeError("invalid length");return t===0?i.toString():("0000000000000000"+i.toString()).slice(-t)}class Ni extends bn{constructor(t,e){if(super(),e||(e=1),xt(t)&&Vt(t)||(t=100),t<0)throw new TypeError("invalid base");this.Yi=t,this.Mn=e,this.bn()}format(t){const e=t<0?"−":"";return t=Math.abs(t),e+this.Sn(t)}bn(){if(this.xn=0,this.Yi>0&&this.Mn>0){let t=this.Yi;for(;t>1;)t/=10,this.xn++}}Sn(t){const e=this.Yi/this.Mn;let s=Math.floor(t),n="";const o=this.xn!==void 0?this.xn:NaN;if(e>1){let r=+(Math.round(t*e)-s*e).toFixed(this.xn);r>=e&&(r-=e,s+=1),n=vs+tt(+r.toFixed(this.xn)*this.Mn,o)}else s=Math.round(s*e)/e,o>0&&(n=vs+tt(0,o));return s.toFixed(0)+n}}class xn extends Ni{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class Fl extends bn{constructor(t){super(),this.Cn=t}format(t){let e="";return t<0&&(e="-",t=-t),t<995?e+this.Pn(t):t<999995?e+this.Pn(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),e+this.Pn(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),e+this.Pn(t/1e9)+"B")}Pn(t){let e;const s=Math.pow(10,this.Cn);return e=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this.Cn).replace(/\.?0+$/,""):String(t),e.replace(/(\.[1-9]*)0+$/,(n,o)=>o)}}const Rl=/[2-9]/g;class di{constructor(t=50){this.yn=0,this.kn=1,this.Tn=1,this.Rn={},this.Dn=new Map,this.Vn=t}Bn(){this.yn=0,this.Dn.clear(),this.kn=1,this.Tn=1,this.Rn={}}Vi(t,e,s){return this.In(t,e,s).width}Di(t,e,s){const n=this.In(t,e,s);return((n.actualBoundingBoxAscent||0)-(n.actualBoundingBoxDescent||0))/2}In(t,e,s){const n=s||Rl,o=String(e).replace(n,"0");if(this.Dn.has(o))return Y(this.Dn.get(o)).En;if(this.yn===this.Vn){const l=this.Rn[this.Tn];delete this.Rn[this.Tn],this.Dn.delete(l),this.Tn++,this.yn--}t.save(),t.textBaseline="middle";const r=t.measureText(o);return t.restore(),r.width===0&&e.length||(this.Dn.set(o,{En:r,An:this.kn}),this.Rn[this.kn]=o,this.yn++,this.kn++),r}}class kl{constructor(t){this.zn=null,this.M=null,this.Ln="right",this.On=t}Nn(t,e,s){this.zn=t,this.M=e,this.Ln=s}nt(t){this.M!==null&&this.zn!==null&&this.zn.nt(t,this.M,this.On,this.Ln)}}class _n{constructor(t,e,s){this.Fn=t,this.On=new di(50),this.Wn=e,this.O=s,this.F=-1,this.Gt=new kl(this.On)}Tt(){const t=this.O.Hn(this.Wn);if(t===null)return null;const e=t.Un(this.Wn)?t.$n():this.Wn.Ft();if(e===null)return null;const s=t.qn(e);if(s==="overlay")return null;const n=this.O.Yn();return n.P!==this.F&&(this.F=n.P,this.On.Bn()),this.Gt.Nn(this.Fn.$i(),n,s),this.Gt}}class zl extends pt{constructor(){super(...arguments),this.Yt=null}ht(t){this.Yt=t}jn(t,e){var r;if(!((r=this.Yt)!=null&&r.Vt))return null;const{ut:s,ct:n,Kn:o}=this.Yt;return e>=s-n-7&&e<=s+n+7?{Xn:this.Yt,Kn:o}:null}et({context:t,bitmapSize:e,horizontalPixelRatio:s,verticalPixelRatio:n}){if(this.Yt===null||this.Yt.Vt===!1)return;const o=Math.round(this.Yt.ut*n);o<0||o>e.height||(t.lineCap="butt",t.strokeStyle=this.Yt.R,t.lineWidth=Math.floor(this.Yt.ct*s),ct(t,this.Yt.Xt),vn(t,o,0,e.width))}}class ts{constructor(t){this.Zn={ut:0,R:"rgba(0, 0, 0, 0)",ct:1,Xt:0,Vt:!1},this.Gn=new zl,this.xt=!0,this.Jn=t,this.Qn=t.Qt(),this.Gn.ht(this.Zn)}yt(){this.xt=!0}Tt(){return this.Jn.Vt()?(this.xt&&(this.te(),this.xt=!1),this.Gn):null}}class Wl extends ts{constructor(t){super(t)}te(){this.Zn.Vt=!1;const t=this.Jn.Ft(),e=t.ie().ie;if(e!==2&&e!==3)return;const s=this.Jn.N();if(!s.baseLineVisible||!this.Jn.Vt())return;const n=this.Jn.zt();n!==null&&(this.Zn.Vt=!0,this.Zn.ut=t.Nt(n.Wt,n.Wt),this.Zn.R=s.baseLineColor,this.Zn.ct=s.baseLineWidth,this.Zn.Xt=s.baseLineStyle)}}class Ol extends pt{constructor(){super(...arguments),this.Yt=null}ht(t){this.Yt=t}se(){return this.Yt}et({context:t,horizontalPixelRatio:e,verticalPixelRatio:s}){const n=this.Yt;if(n===null)return;const o=Math.max(1,Math.floor(e)),r=o%2/2,l=Math.round(n.ne.x*e)+r,a=n.ne.y*s;t.fillStyle=n.ee,t.beginPath();const h=Math.max(2,1.5*n.re)*e;t.arc(l,a,h,0,2*Math.PI,!1),t.fill(),t.fillStyle=n.he,t.beginPath(),t.arc(l,a,n.ft*e,0,2*Math.PI,!1),t.fill(),t.lineWidth=o,t.strokeStyle=n.ae,t.beginPath(),t.arc(l,a,n.ft*e+o/2,0,2*Math.PI,!1),t.stroke()}}const Bl=[{le:0,oe:.25,_e:4,ue:10,ce:.25,de:0,fe:.4,pe:.8},{le:.25,oe:.525,_e:10,ue:14,ce:0,de:0,fe:.8,pe:0},{le:.525,oe:1,_e:14,ue:14,ce:0,de:0,fe:0,pe:0}];class Yl{constructor(t){this.Gt=new Ol,this.xt=!0,this.ve=!0,this.me=performance.now(),this.we=this.me-1,this.ge=t}Me(){this.we=this.me-1,this.yt()}be(){if(this.yt(),this.ge.N().lastPriceAnimation===2){const t=performance.now(),e=this.we-t;if(e>0)return void(e<650&&(this.we+=2600));this.me=t,this.we=t+2600}}yt(){this.xt=!0}Se(){this.ve=!0}Vt(){return this.ge.N().lastPriceAnimation!==0}xe(){switch(this.ge.N().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.we}}Tt(){return this.xt?(this.Rt(),this.xt=!1,this.ve=!1):this.ve&&(this.Ce(),this.ve=!1),this.Gt}Rt(){this.Gt.ht(null);const t=this.ge.Qt().Et(),e=t.Pe(),s=this.ge.zt();if(e===null||s===null)return;const n=this.ge.ye(!0);if(n.ke||!e.Te(n.Re))return;const o={x:t.qt(n.Re),y:this.ge.Ft().Nt(n.gt,s.Wt)},r=n.R,l=this.ge.N().lineWidth,a=this.De(this.Ve(),r);this.Gt.ht({ee:r,re:l,he:a.he,ae:a.ae,ft:a.ft,ne:o})}Ce(){const t=this.Gt.se();if(t!==null){const e=this.De(this.Ve(),t.ee);t.he=e.he,t.ae=e.ae,t.ft=e.ft}}Ve(){return this.xe()?performance.now()-this.me:2599}Be(t,e,s,n){const o=s+(n-s)*e;return this.ge.Qt().Xi().j(t,o)}De(t,e){const s=t%2600/2600;let n;for(const h of Bl)if(s>=h.le&&s<=h.oe){n=h;break}W(n!==void 0,"Last price animation internal logic error");const o=(s-n.le)/(n.oe-n.le);return{he:this.Be(e,o,n.ce,n.de),ae:this.Be(e,o,n.fe,n.pe),ft:(r=o,l=n._e,a=n.ue,l+(a-l)*r)};var r,l,a}}class jl extends ts{constructor(t){super(t)}te(){const t=this.Zn;t.Vt=!1;const e=this.Jn.N();if(!e.priceLineVisible||!this.Jn.Vt())return;const s=this.Jn.ye(e.priceLineSource===0);s.ke||(t.Vt=!0,t.ut=s.Ii,t.R=this.Jn.Ie(s.R),t.ct=e.priceLineWidth,t.Xt=e.priceLineStyle)}}class ql extends wi{constructor(t){super(),this.Jt=t}qi(t,e,s){t.Vt=!1,e.Vt=!1;const n=this.Jt;if(!n.Vt())return;const o=n.N(),r=o.lastValueVisible,l=n.Ee()!=="",a=o.seriesLastValueMode===0,h=n.ye(!1);if(h.ke)return;r&&(t.ri=this.Ae(h,r,a),t.Vt=t.ri.length!==0),(l||a)&&(e.ri=this.ze(h,r,l,a),e.Vt=e.ri.length>0);const c=n.Ie(h.R),u=this.Jt.Qt().Xi().X(c);s.Z=u.Z,s.Ii=h.Ii,e.Ht=n.Qt().Ut(h.Ii/n.Ft().$t()),t.Ht=c,t.R=u.G,e.R=u.G}ze(t,e,s,n){let o="";const r=this.Jt.Ee();return s&&r.length!==0&&(o+=`${r} `),e&&n&&(o+=this.Jt.Ft().Le()?t.Oe:t.Ne),o.trim()}Ae(t,e,s){return e?s?this.Jt.Ft().Le()?t.Ne:t.Oe:t.ri:""}}function ws(i,t,e,s){const n=Number.isFinite(t),o=Number.isFinite(e);return n&&o?i(t,e):n||o?n?t:e:s}class O{constructor(t,e){this.Fe=t,this.We=e}He(t){return t!==null&&this.Fe===t.Fe&&this.We===t.We}Ue(){return new O(this.Fe,this.We)}$e(){return this.Fe}qe(){return this.We}Ye(){return this.We-this.Fe}Ki(){return this.We===this.Fe||Number.isNaN(this.We)||Number.isNaN(this.Fe)}vn(t){return t===null?this:new O(ws(Math.min,this.$e(),t.$e(),-1/0),ws(Math.max,this.qe(),t.qe(),1/0))}je(t){if(!xt(t)||this.We-this.Fe===0)return;const e=.5*(this.We+this.Fe);let s=this.We-e,n=this.Fe-e;s*=t,n*=t,this.We=e+s,this.Fe=e+n}Ke(t){xt(t)&&(this.We+=t,this.Fe+=t)}Xe(){return{minValue:this.Fe,maxValue:this.We}}static Ze(t){return t===null?null:new O(t.minValue,t.maxValue)}}class pi{constructor(t,e){this.Ge=t,this.Je=e||null}Qe(){return this.Ge}tr(){return this.Je}Xe(){return{priceRange:this.Ge===null?null:this.Ge.Xe(),margins:this.Je||void 0}}static Ze(t){return t===null?null:new pi(O.Ze(t.priceRange),t.margins)}}class Hl extends ts{constructor(t,e){super(t),this.ir=e}te(){const t=this.Zn;t.Vt=!1;const e=this.ir.N();if(!this.Jn.Vt()||!e.lineVisible)return;const s=this.ir.sr();s!==null&&(t.Vt=!0,t.ut=s,t.R=e.color,t.ct=e.lineWidth,t.Xt=e.lineStyle,t.Kn=this.ir.N().id)}}class Ul extends wi{constructor(t,e){super(),this.ge=t,this.ir=e}qi(t,e,s){t.Vt=!1,e.Vt=!1;const n=this.ir.N(),o=n.axisLabelVisible,r=n.title!=="",l=this.ge;if(!o||!l.Vt())return;const a=this.ir.sr();if(a===null)return;r&&(e.ri=n.title,e.Vt=!0),e.Ht=l.Qt().Ut(a/l.Ft().$t()),t.ri=this.nr(n.price),t.Vt=!0;const h=this.ge.Qt().Xi().X(n.axisLabelColor||n.color);s.Z=h.Z;const c=n.axisLabelTextColor||h.G;t.R=c,e.R=c,s.Ii=a}nr(t){const e=this.ge.zt();return e===null?"":this.ge.Ft().Zi(t,e.Wt)}}class Jl{constructor(t,e){this.ge=t,this.Ps=e,this.er=new Hl(t,this),this.Fn=new Ul(t,this),this.rr=new _n(this.Fn,t,t.Qt())}hr(t){H(this.Ps,t),this.yt(),this.ge.Qt().ar()}N(){return this.Ps}lr(){return this.er}_r(){return this.rr}ur(){return this.Fn}yt(){this.er.yt(),this.Fn.yt()}sr(){const t=this.ge,e=t.Ft();if(t.Qt().Et().Ki()||e.Ki())return null;const s=t.zt();return s===null?null:e.Nt(this.Ps.price,s.Wt)}}class Ql extends Mn{constructor(t){super(),this.ts=t}Qt(){return this.ts}}const Gl={Bar:(i,t,e,s)=>{const n=t.upColor,o=t.downColor,r=S(i(e,s)),l=ot(r.Wt[0])<=ot(r.Wt[3]);return{cr:r.R??(l?n:o)}},Candlestick:(i,t,e,s)=>{const n=t.upColor,o=t.downColor,r=t.borderUpColor,l=t.borderDownColor,a=t.wickUpColor,h=t.wickDownColor,c=S(i(e,s)),u=ot(c.Wt[0])<=ot(c.Wt[3]);return{cr:c.R??(u?n:o),dr:c.Ht??(u?r:l),pr:c.vr??(u?a:h)}},Custom:(i,t,e,s)=>({cr:S(i(e,s)).R??t.color}),Area:(i,t,e,s)=>{const n=S(i(e,s));return{cr:n.vt??t.lineColor,vt:n.vt??t.lineColor,mr:n.mr??t.topColor,wr:n.wr??t.bottomColor}},Baseline:(i,t,e,s)=>{const n=S(i(e,s));return{cr:n.Wt[3]>=t.baseValue.price?t.topLineColor:t.bottomLineColor,gr:n.gr??t.topLineColor,Mr:n.Mr??t.bottomLineColor,br:n.br??t.topFillColor1,Sr:n.Sr??t.topFillColor2,Cr:n.Cr??t.bottomFillColor1,Pr:n.Pr??t.bottomFillColor2}},Line:(i,t,e,s)=>{const n=S(i(e,s));return{cr:n.R??t.color,vt:n.R??t.color}},Histogram:(i,t,e,s)=>({cr:S(i(e,s)).R??t.color})};class Kl{constructor(t){this.yr=(e,s)=>s!==void 0?s.Wt:this.ge.Xs().kr(e),this.ge=t,this.Tr=Gl[t.Rr()]}Dr(t,e){return this.Tr(this.yr,this.ge.N(),t,e)}}function Cn(i,t,e,s,n=0,o=t.length){let r=o-n;for(;0<r;){const l=r>>1,a=n+l;s(t[a],e)===i?(n=a+1,r-=l+1):r=l}return n}const _t=Cn.bind(null,!0),Sn=Cn.bind(null,!1);var ys;(function(i){i[i.NearestLeft=-1]="NearestLeft",i[i.None=0]="None",i[i.NearestRight=1]="NearestRight"})(ys||(ys={}));const nt=30;class Zl{constructor(){this.Vr=[],this.Br=new Map,this.Ir=new Map,this.Er=[]}Ar(){return this.zr()>0?this.Vr[this.Vr.length-1]:null}Lr(){return this.zr()>0?this.Or(0):null}Ks(){return this.zr()>0?this.Or(this.Vr.length-1):null}zr(){return this.Vr.length}Ki(){return this.zr()===0}Te(t){return this.Nr(t,0)!==null}kr(t){return this.Fr(t)}Fr(t,e=0){const s=this.Nr(t,e);return s===null?null:{...this.Wr(s),Re:this.Or(s)}}Hr(){return this.Vr}Ur(t,e,s){if(this.Ki())return null;let n=null;for(const o of s)n=Ot(n,this.$r(t,e,o));return n}ht(t){this.Ir.clear(),this.Br.clear(),this.Vr=t,this.Er=t.map(e=>e.Re)}qr(){return this.Er}Or(t){return this.Vr[t].Re}Wr(t){return this.Vr[t]}Nr(t,e){const s=this.Yr(t);if(s===null&&e!==0)switch(e){case-1:return this.jr(t);case 1:return this.Kr(t);default:throw new TypeError("Unknown search mode")}return s}jr(t){let e=this.Xr(t);return e>0&&(e-=1),e!==this.Vr.length&&this.Or(e)<t?e:null}Kr(t){const e=this.Zr(t);return e!==this.Vr.length&&t<this.Or(e)?e:null}Yr(t){const e=this.Xr(t);return e===this.Vr.length||t<this.Vr[e].Re?null:e}Xr(t){return _t(this.Vr,t,(e,s)=>e.Re<s)}Zr(t){return Sn(this.Vr,t,(e,s)=>e.Re>s)}Gr(t,e,s){let n=null;for(let o=t;o<e;o++){const r=this.Vr[o].Wt[s];Number.isNaN(r)||(n===null?n={Jr:r,Qr:r}:(r<n.Jr&&(n.Jr=r),r>n.Qr&&(n.Qr=r)))}return n}$r(t,e,s){if(this.Ki())return null;let n=null;const o=S(this.Lr()),r=S(this.Ks()),l=Math.max(t,o),a=Math.min(e,r),h=Math.ceil(l/nt)*nt,c=Math.max(h,Math.floor(a/nt)*nt);{const f=this.Xr(l),d=this.Zr(Math.min(a,h,e));n=Ot(n,this.Gr(f,d,s))}let u=this.Br.get(s);u===void 0&&(u=new Map,this.Br.set(s,u));for(let f=Math.max(h+1,l);f<c;f+=nt){const d=Math.floor(f/nt);let p=u.get(d);if(p===void 0){const m=this.Xr(d*nt),g=this.Zr((d+1)*nt-1);p=this.Gr(m,g,s),u.set(d,p)}n=Ot(n,p)}{const f=this.Xr(c),d=this.Zr(a);n=Ot(n,this.Gr(f,d,s))}return n}}function Ot(i,t){return i===null?t:t===null?i:{Jr:Math.min(i.Jr,t.Jr),Qr:Math.max(i.Qr,t.Qr)}}const mi={setLineStyle:ct};class Xl{constructor(t){this.th=t}nt(t,e,s){this.th.draw(t,mi)}ih(t,e,s){var n,o;(o=(n=this.th).drawBackground)==null||o.call(n,t,mi)}}class ta{constructor(t){this.Dn=null,this.sh=t}Tt(){var s;const t=this.sh.renderer();if(t===null)return null;if(((s=this.Dn)==null?void 0:s.nh)===t)return this.Dn.eh;const e=new Xl(t);return this.Dn={nh:t,eh:e},e}rh(){var t,e;return((e=(t=this.sh).zOrder)==null?void 0:e.call(t))??"normal"}}class An{constructor(t){this.hh=null,this.ah=t}oh(){return this.ah}Ns(){var t,e;(e=(t=this.ah).updateAllViews)==null||e.call(t)}Fs(){var s,n,o;const t=((n=(s=this.ah).paneViews)==null?void 0:n.call(s))??[];if(((o=this.hh)==null?void 0:o.nh)===t)return this.hh.eh;const e=t.map(r=>new ta(r));return this.hh={nh:t,eh:e},e}jn(t,e){var s,n;return((n=(s=this.ah).hitTest)==null?void 0:n.call(s,t,e))??null}}let ea=class extends An{us(){return[]}};class ia{constructor(t){this.th=t}nt(t,e,s){this.th.draw(t,mi)}ih(t,e,s){var n,o;(o=(n=this.th).drawBackground)==null||o.call(n,t,mi)}}class Ns{constructor(t){this.Dn=null,this.sh=t}Tt(){var s;const t=this.sh.renderer();if(t===null)return null;if(((s=this.Dn)==null?void 0:s.nh)===t)return this.Dn.eh;const e=new ia(t);return this.Dn={nh:t,eh:e},e}rh(){var t,e;return((e=(t=this.sh).zOrder)==null?void 0:e.call(t))??"normal"}}function Pn(i){var t,e,s;return{ri:i.text(),Ii:i.coordinate(),Bi:(t=i.fixedCoordinate)==null?void 0:t.call(i),R:i.textColor(),Z:i.backColor(),Vt:((e=i.visible)==null?void 0:e.call(i))??!0,pi:((s=i.tickVisible)==null?void 0:s.call(i))??!0}}class sa{constructor(t,e){this.Gt=new Nn,this._h=t,this.uh=e}Tt(){return this.Gt.ht({Qi:this.uh.Qi(),...Pn(this._h)}),this.Gt}}class na extends wi{constructor(t,e){super(),this._h=t,this.Yi=e}qi(t,e,s){const n=Pn(this._h);s.Z=n.Z,t.R=n.R;const o=2/12*this.Yi.P();s.Ti=o,s.Ri=o,s.Ii=n.Ii,s.Bi=n.Bi,t.ri=n.ri,t.Vt=n.Vt,t.pi=n.pi}}class oa extends An{constructor(t,e){super(t),this.dh=null,this.fh=null,this.ph=null,this.mh=null,this.ge=e}cs(){var n,o,r;const t=((o=(n=this.ah).timeAxisViews)==null?void 0:o.call(n))??[];if(((r=this.dh)==null?void 0:r.nh)===t)return this.dh.eh;const e=this.ge.Qt().Et(),s=t.map(l=>new sa(l,e));return this.dh={nh:t,eh:s},s}Ws(){var n,o,r;const t=((o=(n=this.ah).priceAxisViews)==null?void 0:o.call(n))??[];if(((r=this.fh)==null?void 0:r.nh)===t)return this.fh.eh;const e=this.ge.Ft(),s=t.map(l=>new na(l,e));return this.fh={nh:t,eh:s},s}wh(){var s,n,o;const t=((n=(s=this.ah).priceAxisPaneViews)==null?void 0:n.call(s))??[];if(((o=this.ph)==null?void 0:o.nh)===t)return this.ph.eh;const e=t.map(r=>new Ns(r));return this.ph={nh:t,eh:e},e}gh(){var s,n,o;const t=((n=(s=this.ah).timeAxisPaneViews)==null?void 0:n.call(s))??[];if(((o=this.mh)==null?void 0:o.nh)===t)return this.mh.eh;const e=t.map(r=>new Ns(r));return this.mh={nh:t,eh:e},e}Mh(t,e){var s,n;return((n=(s=this.ah).autoscaleInfo)==null?void 0:n.call(s,t,e))??null}}function Ii(i,t,e,s){i.forEach(n=>{t(n).forEach(o=>{o.rh()===e&&s.push(o)})})}function $i(i){return i.Fs()}function ra(i){return i.wh()}function la(i){return i.gh()}const aa=["Area","Line","Baseline"];class Mi extends Ql{constructor(t,e,s,n,o){super(t),this.Yt=new Zl,this.er=new jl(this),this.bh=[],this.Sh=new Wl(this),this.xh=null,this.Ch=null,this.Ph=null,this.yh=[],this.Ps=s,this.kh=e;const r=new ql(this);this.vs=[r],this.rr=new _n(r,this,t),aa.includes(this.kh)&&(this.xh=new Yl(this)),this.Th(),this.sh=n(this,this.Qt(),o)}m(){this.Ph!==null&&clearTimeout(this.Ph)}Ie(t){return this.Ps.priceLineColor||t}ye(t){const e={ke:!0},s=this.Ft();if(this.Qt().Et().Ki()||s.Ki()||this.Yt.Ki())return e;const n=this.Qt().Et().Pe(),o=this.zt();if(n===null||o===null)return e;let r,l;if(t){const u=this.Yt.Ar();if(u===null)return e;r=u,l=u.Re}else{const u=this.Yt.Fr(n.bi(),-1);if(u===null||(r=this.Yt.kr(u.Re),r===null))return e;l=u.Re}const a=r.Wt[3],h=this.Rh().Dr(l,{Wt:r}),c=s.Nt(a,o.Wt);return{ke:!1,gt:a,ri:s.Zi(a,o.Wt),Oe:s.Dh(a),Ne:s.Vh(a,o.Wt),R:h.cr,Ii:c,Re:l}}Rh(){return this.Ch!==null||(this.Ch=new Kl(this)),this.Ch}N(){return this.Ps}hr(t){const e=t.priceScaleId;e!==void 0&&e!==this.Ps.priceScaleId&&this.Qt().Bh(this,e),H(this.Ps,t),t.priceFormat!==void 0&&(this.Th(),this.Qt().Ih()),this.Qt().Eh(this),this.Qt().Ah(),this.sh.yt("options")}ht(t,e){this.Yt.ht(t),this.sh.yt("data"),this.xh!==null&&(e&&e.zh?this.xh.be():t.length===0&&this.xh.Me());const s=this.Qt().Hn(this);this.Qt().Lh(s),this.Qt().Eh(this),this.Qt().Ah(),this.Qt().ar()}Oh(t){const e=new Jl(this,t);return this.bh.push(e),this.Qt().Eh(this),e}Nh(t){const e=this.bh.indexOf(t);e!==-1&&this.bh.splice(e,1),this.Qt().Eh(this)}Fh(){return this.bh}Rr(){return this.kh}zt(){const t=this.Wh();return t===null?null:{Wt:t.Wt[3],Hh:t.wt}}Wh(){const t=this.Qt().Et().Pe();if(t===null)return null;const e=t.Uh();return this.Yt.Fr(e,1)}Xs(){return this.Yt}$h(t){const e=this.Yt.kr(t);return e===null?null:this.kh==="Bar"||this.kh==="Candlestick"||this.kh==="Custom"?{qh:e.Wt[0],Yh:e.Wt[1],jh:e.Wt[2],Kh:e.Wt[3]}:e.Wt[3]}Xh(t){const e=[];Ii(this.yh,$i,"top",e);const s=this.xh;return s!==null&&s.Vt()&&(this.Ph===null&&s.xe()&&(this.Ph=setTimeout(()=>{this.Ph=null,this.Qt().Zh()},0)),s.Se(),e.unshift(s)),e}Fs(){const t=[];this.Gh()||t.push(this.Sh),t.push(this.sh,this.er);const e=this.bh.map(s=>s.lr());return t.push(...e),Ii(this.yh,$i,"normal",t),t}Jh(){return this.Qh($i,"bottom")}ta(t){return this.Qh(ra,t)}ia(t){return this.Qh(la,t)}sa(t,e){return this.yh.map(s=>s.jn(t,e)).filter(s=>s!==null)}us(){return[this.rr,...this.bh.map(t=>t._r())]}Ws(t,e){if(e!==this.es&&!this.Gh())return[];const s=[...this.vs];for(const n of this.bh)s.push(n.ur());return this.yh.forEach(n=>{s.push(...n.Ws())}),s}cs(){const t=[];return this.yh.forEach(e=>{t.push(...e.cs())}),t}Mh(t,e){if(this.Ps.autoscaleInfoProvider!==void 0){const s=this.Ps.autoscaleInfoProvider(()=>{const n=this.na(t,e);return n===null?null:n.Xe()});return pi.Ze(s)}return this.na(t,e)}nh(){const t=this.Ps.priceFormat;return t.base??1/t.minMove}ea(){return this.ra}Ns(){var t;this.sh.yt();for(const e of this.vs)e.yt();for(const e of this.bh)e.yt();this.er.yt(),this.Sh.yt(),(t=this.xh)==null||t.yt(),this.yh.forEach(e=>e.Ns())}Ft(){return S(super.Ft())}At(t){if(!((this.kh==="Line"||this.kh==="Area"||this.kh==="Baseline")&&this.Ps.crosshairMarkerVisible))return null;const e=this.Yt.kr(t);return e===null?null:{gt:e.Wt[3],ft:this.ha(),Ht:this.aa(),Ot:this.la(),Lt:this.oa(t)}}Ee(){return this.Ps.title}Vt(){return this.Ps.visible}_a(t){this.yh.push(new oa(t,this))}ua(t){this.yh=this.yh.filter(e=>e.oh()!==t)}ca(){if(this.kh==="Custom")return t=>this.sh.da(t)}fa(){if(this.kh==="Custom")return t=>this.sh.pa(t)}va(){return this.Yt.qr()}Gh(){return!yi(this.Ft().ma())}na(t,e){if(!Vt(t)||!Vt(e)||this.Yt.Ki())return null;const s=this.kh==="Line"||this.kh==="Area"||this.kh==="Baseline"||this.kh==="Histogram"?[3]:[2,1],n=this.Yt.Ur(t,e,s);let o=n!==null?new O(n.Jr,n.Qr):null,r=null;if(this.Rr()==="Histogram"){const l=this.Ps.base,a=new O(l,l);o=o!==null?o.vn(a):a}return this.yh.forEach(l=>{const a=l.Mh(t,e);if(a!=null&&a.priceRange){const h=new O(a.priceRange.minValue,a.priceRange.maxValue);o=o!==null?o.vn(h):h}a!=null&&a.margins&&(r=a.margins)}),new pi(o,r)}ha(){switch(this.kh){case"Line":case"Area":case"Baseline":return this.Ps.crosshairMarkerRadius}return 0}aa(){switch(this.kh){case"Line":case"Area":case"Baseline":{const t=this.Ps.crosshairMarkerBorderColor;if(t.length!==0)return t}}return null}la(){switch(this.kh){case"Line":case"Area":case"Baseline":return this.Ps.crosshairMarkerBorderWidth}return 0}oa(t){switch(this.kh){case"Line":case"Area":case"Baseline":{const e=this.Ps.crosshairMarkerBackgroundColor;if(e.length!==0)return e}}return this.Rh().Dr(t).cr}Th(){switch(this.Ps.priceFormat.type){case"custom":{const t=this.Ps.priceFormat.formatter;this.ra={format:t,formatTickmarks:this.Ps.priceFormat.tickmarksFormatter??(e=>e.map(t))};break}case"volume":this.ra=new Fl(this.Ps.priceFormat.precision);break;case"percent":this.ra=new xn(this.Ps.priceFormat.precision);break;default:{const t=Math.pow(10,this.Ps.priceFormat.precision);this.ra=new Ni(t,this.Ps.priceFormat.minMove*t)}}this.es!==null&&this.es.wa()}Qh(t,e){const s=[];return Ii(this.yh,t,e,s),s}}const ha=[3],ca=[0,1,2,3];class ua{constructor(t){this.Ps=t}ga(t,e,s){let n=t;if(this.Ps.mode===0)return n;const o=s.ks(),r=o.zt();if(r===null)return n;const l=o.Nt(t,r),a=s.Ma().filter(c=>c instanceof Mi).reduce((c,u)=>{if(s.Un(u)||!u.Vt())return c;const f=u.Ft(),d=u.Xs();if(f.Ki()||!d.Te(e))return c;const p=d.kr(e);if(p===null)return c;const m=ot(u.zt()),g=this.Ps.mode===3?ca:ha;return c.concat(g.map(v=>f.Nt(p.Wt[v],m.Wt)))},[]);if(a.length===0)return n;a.sort((c,u)=>Math.abs(c-l)-Math.abs(u-l));const h=a[0];return n=o.Ts(h,r),n}}function It(i,t,e){return Math.min(Math.max(i,t),e)}function Bt(i,t,e){return t-i<=e}class fa extends pt{constructor(){super(...arguments),this.Yt=null}ht(t){this.Yt=t}et({context:t,bitmapSize:e,horizontalPixelRatio:s,verticalPixelRatio:n}){if(this.Yt===null)return;const o=Math.max(1,Math.floor(s));t.lineWidth=o,function(r,l){r.save(),r.lineWidth%2&&r.translate(.5,.5),l(),r.restore()}(t,()=>{const r=S(this.Yt);if(r.ba){t.strokeStyle=r.Sa,ct(t,r.xa),t.beginPath();for(const l of r.Ca){const a=Math.round(l.Pa*s);t.moveTo(a,-o),t.lineTo(a,e.height+o)}t.stroke()}if(r.ya){t.strokeStyle=r.ka,ct(t,r.Ta),t.beginPath();for(const l of r.Ra){const a=Math.round(l.Pa*n);t.moveTo(-o,a),t.lineTo(e.width+o,a)}t.stroke()}})}}class da{constructor(t){this.Gt=new fa,this.xt=!0,this.Pt=t}yt(){this.xt=!0}Tt(){if(this.xt){const t=this.Pt.Qt().N().grid,e={ya:t.horzLines.visible,ba:t.vertLines.visible,ka:t.horzLines.color,Sa:t.vertLines.color,Ta:t.horzLines.style,xa:t.vertLines.style,Ra:this.Pt.ks().Da(),Ca:(this.Pt.Qt().Et().Da()||[]).map(s=>({Pa:s.coord}))};this.Gt.ht(e),this.xt=!1}return this.Gt}}class pa{constructor(t){this.sh=new da(t)}lr(){return this.sh}}const Ti={Va:4,Ba:1e-4};function vt(i,t){const e=100*(i-t)/t;return t<0?-e:e}function ma(i,t){const e=vt(i.$e(),t),s=vt(i.qe(),t);return new O(e,s)}function $t(i,t){const e=100*(i-t)/t+100;return t<0?-e:e}function ga(i,t){const e=$t(i.$e(),t),s=$t(i.qe(),t);return new O(e,s)}function gi(i,t){const e=Math.abs(i);if(e<1e-15)return 0;const s=Math.log10(e+t.Ba)+t.Va;return i<0?-s:s}function Tt(i,t){const e=Math.abs(i);if(e<1e-15)return 0;const s=Math.pow(10,e-t.Va)-t.Ba;return i<0?-s:s}function At(i,t){if(i===null)return null;const e=gi(i.$e(),t),s=gi(i.qe(),t);return new O(e,s)}function wt(i,t){if(i===null)return null;const e=Tt(i.$e(),t),s=Tt(i.qe(),t);return new O(e,s)}function Li(i){if(i===null)return Ti;const t=Math.abs(i.qe()-i.$e());if(t>=1||t<1e-15)return Ti;const e=Math.ceil(Math.abs(Math.log10(t))),s=Ti.Va+e;return{Va:s,Ba:1/Math.pow(10,s)}}class Ei{constructor(t,e){if(this.Ia=t,this.Ea=e,function(s){if(s<0)return!1;if(s>1e18)return!0;for(let n=s;n>1;n/=10)if(n%10!=0)return!1;return!0}(this.Ia))this.Aa=[2,2.5,2];else{this.Aa=[];for(let s=this.Ia;s!==1;){if(s%2==0)this.Aa.push(2),s/=2;else{if(s%5!=0)throw new Error("unexpected base");this.Aa.push(2,2.5),s/=5}if(this.Aa.length>100)throw new Error("something wrong with base")}}}za(t,e,s){const n=this.Ia===0?0:1/this.Ia;let o=Math.pow(10,Math.max(0,Math.ceil(Math.log10(t-e)))),r=0,l=this.Ea[0];for(;;){const u=Bt(o,n,1e-14)&&o>n+1e-14,f=Bt(o,s*l,1e-14),d=Bt(o,1,1e-14);if(!(u&&f&&d))break;o/=l,l=this.Ea[++r%this.Ea.length]}if(o<=n+1e-14&&(o=n),o=Math.max(1,o),this.Aa.length>0&&(a=o,h=1,c=1e-14,Math.abs(a-h)<c))for(r=0,l=this.Aa[0];Bt(o,s*l,1e-14)&&o>n+1e-14;)o/=l,l=this.Aa[++r%this.Aa.length];var a,h,c;return o}}let Ms=class{constructor(t,e,s,n){this.La=[],this.Yi=t,this.Ia=e,this.Oa=s,this.Na=n}za(t,e){if(t<e)throw new Error("high < low");const s=this.Yi.$t(),n=(t-e)*this.Fa()/s,o=new Ei(this.Ia,[2,2.5,2]),r=new Ei(this.Ia,[2,2,2.5]),l=new Ei(this.Ia,[2.5,2,2]),a=[];return a.push(o.za(t,e,n),r.za(t,e,n),l.za(t,e,n)),function(h){if(h.length<1)throw Error("array is empty");let c=h[0];for(let u=1;u<h.length;++u)h[u]<c&&(c=h[u]);return c}(a)}Wa(){const t=this.Yi,e=t.zt();if(e===null)return void(this.La=[]);const s=t.$t(),n=this.Oa(s-1,e),o=this.Oa(0,e),r=this.Yi.N().entireTextOnly?this.Ha()/2:0,l=r,a=s-1-r,h=Math.max(n,o),c=Math.min(n,o);if(h===c)return void(this.La=[]);const u=this.za(h,c);if(this.Ua(e,u,h,c,l,a),t.$a()&&this.qa(u,c,h)){const p=this.Yi.Ya();this.ja(e,u,l,a,p,2*p)}const f=this.La.map(p=>p.Ka),d=this.Yi.Xa(f);for(let p=0;p<this.La.length;p++)this.La[p].Za=d[p]}Da(){return this.La}Ha(){return this.Yi.P()}Fa(){return Math.ceil(2.5*this.Ha())}Ua(t,e,s,n,o,r){const l=this.La,a=this.Yi;let h=s%e;h+=h<0?e:0;const c=s>=n?1:-1;let u=null,f=0;for(let d=s-h;d>n;d-=e){const p=this.Na(d,t,!0);u!==null&&Math.abs(p-u)<this.Fa()||p<o||p>r||(f<l.length?(l[f].Pa=p,l[f].Za=a.Ga(d),l[f].Ka=d):l.push({Pa:p,Za:a.Ga(d),Ka:d}),f++,u=p,a.Ja()&&(e=this.za(d*c,n)))}l.length=f}ja(t,e,s,n,o,r){const l=this.La,a=this.Qa(t,s,o,r),h=this.Qa(t,n,-r,-o),c=this.Na(0,t,!0)-this.Na(e,t,!0);l.length>0&&l[0].Pa-a.Pa<c/2&&l.shift(),l.length>0&&h.Pa-l[l.length-1].Pa<c/2&&l.pop(),l.unshift(a),l.push(h)}Qa(t,e,s,n){const o=(s+n)/2,r=this.Oa(e+s,t),l=this.Oa(e+n,t),a=Math.min(r,l),h=Math.max(r,l),c=Math.max(.1,this.za(h,a)),u=this.Oa(e+o,t),f=u-u%c,d=this.Na(f,t,!0);return{Za:this.Yi.Ga(f),Pa:d,Ka:f}}qa(t,e,s){let n=ot(this.Yi.Qe());return this.Yi.Ja()&&(n=wt(n,this.Yi.tl())),n.$e()-e<t&&s-n.qe()<t}};function In(i){return i.slice().sort((t,e)=>S(t.hs())-S(e.hs()))}var bs;(function(i){i[i.Normal=0]="Normal",i[i.Logarithmic=1]="Logarithmic",i[i.Percentage=2]="Percentage",i[i.IndexedTo100=3]="IndexedTo100"})(bs||(bs={}));const xs=new xn,_s=new Ni(100,1);class va{constructor(t,e,s,n,o){this.il=0,this.sl=null,this.Ge=null,this.nl=null,this.el={rl:!1,hl:null},this.al=!1,this.ll=0,this.ol=0,this._l=new k,this.ul=new k,this.cl=[],this.dl=null,this.fl=null,this.pl=null,this.vl=null,this.ml=null,this.ra=_s,this.wl=Li(null),this.gl=t,this.Ps=e,this.Ml=s,this.bl=n,this.Sl=o,this.xl=new Ms(this,100,this.Cl.bind(this),this.Pl.bind(this))}ma(){return this.gl}N(){return this.Ps}hr(t){if(H(this.Ps,t),this.wa(),t.mode!==void 0&&this.yl({ie:t.mode}),t.scaleMargins!==void 0){const e=Y(t.scaleMargins.top),s=Y(t.scaleMargins.bottom);if(e<0||e>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${e}`);if(s<0||s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(e+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${e+s}`);this.kl(),this.pl=null}}Tl(){return this.Ps.autoScale}Rl(){return this.al}Ja(){return this.Ps.mode===1}Le(){return this.Ps.mode===2}Dl(){return this.Ps.mode===3}tl(){return this.wl}ie(){return{sn:this.Ps.autoScale,Vl:this.Ps.invertScale,ie:this.Ps.mode}}yl(t){const e=this.ie();let s=null;t.sn!==void 0&&(this.Ps.autoScale=t.sn),t.ie!==void 0&&(this.Ps.mode=t.ie,t.ie!==2&&t.ie!==3||(this.Ps.autoScale=!0),this.el.rl=!1),e.ie===1&&t.ie!==e.ie&&(function(o,r){if(o===null)return!1;const l=Tt(o.$e(),r),a=Tt(o.qe(),r);return isFinite(l)&&isFinite(a)}(this.Ge,this.wl)?(s=wt(this.Ge,this.wl),s!==null&&this.Bl(s)):this.Ps.autoScale=!0),t.ie===1&&t.ie!==e.ie&&(s=At(this.Ge,this.wl),s!==null&&this.Bl(s));const n=e.ie!==this.Ps.mode;n&&(e.ie===2||this.Le())&&this.wa(),n&&(e.ie===3||this.Dl())&&this.wa(),t.Vl!==void 0&&e.Vl!==t.Vl&&(this.Ps.invertScale=t.Vl,this.Il()),this.ul.p(e,this.ie())}El(){return this.ul}P(){return this.Ml.fontSize}$t(){return this.il}Al(t){this.il!==t&&(this.il=t,this.kl(),this.pl=null)}zl(){if(this.sl)return this.sl;const t=this.$t()-this.Ll()-this.Ol();return this.sl=t,t}Qe(){return this.Nl(),this.Ge}Bl(t,e){const s=this.Ge;(e||s===null&&t!==null||s!==null&&!s.He(t))&&(this.pl=null,this.Ge=t)}Fl(t){this.Bl(t),this.Wl(t!==null)}Ki(){return this.Nl(),this.il===0||!this.Ge||this.Ge.Ki()}Hl(t){return this.Vl()?t:this.$t()-1-t}Nt(t,e){return this.Le()?t=vt(t,e):this.Dl()&&(t=$t(t,e)),this.Pl(t,e)}Ul(t,e,s){this.Nl();const n=this.Ol(),o=S(this.Qe()),r=o.$e(),l=o.qe(),a=this.zl()-1,h=this.Vl(),c=a/(l-r),u=s===void 0?0:s.from,f=s===void 0?t.length:s.to,d=this.$l();for(let p=u;p<f;p++){const m=t[p],g=m.gt;if(isNaN(g))continue;let v=g;d!==null&&(v=d(m.gt,e));const w=n+c*(v-r),N=h?w:this.il-1-w;m.ut=N}}ql(t,e,s){this.Nl();const n=this.Ol(),o=S(this.Qe()),r=o.$e(),l=o.qe(),a=this.zl()-1,h=this.Vl(),c=a/(l-r),u=s===void 0?0:s.from,f=s===void 0?t.length:s.to,d=this.$l();for(let p=u;p<f;p++){const m=t[p];let g=m.qh,v=m.Yh,w=m.jh,N=m.Kh;d!==null&&(g=d(m.qh,e),v=d(m.Yh,e),w=d(m.jh,e),N=d(m.Kh,e));let x=n+c*(g-r),M=h?x:this.il-1-x;m.Yl=M,x=n+c*(v-r),M=h?x:this.il-1-x,m.jl=M,x=n+c*(w-r),M=h?x:this.il-1-x,m.Kl=M,x=n+c*(N-r),M=h?x:this.il-1-x,m.Xl=M}}Ts(t,e){const s=this.Cl(t,e);return this.Zl(s,e)}Zl(t,e){let s=t;return this.Le()?s=function(n,o){return o<0&&(n=-n),n/100*o+o}(s,e):this.Dl()&&(s=function(n,o){return n-=100,o<0&&(n=-n),n/100*o+o}(s,e)),s}Ma(){return this.cl}Dt(){return this.fl||(this.fl=In(this.cl)),this.fl}Gl(t){this.cl.indexOf(t)===-1&&(this.cl.push(t),this.wa(),this.Jl())}Ql(t){const e=this.cl.indexOf(t);if(e===-1)throw new Error("source is not attached to scale");this.cl.splice(e,1),this.cl.length===0&&(this.yl({sn:!0}),this.Bl(null)),this.wa(),this.Jl()}zt(){let t=null;for(const e of this.cl){const s=e.zt();s!==null&&(t===null||s.Hh<t.Hh)&&(t=s)}return t===null?null:t.Wt}Vl(){return this.Ps.invertScale}Da(){const t=this.zt()===null;if(this.pl!==null&&(t||this.pl.io===t))return this.pl.Da;this.xl.Wa();const e=this.xl.Da();return this.pl={Da:e,io:t},this._l.p(),e}so(){return this._l}no(t){this.Le()||this.Dl()||this.vl===null&&this.nl===null&&(this.Ki()||(this.vl=this.il-t,this.nl=S(this.Qe()).Ue()))}eo(t){if(this.Le()||this.Dl()||this.vl===null)return;this.yl({sn:!1}),(t=this.il-t)<0&&(t=0);let e=(this.vl+.2*(this.il-1))/(t+.2*(this.il-1));const s=S(this.nl).Ue();e=Math.max(e,.1),s.je(e),this.Bl(s)}ro(){this.Le()||this.Dl()||(this.vl=null,this.nl=null)}ho(t){this.Tl()||this.ml===null&&this.nl===null&&(this.Ki()||(this.ml=t,this.nl=S(this.Qe()).Ue()))}ao(t){if(this.Tl()||this.ml===null)return;const e=S(this.Qe()).Ye()/(this.zl()-1);let s=t-this.ml;this.Vl()&&(s*=-1);const n=s*e,o=S(this.nl).Ue();o.Ke(n),this.Bl(o,!0),this.pl=null}lo(){this.Tl()||this.ml!==null&&(this.ml=null,this.nl=null)}ea(){return this.ra||this.wa(),this.ra}Zi(t,e){switch(this.Ps.mode){case 2:return this.oo(vt(t,e));case 3:return this.ea().format($t(t,e));default:return this.nr(t)}}Ga(t){switch(this.Ps.mode){case 2:return this.oo(t);case 3:return this.ea().format(t);default:return this.nr(t)}}Xa(t){switch(this.Ps.mode){case 2:return this._o(t);case 3:return this.ea().formatTickmarks(t);default:return this.uo(t)}}Dh(t){return this.nr(t,S(this.dl).ea())}Vh(t,e){return t=vt(t,e),this.oo(t,xs)}co(){return this.cl}do(t){this.el={hl:t,rl:!1}}Ns(){this.cl.forEach(t=>t.Ns())}$a(){return this.Ps.ensureEdgeTickMarksVisible&&this.Tl()}Ya(){return this.P()/2}wa(){this.pl=null;let t=1/0;this.dl=null;for(const s of this.cl)s.hs()<t&&(t=s.hs(),this.dl=s);let e=100;this.dl!==null&&(e=Math.round(this.dl.nh())),this.ra=_s,this.Le()?(this.ra=xs,e=100):this.Dl()?(this.ra=new Ni(100,1),e=100):this.dl!==null&&(this.ra=this.dl.ea()),this.xl=new Ms(this,e,this.Cl.bind(this),this.Pl.bind(this)),this.xl.Wa()}Jl(){this.fl=null}fo(){return this.dl===null||this.Le()||this.Dl()?1:1/this.dl.nh()}Xi(){return this.Sl}Wl(t){this.al=t}Ll(){return this.Vl()?this.Ps.scaleMargins.bottom*this.$t()+this.ol:this.Ps.scaleMargins.top*this.$t()+this.ll}Ol(){return this.Vl()?this.Ps.scaleMargins.top*this.$t()+this.ll:this.Ps.scaleMargins.bottom*this.$t()+this.ol}Nl(){this.el.rl||(this.el.rl=!0,this.po())}kl(){this.sl=null}Pl(t,e){if(this.Nl(),this.Ki())return 0;t=this.Ja()&&t?gi(t,this.wl):t;const s=S(this.Qe()),n=this.Ol()+(this.zl()-1)*(t-s.$e())/s.Ye();return this.Hl(n)}Cl(t,e){if(this.Nl(),this.Ki())return 0;const s=this.Hl(t),n=S(this.Qe()),o=n.$e()+n.Ye()*((s-this.Ol())/(this.zl()-1));return this.Ja()?Tt(o,this.wl):o}Il(){this.pl=null,this.xl.Wa()}po(){if(this.Rl()&&!this.Tl())return;const t=this.el.hl;if(t===null)return;let e=null;const s=this.co();let n=0,o=0;for(const a of s){if(!a.Vt())continue;const h=a.zt();if(h===null)continue;const c=a.Mh(t.Uh(),t.bi());let u=c&&c.Qe();if(u!==null){switch(this.Ps.mode){case 1:u=At(u,this.wl);break;case 2:u=ma(u,h.Wt);break;case 3:u=ga(u,h.Wt)}if(e=e===null?u:e.vn(S(u)),c!==null){const f=c.tr();f!==null&&(n=Math.max(n,f.above),o=Math.max(o,f.below))}}}if(this.$a()&&(n=Math.max(n,this.Ya()),o=Math.max(o,this.Ya())),n===this.ll&&o===this.ol||(this.ll=n,this.ol=o,this.pl=null,this.kl()),e!==null){if(e.$e()===e.qe()){const a=5*this.fo();this.Ja()&&(e=wt(e,this.wl)),e=new O(e.$e()-a,e.qe()+a),this.Ja()&&(e=At(e,this.wl))}if(this.Ja()){const a=wt(e,this.wl),h=Li(a);if(r=h,l=this.wl,r.Va!==l.Va||r.Ba!==l.Ba){const c=this.nl!==null?wt(this.nl,this.wl):null;this.wl=h,e=At(a,h),c!==null&&(this.nl=At(c,h))}}this.Bl(e)}else this.Ge===null&&(this.Bl(new O(-.5,.5)),this.wl=Li(null));var r,l}$l(){return this.Le()?vt:this.Dl()?$t:this.Ja()?t=>gi(t,this.wl):null}vo(t,e,s){return e===void 0?(s===void 0&&(s=this.ea()),s.format(t)):e(t)}mo(t,e,s){return e===void 0?(s===void 0&&(s=this.ea()),s.formatTickmarks(t)):e(t)}nr(t,e){return this.vo(t,this.bl.priceFormatter,e)}uo(t,e){const s=this.bl.priceFormatter;return this.mo(t,this.bl.tickmarksPriceFormatter??(s?n=>n.map(s):void 0),e)}oo(t,e){return this.vo(t,this.bl.percentageFormatter,e)}_o(t,e){const s=this.bl.percentageFormatter;return this.mo(t,this.bl.tickmarksPercentageFormatter??(s?n=>n.map(s):void 0),e)}}function Cs(i){return i instanceof Mi}class Ss{constructor(t,e){this.cl=[],this.wo=new Map,this.il=0,this.Mo=0,this.bo=1,this.fl=null,this.So=!1,this.xo=new k,this.yh=[],this.uh=t,this.ts=e,this.Co=new pa(this);const s=e.N();this.Po=this.yo("left",s.leftPriceScale),this.ko=this.yo("right",s.rightPriceScale),this.Po.El().i(this.To.bind(this,this.Po),this),this.ko.El().i(this.To.bind(this,this.ko),this),this.Ro(s)}Ro(t){if(t.leftPriceScale&&this.Po.hr(t.leftPriceScale),t.rightPriceScale&&this.ko.hr(t.rightPriceScale),t.localization&&(this.Po.wa(),this.ko.wa()),t.overlayPriceScales){const e=Array.from(this.wo.values());for(const s of e){const n=S(s[0].Ft());n.hr(t.overlayPriceScales),t.localization&&n.wa()}}}Do(t){switch(t){case"left":return this.Po;case"right":return this.ko}return this.wo.has(t)?Y(this.wo.get(t))[0].Ft():null}m(){this.Qt().Vo().u(this),this.Po.El().u(this),this.ko.El().u(this),this.cl.forEach(t=>{t.m&&t.m()}),this.yh=this.yh.filter(t=>{const e=t.oh();return e.detached&&e.detached(),!1}),this.xo.p()}Bo(){return this.bo}Io(t){this.bo=t}Qt(){return this.ts}Qi(){return this.Mo}$t(){return this.il}Eo(t){this.Mo=t,this.Ao()}Al(t){this.il=t,this.Po.Al(t),this.ko.Al(t),this.cl.forEach(e=>{if(this.Un(e)){const s=e.Ft();s!==null&&s.Al(t)}}),this.Ao()}zo(t){this.So=t}Lo(){return this.So}Oo(){return this.cl.filter(Cs)}Ma(){return this.cl}Un(t){const e=t.Ft();return e===null||this.Po!==e&&this.ko!==e}Gl(t,e,s){this.No(t,e,s?t.hs():this.cl.length)}Ql(t,e){const s=this.cl.indexOf(t);W(s!==-1,"removeDataSource: invalid data source"),this.cl.splice(s,1),e||this.cl.forEach((r,l)=>r.ls(l));const n=S(t.Ft()).ma();if(this.wo.has(n)){const r=Y(this.wo.get(n)),l=r.indexOf(t);l!==-1&&(r.splice(l,1),r.length===0&&this.wo.delete(n))}const o=t.Ft();o&&o.Ma().indexOf(t)>=0&&(o.Ql(t),this.Fo(o)),this.fl=null}qn(t){return t===this.Po?"left":t===this.ko?"right":"overlay"}Wo(){return this.Po}Ho(){return this.ko}Uo(t,e){t.no(e)}$o(t,e){t.eo(e),this.Ao()}qo(t){t.ro()}Yo(t,e){t.ho(e)}jo(t,e){t.ao(e),this.Ao()}Ko(t){t.lo()}Ao(){this.cl.forEach(t=>{t.Ns()})}ks(){let t=null;return this.ts.N().rightPriceScale.visible&&this.ko.Ma().length!==0?t=this.ko:this.ts.N().leftPriceScale.visible&&this.Po.Ma().length!==0?t=this.Po:this.cl.length!==0&&(t=this.cl[0].Ft()),t===null&&(t=this.ko),t}$n(){let t=null;return this.ts.N().rightPriceScale.visible?t=this.ko:this.ts.N().leftPriceScale.visible&&(t=this.Po),t}Fo(t){t!==null&&t.Tl()&&this.Xo(t)}Zo(t){const e=this.uh.Pe();t.yl({sn:!0}),e!==null&&t.do(e),this.Ao()}Go(){this.Xo(this.Po),this.Xo(this.ko)}Jo(){this.Fo(this.Po),this.Fo(this.ko),this.cl.forEach(t=>{this.Un(t)&&this.Fo(t.Ft())}),this.Ao(),this.ts.ar()}Dt(){return this.fl===null&&(this.fl=In(this.cl)),this.fl}Qo(t,e){e=It(e,0,this.cl.length-1);const s=this.cl.indexOf(t);W(s!==-1,"setSeriesOrder: invalid data source"),this.cl.splice(s,1),this.cl.splice(e,0,t),this.cl.forEach((n,o)=>n.ls(o)),this.fl=null;for(const n of[this.Po,this.ko])n.Jl(),n.wa();this.ts.ar()}Bt(){return this.Dt().filter(Cs)}t_(){return this.xo}i_(){return this.Co}_a(t){this.yh.push(new ea(t))}ua(t){this.yh=this.yh.filter(e=>e.oh()!==t),t.detached&&t.detached(),this.ts.ar()}s_(){return this.yh}sa(t,e){return this.yh.map(s=>s.jn(t,e)).filter(s=>s!==null)}Xo(t){const e=t.co();if(e&&e.length>0&&!this.uh.Ki()){const s=this.uh.Pe();s!==null&&t.do(s)}t.Ns()}No(t,e,s){let n=this.Do(e);if(n===null&&(n=this.yo(e,this.ts.N().overlayPriceScales)),this.cl.splice(s,0,t),!yi(e)){const o=this.wo.get(e)||[];o.push(t),this.wo.set(e,o)}t.ls(s),n.Gl(t),t._s(n),this.Fo(n),this.fl=null}To(t,e,s){e.ie!==s.ie&&this.Xo(t)}yo(t,e){const s={visible:!0,autoScale:!0,...X(e)},n=new va(t,s,this.ts.N().layout,this.ts.N().localization,this.ts.Xi());return n.Al(this.$t()),n}}function Yt(i){return{n_:i.n_,e_:{Kn:i.r_.externalId},h_:i.r_.cursorStyle}}function wa(i,t,e,s){for(const n of i){const o=n.Tt(s);if(o!==null&&o.jn){const r=o.jn(t,e);if(r!==null)return{a_:n,e_:r}}}return null}function ya(i){return i.Fs!==void 0}function $n(i,t,e){const s=[i,...i.Dt()],n=function(o,r,l){var f;let a,h;for(const d of o){const p=((f=d.sa)==null?void 0:f.call(d,r,l))??[];for(const m of p)c=m.zOrder,u=a==null?void 0:a.zOrder,(!u||c==="top"&&u!=="top"||c==="normal"&&u==="bottom")&&(a=m,h=d)}var c,u;return a&&h?{r_:a,n_:h}:null}(s,t,e);if((n==null?void 0:n.r_.zOrder)==="top")return Yt(n);for(const o of s){if(n&&n.n_===o&&n.r_.zOrder!=="bottom"&&!n.r_.isBackground)return Yt(n);if(ya(o)){const r=wa(o.Fs(i),t,e,i);if(r!==null)return{n_:o,a_:r.a_,e_:r.e_}}if(n&&n.n_===o&&n.r_.zOrder!=="bottom"&&n.r_.isBackground)return Yt(n)}return n!=null&&n.r_?Yt(n):null}class Na{constructor(t,e,s=50){this.yn=0,this.kn=1,this.Tn=1,this.Dn=new Map,this.Rn=new Map,this.l_=t,this.o_=e,this.Vn=s}__(t){const e=t.time,s=this.o_.cacheKey(e),n=this.Dn.get(s);if(n!==void 0)return n.u_;if(this.yn===this.Vn){const r=this.Rn.get(this.Tn);this.Rn.delete(this.Tn),this.Dn.delete(Y(r)),this.Tn++,this.yn--}const o=this.l_(t);return this.Dn.set(s,{u_:o,An:this.kn}),this.Rn.set(this.kn,s),this.yn++,this.kn++,o}}class Lt{constructor(t,e){W(t<=e,"right should be >= left"),this.c_=t,this.d_=e}Uh(){return this.c_}bi(){return this.d_}f_(){return this.d_-this.c_+1}Te(t){return this.c_<=t&&t<=this.d_}He(t){return this.c_===t.Uh()&&this.d_===t.bi()}}function As(i,t){return i===null||t===null?i===t:i.He(t)}class Ma{constructor(){this.p_=new Map,this.Dn=null,this.v_=!1}m_(t){this.v_=t,this.Dn=null}w_(t,e){this.g_(e),this.Dn=null;for(let s=e;s<t.length;++s){const n=t[s];let o=this.p_.get(n.timeWeight);o===void 0&&(o=[],this.p_.set(n.timeWeight,o)),o.push({index:s,time:n.time,weight:n.timeWeight,originalTime:n.originalTime})}}M_(t,e,s,n,o){const r=Math.ceil(e/t);return this.Dn!==null&&this.Dn.b_===r&&o===this.Dn.S_&&s===this.Dn.x_||(this.Dn={S_:o,x_:s,Da:this.C_(r,s,n),b_:r}),this.Dn.Da}g_(t){if(t===0)return void this.p_.clear();const e=[];this.p_.forEach((s,n)=>{t<=s[0].index?e.push(n):s.splice(_t(s,t,o=>o.index<t),1/0)});for(const s of e)this.p_.delete(s)}C_(t,e,s){let n=[];const o=r=>!e||s.has(r.index);for(const r of Array.from(this.p_.keys()).sort((l,a)=>a-l)){if(!this.p_.get(r))continue;const l=n;n=[];const a=l.length;let h=0;const c=Y(this.p_.get(r)),u=c.length;let f=1/0,d=-1/0;for(let p=0;p<u;p++){const m=c[p],g=m.index;for(;h<a;){const v=l[h],w=v.index;if(!(w<g&&o(v))){f=w;break}h++,n.push(v),d=w,f=1/0}if(f-g>=t&&g-d>=t&&o(m))n.push(m),d=g;else if(this.v_)return l}for(;h<a;h++)o(l[h])&&n.push(l[h])}return n}}class Nt{constructor(t){this.P_=t}y_(){return this.P_===null?null:new Lt(Math.floor(this.P_.Uh()),Math.ceil(this.P_.bi()))}k_(){return this.P_}static T_(){return new Nt(null)}}function ba(i,t){return i.weight>t.weight?i:t}class xa{constructor(t,e,s,n){this.Mo=0,this.R_=null,this.D_=[],this.ml=null,this.vl=null,this.V_=new Ma,this.B_=new Map,this.I_=Nt.T_(),this.E_=!0,this.A_=new k,this.z_=new k,this.L_=new k,this.O_=null,this.N_=null,this.F_=new Map,this.W_=-1,this.H_=[],this.Ps=e,this.bl=s,this.U_=e.rightOffset,this.q_=e.barSpacing,this.ts=t,this.Y_(e),this.o_=n,this.j_(),this.V_.m_(e.uniformDistribution),this.K_()}N(){return this.Ps}X_(t){H(this.bl,t),this.Z_(),this.j_()}hr(t,e){H(this.Ps,t),this.Ps.fixLeftEdge&&this.G_(),this.Ps.fixRightEdge&&this.J_(),t.barSpacing!==void 0&&this.ts.dn(t.barSpacing),t.rightOffset!==void 0&&this.ts.fn(t.rightOffset),this.Y_(t),t.minBarSpacing===void 0&&t.maxBarSpacing===void 0||this.ts.dn(t.barSpacing??this.q_),t.ignoreWhitespaceIndices!==void 0&&t.ignoreWhitespaceIndices!==this.Ps.ignoreWhitespaceIndices&&this.K_(),this.Z_(),this.j_(),this.L_.p()}Rs(t){var e;return((e=this.D_[t])==null?void 0:e.time)??null}ss(t){return this.D_[t]??null}Q_(t,e){if(this.D_.length<1)return null;if(this.o_.key(t)>this.o_.key(this.D_[this.D_.length-1].time))return e?this.D_.length-1:null;const s=_t(this.D_,this.o_.key(t),(n,o)=>this.o_.key(n.time)<o);return this.o_.key(t)<this.o_.key(this.D_[s].time)?e?s:null:s}Ki(){return this.Mo===0||this.D_.length===0||this.R_===null}tu(){return this.D_.length>0}Pe(){return this.iu(),this.I_.y_()}su(){return this.iu(),this.I_.k_()}nu(){const t=this.Pe();if(t===null)return null;const e={from:t.Uh(),to:t.bi()};return this.eu(e)}eu(t){const e=Math.round(t.from),s=Math.round(t.to),n=S(this.ru()),o=S(this.hu());return{from:S(this.ss(Math.max(n,e))),to:S(this.ss(Math.min(o,s)))}}au(t){return{from:S(this.Q_(t.from,!0)),to:S(this.Q_(t.to,!0))}}Qi(){return this.Mo}Eo(t){if(!isFinite(t)||t<=0||this.Mo===t)return;const e=this.su(),s=this.Mo;if(this.Mo=t,this.E_=!0,this.Ps.lockVisibleTimeRangeOnResize&&s!==0){const n=this.q_*t/s;this.q_=n}if(this.Ps.fixLeftEdge&&e!==null&&e.Uh()<=0){const n=s-t;this.U_-=Math.round(n/this.q_)+1,this.E_=!0}this.lu(),this.ou()}qt(t){if(this.Ki()||!Vt(t))return 0;const e=this._u()+this.U_-t;return this.Mo-(e+.5)*this.q_-1}uu(t,e){const s=this._u(),n=e===void 0?0:e.from,o=e===void 0?t.length:e.to;for(let r=n;r<o;r++){const l=t[r].wt,a=s+this.U_-l,h=this.Mo-(a+.5)*this.q_-1;t[r]._t=h}}cu(t,e){const s=Math.ceil(this.du(t));return e&&this.Ps.ignoreWhitespaceIndices&&!this.fu(s)?this.pu(s):s}fn(t){this.E_=!0,this.U_=t,this.ou(),this.ts.vu(),this.ts.ar()}mu(){return this.q_}dn(t){const e=this.q_;if(this.wu(t),this.Ps.rightOffsetPixels!==void 0&&e!==0){const s=this.U_*e/this.q_;this.U_=s}this.ou(),this.ts.vu(),this.ts.ar()}gu(){return this.U_}Da(){if(this.Ki())return null;if(this.N_!==null)return this.N_;const t=this.q_,e=5*(this.ts.N().layout.fontSize+4)/8*(this.Ps.tickMarkMaxCharacterLength||8),s=Math.round(e/t),n=S(this.Pe()),o=Math.max(n.Uh(),n.Uh()-s),r=Math.max(n.bi(),n.bi()-s),l=this.V_.M_(t,e,this.Ps.ignoreWhitespaceIndices,this.F_,this.W_),a=this.ru()+s,h=this.hu()-s,c=this.Mu(),u=this.Ps.fixLeftEdge||c,f=this.Ps.fixRightEdge||c;let d=0;for(const p of l){if(!(o<=p.index&&p.index<=r))continue;let m;d<this.H_.length?(m=this.H_[d],m.coord=this.qt(p.index),m.label=this.bu(p),m.weight=p.weight):(m={needAlignCoordinate:!1,coord:this.qt(p.index),label:this.bu(p),weight:p.weight},this.H_.push(m)),this.q_>e/2&&!c?m.needAlignCoordinate=!1:m.needAlignCoordinate=u&&p.index<=a||f&&p.index>=h,d++}return this.H_.length=d,this.N_=this.H_,this.H_}Su(){let t;this.E_=!0,this.dn(this.Ps.barSpacing),t=this.Ps.rightOffsetPixels!==void 0?this.Ps.rightOffsetPixels/this.mu():this.Ps.rightOffset,this.fn(t)}xu(t){this.E_=!0,this.R_=t,this.ou(),this.G_()}Cu(t,e){const s=this.du(t),n=this.mu(),o=n+e*(n/10);this.dn(o),this.Ps.rightBarStaysOnScroll||this.fn(this.gu()+(s-this.du(t)))}no(t){this.ml&&this.lo(),this.vl===null&&this.O_===null&&(this.Ki()||(this.vl=t,this.Pu()))}eo(t){if(this.O_===null)return;const e=It(this.Mo-t,0,this.Mo),s=It(this.Mo-S(this.vl),0,this.Mo);e!==0&&s!==0&&this.dn(this.O_.mu*e/s)}ro(){this.vl!==null&&(this.vl=null,this.yu())}ho(t){this.ml===null&&this.O_===null&&(this.Ki()||(this.ml=t,this.Pu()))}ao(t){if(this.ml===null)return;const e=(this.ml-t)/this.mu();this.U_=S(this.O_).gu+e,this.E_=!0,this.ou()}lo(){this.ml!==null&&(this.ml=null,this.yu())}ku(){this.Tu(this.Ps.rightOffset)}Tu(t,e=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(e)||e<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.U_,n=performance.now();this.ts._n({Ru:o=>(o-n)/e>=1,Du:o=>{const r=(o-n)/e;return r>=1?t:s+(t-s)*r}})}yt(t,e){this.E_=!0,this.D_=t,this.V_.w_(t,e),this.ou()}Vu(){return this.A_}Bu(){return this.z_}Iu(){return this.L_}_u(){return this.R_||0}Eu(t,e){const s=t.f_(),n=e&&this.Ps.rightOffsetPixels||0;this.wu((this.Mo-n)/s),this.U_=t.bi()-this._u(),e&&(this.U_=n?n/this.mu():this.Ps.rightOffset),this.ou(),this.E_=!0,this.ts.vu(),this.ts.ar()}Au(){const t=this.ru(),e=this.hu();t!==null&&e!==null&&this.Eu(new Lt(t,e),!0)}zu(t){const e=new Lt(t.from,t.to);this.Eu(e)}ns(t){return this.bl.timeFormatter!==void 0?this.bl.timeFormatter(t.originalTime):this.o_.formatHorzItem(t.time)}K_(){if(!this.Ps.ignoreWhitespaceIndices)return;this.F_.clear();const t=this.ts.js();for(const e of t)for(const s of e.va())this.F_.set(s,!0);this.W_++}Mu(){const t=this.ts.N().handleScroll,e=this.ts.N().handleScale;return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||e.axisDoubleClickReset.time||e.axisPressedMouseMove.time||e.mouseWheel||e.pinch)}ru(){return this.D_.length===0?null:0}hu(){return this.D_.length===0?null:this.D_.length-1}Lu(t){return(this.Mo-1-t)/this.q_}du(t){const e=this.Lu(t),s=this._u()+this.U_-e;return Math.round(1e6*s)/1e6}wu(t){const e=this.q_;this.q_=t,this.lu(),e!==this.q_&&(this.E_=!0,this.Ou())}iu(){if(!this.E_)return;if(this.E_=!1,this.Ki())return void this.Nu(Nt.T_());const t=this._u(),e=this.Mo/this.q_,s=this.U_+t,n=new Lt(s-e+1,s);this.Nu(new Nt(n))}lu(){const t=It(this.q_,this.Fu(),this.Wu());this.q_!==t&&(this.q_=t,this.E_=!0)}Wu(){return this.Ps.maxBarSpacing>0?this.Ps.maxBarSpacing:.5*this.Mo}Fu(){return this.Ps.fixLeftEdge&&this.Ps.fixRightEdge&&this.D_.length!==0?this.Mo/this.D_.length:this.Ps.minBarSpacing}ou(){const t=this.Hu();t!==null&&this.U_<t&&(this.U_=t,this.E_=!0);const e=this.Uu();this.U_>e&&(this.U_=e,this.E_=!0)}Hu(){const t=this.ru(),e=this.R_;return t===null||e===null?null:t-e-1+(this.Ps.fixLeftEdge?this.Mo/this.q_:Math.min(2,this.D_.length))}Uu(){return this.Ps.fixRightEdge?0:this.Mo/this.q_-Math.min(2,this.D_.length)}Pu(){this.O_={mu:this.mu(),gu:this.gu()}}yu(){this.O_=null}bu(t){let e=this.B_.get(t.weight);return e===void 0&&(e=new Na(s=>this.$u(s),this.o_),this.B_.set(t.weight,e)),e.__(t)}$u(t){return this.o_.formatTickmark(t,this.bl)}Nu(t){const e=this.I_;this.I_=t,As(e.y_(),this.I_.y_())||this.A_.p(),As(e.k_(),this.I_.k_())||this.z_.p(),this.Ou()}Ou(){this.N_=null}Z_(){this.Ou(),this.B_.clear()}j_(){this.o_.updateFormatter(this.bl)}G_(){if(!this.Ps.fixLeftEdge)return;const t=this.ru();if(t===null)return;const e=this.Pe();if(e===null)return;const s=e.Uh()-t;if(s<0){const n=this.U_-s-1;this.fn(n)}this.lu()}J_(){this.ou(),this.lu()}fu(t){return!this.Ps.ignoreWhitespaceIndices||this.F_.get(t)||!1}pu(t){const e=function*(n){const o=Math.round(n),r=o<n;let l=1;for(;;)r?(yield o+l,yield o-l):(yield o-l,yield o+l),l++}(t),s=this.hu();for(;s;){const n=e.next().value;if(this.F_.get(n))return n;if(n<0||n>s)break}return t}Y_(t){if(t.rightOffsetPixels!==void 0){const e=t.rightOffsetPixels/(t.barSpacing||this.q_);this.ts.fn(e)}}}var Ps,Is,$s,Qi,Ts;(function(i){i[i.OnTouchEnd=0]="OnTouchEnd",i[i.OnNextTap=1]="OnNextTap"})(Ps||(Ps={}));class _a{constructor(t,e,s){this.qu=[],this.Yu=[],this.Mo=0,this.ju=null,this.Ku=new k,this.Xu=new k,this.Zu=null,this.Gu=t,this.Ps=e,this.o_=s,this.Sl=new xl(this.Ps.layout.colorParsers),this.Ju=new bl(this),this.uh=new xa(this,e.timeScale,this.Ps.localization,s),this.Ct=new Dl(this,e.crosshair),this.Qu=new ua(e.crosshair),e.addDefaultPane&&(this.tc(0),this.qu[0].Io(2)),this.sc=this.nc(0),this.ec=this.nc(1)}Ih(){this.rc(z.gn())}ar(){this.rc(z.wn())}Zh(){this.rc(new z(1))}Eh(t){const e=this.hc(t);this.rc(e)}ac(){return this.ju}lc(t){var s,n,o,r;if(((s=this.ju)==null?void 0:s.n_)===(t==null?void 0:t.n_)&&((o=(n=this.ju)==null?void 0:n.e_)==null?void 0:o.Kn)===((r=t==null?void 0:t.e_)==null?void 0:r.Kn))return;const e=this.ju;this.ju=t,e!==null&&this.Eh(e.n_),t!==null&&t.n_!==(e==null?void 0:e.n_)&&this.Eh(t.n_)}N(){return this.Ps}hr(t){H(this.Ps,t),this.qu.forEach(e=>e.Ro(t)),t.timeScale!==void 0&&this.uh.hr(t.timeScale),t.localization!==void 0&&this.uh.X_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Ku.p(),this.sc=this.nc(0),this.ec=this.nc(1),this.Ih()}oc(t,e,s=0){const n=this.qu[s];if(n===void 0)return;if(t==="left")return H(this.Ps,{leftPriceScale:e}),n.Ro({leftPriceScale:e}),this.Ku.p(),void this.Ih();if(t==="right")return H(this.Ps,{rightPriceScale:e}),n.Ro({rightPriceScale:e}),this.Ku.p(),void this.Ih();const o=this._c(t,s);o!==null&&(o.Ft.hr(e),this.Ku.p())}_c(t,e){const s=this.qu[e];if(s===void 0)return null;const n=s.Do(t);return n!==null?{Us:s,Ft:n}:null}Et(){return this.uh}$s(){return this.qu}uc(){return this.Ct}cc(){return this.Xu}dc(t,e){t.Al(e),this.vu()}Eo(t){this.Mo=t,this.uh.Eo(this.Mo),this.qu.forEach(e=>e.Eo(t)),this.vu()}fc(t){this.qu.length!==1&&(W(t>=0&&t<this.qu.length,"Invalid pane index"),this.qu.splice(t,1),this.Ih())}vc(t,e){if(this.qu.length<2)return;W(t>=0&&t<this.qu.length,"Invalid pane index");const s=this.qu[t],n=this.qu.reduce((u,f)=>u+f.Bo(),0),o=this.qu.reduce((u,f)=>u+f.$t(),0),r=o-30*(this.qu.length-1);e=Math.min(r,Math.max(30,e));const l=n/o,a=s.$t();s.Io(e*l);let h=e-a,c=this.qu.length-1;for(const u of this.qu)if(u!==s){const f=Math.min(r,Math.max(30,u.$t()-h/c));h-=u.$t()-f,c-=1;const d=f*l;u.Io(d)}this.Ih()}mc(t,e){W(t>=0&&t<this.qu.length&&e>=0&&e<this.qu.length,"Invalid pane index");const s=this.qu[t],n=this.qu[e];this.qu[t]=n,this.qu[e]=s,this.Ih()}wc(t,e){if(W(t>=0&&t<this.qu.length&&e>=0&&e<this.qu.length,"Invalid pane index"),t===e)return;const[s]=this.qu.splice(t,1);this.qu.splice(e,0,s),this.Ih()}Uo(t,e,s){t.Uo(e,s)}$o(t,e,s){t.$o(e,s),this.Ah(),this.rc(this.gc(t,2))}qo(t,e){t.qo(e),this.rc(this.gc(t,2))}Yo(t,e,s){e.Tl()||t.Yo(e,s)}jo(t,e,s){e.Tl()||(t.jo(e,s),this.Ah(),this.rc(this.gc(t,2)))}Ko(t,e){e.Tl()||(t.Ko(e),this.rc(this.gc(t,2)))}Zo(t,e){t.Zo(e),this.rc(this.gc(t,2))}Mc(t){this.uh.no(t)}bc(t,e){const s=this.Et();if(s.Ki()||e===0)return;const n=s.Qi();t=Math.max(1,Math.min(t,n)),s.Cu(t,e),this.vu()}Sc(t){this.xc(0),this.Cc(t),this.Pc()}yc(t){this.uh.eo(t),this.vu()}kc(){this.uh.ro(),this.ar()}xc(t){this.uh.ho(t)}Cc(t){this.uh.ao(t),this.vu()}Pc(){this.uh.lo(),this.ar()}js(){return this.Yu}Tc(t,e,s,n,o){this.Ct.Vs(t,e);let r=NaN,l=this.uh.cu(t,!0);const a=this.uh.Pe();a!==null&&(l=Math.min(Math.max(a.Uh(),l),a.bi()));const h=n.ks(),c=h.zt();if(c!==null&&(r=h.Ts(e,c)),r=this.Qu.ga(r,l,n),this.Ct.As(l,r,n),this.Zh(),!o){const u=$n(n,t,e);this.lc(u&&{n_:u.n_,e_:u.e_,h_:u.h_||null}),this.Xu.p(this.Ct.It(),{x:t,y:e},s)}}Rc(t,e,s){const n=s.ks(),o=n.zt(),r=n.Nt(t,S(o)),l=this.uh.Q_(e,!0),a=this.uh.qt(S(l));this.Tc(a,r,null,s,!0)}Dc(t){this.uc().Ls(),this.Zh(),t||this.Xu.p(null,null,null)}Ah(){const t=this.Ct.Us();if(t!==null){const e=this.Ct.Is(),s=this.Ct.Es();this.Tc(e,s,null,t)}this.Ct.Ns()}Vc(t,e,s){const n=this.uh.Rs(0);e!==void 0&&s!==void 0&&this.uh.yt(e,s);const o=this.uh.Rs(0),r=this.uh._u(),l=this.uh.Pe();if(l!==null&&n!==null&&o!==null){const a=l.Te(r),h=this.o_.key(n)>this.o_.key(o),c=t!==null&&t>r&&!h,u=this.uh.N().allowShiftVisibleRangeOnWhitespaceReplacement,f=a&&(s!==void 0||u)&&this.uh.N().shiftVisibleRangeOnNewBar;if(c&&!f){const d=t-r;this.uh.fn(this.uh.gu()-d)}}this.uh.xu(t)}Lh(t){t!==null&&t.Jo()}Hn(t){if(function(s){return s instanceof Ss}(t))return t;const e=this.qu.find(s=>s.Dt().includes(t));return e===void 0?null:e}vu(){this.qu.forEach(t=>t.Jo()),this.Ah()}m(){this.qu.forEach(t=>t.m()),this.qu.length=0,this.Ps.localization.priceFormatter=void 0,this.Ps.localization.percentageFormatter=void 0,this.Ps.localization.timeFormatter=void 0}Bc(){return this.Ju}Yn(){return this.Ju.N()}Vo(){return this.Ku}Ic(t,e){const s=this.tc(e);this.Ec(t,s),this.Yu.push(t),this.Yu.length===1?this.Ih():this.ar()}Ac(t){const e=this.Hn(t),s=this.Yu.indexOf(t);W(s!==-1,"Series not found");const n=S(e);this.Yu.splice(s,1),n.Ql(t),t.m&&t.m(),this.uh.K_(),this.zc(n)}Bh(t,e){const s=S(this.Hn(t));s.Ql(t,!0),s.Gl(t,e,!0)}Au(){const t=z.wn();t.rn(),this.rc(t)}Lc(t){const e=z.wn();e.ln(t),this.rc(e)}cn(){const t=z.wn();t.cn(),this.rc(t)}dn(t){const e=z.wn();e.dn(t),this.rc(e)}fn(t){const e=z.wn();e.fn(t),this.rc(e)}_n(t){const e=z.wn();e._n(t),this.rc(e)}hn(){const t=z.wn();t.hn(),this.rc(t)}Oc(){return this.Ps.rightPriceScale.visible?"right":"left"}Nc(t,e){if(W(e>=0,"Index should be greater or equal to 0"),e===this.Fc(t))return;const s=S(this.Hn(t));s.Ql(t);const n=this.tc(e);this.Ec(t,n),s.Ma().length===0&&this.zc(s),this.Ih()}Wc(){return this.ec}$(){return this.sc}Ut(t){const e=this.ec,s=this.sc;if(e===s)return e;if(t=Math.max(0,Math.min(100,Math.round(100*t))),this.Zu===null||this.Zu.mr!==s||this.Zu.wr!==e)this.Zu={mr:s,wr:e,Hc:new Map};else{const o=this.Zu.Hc.get(t);if(o!==void 0)return o}const n=this.Sl.tt(s,e,t/100);return this.Zu.Hc.set(t,n),n}Uc(t){return this.qu.indexOf(t)}Xi(){return this.Sl}$c(){return this.qc()}qc(t){const e=new Ss(this.uh,this);this.qu.push(e);const s=t??this.qu.length-1,n=z.gn();return n.Qs(s,{tn:0,sn:!0}),this.rc(n),e}tc(t){return W(t>=0,"Index should be greater or equal to 0"),(t=Math.min(this.qu.length,t))<this.qu.length?this.qu[t]:this.qc(t)}Fc(t){return this.qu.findIndex(e=>e.Oo().includes(t))}gc(t,e){const s=new z(e);if(t!==null){const n=this.qu.indexOf(t);s.Qs(n,{tn:e})}return s}hc(t,e){return e===void 0&&(e=2),this.gc(this.Hn(t),e)}rc(t){this.Gu&&this.Gu(t),this.qu.forEach(e=>e.i_().lr().yt())}Ec(t,e){const s=t.N().priceScaleId,n=s!==void 0?s:this.Oc();e.Gl(t,n),yi(n)||t.hr(t.N())}nc(t){const e=this.Ps.layout;return e.background.type==="gradient"?t===0?e.background.topColor:e.background.bottomColor:e.background.color}zc(t){!t.Lo()&&t.Ma().length===0&&this.qu.length>1&&this.qu.splice(this.Uc(t),1)}}function Tn(i){if(i>=1)return 0;let t=0;for(;t<8;t++){const e=Math.round(i);if(Math.abs(e-i)<1e-8)return t;i*=10}return t}function Gi(i){return!xt(i)&&!Rt(i)}function Ln(i){return xt(i)}(function(i){i[i.Disabled=0]="Disabled",i[i.Continuous=1]="Continuous",i[i.OnDataUpdate=2]="OnDataUpdate"})(Is||(Is={})),function(i){i[i.LastBar=0]="LastBar",i[i.LastVisible=1]="LastVisible"}($s||($s={})),function(i){i.Solid="solid",i.VerticalGradient="gradient"}(Qi||(Qi={})),function(i){i[i.Year=0]="Year",i[i.Month=1]="Month",i[i.DayOfMonth=2]="DayOfMonth",i[i.Time=3]="Time",i[i.TimeWithSeconds=4]="TimeWithSeconds"}(Ts||(Ts={}));const Ls=i=>i.getUTCFullYear();function Ca(i,t,e){return t.replace(/yyyy/g,(s=>tt(Ls(s),4))(i)).replace(/yy/g,(s=>tt(Ls(s)%100,2))(i)).replace(/MMMM/g,((s,n)=>new Date(s.getUTCFullYear(),s.getUTCMonth(),1).toLocaleString(n,{month:"long"}))(i,e)).replace(/MMM/g,((s,n)=>new Date(s.getUTCFullYear(),s.getUTCMonth(),1).toLocaleString(n,{month:"short"}))(i,e)).replace(/MM/g,(s=>tt((n=>n.getUTCMonth()+1)(s),2))(i)).replace(/dd/g,(s=>tt((n=>n.getUTCDate())(s),2))(i))}class En{constructor(t="yyyy-MM-dd",e="default"){this.Yc=t,this.jc=e}__(t){return Ca(t,this.Yc,this.jc)}}class Sa{constructor(t){this.Kc=t||"%h:%m:%s"}__(t){return this.Kc.replace("%h",tt(t.getUTCHours(),2)).replace("%m",tt(t.getUTCMinutes(),2)).replace("%s",tt(t.getUTCSeconds(),2))}}const Aa={Xc:"yyyy-MM-dd",Zc:"%h:%m:%s",Gc:" ",Jc:"default"};class Pa{constructor(t={}){const e={...Aa,...t};this.Qc=new En(e.Xc,e.Jc),this.td=new Sa(e.Zc),this.sd=e.Gc}__(t){return`${this.Qc.__(t)}${this.sd}${this.td.__(t)}`}}function jt(i){return 60*i*60*1e3}function Vi(i){return 60*i*1e3}const qt=[{nd:(Es=1,1e3*Es),ed:10},{nd:Vi(1),ed:20},{nd:Vi(5),ed:21},{nd:Vi(30),ed:22},{nd:jt(1),ed:30},{nd:jt(3),ed:31},{nd:jt(6),ed:32},{nd:jt(12),ed:33}];var Es;function Vs(i,t){if(i.getUTCFullYear()!==t.getUTCFullYear())return 70;if(i.getUTCMonth()!==t.getUTCMonth())return 60;if(i.getUTCDate()!==t.getUTCDate())return 50;for(let e=qt.length-1;e>=0;--e)if(Math.floor(t.getTime()/qt[e].nd)!==Math.floor(i.getTime()/qt[e].nd))return qt[e].ed;return 0}function Di(i){let t=i;if(Rt(i)&&(t=es(i)),!Gi(t))throw new Error("time must be of type BusinessDay");const e=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{rd:Math.round(e.getTime()/1e3),hd:t}}function Ds(i){if(!Ln(i))throw new Error("time must be of type isUTCTimestamp");return{rd:i}}function es(i){const t=new Date(i);if(isNaN(t.getTime()))throw new Error(`Invalid date string=${i}, expected format=yyyy-mm-dd`);return{day:t.getUTCDate(),month:t.getUTCMonth()+1,year:t.getUTCFullYear()}}function Fs(i){Rt(i.time)&&(i.time=es(i.time))}class Rs{options(){return this.Ps}setOptions(t){this.Ps=t,this.updateFormatter(t.localization)}preprocessData(t){Array.isArray(t)?function(e){e.forEach(Fs)}(t):Fs(t)}createConverterToInternalObj(t){return S(function(e){return e.length===0?null:Gi(e[0].time)||Rt(e[0].time)?Di:Ds}(t))}key(t){return typeof t=="object"&&"rd"in t?t.rd:this.key(this.convertHorzItemToInternal(t))}cacheKey(t){const e=t;return e.hd===void 0?new Date(1e3*e.rd).getTime():new Date(Date.UTC(e.hd.year,e.hd.month-1,e.hd.day)).getTime()}convertHorzItemToInternal(t){return Ln(e=t)?Ds(e):Gi(e)?Di(e):Di(es(e));var e}updateFormatter(t){if(!this.Ps)return;const e=t.dateFormat;this.Ps.timeScale.timeVisible?this.ad=new Pa({Xc:e,Zc:this.Ps.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",Gc:"   ",Jc:t.locale}):this.ad=new En(e,t.locale)}formatHorzItem(t){const e=t;return this.ad.__(new Date(1e3*e.rd))}formatTickmark(t,e){const s=function(o,r,l){switch(o){case 0:case 10:return r?l?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return r?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.weight,this.Ps.timeScale.timeVisible,this.Ps.timeScale.secondsVisible),n=this.Ps.timeScale;if(n.tickMarkFormatter!==void 0){const o=n.tickMarkFormatter(t.originalTime,s,e.locale);if(o!==null)return o}return function(o,r,l){const a={};switch(r){case 0:a.year="numeric";break;case 1:a.month="short";break;case 2:a.day="numeric";break;case 3:a.hour12=!1,a.hour="2-digit",a.minute="2-digit";break;case 4:a.hour12=!1,a.hour="2-digit",a.minute="2-digit",a.second="2-digit"}const h=o.hd===void 0?new Date(1e3*o.rd):new Date(Date.UTC(o.hd.year,o.hd.month-1,o.hd.day));return new Date(h.getUTCFullYear(),h.getUTCMonth(),h.getUTCDate(),h.getUTCHours(),h.getUTCMinutes(),h.getUTCSeconds(),h.getUTCMilliseconds()).toLocaleString(l,a)}(t.time,s,e.locale)}maxTickMarkWeight(t){let e=t.reduce(ba,t[0]).weight;return e>30&&e<50&&(e=30),e}fillWeightsForPoints(t,e){(function(s,n=0){if(s.length===0)return;let o=n===0?null:s[n-1].time.rd,r=o!==null?new Date(1e3*o):null,l=0;for(let a=n;a<s.length;++a){const h=s[a],c=new Date(1e3*h.time.rd);r!==null&&(h.timeWeight=Vs(c,r)),l+=h.time.rd-(o||h.time.rd),o=h.time.rd,r=c}if(n===0&&s.length>1){const a=Math.ceil(l/(s.length-1)),h=new Date(1e3*(s[0].time.rd-a));s[0].timeWeight=Vs(new Date(1e3*s[0].time.rd),h)}})(t,e)}static ld(t){return H({localization:{dateFormat:"dd MMM 'yy"}},t??{})}}const Ct=typeof window<"u";function ks(){return!!Ct&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Fi(){return!!Ct&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Ki(i){return i+i%2}function Ia(i){Ct&&window.chrome!==void 0&&i.addEventListener("mousedown",t=>{if(t.button===1)return t.preventDefault(),!1})}class bi{constructor(t,e,s){this.od=0,this._d=null,this.ud={_t:Number.NEGATIVE_INFINITY,ut:Number.POSITIVE_INFINITY},this.dd=0,this.fd=null,this.pd={_t:Number.NEGATIVE_INFINITY,ut:Number.POSITIVE_INFINITY},this.vd=null,this.md=!1,this.wd=null,this.gd=null,this.Md=!1,this.bd=!1,this.Sd=!1,this.xd=null,this.Cd=null,this.Pd=null,this.yd=null,this.kd=null,this.Td=null,this.Rd=null,this.Dd=0,this.Vd=!1,this.Bd=!1,this.Id=!1,this.Ed=0,this.Ad=null,this.zd=!Fi(),this.Ld=n=>{this.Od(n)},this.Nd=n=>{if(this.Fd(n)){const o=this.Wd(n);if(++this.dd,this.fd&&this.dd>1){const{Hd:r}=this.Ud(K(n),this.pd);r<30&&!this.Sd&&this.$d(o,this.Yd.qd),this.jd()}}else{const o=this.Wd(n);if(++this.od,this._d&&this.od>1){const{Hd:r}=this.Ud(K(n),this.ud);r<5&&!this.bd&&this.Kd(o,this.Yd.Xd),this.Zd()}}},this.Gd=t,this.Yd=e,this.Ps=s,this.Jd()}m(){this.xd!==null&&(this.xd(),this.xd=null),this.Cd!==null&&(this.Cd(),this.Cd=null),this.yd!==null&&(this.yd(),this.yd=null),this.kd!==null&&(this.kd(),this.kd=null),this.Td!==null&&(this.Td(),this.Td=null),this.Pd!==null&&(this.Pd(),this.Pd=null),this.Qd(),this.Zd()}tf(t){this.yd&&this.yd();const e=this.if.bind(this);if(this.yd=()=>{this.Gd.removeEventListener("mousemove",e)},this.Gd.addEventListener("mousemove",e),this.Fd(t))return;const s=this.Wd(t);this.Kd(s,this.Yd.sf),this.zd=!0}Zd(){this._d!==null&&clearTimeout(this._d),this.od=0,this._d=null,this.ud={_t:Number.NEGATIVE_INFINITY,ut:Number.POSITIVE_INFINITY}}jd(){this.fd!==null&&clearTimeout(this.fd),this.dd=0,this.fd=null,this.pd={_t:Number.NEGATIVE_INFINITY,ut:Number.POSITIVE_INFINITY}}if(t){if(this.Id||this.gd!==null||this.Fd(t))return;const e=this.Wd(t);this.Kd(e,this.Yd.nf),this.zd=!0}ef(t){const e=Ri(t.changedTouches,S(this.Ad));if(e===null||(this.Ed=Ht(t),this.Rd!==null)||this.Bd)return;this.Vd=!0;const s=this.Ud(K(e),S(this.gd)),{rf:n,hf:o,Hd:r}=s;if(this.Md||!(r<5)){if(!this.Md){const l=.5*n,a=o>=l&&!this.Ps.af(),h=l>o&&!this.Ps.lf();a||h||(this.Bd=!0),this.Md=!0,this.Sd=!0,this.Qd(),this.jd()}if(!this.Bd){const l=this.Wd(t,e);this.$d(l,this.Yd._f),mt(t)}}}uf(t){if(t.button!==0)return;const e=this.Ud(K(t),S(this.wd)),{Hd:s}=e;if(s>=5&&(this.bd=!0,this.Zd()),this.bd){const n=this.Wd(t);this.Kd(n,this.Yd.cf)}}Ud(t,e){const s=Math.abs(e._t-t._t),n=Math.abs(e.ut-t.ut);return{rf:s,hf:n,Hd:s+n}}df(t){let e=Ri(t.changedTouches,S(this.Ad));if(e===null&&t.touches.length===0&&(e=t.changedTouches[0]),e===null)return;this.Ad=null,this.Ed=Ht(t),this.Qd(),this.gd=null,this.Td&&(this.Td(),this.Td=null);const s=this.Wd(t,e);if(this.$d(s,this.Yd.ff),++this.dd,this.fd&&this.dd>1){const{Hd:n}=this.Ud(K(e),this.pd);n<30&&!this.Sd&&this.$d(s,this.Yd.qd),this.jd()}else this.Sd||(this.$d(s,this.Yd.pf),this.Yd.pf&&mt(t));this.dd===0&&mt(t),t.touches.length===0&&this.md&&(this.md=!1,mt(t))}Od(t){if(t.button!==0)return;const e=this.Wd(t);if(this.wd=null,this.Id=!1,this.kd&&(this.kd(),this.kd=null),ks()&&this.Gd.ownerDocument.documentElement.removeEventListener("mouseleave",this.Ld),!this.Fd(t))if(this.Kd(e,this.Yd.vf),++this.od,this._d&&this.od>1){const{Hd:s}=this.Ud(K(t),this.ud);s<5&&!this.bd&&this.Kd(e,this.Yd.Xd),this.Zd()}else this.bd||this.Kd(e,this.Yd.mf)}Qd(){this.vd!==null&&(clearTimeout(this.vd),this.vd=null)}wf(t){if(this.Ad!==null)return;const e=t.changedTouches[0];this.Ad=e.identifier,this.Ed=Ht(t);const s=this.Gd.ownerDocument.documentElement;this.Sd=!1,this.Md=!1,this.Bd=!1,this.gd=K(e),this.Td&&(this.Td(),this.Td=null);{const o=this.ef.bind(this),r=this.df.bind(this);this.Td=()=>{s.removeEventListener("touchmove",o),s.removeEventListener("touchend",r)},s.addEventListener("touchmove",o,{passive:!1}),s.addEventListener("touchend",r,{passive:!1}),this.Qd(),this.vd=setTimeout(this.gf.bind(this,t),240)}const n=this.Wd(t,e);this.$d(n,this.Yd.Mf),this.fd||(this.dd=0,this.fd=setTimeout(this.jd.bind(this),500),this.pd=K(e))}bf(t){if(t.button!==0)return;const e=this.Gd.ownerDocument.documentElement;ks()&&e.addEventListener("mouseleave",this.Ld),this.bd=!1,this.wd=K(t),this.kd&&(this.kd(),this.kd=null);{const n=this.uf.bind(this),o=this.Od.bind(this);this.kd=()=>{e.removeEventListener("mousemove",n),e.removeEventListener("mouseup",o)},e.addEventListener("mousemove",n),e.addEventListener("mouseup",o)}if(this.Id=!0,this.Fd(t))return;const s=this.Wd(t);this.Kd(s,this.Yd.Sf),this._d||(this.od=0,this._d=setTimeout(this.Zd.bind(this),500),this.ud=K(t))}Jd(){this.Gd.addEventListener("mouseenter",this.tf.bind(this)),this.Gd.addEventListener("touchcancel",this.Qd.bind(this));{const t=this.Gd.ownerDocument,e=s=>{this.Yd.xf&&(s.composed&&this.Gd.contains(s.composedPath()[0])||s.target&&this.Gd.contains(s.target)||this.Yd.xf())};this.Cd=()=>{t.removeEventListener("touchstart",e)},this.xd=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}Fi()&&(this.Pd=()=>{this.Gd.removeEventListener("dblclick",this.Nd)},this.Gd.addEventListener("dblclick",this.Nd)),this.Gd.addEventListener("mouseleave",this.Cf.bind(this)),this.Gd.addEventListener("touchstart",this.wf.bind(this),{passive:!0}),Ia(this.Gd),this.Gd.addEventListener("mousedown",this.bf.bind(this)),this.Pf(),this.Gd.addEventListener("touchmove",()=>{},{passive:!1})}Pf(){this.Yd.yf===void 0&&this.Yd.kf===void 0&&this.Yd.Tf===void 0||(this.Gd.addEventListener("touchstart",t=>this.Rf(t.touches),{passive:!0}),this.Gd.addEventListener("touchmove",t=>{if(t.touches.length===2&&this.Rd!==null&&this.Yd.kf!==void 0){const e=zs(t.touches[0],t.touches[1])/this.Dd;this.Yd.kf(this.Rd,e),mt(t)}},{passive:!1}),this.Gd.addEventListener("touchend",t=>{this.Rf(t.touches)}))}Rf(t){t.length===1&&(this.Vd=!1),t.length!==2||this.Vd||this.md?this.Df():this.Vf(t)}Vf(t){const e=this.Gd.getBoundingClientRect()||{left:0,top:0};this.Rd={_t:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,ut:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this.Dd=zs(t[0],t[1]),this.Yd.yf!==void 0&&this.Yd.yf(),this.Qd()}Df(){this.Rd!==null&&(this.Rd=null,this.Yd.Tf!==void 0&&this.Yd.Tf())}Cf(t){if(this.yd&&this.yd(),this.Fd(t)||!this.zd)return;const e=this.Wd(t);this.Kd(e,this.Yd.Bf),this.zd=!Fi()}gf(t){const e=Ri(t.touches,S(this.Ad));if(e===null)return;const s=this.Wd(t,e);this.$d(s,this.Yd.If),this.Sd=!0,this.md=!0}Fd(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents!==void 0?t.sourceCapabilities.firesTouchEvents:Ht(t)<this.Ed+500}$d(t,e){e&&e.call(this.Yd,t)}Kd(t,e){e&&e.call(this.Yd,t)}Wd(t,e){const s=e||t,n=this.Gd.getBoundingClientRect()||{left:0,top:0};return{clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY,localX:s.clientX-n.left,localY:s.clientY-n.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,Ef:!t.type.startsWith("mouse")&&t.type!=="contextmenu"&&t.type!=="click",Af:t.type,zf:s.target,a_:t.view,Lf:()=>{t.type!=="touchstart"&&mt(t)}}}}function zs(i,t){const e=i.clientX-t.clientX,s=i.clientY-t.clientY;return Math.sqrt(e*e+s*s)}function mt(i){i.cancelable&&i.preventDefault()}function K(i){return{_t:i.pageX,ut:i.pageY}}function Ht(i){return i.timeStamp||performance.now()}function Ri(i,t){for(let e=0;e<i.length;++e)if(i[e].identifier===t)return i[e];return null}class $a{constructor(t,e,s){this.Of=null,this.Nf=null,this.Ff=!0,this.Wf=null,this.Hf=t,this.Uf=t.$f()[e],this.qf=t.$f()[s],this.Yf=document.createElement("tr"),this.Yf.style.height="1px",this.jf=document.createElement("td"),this.jf.style.position="relative",this.jf.style.padding="0",this.jf.style.margin="0",this.jf.setAttribute("colspan","3"),this.Kf(),this.Yf.appendChild(this.jf),this.Ff=this.Hf.N().layout.panes.enableResize,this.Ff?this.Xf():(this.Of=null,this.Nf=null)}m(){this.Nf!==null&&this.Nf.m()}Zf(){return this.Yf}Gf(){return E({width:this.Uf.Gf().width,height:1})}Jf(){return E({width:this.Uf.Jf().width,height:1*window.devicePixelRatio})}Qf(t,e,s){const n=this.Jf();t.fillStyle=this.Hf.N().layout.panes.separatorColor,t.fillRect(e,s,n.width,n.height)}yt(){this.Kf(),this.Hf.N().layout.panes.enableResize!==this.Ff&&(this.Ff=this.Hf.N().layout.panes.enableResize,this.Ff?this.Xf():(this.Of!==null&&(this.jf.removeChild(this.Of.tp),this.jf.removeChild(this.Of.ip),this.Of=null),this.Nf!==null&&(this.Nf.m(),this.Nf=null)))}Xf(){const t=document.createElement("div"),e=t.style;e.position="fixed",e.display="none",e.zIndex="49",e.top="0",e.left="0",e.width="100%",e.height="100%",e.cursor="row-resize",this.jf.appendChild(t);const s=document.createElement("div"),n=s.style;n.position="absolute",n.zIndex="50",n.top="-4px",n.height="9px",n.width="100%",n.backgroundColor="",n.cursor="row-resize",this.jf.appendChild(s);const o={sf:this.sp.bind(this),Bf:this.np.bind(this),Sf:this.ep.bind(this),Mf:this.ep.bind(this),cf:this.rp.bind(this),_f:this.rp.bind(this),vf:this.hp.bind(this),ff:this.hp.bind(this)};this.Nf=new bi(s,o,{af:()=>!1,lf:()=>!0}),this.Of={ip:s,tp:t}}Kf(){this.jf.style.background=this.Hf.N().layout.panes.separatorColor}sp(t){this.Of!==null&&(this.Of.ip.style.backgroundColor=this.Hf.N().layout.panes.separatorHoverColor)}np(t){this.Of!==null&&this.Wf===null&&(this.Of.ip.style.backgroundColor="")}ep(t){if(this.Of===null)return;const e=this.Uf.ap().Bo()+this.qf.ap().Bo(),s=e/(this.Uf.Gf().height+this.qf.Gf().height),n=30*s;e<=2*n||(this.Wf={lp:t.pageY,op:this.Uf.ap().Bo(),_p:e-n,up:e,cp:s,dp:n},this.Of.tp.style.display="block")}rp(t){const e=this.Wf;if(e===null)return;const s=(t.pageY-e.lp)*e.cp,n=It(e.op+s,e.dp,e._p);this.Uf.ap().Io(n),this.qf.ap().Io(e.up-n),this.Hf.Qt().Ih()}hp(t){this.Wf!==null&&this.Of!==null&&(this.Wf=null,this.Of.tp.style.display="none")}}function ki(i,t){return i.fp-t.fp}function zi(i,t,e){const s=(i.fp-t.fp)/(i.wt-t.wt);return Math.sign(s)*Math.min(Math.abs(s),e)}class Ta{constructor(t,e,s,n){this.pp=null,this.vp=null,this.mp=null,this.wp=null,this.gp=null,this.Mp=0,this.bp=0,this.Sp=t,this.xp=e,this.Cp=s,this.Mn=n}Pp(t,e){if(this.pp!==null){if(this.pp.wt===e)return void(this.pp.fp=t);if(Math.abs(this.pp.fp-t)<this.Mn)return}this.wp=this.mp,this.mp=this.vp,this.vp=this.pp,this.pp={wt:e,fp:t}}le(t,e){if(this.pp===null||this.vp===null||e-this.pp.wt>50)return;let s=0;const n=zi(this.pp,this.vp,this.xp),o=ki(this.pp,this.vp),r=[n],l=[o];if(s+=o,this.mp!==null){const h=zi(this.vp,this.mp,this.xp);if(Math.sign(h)===Math.sign(n)){const c=ki(this.vp,this.mp);if(r.push(h),l.push(c),s+=c,this.wp!==null){const u=zi(this.mp,this.wp,this.xp);if(Math.sign(u)===Math.sign(n)){const f=ki(this.mp,this.wp);r.push(u),l.push(f),s+=f}}}}let a=0;for(let h=0;h<r.length;++h)a+=l[h]/s*r[h];Math.abs(a)<this.Sp||(this.gp={fp:t,wt:e},this.bp=a,this.Mp=function(h,c){const u=Math.log(c);return Math.log(1*u/-h)/u}(Math.abs(a),this.Cp))}Du(t){const e=S(this.gp),s=t-e.wt;return e.fp+this.bp*(Math.pow(this.Cp,s)-1)/Math.log(this.Cp)}Ru(t){return this.gp===null||this.yp(t)===this.Mp}yp(t){const e=t-S(this.gp).wt;return Math.min(e,this.Mp)}}class La{constructor(t,e){this.kp=void 0,this.Tp=void 0,this.Rp=void 0,this.ps=!1,this.Dp=t,this.Vp=e,this.Bp()}yt(){this.Bp()}Ip(){this.kp&&this.Dp.removeChild(this.kp),this.Tp&&this.Dp.removeChild(this.Tp),this.kp=void 0,this.Tp=void 0}Ep(){return this.ps!==this.Ap()||this.Rp!==this.zp()}zp(){return this.Vp.Qt().Xi().J(this.Vp.N().layout.textColor)>160?"dark":"light"}Ap(){return this.Vp.N().layout.attributionLogo}Lp(){const t=new URL(location.href);return t.hostname?"&utm_source="+t.hostname+t.pathname:""}Bp(){this.Ep()&&(this.Ip(),this.ps=this.Ap(),this.ps&&(this.Rp=this.zp(),this.Tp=document.createElement("style"),this.Tp.innerText="a#tv-attr-logo{--fill:#131722;--stroke:#fff;position:absolute;left:10px;bottom:10px;height:19px;width:35px;margin:0;padding:0;border:0;z-index:3;}a#tv-attr-logo[data-dark]{--fill:#D1D4DC;--stroke:#131722;}",this.kp=document.createElement("a"),this.kp.href=`https://www.tradingview.com/?utm_medium=lwc-link&utm_campaign=lwc-chart${this.Lp()}`,this.kp.title="Charting by TradingView",this.kp.id="tv-attr-logo",this.kp.target="_blank",this.kp.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="35" height="19" fill="none"><g fill-rule="evenodd" clip-path="url(#a)" clip-rule="evenodd"><path fill="var(--stroke)" d="M2 0H0v10h6v9h21.4l.5-1.3 6-15 1-2.7H23.7l-.5 1.3-.2.6a5 5 0 0 0-7-.9V0H2Zm20 17h4l5.2-13 .8-2h-7l-1 2.5-.2.5-1.5 3.8-.3.7V17Zm-.8-10a3 3 0 0 0 .7-2.7A3 3 0 1 0 16.8 7h4.4ZM14 7V2H2v6h6v9h4V7h2Z"/><path fill="var(--fill)" d="M14 2H2v6h6v9h6V2Zm12 15h-7l6-15h7l-6 15Zm-7-9a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></g><defs><clipPath id="a"><path fill="var(--stroke)" d="M0 0h35v19H0z"/></clipPath></defs></svg>',this.kp.toggleAttribute("data-dark",this.Rp==="dark"),this.Dp.appendChild(this.Tp),this.Dp.appendChild(this.kp)))}}function ut(i,t){const e=S(i.ownerDocument).createElement("canvas");i.appendChild(e);const s=vl(e,{options:{allowResizeObserver:!0},transform:(n,o)=>({width:Math.max(n.width,o.width),height:Math.max(n.height,o.height)})});return s.resizeCanvasElement(t),s}function ft(i){var t;i.width=1,i.height=1,(t=i.getContext("2d"))==null||t.clearRect(0,0,1,1)}function Zi(i,t,e,s){i.ih&&i.ih(t,e,s)}function Jt(i,t,e,s){i.nt(t,e,s)}function Xi(i,t,e,s){const n=i(e,s);for(const o of n){const r=o.Tt(s);r!==null&&t(r)}}function Wi(i,t){return e=>{var s,n;return function(o){return o.Ft!==void 0}(e)?(((s=e.Ft())==null?void 0:s.ma())??"")!==t?[]:((n=e.ta)==null?void 0:n.call(e,i))??[]:[]}}function Ws(i,t,e,s){if(!i.length)return;let n=0;const o=i[0].$t(s,!0);let r=t===1?e/2-(i[0].Fi()-o/2):i[0].Fi()-o/2-e/2;r=Math.max(0,r);for(let l=1;l<i.length;l++){const a=i[l],h=i[l-1],c=h.$t(s,!1),u=a.Fi(),f=h.Fi();if(t===1?u>f-c:u<f+c){const d=f-c*t;a.Wi(d);const p=d-t*c/2;if((t===1?p<0:p>e)&&r>0){const m=t===1?-1-p:p-e,g=Math.min(m,r);for(let v=n;v<i.length;v++)i[v].Wi(i[v].Fi()+t*g);r-=g}}else n=l,r=t===1?f-c-u:u-(f+c)}}class Os{constructor(t,e,s,n){this.Yi=null,this.Op=null,this.Np=!1,this.Fp=new di(200),this.Wp=null,this.Hp=0,this.Up=!1,this.$p=()=>{this.Up||this.Pt.qp().Qt().ar()},this.Yp=()=>{this.Up||this.Pt.qp().Qt().ar()},this.Pt=t,this.Ps=e,this.Ml=e.layout,this.Ju=s,this.jp=n==="left",this.Kp=Wi("normal",n),this.Xp=Wi("top",n),this.Zp=Wi("bottom",n),this.jf=document.createElement("div"),this.jf.style.height="100%",this.jf.style.overflow="hidden",this.jf.style.width="25px",this.jf.style.left="0",this.jf.style.position="relative",this.Gp=ut(this.jf,E({width:16,height:16})),this.Gp.subscribeSuggestedBitmapSizeChanged(this.$p);const o=this.Gp.canvasElement;o.style.position="absolute",o.style.zIndex="1",o.style.left="0",o.style.top="0",this.Jp=ut(this.jf,E({width:16,height:16})),this.Jp.subscribeSuggestedBitmapSizeChanged(this.Yp);const r=this.Jp.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const l={Sf:this.ep.bind(this),Mf:this.ep.bind(this),cf:this.rp.bind(this),_f:this.rp.bind(this),xf:this.Qp.bind(this),vf:this.hp.bind(this),ff:this.hp.bind(this),Xd:this.tv.bind(this),qd:this.tv.bind(this),sf:this.iv.bind(this),Bf:this.np.bind(this)};this.Nf=new bi(this.Jp.canvasElement,l,{af:()=>!this.Ps.handleScroll.vertTouchDrag,lf:()=>!0})}m(){this.Nf.m(),this.Jp.unsubscribeSuggestedBitmapSizeChanged(this.Yp),ft(this.Jp.canvasElement),this.Jp.dispose(),this.Gp.unsubscribeSuggestedBitmapSizeChanged(this.$p),ft(this.Gp.canvasElement),this.Gp.dispose(),this.Yi!==null&&this.Yi.so().u(this),this.Yi=null}Zf(){return this.jf}P(){return this.Ml.fontSize}sv(){const t=this.Ju.N();return this.Wp!==t.k&&(this.Fp.Bn(),this.Wp=t.k),t}nv(){if(this.Yi===null)return 0;let t=0;const e=this.sv(),s=S(this.Gp.canvasElement.getContext("2d",{colorSpace:this.Pt.qp().N().layout.colorSpace}));s.save();const n=this.Yi.Da();s.font=this.ev(),n.length>0&&(t=Math.max(this.Fp.Vi(s,n[0].Za),this.Fp.Vi(s,n[n.length-1].Za)));const o=this.rv();for(let h=o.length;h--;){const c=this.Fp.Vi(s,o[h].ri());c>t&&(t=c)}const r=this.Yi.zt();if(r!==null&&this.Op!==null&&(l=this.Ps.crosshair).mode!==2&&l.horzLine.visible&&l.horzLine.labelVisible){const h=this.Yi.Ts(1,r),c=this.Yi.Ts(this.Op.height-2,r);t=Math.max(t,this.Fp.Vi(s,this.Yi.Zi(Math.floor(Math.min(h,c))+.11111111111111,r)),this.Fp.Vi(s,this.Yi.Zi(Math.ceil(Math.max(h,c))-.11111111111111,r)))}var l;s.restore();const a=t||34;return Ki(Math.ceil(e.S+e.C+e.B+e.I+5+a))}hv(t){this.Op!==null&&at(this.Op,t)||(this.Op=t,this.Up=!0,this.Gp.resizeCanvasElement(t),this.Jp.resizeCanvasElement(t),this.Up=!1,this.jf.style.width=`${t.width}px`,this.jf.style.height=`${t.height}px`)}av(){return S(this.Op).width}_s(t){this.Yi!==t&&(this.Yi!==null&&this.Yi.so().u(this),this.Yi=t,t.so().i(this._l.bind(this),this))}Ft(){return this.Yi}Bn(){const t=this.Pt.ap();this.Pt.qp().Qt().Zo(t,S(this.Ft()))}lv(t){if(this.Op===null)return;const e={colorSpace:this.Pt.qp().N().layout.colorSpace};if(t!==1){this.ov(),this.Gp.applySuggestedBitmapSize();const n=ht(this.Gp,e);n!==null&&(n.useBitmapCoordinateSpace(o=>{this._v(o),this.uv(o)}),this.Pt.cv(n,this.Zp),this.dv(n),this.Pt.cv(n,this.Kp),this.fv(n))}this.Jp.applySuggestedBitmapSize();const s=ht(this.Jp,e);s!==null&&(s.useBitmapCoordinateSpace(({context:n,bitmapSize:o})=>{n.clearRect(0,0,o.width,o.height)}),this.pv(s),this.Pt.cv(s,this.Xp))}Jf(){return this.Gp.bitmapSize}Qf(t,e,s,n){const o=this.Jf();if(o.width>0&&o.height>0&&(t.drawImage(this.Gp.canvasElement,e,s),n)){const r=this.Jp.canvasElement;t.drawImage(r,e,s)}}yt(){var t;(t=this.Yi)==null||t.Da()}ep(t){if(this.Yi===null||this.Yi.Ki()||!this.Ps.handleScale.axisPressedMouseMove.price)return;const e=this.Pt.qp().Qt(),s=this.Pt.ap();this.Np=!0,e.Uo(s,this.Yi,t.localY)}rp(t){if(this.Yi===null||!this.Ps.handleScale.axisPressedMouseMove.price)return;const e=this.Pt.qp().Qt(),s=this.Pt.ap(),n=this.Yi;e.$o(s,n,t.localY)}Qp(){if(this.Yi===null||!this.Ps.handleScale.axisPressedMouseMove.price)return;const t=this.Pt.qp().Qt(),e=this.Pt.ap(),s=this.Yi;this.Np&&(this.Np=!1,t.qo(e,s))}hp(t){if(this.Yi===null||!this.Ps.handleScale.axisPressedMouseMove.price)return;const e=this.Pt.qp().Qt(),s=this.Pt.ap();this.Np=!1,e.qo(s,this.Yi)}tv(t){this.Ps.handleScale.axisDoubleClickReset.price&&this.Bn()}iv(t){this.Yi!==null&&(!this.Pt.qp().Qt().N().handleScale.axisPressedMouseMove.price||this.Yi.Le()||this.Yi.Dl()||this.vv(1))}np(t){this.vv(0)}rv(){const t=[],e=this.Yi===null?void 0:this.Yi;return(s=>{for(let n=0;n<s.length;++n){const o=s[n].Ws(this.Pt.ap(),e);for(let r=0;r<o.length;r++)t.push(o[r])}})(this.Pt.ap().Dt()),t}_v({context:t,bitmapSize:e}){const{width:s,height:n}=e,o=this.Pt.ap().Qt(),r=o.$(),l=o.Wc();r===l?vi(t,0,0,s,n,r):yn(t,0,0,s,n,r,l)}uv({context:t,bitmapSize:e,horizontalPixelRatio:s}){if(this.Op===null||this.Yi===null||!this.Yi.N().borderVisible)return;t.fillStyle=this.Yi.N().borderColor;const n=Math.max(1,Math.floor(this.sv().S*s));let o;o=this.jp?e.width-n:0,t.fillRect(o,0,n,e.height)}dv(t){if(this.Op===null||this.Yi===null)return;const e=this.Yi.Da(),s=this.Yi.N(),n=this.sv(),o=this.jp?this.Op.width-n.C:0;s.borderVisible&&s.ticksVisible&&t.useBitmapCoordinateSpace(({context:r,horizontalPixelRatio:l,verticalPixelRatio:a})=>{r.fillStyle=s.borderColor;const h=Math.max(1,Math.floor(a)),c=Math.floor(.5*a),u=Math.round(n.C*l);r.beginPath();for(const f of e)r.rect(Math.floor(o*l),Math.round(f.Pa*a)-c,u,h);r.fill()}),t.useMediaCoordinateSpace(({context:r})=>{r.font=this.ev(),r.fillStyle=s.textColor??this.Ml.textColor,r.textAlign=this.jp?"right":"left",r.textBaseline="middle";const l=this.jp?Math.round(o-n.B):Math.round(o+n.C+n.B),a=e.map(h=>this.Fp.Di(r,h.Za));for(let h=e.length;h--;){const c=e[h];r.fillText(c.Za,l,c.Pa+a[h])}})}ov(){if(this.Op===null||this.Yi===null)return;let t=this.Op.height/2;const e=[],s=this.Yi.Dt().slice(),n=this.Pt.ap(),o=this.sv();this.Yi===n.$n()&&this.Pt.ap().Dt().forEach(a=>{n.Un(a)&&s.push(a)});const r=this.Yi.Ma()[0],l=this.Yi;s.forEach(a=>{const h=a.Ws(n,l);h.forEach(c=>{c.Wi(null),c.Hi()&&e.push(c)}),r===a&&h.length>0&&(t=h[0].Ii())}),e.forEach(a=>a.Wi(a.Ii())),this.Yi.N().alignLabels&&this.mv(e,o,t)}mv(t,e,s){if(this.Op===null)return;const n=t.filter(r=>r.Ii()<=s),o=t.filter(r=>r.Ii()>s);n.sort((r,l)=>l.Ii()-r.Ii()),n.length&&o.length&&o.push(n[0]),o.sort((r,l)=>r.Ii()-l.Ii());for(const r of t){const l=Math.floor(r.$t(e)/2),a=r.Ii();a>-l&&a<l&&r.Wi(l),a>this.Op.height-l&&a<this.Op.height+l&&r.Wi(this.Op.height-l)}Ws(n,1,this.Op.height,e),Ws(o,-1,this.Op.height,e)}fv(t){if(this.Op===null)return;const e=this.rv(),s=this.sv(),n=this.jp?"right":"left";e.forEach(o=>{o.Ui()&&o.Tt(S(this.Yi)).nt(t,s,this.Fp,n)})}pv(t){if(this.Op===null||this.Yi===null)return;const e=this.Pt.qp().Qt(),s=[],n=this.Pt.ap(),o=e.uc().Ws(n,this.Yi);o.length&&s.push(o);const r=this.sv(),l=this.jp?"right":"left";s.forEach(a=>{a.forEach(h=>{h.Tt(S(this.Yi)).nt(t,r,this.Fp,l)})})}vv(t){this.jf.style.cursor=t===1?"ns-resize":"default"}_l(){const t=this.nv();this.Hp<t&&this.Pt.qp().Qt().Ih(),this.Hp=t}ev(){return fi(this.Ml.fontSize,this.Ml.fontFamily)}}function Ea(i,t){var e;return((e=i.Jh)==null?void 0:e.call(i,t))??[]}function Bs(i,t){var e;return((e=i.Fs)==null?void 0:e.call(i,t))??[]}function Ys(i,t){var e;return((e=i.us)==null?void 0:e.call(i,t))??[]}function Va(i,t){var e;return((e=i.Xh)==null?void 0:e.call(i,t))??[]}class is{constructor(t,e){this.Op=E({width:0,height:0}),this.wv=null,this.gv=null,this.Mv=null,this.bv=null,this.Sv=!1,this.xv=new k,this.Cv=new k,this.Pv=0,this.yv=!1,this.kv=null,this.Tv=!1,this.Rv=null,this.Dv=null,this.Up=!1,this.$p=()=>{this.Up||this.Vv===null||this.ts().ar()},this.Yp=()=>{this.Up||this.Vv===null||this.ts().ar()},this.Vp=t,this.Vv=e,this.Vv.t_().i(this.Bv.bind(this),this,!0),this.Iv=document.createElement("td"),this.Iv.style.padding="0",this.Iv.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Ev=document.createElement("td"),this.Ev.style.padding="0",this.Av=document.createElement("td"),this.Av.style.padding="0",this.Iv.appendChild(s),this.Gp=ut(s,E({width:16,height:16})),this.Gp.subscribeSuggestedBitmapSizeChanged(this.$p);const n=this.Gp.canvasElement;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Jp=ut(s,E({width:16,height:16})),this.Jp.subscribeSuggestedBitmapSizeChanged(this.Yp);const o=this.Jp.canvasElement;o.style.position="absolute",o.style.zIndex="2",o.style.left="0",o.style.top="0",this.Yf=document.createElement("tr"),this.Yf.appendChild(this.Ev),this.Yf.appendChild(this.Iv),this.Yf.appendChild(this.Av),this.zv(),this.Nf=new bi(this.Jp.canvasElement,this,{af:()=>this.kv===null&&!this.Vp.N().handleScroll.vertTouchDrag,lf:()=>this.kv===null&&!this.Vp.N().handleScroll.horzTouchDrag})}m(){this.wv!==null&&this.wv.m(),this.gv!==null&&this.gv.m(),this.Mv=null,this.Jp.unsubscribeSuggestedBitmapSizeChanged(this.Yp),ft(this.Jp.canvasElement),this.Jp.dispose(),this.Gp.unsubscribeSuggestedBitmapSizeChanged(this.$p),ft(this.Gp.canvasElement),this.Gp.dispose(),this.Vv!==null&&(this.Vv.t_().u(this),this.Vv.m()),this.Nf.m()}ap(){return S(this.Vv)}Lv(t){var e;this.Vv!==null&&this.Vv.t_().u(this),this.Vv=t,this.Vv!==null&&this.Vv.t_().i(is.prototype.Bv.bind(this),this,!0),this.zv(),this.Vp.$f().indexOf(this)===this.Vp.$f().length-1?(this.Mv=this.Mv??new La(this.Iv,this.Vp),this.Mv.yt()):((e=this.Mv)==null||e.Ip(),this.Mv=null)}qp(){return this.Vp}Zf(){return this.Yf}zv(){if(this.Vv!==null&&(this.Ov(),this.ts().js().length!==0)){if(this.wv!==null){const t=this.Vv.Wo();this.wv._s(S(t))}if(this.gv!==null){const t=this.Vv.Ho();this.gv._s(S(t))}}}Nv(){this.wv!==null&&this.wv.yt(),this.gv!==null&&this.gv.yt()}Bo(){return this.Vv!==null?this.Vv.Bo():0}Io(t){this.Vv&&this.Vv.Io(t)}sf(t){if(!this.Vv)return;this.Fv();const e=t.localX,s=t.localY;this.Wv(e,s,t)}Sf(t){this.Fv(),this.Hv(),this.Wv(t.localX,t.localY,t)}nf(t){if(!this.Vv)return;this.Fv();const e=t.localX,s=t.localY;this.Wv(e,s,t)}mf(t){this.Vv!==null&&(this.Fv(),this.Uv(t))}Xd(t){this.Vv!==null&&this.$v(this.Cv,t)}qd(t){this.Xd(t)}cf(t){this.Fv(),this.qv(t),this.Wv(t.localX,t.localY,t)}vf(t){this.Vv!==null&&(this.Fv(),this.yv=!1,this.Yv(t))}pf(t){this.Vv!==null&&this.Uv(t)}If(t){if(this.yv=!0,this.kv===null){const e={x:t.localX,y:t.localY};this.jv(e,e,t)}}Bf(t){this.Vv!==null&&(this.Fv(),this.Vv.Qt().lc(null),this.Kv())}Xv(){return this.xv}Zv(){return this.Cv}yf(){this.Pv=1,this.ts().hn()}kf(t,e){if(!this.Vp.N().handleScale.pinch)return;const s=5*(e-this.Pv);this.Pv=e,this.ts().bc(t._t,s)}Mf(t){this.yv=!1,this.Tv=this.kv!==null,this.Hv();const e=this.ts().uc();this.kv!==null&&e.Vt()&&(this.Rv={x:e.si(),y:e.ni()},this.kv={x:t.localX,y:t.localY})}_f(t){if(this.Vv===null)return;const e=t.localX,s=t.localY;if(this.kv===null)this.qv(t);else{this.Tv=!1;const n=S(this.Rv),o=n.x+(e-this.kv.x),r=n.y+(s-this.kv.y);this.Wv(o,r,t)}}ff(t){this.qp().N().trackingMode.exitMode===0&&(this.Tv=!0),this.Gv(),this.Yv(t)}jn(t,e){const s=this.Vv;return s===null?null:$n(s,t,e)}Jv(t,e){S(e==="left"?this.wv:this.gv).hv(E({width:t,height:this.Op.height}))}Gf(){return this.Op}hv(t){at(this.Op,t)||(this.Op=t,this.Up=!0,this.Gp.resizeCanvasElement(t),this.Jp.resizeCanvasElement(t),this.Up=!1,this.Iv.style.width=t.width+"px",this.Iv.style.height=t.height+"px")}Qv(){const t=S(this.Vv);t.Fo(t.Wo()),t.Fo(t.Ho());for(const e of t.Ma())if(t.Un(e)){const s=e.Ft();s!==null&&t.Fo(s),e.Ns()}for(const e of t.s_())e.Ns()}Jf(){return this.Gp.bitmapSize}Qf(t,e,s,n){const o=this.Jf();if(o.width>0&&o.height>0&&(t.drawImage(this.Gp.canvasElement,e,s),n)){const r=this.Jp.canvasElement;t!==null&&t.drawImage(r,e,s)}}lv(t){if(t===0||this.Vv===null)return;t>1&&this.Qv(),this.wv!==null&&this.wv.lv(t),this.gv!==null&&this.gv.lv(t);const e={colorSpace:this.Vp.N().layout.colorSpace};if(t!==1){this.Gp.applySuggestedBitmapSize();const n=ht(this.Gp,e);n!==null&&(n.useBitmapCoordinateSpace(o=>{this._v(o)}),this.Vv&&(this.tm(n,Ea),this.im(n),this.tm(n,Bs),this.tm(n,Ys)))}this.Jp.applySuggestedBitmapSize();const s=ht(this.Jp,e);s!==null&&(s.useBitmapCoordinateSpace(({context:n,bitmapSize:o})=>{n.clearRect(0,0,o.width,o.height)}),this.sm(s),this.tm(s,Va),this.tm(s,Ys))}nm(){return this.wv}rm(){return this.gv}cv(t,e){this.tm(t,e)}Bv(){this.Vv!==null&&this.Vv.t_().u(this),this.Vv=null}Uv(t){this.$v(this.xv,t)}$v(t,e){const s=e.localX,n=e.localY;t.v()&&t.p(this.ts().Et().cu(s),{x:s,y:n},e)}_v({context:t,bitmapSize:e}){const{width:s,height:n}=e,o=this.ts(),r=o.$(),l=o.Wc();r===l?vi(t,0,0,s,n,l):yn(t,0,0,s,n,r,l)}im(t){const e=S(this.Vv),s=e.i_().lr().Tt(e);s!==null&&s.nt(t,!1)}sm(t){this.hm(t,Bs,Jt,this.ts().uc())}tm(t,e){const s=S(this.Vv),n=s.Dt(),o=s.s_();for(const r of o)this.hm(t,e,Zi,r);for(const r of n)this.hm(t,e,Zi,r);for(const r of o)this.hm(t,e,Jt,r);for(const r of n)this.hm(t,e,Jt,r)}hm(t,e,s,n){const o=S(this.Vv),r=o.Qt().ac(),l=r!==null&&r.n_===n,a=r!==null&&l&&r.e_!==void 0?r.e_.Xn:void 0;Xi(e,h=>s(h,t,l,a),n,o)}Ov(){if(this.Vv===null)return;const t=this.Vp,e=this.Vv.Wo().N().visible,s=this.Vv.Ho().N().visible;e||this.wv===null||(this.Ev.removeChild(this.wv.Zf()),this.wv.m(),this.wv=null),s||this.gv===null||(this.Av.removeChild(this.gv.Zf()),this.gv.m(),this.gv=null);const n=t.Qt().Bc();e&&this.wv===null&&(this.wv=new Os(this,t.N(),n,"left"),this.Ev.appendChild(this.wv.Zf())),s&&this.gv===null&&(this.gv=new Os(this,t.N(),n,"right"),this.Av.appendChild(this.gv.Zf()))}am(t){return t.Ef&&this.yv||this.kv!==null}lm(t){return Math.max(0,Math.min(t,this.Op.width-1))}om(t){return Math.max(0,Math.min(t,this.Op.height-1))}Wv(t,e,s){this.ts().Tc(this.lm(t),this.om(e),s,S(this.Vv))}Kv(){this.ts().Dc()}Gv(){this.Tv&&(this.kv=null,this.Kv())}jv(t,e,s){this.kv=t,this.Tv=!1,this.Wv(e.x,e.y,s);const n=this.ts().uc();this.Rv={x:n.si(),y:n.ni()}}ts(){return this.Vp.Qt()}Yv(t){if(!this.Sv)return;const e=this.ts(),s=this.ap();if(e.Ko(s,s.ks()),this.bv=null,this.Sv=!1,e.Pc(),this.Dv!==null){const n=performance.now(),o=e.Et();this.Dv.le(o.gu(),n),this.Dv.Ru(n)||e._n(this.Dv)}}Fv(){this.kv=null}Hv(){if(this.Vv){if(this.ts().hn(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)S(document.activeElement).blur();else{const t=document.getSelection();t!==null&&t.removeAllRanges()}!this.Vv.ks().Ki()&&this.ts().Et().Ki()}}qv(t){if(this.Vv===null)return;const e=this.ts(),s=e.Et();if(s.Ki())return;const n=this.Vp.N(),o=n.handleScroll,r=n.kineticScroll;if((!o.pressedMouseMove||t.Ef)&&(!o.horzTouchDrag&&!o.vertTouchDrag||!t.Ef))return;const l=this.Vv.ks(),a=performance.now();if(this.bv!==null||this.am(t)||(this.bv={x:t.clientX,y:t.clientY,rd:a,_m:t.localX,um:t.localY}),this.bv!==null&&!this.Sv&&(this.bv.x!==t.clientX||this.bv.y!==t.clientY)){if(t.Ef&&r.touch||!t.Ef&&r.mouse){const h=s.mu();this.Dv=new Ta(.2/h,7/h,.997,15/h),this.Dv.Pp(s.gu(),this.bv.rd)}else this.Dv=null;l.Ki()||e.Yo(this.Vv,l,t.localY),e.xc(t.localX),this.Sv=!0}this.Sv&&(l.Ki()||e.jo(this.Vv,l,t.localY),e.Cc(t.localX),this.Dv!==null&&this.Dv.Pp(s.gu(),a))}}class js{constructor(t,e,s,n,o){this.xt=!0,this.Op=E({width:0,height:0}),this.$p=()=>this.lv(3),this.jp=t==="left",this.Ju=s.Bc,this.Ps=e,this.dm=n,this.fm=o,this.jf=document.createElement("div"),this.jf.style.width="25px",this.jf.style.height="100%",this.jf.style.overflow="hidden",this.Gp=ut(this.jf,E({width:16,height:16})),this.Gp.subscribeSuggestedBitmapSizeChanged(this.$p)}m(){this.Gp.unsubscribeSuggestedBitmapSizeChanged(this.$p),ft(this.Gp.canvasElement),this.Gp.dispose()}Zf(){return this.jf}Gf(){return this.Op}hv(t){at(this.Op,t)||(this.Op=t,this.Gp.resizeCanvasElement(t),this.jf.style.width=`${t.width}px`,this.jf.style.height=`${t.height}px`,this.xt=!0)}lv(t){if(t<3&&!this.xt||this.Op.width===0||this.Op.height===0)return;this.xt=!1,this.Gp.applySuggestedBitmapSize();const e=ht(this.Gp,{colorSpace:this.Ps.layout.colorSpace});e!==null&&e.useBitmapCoordinateSpace(s=>{this._v(s),this.uv(s)})}Jf(){return this.Gp.bitmapSize}Qf(t,e,s){const n=this.Jf();n.width>0&&n.height>0&&t.drawImage(this.Gp.canvasElement,e,s)}uv({context:t,bitmapSize:e,horizontalPixelRatio:s,verticalPixelRatio:n}){if(!this.dm())return;t.fillStyle=this.Ps.timeScale.borderColor;const o=Math.floor(this.Ju.N().S*s),r=Math.floor(this.Ju.N().S*n),l=this.jp?e.width-o:0;t.fillRect(l,0,o,r)}_v({context:t,bitmapSize:e}){vi(t,0,0,e.width,e.height,this.fm())}}function ss(i){return t=>{var e;return((e=t.ia)==null?void 0:e.call(t,i))??[]}}const Da=ss("normal"),Fa=ss("top"),Ra=ss("bottom");class ka{constructor(t,e){this.pm=null,this.vm=null,this.M=null,this.wm=!1,this.Op=E({width:0,height:0}),this.gm=new k,this.Fp=new di(5),this.Up=!1,this.$p=()=>{this.Up||this.Vp.Qt().ar()},this.Yp=()=>{this.Up||this.Vp.Qt().ar()},this.Vp=t,this.o_=e,this.Ps=t.N().layout,this.kp=document.createElement("tr"),this.Mm=document.createElement("td"),this.Mm.style.padding="0",this.bm=document.createElement("td"),this.bm.style.padding="0",this.jf=document.createElement("td"),this.jf.style.height="25px",this.jf.style.padding="0",this.Sm=document.createElement("div"),this.Sm.style.width="100%",this.Sm.style.height="100%",this.Sm.style.position="relative",this.Sm.style.overflow="hidden",this.jf.appendChild(this.Sm),this.Gp=ut(this.Sm,E({width:16,height:16})),this.Gp.subscribeSuggestedBitmapSizeChanged(this.$p);const s=this.Gp.canvasElement;s.style.position="absolute",s.style.zIndex="1",s.style.left="0",s.style.top="0",this.Jp=ut(this.Sm,E({width:16,height:16})),this.Jp.subscribeSuggestedBitmapSizeChanged(this.Yp);const n=this.Jp.canvasElement;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0",this.kp.appendChild(this.Mm),this.kp.appendChild(this.jf),this.kp.appendChild(this.bm),this.xm(),this.Vp.Qt().Vo().i(this.xm.bind(this),this),this.Nf=new bi(this.Jp.canvasElement,this,{af:()=>!0,lf:()=>!this.Vp.N().handleScroll.horzTouchDrag})}m(){this.Nf.m(),this.pm!==null&&this.pm.m(),this.vm!==null&&this.vm.m(),this.Jp.unsubscribeSuggestedBitmapSizeChanged(this.Yp),ft(this.Jp.canvasElement),this.Jp.dispose(),this.Gp.unsubscribeSuggestedBitmapSizeChanged(this.$p),ft(this.Gp.canvasElement),this.Gp.dispose()}Zf(){return this.kp}Cm(){return this.pm}Pm(){return this.vm}Sf(t){if(this.wm)return;this.wm=!0;const e=this.Vp.Qt();!e.Et().Ki()&&this.Vp.N().handleScale.axisPressedMouseMove.time&&e.Mc(t.localX)}Mf(t){this.Sf(t)}xf(){const t=this.Vp.Qt();!t.Et().Ki()&&this.wm&&(this.wm=!1,this.Vp.N().handleScale.axisPressedMouseMove.time&&t.kc())}cf(t){const e=this.Vp.Qt();!e.Et().Ki()&&this.Vp.N().handleScale.axisPressedMouseMove.time&&e.yc(t.localX)}_f(t){this.cf(t)}vf(){this.wm=!1;const t=this.Vp.Qt();t.Et().Ki()&&!this.Vp.N().handleScale.axisPressedMouseMove.time||t.kc()}ff(){this.vf()}Xd(){this.Vp.N().handleScale.axisDoubleClickReset.time&&this.Vp.Qt().cn()}qd(){this.Xd()}sf(){this.Vp.Qt().N().handleScale.axisPressedMouseMove.time&&this.vv(1)}Bf(){this.vv(0)}Gf(){return this.Op}ym(){return this.gm}km(t,e,s){at(this.Op,t)||(this.Op=t,this.Up=!0,this.Gp.resizeCanvasElement(t),this.Jp.resizeCanvasElement(t),this.Up=!1,this.jf.style.width=`${t.width}px`,this.jf.style.height=`${t.height}px`,this.gm.p(t)),this.pm!==null&&this.pm.hv(E({width:e,height:t.height})),this.vm!==null&&this.vm.hv(E({width:s,height:t.height}))}Tm(){const t=this.Rm();return Math.ceil(t.S+t.C+t.P+t.A+t.V+t.Dm)}yt(){this.Vp.Qt().Et().Da()}Jf(){return this.Gp.bitmapSize}Qf(t,e,s,n){const o=this.Jf();if(o.width>0&&o.height>0&&(t.drawImage(this.Gp.canvasElement,e,s),n)){const r=this.Jp.canvasElement;t.drawImage(r,e,s)}}lv(t){if(t===0)return;const e={colorSpace:this.Ps.colorSpace};if(t!==1){this.Gp.applySuggestedBitmapSize();const n=ht(this.Gp,e);n!==null&&(n.useBitmapCoordinateSpace(o=>{this._v(o),this.uv(o),this.Vm(n,Ra)}),this.dv(n),this.Vm(n,Da)),this.pm!==null&&this.pm.lv(t),this.vm!==null&&this.vm.lv(t)}this.Jp.applySuggestedBitmapSize();const s=ht(this.Jp,e);s!==null&&(s.useBitmapCoordinateSpace(({context:n,bitmapSize:o})=>{n.clearRect(0,0,o.width,o.height)}),this.Bm([...this.Vp.Qt().js(),this.Vp.Qt().uc()],s),this.Vm(s,Fa))}Vm(t,e){const s=this.Vp.Qt().js();for(const n of s)Xi(e,o=>Zi(o,t,!1,void 0),n,void 0);for(const n of s)Xi(e,o=>Jt(o,t,!1,void 0),n,void 0)}_v({context:t,bitmapSize:e}){vi(t,0,0,e.width,e.height,this.Vp.Qt().Wc())}uv({context:t,bitmapSize:e,verticalPixelRatio:s}){if(this.Vp.N().timeScale.borderVisible){t.fillStyle=this.Im();const n=Math.max(1,Math.floor(this.Rm().S*s));t.fillRect(0,0,e.width,n)}}dv(t){const e=this.Vp.Qt().Et(),s=e.Da();if(!s||s.length===0)return;const n=this.o_.maxTickMarkWeight(s),o=this.Rm(),r=e.N();r.borderVisible&&r.ticksVisible&&t.useBitmapCoordinateSpace(({context:l,horizontalPixelRatio:a,verticalPixelRatio:h})=>{l.strokeStyle=this.Im(),l.fillStyle=this.Im();const c=Math.max(1,Math.floor(a)),u=Math.floor(.5*a);l.beginPath();const f=Math.round(o.C*h);for(let d=s.length;d--;){const p=Math.round(s[d].coord*a);l.rect(p-u,0,c,f)}l.fill()}),t.useMediaCoordinateSpace(({context:l})=>{const a=o.S+o.C+o.A+o.P/2;l.textAlign="center",l.textBaseline="middle",l.fillStyle=this.H(),l.font=this.ev();for(const h of s)if(h.weight<n){const c=h.needAlignCoordinate?this.Em(l,h.coord,h.label):h.coord;l.fillText(h.label,c,a)}this.Vp.N().timeScale.allowBoldLabels&&(l.font=this.Am());for(const h of s)if(h.weight>=n){const c=h.needAlignCoordinate?this.Em(l,h.coord,h.label):h.coord;l.fillText(h.label,c,a)}})}Em(t,e,s){const n=this.Fp.Vi(t,s),o=n/2,r=Math.floor(e-o)+.5;return r<0?e+=Math.abs(0-r):r+n>this.Op.width&&(e-=Math.abs(this.Op.width-(r+n))),e}Bm(t,e){const s=this.Rm();for(const n of t)for(const o of n.cs())o.Tt().nt(e,s)}Im(){return this.Vp.N().timeScale.borderColor}H(){return this.Ps.textColor}F(){return this.Ps.fontSize}ev(){return fi(this.F(),this.Ps.fontFamily)}Am(){return fi(this.F(),this.Ps.fontFamily,"bold")}Rm(){this.M===null&&(this.M={S:1,L:NaN,A:NaN,V:NaN,Ji:NaN,C:5,P:NaN,k:"",Gi:new di,Dm:0});const t=this.M,e=this.ev();if(t.k!==e){const s=this.F();t.P=s,t.k=e,t.A=3*s/12,t.V=3*s/12,t.Ji=9*s/12,t.L=0,t.Dm=4*s/12,t.Gi.Bn()}return this.M}vv(t){this.jf.style.cursor=t===1?"ew-resize":"default"}xm(){const t=this.Vp.Qt(),e=t.N();e.leftPriceScale.visible||this.pm===null||(this.Mm.removeChild(this.pm.Zf()),this.pm.m(),this.pm=null),e.rightPriceScale.visible||this.vm===null||(this.bm.removeChild(this.vm.Zf()),this.vm.m(),this.vm=null);const s={Bc:this.Vp.Qt().Bc()},n=()=>e.leftPriceScale.borderVisible&&t.Et().N().borderVisible,o=()=>t.Wc();e.leftPriceScale.visible&&this.pm===null&&(this.pm=new js("left",e,s,n,o),this.Mm.appendChild(this.pm.Zf())),e.rightPriceScale.visible&&this.vm===null&&(this.vm=new js("right",e,s,n,o),this.bm.appendChild(this.vm.Zf()))}}var mn;const za=!!Ct&&!!navigator.userAgentData&&navigator.userAgentData.brands.some(i=>i.brand.includes("Chromium"))&&!!Ct&&((mn=navigator==null?void 0:navigator.userAgentData)!=null&&mn.platform?navigator.userAgentData.platform==="Windows":navigator.userAgent.toLowerCase().indexOf("win")>=0);class Wa{constructor(t,e,s){var n;this.zm=[],this.Lm=[],this.Om=0,this.il=0,this.Mo=0,this.Nm=0,this.Fm=0,this.Wm=null,this.Hm=!1,this.xv=new k,this.Cv=new k,this.Xu=new k,this.Um=null,this.$m=null,this.Dp=t,this.Ps=e,this.o_=s,this.kp=document.createElement("div"),this.kp.classList.add("tv-lightweight-charts"),this.kp.style.overflow="hidden",this.kp.style.direction="ltr",this.kp.style.width="100%",this.kp.style.height="100%",(n=this.kp).style.userSelect="none",n.style.webkitUserSelect="none",n.style.msUserSelect="none",n.style.MozUserSelect="none",n.style.webkitTapHighlightColor="transparent",this.qm=document.createElement("table"),this.qm.setAttribute("cellspacing","0"),this.kp.appendChild(this.qm),this.Ym=this.jm.bind(this),Oi(this.Ps)&&this.Km(!0),this.ts=new _a(this.Gu.bind(this),this.Ps,s),this.Qt().cc().i(this.Xm.bind(this),this),this.Zm=new ka(this,this.o_),this.qm.appendChild(this.Zm.Zf());const o=e.autoSize&&this.Gm();let r=this.Ps.width,l=this.Ps.height;if(o||r===0||l===0){const a=t.getBoundingClientRect();r=r||a.width,l=l||a.height}this.Jm(r,l),this.Qm(),t.appendChild(this.kp),this.tw(),this.ts.Et().Iu().i(this.ts.Ih.bind(this.ts),this),this.ts.Vo().i(this.ts.Ih.bind(this.ts),this)}Qt(){return this.ts}N(){return this.Ps}$f(){return this.zm}iw(){return this.Zm}m(){this.Km(!1),this.Om!==0&&window.cancelAnimationFrame(this.Om),this.ts.cc().u(this),this.ts.Et().Iu().u(this),this.ts.Vo().u(this),this.ts.m();for(const t of this.zm)this.qm.removeChild(t.Zf()),t.Xv().u(this),t.Zv().u(this),t.m();this.zm=[];for(const t of this.Lm)this.sw(t);this.Lm=[],S(this.Zm).m(),this.kp.parentElement!==null&&this.kp.parentElement.removeChild(this.kp),this.Xu.m(),this.xv.m(),this.Cv.m(),this.nw()}Jm(t,e,s=!1){if(this.il===e&&this.Mo===t)return;const n=function(l){const a=Math.floor(l.width),h=Math.floor(l.height);return E({width:a-a%2,height:h-h%2})}(E({width:t,height:e}));this.il=n.height,this.Mo=n.width;const o=this.il+"px",r=this.Mo+"px";S(this.kp).style.height=o,S(this.kp).style.width=r,this.qm.style.height=o,this.qm.style.width=r,s?this.ew(z.gn(),performance.now()):this.ts.Ih()}lv(t){t===void 0&&(t=z.gn());for(let e=0;e<this.zm.length;e++)this.zm[e].lv(t.en(e).tn);this.Ps.timeScale.visible&&this.Zm.lv(t.nn())}hr(t){var n;const e=Oi(this.Ps);this.ts.hr(t);const s=Oi(this.Ps);s!==e&&this.Km(s),(n=t.layout)!=null&&n.panes&&this.rw(),this.tw(),this.hw(t)}Xv(){return this.xv}Zv(){return this.Cv}cc(){return this.Xu}aw(t=!1){this.Wm!==null&&(this.ew(this.Wm,performance.now()),this.Wm=null);const e=this.lw(null),s=document.createElement("canvas");s.width=e.width,s.height=e.height;const n=S(s.getContext("2d"));return this.lw(n,t),s}ow(t){return t==="left"&&!this._w()||t==="right"&&!this.uw()||this.zm.length===0?0:S(t==="left"?this.zm[0].nm():this.zm[0].rm()).av()}cw(){return this.Ps.autoSize&&this.Um!==null}ip(){return this.kp}dw(t){this.$m=t,this.$m?this.ip().style.setProperty("cursor",t):this.ip().style.removeProperty("cursor")}fw(){return this.$m}pw(t){return Y(this.zm[t]).Gf()}rw(){this.Lm.forEach(t=>{t.yt()})}hw(t){(t.autoSize!==void 0||!this.Um||t.width===void 0&&t.height===void 0)&&(t.autoSize&&!this.Um&&this.Gm(),t.autoSize===!1&&this.Um!==null&&this.nw(),t.autoSize||t.width===void 0&&t.height===void 0||this.Jm(t.width||this.Mo,t.height||this.il))}lw(t,e){let s=0,n=0;const o=this.zm[0],r=(a,h)=>{let c=0;for(let u=0;u<this.zm.length;u++){const f=this.zm[u],d=S(a==="left"?f.nm():f.rm()),p=d.Jf();if(t!==null&&d.Qf(t,h,c,e),c+=p.height,u<this.zm.length-1){const m=this.Lm[u],g=m.Jf();t!==null&&m.Qf(t,h,c),c+=g.height}}};this._w()&&(r("left",0),s+=S(o.nm()).Jf().width);for(let a=0;a<this.zm.length;a++){const h=this.zm[a],c=h.Jf();if(t!==null&&h.Qf(t,s,n,e),n+=c.height,a<this.zm.length-1){const u=this.Lm[a],f=u.Jf();t!==null&&u.Qf(t,s,n),n+=f.height}}s+=o.Jf().width,this.uw()&&(r("right",s),s+=S(o.rm()).Jf().width);const l=(a,h,c)=>{S(a==="left"?this.Zm.Cm():this.Zm.Pm()).Qf(S(t),h,c)};if(this.Ps.timeScale.visible){const a=this.Zm.Jf();if(t!==null){let h=0;this._w()&&(l("left",h,n),h=S(o.nm()).Jf().width),this.Zm.Qf(t,h,n,e),h+=a.width,this.uw()&&l("right",h,n)}n+=a.height}return E({width:s,height:n})}mw(){let t=0,e=0,s=0;for(const g of this.zm)this._w()&&(e=Math.max(e,S(g.nm()).nv(),this.Ps.leftPriceScale.minimumWidth)),this.uw()&&(s=Math.max(s,S(g.rm()).nv(),this.Ps.rightPriceScale.minimumWidth)),t+=g.Bo();e=Ki(e),s=Ki(s);const n=this.Mo,o=this.il,r=Math.max(n-e-s,0),l=1*this.Lm.length,a=this.Ps.timeScale.visible;let h=a?Math.max(this.Zm.Tm(),this.Ps.timeScale.minimumHeight):0;var c;h=(c=h)+c%2;const u=l+h,f=o<u?0:o-u,d=f/t;let p=0;const m=window.devicePixelRatio||1;for(let g=0;g<this.zm.length;++g){const v=this.zm[g];v.Lv(this.ts.$s()[g]);let w=0,N=0;N=g===this.zm.length-1?Math.ceil((f-p)*m)/m:Math.round(v.Bo()*d*m)/m,w=Math.max(N,2),p+=w,v.hv(E({width:r,height:w})),this._w()&&v.Jv(e,"left"),this.uw()&&v.Jv(s,"right"),v.ap()&&this.ts.dc(v.ap(),w)}this.Zm.km(E({width:a?r:0,height:h}),a?e:0,a?s:0),this.ts.Eo(r),this.Nm!==e&&(this.Nm=e),this.Fm!==s&&(this.Fm=s)}Km(t){t?this.kp.addEventListener("wheel",this.Ym,{passive:!1}):this.kp.removeEventListener("wheel",this.Ym)}ww(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return za?1/window.devicePixelRatio:1}jm(t){if(!(t.deltaX!==0&&this.Ps.handleScroll.mouseWheel||t.deltaY!==0&&this.Ps.handleScale.mouseWheel))return;const e=this.ww(t),s=e*t.deltaX/100,n=-e*t.deltaY/100;if(t.cancelable&&t.preventDefault(),n!==0&&this.Ps.handleScale.mouseWheel){const o=Math.sign(n)*Math.min(1,Math.abs(n)),r=t.clientX-this.kp.getBoundingClientRect().left;this.Qt().bc(r,o)}s!==0&&this.Ps.handleScroll.mouseWheel&&this.Qt().Sc(-80*s)}ew(t,e){var n;const s=t.nn();s===3&&this.gw(),s!==3&&s!==2||(this.Mw(t),this.bw(t,e),this.Zm.yt(),this.zm.forEach(o=>{o.Nv()}),((n=this.Wm)==null?void 0:n.nn())===3&&(this.Wm.vn(t),this.gw(),this.Mw(this.Wm),this.bw(this.Wm,e),t=this.Wm,this.Wm=null)),this.lv(t)}bw(t,e){for(const s of t.pn())this.mn(s,e)}Mw(t){const e=this.ts.$s();for(let s=0;s<e.length;s++)t.en(s).sn&&e[s].Go()}mn(t,e){const s=this.ts.Et();switch(t.an){case 0:s.Au();break;case 1:s.zu(t.Wt);break;case 2:s.dn(t.Wt);break;case 3:s.fn(t.Wt);break;case 4:s.Su();break;case 5:t.Wt.Ru(e)||s.fn(t.Wt.Du(e))}}Gu(t){this.Wm!==null?this.Wm.vn(t):this.Wm=t,this.Hm||(this.Hm=!0,this.Om=window.requestAnimationFrame(e=>{if(this.Hm=!1,this.Om=0,this.Wm!==null){const s=this.Wm;this.Wm=null,this.ew(s,e);for(const n of s.pn())if(n.an===5&&!n.Wt.Ru(e)){this.Qt()._n(n.Wt);break}}}))}gw(){this.Qm()}sw(t){this.qm.removeChild(t.Zf()),t.m()}Qm(){const t=this.ts.$s(),e=t.length,s=this.zm.length;for(let n=e;n<s;n++){const o=Y(this.zm.pop());this.qm.removeChild(o.Zf()),o.Xv().u(this),o.Zv().u(this),o.m();const r=this.Lm.pop();r!==void 0&&this.sw(r)}for(let n=s;n<e;n++){const o=new is(this,t[n]);if(o.Xv().i(this.Sw.bind(this,o),this),o.Zv().i(this.xw.bind(this,o),this),this.zm.push(o),n>0){const r=new $a(this,n-1,n);this.Lm.push(r),this.qm.insertBefore(r.Zf(),this.Zm.Zf())}this.qm.insertBefore(o.Zf(),this.Zm.Zf())}for(let n=0;n<e;n++){const o=t[n],r=this.zm[n];r.ap()!==o?r.Lv(o):r.zv()}this.tw(),this.mw()}Cw(t,e,s,n){var u;const o=new Map;t!==null&&this.ts.js().forEach(f=>{const d=f.Xs().Fr(t);d!==null&&o.set(f,d)});let r;if(t!==null){const f=(u=this.ts.Et().ss(t))==null?void 0:u.originalTime;f!==void 0&&(r=f)}const l=this.Qt().ac(),a=l!==null&&l.n_ instanceof Mi?l.n_:void 0,h=l!==null&&l.e_!==void 0?l.e_.Kn:void 0,c=this.Pw(n);return{yw:r,Re:t??void 0,kw:e??void 0,Tw:c!==-1?c:void 0,Rw:a,Dw:o,Vw:h,Bw:s??void 0}}Pw(t){let e=-1;if(t)e=this.zm.indexOf(t);else{const s=this.Qt().uc().Us();s!==null&&(e=this.Qt().$s().indexOf(s))}return e}Sw(t,e,s,n){this.xv.p(()=>this.Cw(e,s,n,t))}xw(t,e,s,n){this.Cv.p(()=>this.Cw(e,s,n,t))}Xm(t,e,s){var n;this.dw(((n=this.Qt().ac())==null?void 0:n.h_)??null),this.Xu.p(()=>this.Cw(t,e,s))}tw(){const t=this.Ps.timeScale.visible?"":"none";this.Zm.Zf().style.display=t}_w(){return this.zm[0].ap().Wo().N().visible}uw(){return this.zm[0].ap().Ho().N().visible}Gm(){return"ResizeObserver"in window&&(this.Um=new ResizeObserver(t=>{const e=t[t.length-1];e&&this.Jm(e.contentRect.width,e.contentRect.height)}),this.Um.observe(this.Dp,{box:"border-box"}),!0)}nw(){this.Um!==null&&this.Um.disconnect(),this.Um=null}}function Oi(i){return!!(i.handleScroll.mouseWheel||i.handleScale.mouseWheel)}function Oa(i){return i.open===void 0&&i.value===void 0}function Ba(i){return function(t){return t.open!==void 0}(i)||function(t){return t.value!==void 0}(i)}function qs(i,t,e,s){const n=e.value,o={Re:t,wt:i,Wt:[n,n,n,n],yw:s};return e.color!==void 0&&(o.R=e.color),o}function Ya(i,t,e,s){const n=e.value,o={Re:t,wt:i,Wt:[n,n,n,n],yw:s};return e.lineColor!==void 0&&(o.vt=e.lineColor),e.topColor!==void 0&&(o.mr=e.topColor),e.bottomColor!==void 0&&(o.wr=e.bottomColor),o}function ja(i,t,e,s){const n=e.value,o={Re:t,wt:i,Wt:[n,n,n,n],yw:s};return e.topLineColor!==void 0&&(o.gr=e.topLineColor),e.bottomLineColor!==void 0&&(o.Mr=e.bottomLineColor),e.topFillColor1!==void 0&&(o.br=e.topFillColor1),e.topFillColor2!==void 0&&(o.Sr=e.topFillColor2),e.bottomFillColor1!==void 0&&(o.Cr=e.bottomFillColor1),e.bottomFillColor2!==void 0&&(o.Pr=e.bottomFillColor2),o}function qa(i,t,e,s){const n={Re:t,wt:i,Wt:[e.open,e.high,e.low,e.close],yw:s};return e.color!==void 0&&(n.R=e.color),n}function Ha(i,t,e,s){const n={Re:t,wt:i,Wt:[e.open,e.high,e.low,e.close],yw:s};return e.color!==void 0&&(n.R=e.color),e.borderColor!==void 0&&(n.Ht=e.borderColor),e.wickColor!==void 0&&(n.vr=e.wickColor),n}function Ua(i,t,e,s,n){const o=Y(n)(e),r=Math.max(...o),l=Math.min(...o),a=o[o.length-1],h=[a,r,l,a],{time:c,color:u,...f}=e;return{Re:t,wt:i,Wt:h,yw:s,se:f,R:u}}function Pt(i){return i.Wt!==void 0}function Hs(i,t){return t.customValues!==void 0&&(i.Iw=t.customValues),i}function rt(i){return(t,e,s,n,o,r)=>function(l,a){return a?a(l):Oa(l)}(s,r)?Hs({wt:t,Re:e,yw:n},s):Hs(i(t,e,s,n,o),s)}function Us(i){return{Candlestick:rt(Ha),Bar:rt(qa),Area:rt(Ya),Baseline:rt(ja),Histogram:rt(qs),Line:rt(qs),Custom:rt(Ua)}[i]}function Js(i){return{Re:0,Ew:new Map,Hh:i}}function Qs(i,t){if(i!==void 0&&i.length!==0)return{Aw:t.key(i[0].wt),zw:t.key(i[i.length-1].wt)}}function Gs(i){let t;return i.forEach(e=>{t===void 0&&(t=e.yw)}),Y(t)}class Ja{constructor(t){this.Lw=new Map,this.Ow=new Map,this.Nw=new Map,this.Fw=[],this.o_=t}m(){this.Lw.clear(),this.Ow.clear(),this.Nw.clear(),this.Fw=[]}Ww(t,e){let s=this.Lw.size!==0,n=!1;const o=this.Ow.get(t);if(o!==void 0)if(this.Ow.size===1)s=!1,n=!0,this.Lw.clear();else for(const a of this.Fw)a.pointData.Ew.delete(t)&&(n=!0);let r=[];if(e.length!==0){const a=e.map(d=>d.time),h=this.o_.createConverterToInternalObj(e),c=Us(t.Rr()),u=t.ca(),f=t.fa();r=e.map((d,p)=>{const m=h(d.time),g=this.o_.key(m);let v=this.Lw.get(g);v===void 0&&(v=Js(m),this.Lw.set(g,v),n=!0);const w=c(m,v.Re,d,a[p],u,f);return v.Ew.set(t,w),w})}s&&this.Hw(),this.Uw(t,r);let l=-1;if(n){const a=[];this.Lw.forEach(h=>{a.push({timeWeight:0,time:h.Hh,pointData:h,originalTime:Gs(h.Ew)})}),a.sort((h,c)=>this.o_.key(h.time)-this.o_.key(c.time)),l=this.$w(a)}return this.qw(t,l,function(a,h,c){const u=Qs(a,c),f=Qs(h,c);if(u!==void 0&&f!==void 0)return{Yw:!1,zh:u.zw>=f.zw&&u.Aw>=f.Aw}}(this.Ow.get(t),o,this.o_))}Ac(t){return this.Ww(t,[])}jw(t,e,s){const n=e;(function(g){g.yw===void 0&&(g.yw=g.time)})(n),this.o_.preprocessData(e);const o=this.o_.createConverterToInternalObj([e])(e.time),r=this.Nw.get(t);if(!s&&r!==void 0&&this.o_.key(o)<this.o_.key(r))throw new Error(`Cannot update oldest data, last time=${r}, new time=${o}`);let l=this.Lw.get(this.o_.key(o));if(s&&l===void 0)throw new Error("Cannot update non-existing data point when historicalUpdate is true");const a=l===void 0;l===void 0&&(l=Js(o),this.Lw.set(this.o_.key(o),l));const h=Us(t.Rr()),c=t.ca(),u=t.fa(),f=h(o,l.Re,e,n.yw,c,u);l.Ew.set(t,f),s?this.Kw(t,f,l.Re):this.Xw(t,f);const d={zh:Pt(f),Yw:s};if(!a)return this.qw(t,-1,d);const p={timeWeight:0,time:l.Hh,pointData:l,originalTime:Gs(l.Ew)},m=_t(this.Fw,this.o_.key(p.time),(g,v)=>this.o_.key(g.time)<v);this.Fw.splice(m,0,p);for(let g=m;g<this.Fw.length;++g)Ut(this.Fw[g].pointData,g);return this.o_.fillWeightsForPoints(this.Fw,m),this.qw(t,m,d)}Zw(t,e){const s=this.Ow.get(t);if(s===void 0||e<=0)return[[],this.Gw()];e=Math.min(e,s.length);const n=s.splice(-e).reverse();s.length===0?this.Nw.delete(t):this.Nw.set(t,s[s.length-1].wt);for(const o of n){const r=this.Lw.get(this.o_.key(o.wt));if(r&&(r.Ew.delete(t),r.Ew.size===0)){this.Lw.delete(this.o_.key(r.Hh)),this.Fw.splice(r.Re,1);for(let l=r.Re;l<this.Fw.length;++l)Ut(this.Fw[l].pointData,l)}}return[n,this.qw(t,this.Fw.length-1,{Yw:!1,zh:!1})]}Xw(t,e){let s=this.Ow.get(t);s===void 0&&(s=[],this.Ow.set(t,s));const n=s.length!==0?s[s.length-1]:null;n===null||this.o_.key(e.wt)>this.o_.key(n.wt)?Pt(e)&&s.push(e):Pt(e)?s[s.length-1]=e:s.splice(-1,1),this.Nw.set(t,e.wt)}Kw(t,e,s){const n=this.Ow.get(t);if(n===void 0)return;const o=_t(n,s,(r,l)=>r.Re<l);Pt(e)?n[o]=e:n.splice(o,1)}Uw(t,e){e.length!==0?(this.Ow.set(t,e.filter(Pt)),this.Nw.set(t,e[e.length-1].wt)):(this.Ow.delete(t),this.Nw.delete(t))}Hw(){for(const t of this.Fw)t.pointData.Ew.size===0&&this.Lw.delete(this.o_.key(t.time))}$w(t){let e=-1;for(let s=0;s<this.Fw.length&&s<t.length;++s){const n=this.Fw[s],o=t[s];if(this.o_.key(n.time)!==this.o_.key(o.time)){e=s;break}o.timeWeight=n.timeWeight,Ut(o.pointData,s)}if(e===-1&&this.Fw.length!==t.length&&(e=Math.min(this.Fw.length,t.length)),e===-1)return-1;for(let s=e;s<t.length;++s)Ut(t[s].pointData,s);return this.o_.fillWeightsForPoints(t,e),this.Fw=t,e}Jw(){if(this.Ow.size===0)return null;let t=0;return this.Ow.forEach(e=>{e.length!==0&&(t=Math.max(t,e[e.length-1].Re))}),t}qw(t,e,s){const n=this.Gw();if(e!==-1)this.Ow.forEach((o,r)=>{n.Oo.set(r,{se:o,Qw:r===t?s:void 0})}),this.Ow.has(t)||n.Oo.set(t,{se:[],Qw:s}),n.Et.tg=this.Fw,n.Et.ig=e;else{const o=this.Ow.get(t);n.Oo.set(t,{se:o||[],Qw:s})}return n}Gw(){return{Oo:new Map,Et:{_u:this.Jw()}}}}function Ut(i,t){i.Re=t,i.Ew.forEach(e=>{e.Re=t})}function Qa(i,t){return i.wt<t}function Ga(i,t){return t<i.wt}function Ka(i,t,e){const s=t.Uh(),n=t.bi(),o=_t(i,s,Qa),r=Sn(i,n,Ga);if(!e)return{from:o,to:r};let l=o,a=r;return o>0&&o<i.length&&i[o].wt>=s&&(l=o-1),r>0&&r<i.length&&i[r-1].wt<=n&&(a=r+1),{from:l,to:a}}class ns{constructor(t,e,s){this.sg=!0,this.ng=!0,this.eg=!0,this.rg=[],this.hg=null,this.Jn=t,this.Qn=e,this.ag=s}yt(t){this.sg=!0,t==="data"&&(this.ng=!0),t==="options"&&(this.eg=!0)}Tt(){return this.Jn.Vt()?(this.lg(),this.hg===null?null:this.og):null}_g(){this.rg=this.rg.map(t=>({...t,...this.Jn.Rh().Dr(t.wt)}))}ug(){this.hg=null}lg(){this.ng&&(this.cg(),this.ng=!1),this.eg&&(this._g(),this.eg=!1),this.sg&&(this.dg(),this.sg=!1)}dg(){const t=this.Jn.Ft(),e=this.Qn.Et();if(this.ug(),e.Ki()||t.Ki())return;const s=e.Pe();if(s===null||this.Jn.Xs().zr()===0)return;const n=this.Jn.zt();n!==null&&(this.hg=Ka(this.rg,s,this.ag),this.fg(t,e,n.Wt),this.pg())}}class Za{constructor(t,e){this.vg=t,this.Yi=e}nt(t,e,s){this.vg.draw(t,this.Yi,e,s)}}class Xa extends ns{constructor(t,e,s){super(t,e,!1),this.sh=s,this.og=new Za(this.sh.renderer(),n=>{const o=t.zt();return o===null?null:t.Ft().Nt(n,o.Wt)})}da(t){return this.sh.priceValueBuilder(t)}pa(t){return this.sh.isWhitespace(t)}cg(){const t=this.Jn.Rh();this.rg=this.Jn.Xs().Hr().map(e=>({wt:e.Re,_t:NaN,...t.Dr(e.Re),mg:e.se}))}fg(t,e){e.uu(this.rg,Dt(this.hg))}pg(){this.sh.update({bars:this.rg.map(th),barSpacing:this.Qn.Et().mu(),visibleRange:this.hg},this.Jn.N())}}function th(i){return{x:i._t,time:i.wt,originalData:i.mg,barColor:i.cr}}const eh={color:"#2196f3"},ih=(i,t,e)=>{const s=ot(e);return new Xa(i,t,s)};function os(i){const t={value:i.Wt[3],time:i.yw};return i.Iw!==void 0&&(t.customValues=i.Iw),t}function Ks(i){const t=os(i);return i.R!==void 0&&(t.color=i.R),t}function sh(i){const t=os(i);return i.vt!==void 0&&(t.lineColor=i.vt),i.mr!==void 0&&(t.topColor=i.mr),i.wr!==void 0&&(t.bottomColor=i.wr),t}function nh(i){const t=os(i);return i.gr!==void 0&&(t.topLineColor=i.gr),i.Mr!==void 0&&(t.bottomLineColor=i.Mr),i.br!==void 0&&(t.topFillColor1=i.br),i.Sr!==void 0&&(t.topFillColor2=i.Sr),i.Cr!==void 0&&(t.bottomFillColor1=i.Cr),i.Pr!==void 0&&(t.bottomFillColor2=i.Pr),t}function Vn(i){const t={open:i.Wt[0],high:i.Wt[1],low:i.Wt[2],close:i.Wt[3],time:i.yw};return i.Iw!==void 0&&(t.customValues=i.Iw),t}function oh(i){const t=Vn(i);return i.R!==void 0&&(t.color=i.R),t}function rh(i){const t=Vn(i),{R:e,Ht:s,vr:n}=i;return e!==void 0&&(t.color=e),s!==void 0&&(t.borderColor=s),n!==void 0&&(t.wickColor=n),t}function Qt(i){return{Area:sh,Line:Ks,Baseline:nh,Histogram:Ks,Bar:oh,Candlestick:rh,Custom:lh}[i]}function lh(i){const t=i.yw;return{...i.se,time:t}}const ah={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},hh={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},ch={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:wn,panes:{enableResize:!0,separatorColor:"#E0E3EB",separatorHoverColor:"rgba(178, 181, 189, 0.2)"},attributionLogo:!0,colorSpace:"srgb",colorParsers:[]},Bi={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0,ensureEdgeTickMarksVisible:!1},uh={rightOffset:0,barSpacing:6,minBarSpacing:.5,maxBarSpacing:0,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0,ignoreWhitespaceIndices:!1};function Zs(){return{addDefaultPane:!0,width:0,height:0,autoSize:!1,layout:ch,crosshair:ah,grid:hh,overlayPriceScales:{...Bi},leftPriceScale:{...Bi,visible:!1},rightPriceScale:{...Bi,visible:!0},timeScale:uh,localization:{locale:Ct?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}class Dn{constructor(t,e,s){this.Hf=t,this.wg=e,this.gg=s??0}applyOptions(t){this.Hf.Qt().oc(this.wg,t,this.gg)}options(){return this.Yi().N()}width(){return yi(this.wg)?this.Hf.ow(this.wg):0}setVisibleRange(t){this.setAutoScale(!1),this.Yi().Fl(new O(t.from,t.to))}getVisibleRange(){let t,e,s=this.Yi().Qe();if(s===null)return null;if(this.Yi().Ja()){const n=this.Yi().fo(),o=Tn(n);s=wt(s,this.Yi().tl()),t=Number((Math.round(s.$e()/n)*n).toFixed(o)),e=Number((Math.round(s.qe()/n)*n).toFixed(o))}else t=s.$e(),e=s.qe();return{from:t,to:e}}setAutoScale(t){this.applyOptions({autoScale:t})}Yi(){return S(this.Hf.Qt()._c(this.wg,this.gg)).Ft}}class fh{constructor(t,e,s,n){this.Hf=t,this.Pt=s,this.Mg=e,this.bg=n}getHeight(){return this.Pt.$t()}setHeight(t){const e=this.Hf.Qt(),s=e.Uc(this.Pt);e.vc(s,t)}getStretchFactor(){return this.Pt.Bo()}setStretchFactor(t){this.Pt.Io(t),this.Hf.Qt().Ih()}paneIndex(){return this.Hf.Qt().Uc(this.Pt)}moveTo(t){const e=this.paneIndex();e!==t&&(W(t>=0&&t<this.Hf.$f().length,"Invalid pane index"),this.Hf.Qt().wc(e,t))}getSeries(){return this.Pt.Oo().map(t=>this.Mg(t))??[]}getHTMLElement(){const t=this.Hf.$f();return t&&t.length!==0&&t[this.paneIndex()]?t[this.paneIndex()].Zf():null}attachPrimitive(t){this.Pt._a(t),t.attached&&t.attached({chart:this.bg,requestUpdate:()=>this.Pt.Qt().Ih()})}detachPrimitive(t){this.Pt.ua(t)}priceScale(t){if(this.Pt.Do(t)===null)throw new Error(`Cannot find price scale with id: ${t}`);return new Dn(this.Hf,t,this.paneIndex())}setPreserveEmptyPane(t){this.Pt.zo(t)}preserveEmptyPane(){return this.Pt.Lo()}addCustomSeries(t,e={},s=0){return this.bg.addCustomSeries(t,e,s)}addSeries(t,e={}){return this.bg.addSeries(t,e,this.paneIndex())}}const dh={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};class Xs{constructor(t){this.ir=t}applyOptions(t){this.ir.hr(t)}options(){return this.ir.N()}Sg(){return this.ir}}class ph{constructor(t,e,s,n,o,r){this.xg=new k,this.Jn=t,this.Cg=e,this.Pg=s,this.o_=o,this.bg=n,this.yg=r}m(){this.xg.m()}priceFormatter(){return this.Jn.ea()}priceToCoordinate(t){const e=this.Jn.zt();return e===null?null:this.Jn.Ft().Nt(t,e.Wt)}coordinateToPrice(t){const e=this.Jn.zt();return e===null?null:this.Jn.Ft().Ts(t,e.Wt)}barsInLogicalRange(t){if(t===null)return null;const e=new Nt(new Lt(t.from,t.to)).y_(),s=this.Jn.Xs();if(s.Ki())return null;const n=s.Fr(e.Uh(),1),o=s.Fr(e.bi(),-1),r=S(s.Lr()),l=S(s.Ks());if(n!==null&&o!==null&&n.Re>o.Re)return{barsBefore:t.from-r,barsAfter:l-t.to};const a={barsBefore:n===null||n.Re===r?t.from-r:n.Re-r,barsAfter:o===null||o.Re===l?l-t.to:l-o.Re};return n!==null&&o!==null&&(a.from=n.yw,a.to=o.yw),a}setData(t){this.o_,this.Jn.Rr(),this.Cg.kg(this.Jn,t),this.Tg("full")}update(t,e=!1){this.Jn.Rr(),this.Cg.Rg(this.Jn,t,e),this.Tg("update")}pop(t=1){const e=this.Cg.Dg(this.Jn,t);e.length!==0&&this.Tg("update");const s=Qt(this.seriesType());return e.map(n=>s(n))}dataByIndex(t,e){const s=this.Jn.Xs().Fr(t,e);return s===null?null:Qt(this.seriesType())(s)}data(){const t=Qt(this.seriesType());return this.Jn.Xs().Hr().map(e=>t(e))}subscribeDataChanged(t){this.xg.i(t)}unsubscribeDataChanged(t){this.xg._(t)}applyOptions(t){this.Jn.hr(t)}options(){return X(this.Jn.N())}priceScale(){return this.Pg.priceScale(this.Jn.Ft().ma(),this.getPane().paneIndex())}createPriceLine(t){const e=H(X(dh),t),s=this.Jn.Oh(e);return new Xs(s)}removePriceLine(t){this.Jn.Nh(t.Sg())}priceLines(){return this.Jn.Fh().map(t=>new Xs(t))}seriesType(){return this.Jn.Rr()}lastValueData(t){const e=this.Jn.ye(t);return e.ke?{noData:!0}:{noData:!1,price:e.gt,color:e.R}}attachPrimitive(t){this.Jn._a(t),t.attached&&t.attached({chart:this.bg,series:this,requestUpdate:()=>this.Jn.Qt().Ih(),horzScaleBehavior:this.o_})}detachPrimitive(t){this.Jn.ua(t),t.detached&&t.detached(),this.Jn.Qt().Ih()}getPane(){const t=this.Jn,e=S(this.Jn.Qt().Hn(t));return this.yg(e)}moveToPane(t){this.Jn.Qt().Nc(this.Jn,t)}seriesOrder(){const t=this.Jn.Qt().Hn(this.Jn);return t===null?-1:t.Oo().indexOf(this.Jn)}setSeriesOrder(t){const e=this.Jn.Qt().Hn(this.Jn);e!==null&&e.Qo(this.Jn,t)}Tg(t){this.xg.v()&&this.xg.p(t)}}class mh{constructor(t,e,s){this.Vg=new k,this.z_=new k,this.gm=new k,this.ts=t,this.uh=t.Et(),this.Zm=e,this.uh.Vu().i(this.Bg.bind(this)),this.uh.Bu().i(this.Ig.bind(this)),this.Zm.ym().i(this.Eg.bind(this)),this.o_=s}m(){this.uh.Vu().u(this),this.uh.Bu().u(this),this.Zm.ym().u(this),this.Vg.m(),this.z_.m(),this.gm.m()}scrollPosition(){return this.uh.gu()}scrollToPosition(t,e){e?this.uh.Tu(t,1e3):this.ts.fn(t)}scrollToRealTime(){this.uh.ku()}getVisibleRange(){const t=this.uh.nu();return t===null?null:{from:t.from.originalTime,to:t.to.originalTime}}setVisibleRange(t){const e={from:this.o_.convertHorzItemToInternal(t.from),to:this.o_.convertHorzItemToInternal(t.to)},s=this.uh.au(e);this.ts.Lc(s)}getVisibleLogicalRange(){const t=this.uh.su();return t===null?null:{from:t.Uh(),to:t.bi()}}setVisibleLogicalRange(t){W(t.from<=t.to,"The from index cannot be after the to index."),this.ts.Lc(t)}resetTimeScale(){this.ts.cn()}fitContent(){this.ts.Au()}logicalToCoordinate(t){const e=this.ts.Et();return e.Ki()?null:e.qt(t)}coordinateToLogical(t){return this.uh.Ki()?null:this.uh.cu(t)}timeToIndex(t,e){const s=this.o_.convertHorzItemToInternal(t);return this.uh.Q_(s,e)}timeToCoordinate(t){const e=this.timeToIndex(t,!1);return e===null?null:this.uh.qt(e)}coordinateToTime(t){const e=this.ts.Et(),s=e.cu(t),n=e.ss(s);return n===null?null:n.originalTime}width(){return this.Zm.Gf().width}height(){return this.Zm.Gf().height}subscribeVisibleTimeRangeChange(t){this.Vg.i(t)}unsubscribeVisibleTimeRangeChange(t){this.Vg._(t)}subscribeVisibleLogicalRangeChange(t){this.z_.i(t)}unsubscribeVisibleLogicalRangeChange(t){this.z_._(t)}subscribeSizeChange(t){this.gm.i(t)}unsubscribeSizeChange(t){this.gm._(t)}applyOptions(t){this.uh.hr(t)}options(){return{...X(this.uh.N()),barSpacing:this.uh.mu()}}Bg(){this.Vg.v()&&this.Vg.p(this.getVisibleRange())}Ig(){this.z_.v()&&this.z_.p(this.getVisibleLogicalRange())}Eg(t){this.gm.p(t.width,t.height)}}function tn(i){return function(t){if(Wt(t.handleScale)){const s=t.handleScale;t.handleScale={axisDoubleClickReset:{time:s,price:s},axisPressedMouseMove:{time:s,price:s},mouseWheel:s,pinch:s}}else if(t.handleScale!==void 0){const{axisPressedMouseMove:s,axisDoubleClickReset:n}=t.handleScale;Wt(s)&&(t.handleScale.axisPressedMouseMove={time:s,price:s}),Wt(n)&&(t.handleScale.axisDoubleClickReset={time:n,price:n})}const e=t.handleScroll;Wt(e)&&(t.handleScroll={horzTouchDrag:e,vertTouchDrag:e,mouseWheel:e,pressedMouseMove:e})}(i),i}class gh{constructor(t,e,s){this.Ag=new Map,this.zg=new Map,this.Lg=new k,this.Og=new k,this.Ng=new k,this.qu=new WeakMap,this.Fg=new Ja(e);const n=s===void 0?X(Zs()):H(X(Zs()),tn(s));this.Wg=e,this.Hf=new Wa(t,n,e),this.Hf.Xv().i(r=>{this.Lg.v()&&this.Lg.p(this.Hg(r()))},this),this.Hf.Zv().i(r=>{this.Og.v()&&this.Og.p(this.Hg(r()))},this),this.Hf.cc().i(r=>{this.Ng.v()&&this.Ng.p(this.Hg(r()))},this);const o=this.Hf.Qt();this.Ug=new mh(o,this.Hf.iw(),this.Wg)}remove(){this.Hf.Xv().u(this),this.Hf.Zv().u(this),this.Hf.cc().u(this),this.Ug.m(),this.Hf.m(),this.Ag.clear(),this.zg.clear(),this.Lg.m(),this.Og.m(),this.Ng.m(),this.Fg.m()}resize(t,e,s){this.autoSizeActive()||this.Hf.Jm(t,e,s)}addCustomSeries(t,e={},s=0){const n=(o=>({type:"Custom",isBuiltIn:!1,defaultOptions:{...eh,...o.defaultOptions()},$g:ih,qg:o}))(ot(t));return this.Yg(n,e,s)}addSeries(t,e={},s=0){return this.Yg(t,e,s)}removeSeries(t){const e=Y(this.Ag.get(t)),s=this.Fg.Ac(e);this.Hf.Qt().Ac(e),this.jg(s),this.Ag.delete(t),this.zg.delete(e)}kg(t,e){this.jg(this.Fg.Ww(t,e))}Rg(t,e,s){this.jg(this.Fg.jw(t,e,s))}Dg(t,e){const[s,n]=this.Fg.Zw(t,e);return s.length!==0&&this.jg(n),s}subscribeClick(t){this.Lg.i(t)}unsubscribeClick(t){this.Lg._(t)}subscribeCrosshairMove(t){this.Ng.i(t)}unsubscribeCrosshairMove(t){this.Ng._(t)}subscribeDblClick(t){this.Og.i(t)}unsubscribeDblClick(t){this.Og._(t)}priceScale(t,e=0){return new Dn(this.Hf,t,e)}timeScale(){return this.Ug}applyOptions(t){this.Hf.hr(tn(t))}options(){return this.Hf.N()}takeScreenshot(t=!1,e=!1){let s,n;try{e||(s=this.Hf.Qt().N().crosshair.mode,this.Hf.hr({crosshair:{mode:2}})),n=this.Hf.aw(t)}finally{e||s===void 0||this.Hf.Qt().hr({crosshair:{mode:s}})}return n}addPane(t=!1){const e=this.Hf.Qt().$c();return e.zo(t),this.Kg(e)}removePane(t){this.Hf.Qt().fc(t)}swapPanes(t,e){this.Hf.Qt().mc(t,e)}autoSizeActive(){return this.Hf.cw()}chartElement(){return this.Hf.ip()}panes(){return this.Hf.Qt().$s().map(t=>this.Kg(t))}paneSize(t=0){const e=this.Hf.pw(t);return{height:e.height,width:e.width}}setCrosshairPosition(t,e,s){const n=this.Ag.get(s);if(n===void 0)return;const o=this.Hf.Qt().Hn(n);o!==null&&this.Hf.Qt().Rc(t,e,o)}clearCrosshairPosition(){this.Hf.Qt().Dc(!0)}horzBehaviour(){return this.Wg}Yg(t,e={},s=0){W(t.$g!==void 0),function(a){if(a===void 0||a.type==="custom")return;const h=a;h.minMove!==void 0&&h.precision===void 0&&(h.precision=Tn(h.minMove))}(e.priceFormat),t.type==="Candlestick"&&function(a){a.borderColor!==void 0&&(a.borderUpColor=a.borderColor,a.borderDownColor=a.borderColor),a.wickColor!==void 0&&(a.wickUpColor=a.wickColor,a.wickDownColor=a.wickColor)}(e);const n=H(X(gn),X(t.defaultOptions),e),o=t.$g,r=new Mi(this.Hf.Qt(),t.type,n,o,t.qg);this.Hf.Qt().Ic(r,s);const l=new ph(r,this,this,this,this.Wg,a=>this.Kg(a));return this.Ag.set(l,r),this.zg.set(r,l),l}jg(t){const e=this.Hf.Qt();e.Vc(t.Et._u,t.Et.tg,t.Et.ig),t.Oo.forEach((s,n)=>n.ht(s.se,s.Qw)),e.Et().K_(),e.vu()}Xg(t){return Y(this.zg.get(t))}Hg(t){const e=new Map;t.Dw.forEach((n,o)=>{const r=o.Rr(),l=Qt(r)(n);if(r!=="Custom")W(Ba(l));else{const a=o.fa();W(!a||a(l)===!1)}e.set(this.Xg(o),l)});const s=t.Rw!==void 0&&this.zg.has(t.Rw)?this.Xg(t.Rw):void 0;return{time:t.yw,logical:t.Re,point:t.kw,paneIndex:t.Tw,hoveredSeries:s,hoveredObjectId:t.Vw,seriesData:e,sourceEvent:t.Bw}}Kg(t){let e=this.qu.get(t);return e||(e=new fh(this.Hf,s=>this.Xg(s),t,this),this.qu.set(t,e)),e}}function vh(i){if(Rt(i)){const t=document.getElementById(i);return W(t!==null,`Cannot find element in DOM with id=${i}`),t}return i}function wh(i,t,e){const s=vh(i),n=new gh(s,t,e);return t.setOptions(n.options()),n}function yh(i,t){return wh(i,new Rs,Rs.ld(t))}class Nh extends ns{constructor(t,e){super(t,e,!0)}fg(t,e,s){e.uu(this.rg,Dt(this.hg)),t.Ul(this.rg,s,Dt(this.hg))}Zg(t,e){return{wt:t,gt:e,_t:NaN,ut:NaN}}cg(){const t=this.Jn.Rh();this.rg=this.Jn.Xs().Hr().map(e=>{const s=e.Wt[3];return this.Gg(e.Re,s,t)})}}function Mh(i,t,e,s,n,o,r){if(t.length===0||s.from>=t.length||s.to<=0)return;const{context:l,horizontalPixelRatio:a,verticalPixelRatio:h}=i,c=t[s.from];let u=o(i,c),f=c;if(s.to-s.from<2){const d=n/2;l.beginPath();const p={_t:c._t-d,ut:c.ut},m={_t:c._t+d,ut:c.ut};l.moveTo(p._t*a,p.ut*h),l.lineTo(m._t*a,m.ut*h),r(i,u,p,m)}else{const d=(m,g)=>{r(i,u,f,g),l.beginPath(),u=m,f=g};let p=f;l.beginPath(),l.moveTo(c._t*a,c.ut*h);for(let m=s.from+1;m<s.to;++m){p=t[m];const g=o(i,p);switch(e){case 0:l.lineTo(p._t*a,p.ut*h);break;case 1:l.lineTo(p._t*a,t[m-1].ut*h),g!==u&&(d(g,p),l.lineTo(p._t*a,t[m-1].ut*h)),l.lineTo(p._t*a,p.ut*h);break;case 2:{const[v,w]=bh(t,m-1,m);l.bezierCurveTo(v._t*a,v.ut*h,w._t*a,w.ut*h,p._t*a,p.ut*h);break}}e!==1&&g!==u&&(d(g,p),l.moveTo(p._t*a,p.ut*h))}(f!==p||f===p&&e===1)&&r(i,u,f,p)}}const en=6;function Yi(i,t){return{_t:i._t-t._t,ut:i.ut-t.ut}}function sn(i,t){return{_t:i._t/t,ut:i.ut/t}}function bh(i,t,e){const s=Math.max(0,t-1),n=Math.min(i.length-1,e+1);var o,r;return[(o=i[t],r=sn(Yi(i[e],i[s]),en),{_t:o._t+r._t,ut:o.ut+r.ut}),Yi(i[e],sn(Yi(i[n],i[t]),en))]}function xh(i,t){const e=i.context;e.strokeStyle=t,e.stroke()}class _h extends pt{constructor(){super(...arguments),this.rt=null}ht(t){this.rt=t}et(t){if(this.rt===null)return;const{ot:e,lt:s,Jg:n,Qg:o,ct:r,Xt:l,tM:a}=this.rt;if(s===null)return;const h=t.context;h.lineCap="butt",h.lineWidth=r*t.verticalPixelRatio,ct(h,l),h.lineJoin="round";const c=this.iM.bind(this);o!==void 0&&Mh(t,e,o,s,n,c,xh),a&&function(u,f,d,p,m){if(p.to-p.from<=0)return;const{horizontalPixelRatio:g,verticalPixelRatio:v,context:w}=u;let N=null;const x=Math.max(1,Math.floor(g))%2/2,M=d*v+x;for(let _=p.to-1;_>=p.from;--_){const C=f[_];if(C){const A=m(u,C);A!==N&&(w.beginPath(),N!==null&&w.fill(),w.fillStyle=A,N=A);const L=Math.round(C._t*g)+x,P=C.ut*v;w.moveTo(L,P),w.arc(L,P,M,0,2*Math.PI)}}w.fill()}(t,e,a,s,c)}}class Ch extends _h{iM(t,e){return e.vt}}class Sh extends Nh{constructor(){super(...arguments),this.og=new Ch}Gg(t,e,s){return{...this.Zg(t,e),...s.Dr(t)}}pg(){const t=this.Jn.N(),e={ot:this.rg,Xt:t.lineStyle,Qg:t.lineVisible?t.lineType:void 0,ct:t.lineWidth,tM:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0,lt:this.hg,Jg:this.Qn.Et().mu()};this.og.ht(e)}}const Ah={type:"Line",isBuiltIn:!0,defaultOptions:{color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},$g:(i,t)=>new Sh(i,t)};class Ph extends ns{constructor(t,e){super(t,e,!1)}fg(t,e,s){e.uu(this.rg,Dt(this.hg)),t.ql(this.rg,s,Dt(this.hg))}VM(t,e,s){return{wt:t,qh:e.Wt[0],Yh:e.Wt[1],jh:e.Wt[2],Kh:e.Wt[3],_t:NaN,Yl:NaN,jl:NaN,Kl:NaN,Xl:NaN}}cg(){const t=this.Jn.Rh();this.rg=this.Jn.Xs().Hr().map(e=>this.Gg(e.Re,e,t))}}class Ih extends pt{constructor(){super(...arguments),this.Yt=null,this.yM=0}ht(t){this.Yt=t}et(t){if(this.Yt===null||this.Yt.Xs.length===0||this.Yt.lt===null)return;const{horizontalPixelRatio:e}=t;this.yM=function(o,r){if(o>=2.5&&o<=4)return Math.floor(3*r);const l=1-.2*Math.atan(Math.max(4,o)-4)/(.5*Math.PI),a=Math.floor(o*l*r),h=Math.floor(o*r),c=Math.min(a,h);return Math.max(Math.floor(r),c)}(this.Yt.mu,e),this.yM>=2&&Math.floor(e)%2!=this.yM%2&&this.yM--;const s=this.Yt.Xs;this.Yt.BM&&this.IM(t,s,this.Yt.lt),this.Yt.Mi&&this.uv(t,s,this.Yt.lt);const n=this.EM(e);(!this.Yt.Mi||this.yM>2*n)&&this.AM(t,s,this.Yt.lt)}IM(t,e,s){if(this.Yt===null)return;const{context:n,horizontalPixelRatio:o,verticalPixelRatio:r}=t;let l="",a=Math.min(Math.floor(o),Math.floor(this.Yt.mu*o));a=Math.max(Math.floor(o),Math.min(a,this.yM));const h=Math.floor(.5*a);let c=null;for(let u=s.from;u<s.to;u++){const f=e[u];f.pr!==l&&(n.fillStyle=f.pr,l=f.pr);const d=Math.round(Math.min(f.Yl,f.Xl)*r),p=Math.round(Math.max(f.Yl,f.Xl)*r),m=Math.round(f.jl*r),g=Math.round(f.Kl*r);let v=Math.round(o*f._t)-h;const w=v+a-1;c!==null&&(v=Math.max(c+1,v),v=Math.min(v,w));const N=w-v+1;n.fillRect(v,m,N,d-m),n.fillRect(v,p+1,N,g-p),c=w}}EM(t){let e=Math.floor(1*t);this.yM<=2*e&&(e=Math.floor(.5*(this.yM-1)));const s=Math.max(Math.floor(t),e);return this.yM<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}uv(t,e,s){if(this.Yt===null)return;const{context:n,horizontalPixelRatio:o,verticalPixelRatio:r}=t;let l="";const a=this.EM(o);let h=null;for(let c=s.from;c<s.to;c++){const u=e[c];u.dr!==l&&(n.fillStyle=u.dr,l=u.dr);let f=Math.round(u._t*o)-Math.floor(.5*this.yM);const d=f+this.yM-1,p=Math.round(Math.min(u.Yl,u.Xl)*r),m=Math.round(Math.max(u.Yl,u.Xl)*r);if(h!==null&&(f=Math.max(h+1,f),f=Math.min(f,d)),this.Yt.mu*o>2*a)Tl(n,f,p,d-f+1,m-p+1,a);else{const g=d-f+1;n.fillRect(f,p,g,m-p+1)}h=d}}AM(t,e,s){if(this.Yt===null)return;const{context:n,horizontalPixelRatio:o,verticalPixelRatio:r}=t;let l="";const a=this.EM(o);for(let h=s.from;h<s.to;h++){const c=e[h];let u=Math.round(Math.min(c.Yl,c.Xl)*r),f=Math.round(Math.max(c.Yl,c.Xl)*r),d=Math.round(c._t*o)-Math.floor(.5*this.yM),p=d+this.yM-1;if(c.cr!==l){const m=c.cr;n.fillStyle=m,l=m}this.Yt.Mi&&(d+=a,u+=a,p-=a,f-=a),u>f||n.fillRect(d,u,p-d+1,f-u+1)}}}class $h extends Ph{constructor(){super(...arguments),this.og=new Ih}Gg(t,e,s){return{...this.VM(t,e,s),...s.Dr(t)}}pg(){const t=this.Jn.N();this.og.ht({Xs:this.rg,mu:this.Qn.Et().mu(),BM:t.wickVisible,Mi:t.borderVisible,lt:this.hg})}}const Th={type:"Candlestick",isBuiltIn:!0,defaultOptions:{upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},$g:(i,t)=>new $h(i,t)};({...gn});class Lh{constructor(t){V(this,"chart");V(this,"candlestickSeries");V(this,"indicatorSeries",new Map);V(this,"indicatorPanes",new Map);V(this,"container");this.container=t,this.chart=yh(t,{layout:{background:{type:Qi.Solid,color:"#1e222d"},textColor:"#d1d4dc"},grid:{vertLines:{color:"#2b2b43"},horzLines:{color:"#2b2b43"}},crosshair:{mode:1},rightPriceScale:{borderColor:"#2b2b43"},timeScale:{borderColor:"#2b2b43",timeVisible:!0,secondsVisible:!1}}),this.candlestickSeries=this.chart.addSeries(Th,{upColor:"#26a69a",downColor:"#ef5350",borderVisible:!1,wickUpColor:"#26a69a",wickDownColor:"#ef5350"}),new ResizeObserver(()=>{const{width:s,height:n}=t.getBoundingClientRect();this.chart.resize(s,n)}).observe(t)}setCandlestickData(t){const e=fl(t);this.candlestickSeries.setData(e),this.chart.timeScale().fitContent()}setIndicatorData(t,e,s={}){console.log("[ChartManager] setIndicatorData - id:",t),console.log("[ChartManager] setIndicatorData - data length:",e.length),console.log("[ChartManager] setIndicatorData - first 3 values:",e.slice(0,3).map(r=>({time:r.time,value:r.value,valueType:typeof r.value}))),console.log("[ChartManager] setIndicatorData - config:",s);let n=this.indicatorSeries.get(t);if(!n){const r=s.lineWidth&&s.lineWidth>=1&&s.lineWidth<=4?s.lineWidth:2;if(n=this.chart.addSeries(Ah,{color:s.color||"#2962FF",lineWidth:r,lineStyle:s.lineStyle??Ji.Solid,crosshairMarkerVisible:!0,crosshairMarkerRadius:4}),s.overlay===!1){const l=s.paneIndex??this.getNextPaneIndex();n.moveToPane(l),this.indicatorPanes.set(t,l)}else n.moveToPane(0),this.indicatorPanes.set(t,0);this.indicatorSeries.set(t,n)}const o=e.filter(r=>r.value!=null&&!Number.isNaN(r.value));console.log("[ChartManager] setIndicatorData - filtered data length:",o.length),n.setData(o)}getNextPaneIndex(){const t=new Set(this.indicatorPanes.values());let e=1;for(;t.has(e);)e++;return e}removeIndicator(t){const e=this.indicatorSeries.get(t);e&&(this.chart.removeSeries(e),this.indicatorSeries.delete(t),this.indicatorPanes.delete(t))}clearIndicators(){for(const[t,e]of this.indicatorSeries)this.chart.removeSeries(e);this.indicatorSeries.clear(),this.indicatorPanes.clear(),this.removeEmptyPanes()}removeEmptyPanes(){const t=this.chart.panes();for(let e=t.length-1;e>0;e--)t[e].getSeries().length===0&&this.chart.removePane(e)}getChart(){return this.chart}fitContent(){this.chart.timeScale().fitContent()}}var Eh=Object.defineProperty,j=(i,t)=>{for(var e in t)Eh(i,e,{get:t[e],enumerable:!0})},Vh={};j(Vh,{alma:()=>io,atr:()=>as,barssince:()=>jh,bb:()=>rs,bbw:()=>Qh,cci:()=>Kn,change:()=>Wn,cmo:()=>Jh,cog:()=>sc,correlation:()=>kh,cross:()=>Yn,crossover:()=>kn,crossunder:()=>zn,cum:()=>Bn,dev:()=>Jn,dmi:()=>Hh,ema:()=>Q,falling:()=>qn,highest:()=>Mt,highestbars:()=>Xh,hma:()=>Oh,ichimoku:()=>oo,kc:()=>to,kcw:()=>Kh,linreg:()=>Gn,lowest:()=>bt,lowestbars:()=>tc,macd:()=>Rn,max:()=>ec,median:()=>Fh,mfi:()=>Wh,min:()=>ic,mode:()=>nc,mom:()=>Un,percentile_linear_interpolation:()=>so,percentile_nearest_rank:()=>no,percentrank:()=>zh,pivot_point_levels:()=>rc,pivothigh:()=>Bh,pivotlow:()=>Yh,range:()=>Zh,rci:()=>oc,rising:()=>jn,rma:()=>et,roc:()=>Hn,rsi:()=>Fn,sar:()=>Xn,sma:()=>it,stdev:()=>ls,stoch:()=>Zn,supertrend:()=>On,swma:()=>Rh,tr:()=>kt,tsi:()=>Uh,valuewhen:()=>qh,variance:()=>Dh,vwap:()=>eo,vwma:()=>Qn,wma:()=>Et,wpr:()=>Gh,zigzag:()=>ro});function it(i,t){const e=[],s=Math.floor(t);for(let n=0;n<i.length;n++)if(n<s-1)e.push(NaN);else{let o=0;for(let r=0;r<s;r++)o+=i[n-r];e.push(o/s)}return e}function Q(i,t){const e=[],s=Math.floor(t),n=2/(s+1);let o=0;for(let r=0;r<Math.min(s,i.length);r++)o+=i[r];o=o/Math.min(s,i.length);for(let r=0;r<i.length;r++)r===0?(e.push(i[r]),o=i[r]):(o=(i[r]-o)*n+o,e.push(o));return e}function Fn(i,t){const e=[],s=[];for(let a=1;a<i.length;a++)s.push(i[a]-i[a-1]);const n=s.map(a=>a>0?a:0),o=s.map(a=>a<0?-a:0),r=et(n,t),l=et(o,t);e.push(NaN);for(let a=0;a<r.length;a++)if(l[a]===0)e.push(100);else{const h=r[a]/l[a];e.push(100-100/(1+h))}return e}function Rn(i,t,e,s){const n=Q(i,t),o=Q(i,e),r=[];for(let h=0;h<i.length;h++)r.push(n[h]-o[h]);const l=Q(r,s),a=[];for(let h=0;h<i.length;h++)a.push(r[h]-l[h]);return[r,l,a]}function rs(i,t,e){const s=it(i,t),n=ls(i,t),o=[],r=[];for(let l=0;l<i.length;l++)o.push(s[l]+e*n[l]),r.push(s[l]-e*n[l]);return[s,o,r]}function ls(i,t){const e=[],s=Math.floor(t),n=it(i,s);for(let o=0;o<i.length;o++)if(o<s-1)e.push(NaN);else{let r=0;for(let l=0;l<s;l++){const a=i[o-l]-n[o];r+=a*a}e.push(Math.sqrt(r/s))}return e}function kn(i,t){const e=[];for(let s=0;s<i.length;s++)s===0?e.push(!1):e.push(i[s]>t[s]&&i[s-1]<=t[s-1]);return e}function zn(i,t){const e=[];for(let s=0;s<i.length;s++)s===0?e.push(!1):e.push(i[s]<t[s]&&i[s-1]>=t[s-1]);return e}function Wn(i,t=1){const e=[];for(let s=0;s<i.length;s++)s<t?e.push(NaN):e.push(i[s]-i[s-t]);return e}function kt(i=!1,t,e,s){if(!t||!e||!s)throw new Error("ta.tr() requires high, low, and close series. Either pass them explicitly or use createContext({ chart: { high, low, close } }) for implicit data.");const n=[];for(let o=0;o<t.length;o++)if(o===0)n.push(t[o]-e[o]);else{const r=s[o-1];if(isNaN(r))i?n.push(t[o]-e[o]):n.push(NaN);else{const l=Math.max(t[o]-e[o],Math.abs(t[o]-r),Math.abs(e[o]-r));n.push(l)}}return n}function as(i,t,e,s){if(!t||!e||!s)throw new Error("ta.atr() requires high, low, and close series. Either pass them explicitly or use createContext({ chart: { high, low, close } }) for implicit data.");const n=kt(!1,t,e,s);return et(n,i)}function On(i,t,e,s,n,o=!1){if(!e||!s||!n)throw new Error("ta.supertrend() requires high, low, and close series. Either pass them explicitly or use createContext({ chart: { high, low, close } }) for implicit data.");const r=[],l=[],a=[];for(let d=0;d<e.length;d++)a.push((e[d]+s[d])/2);const h=as(t,e,s,n);let c=NaN,u=NaN,f=NaN;for(let d=0;d<a.length;d++){const p=h[d]*i;if(isNaN(p)){r.push(NaN),l.push(1);continue}let m=a[d]+p,g=a[d]-p;const v=o?e[d]:n[d],w=o?s[d]:n[d],N=d>0?o?s[d-1]:n[d-1]:0,x=d>0?o?e[d-1]:n[d-1]:0;d>0&&!isNaN(c)&&!isNaN(u)&&(g=g>c||N<c?g:c,m=m<u||x>u?m:u);let M;isNaN(f)?M=1:f===u?M=v>m?-1:1:M=w<g?1:-1;const _=M===-1?g:m;r.push(_),l.push(M),c=g,u=m,f=_}return[r,l]}function et(i,t){const e=[],s=Math.floor(t),n=1/s;let o=-1,r=0,l=0;for(let c=0;c<i.length;c++){const u=i[c];if(u!==void 0&&!isNaN(u)&&(l+=u,r++,r===s)){o=c;break}}let a=r>0?l/r:NaN,h=o>=0;for(let c=0;c<i.length;c++)if(!h||c<o)e.push(NaN);else if(c===o)e.push(a);else{const u=i[c];u!==void 0&&!isNaN(u)&&(a=n*u+(1-n)*a),e.push(a)}return e}function Et(i,t){const e=[],s=Math.floor(t);for(let n=0;n<i.length;n++)if(n<s-1)e.push(NaN);else{let o=0,r=0;for(let l=0;l<s;l++){const a=s-l;o+=i[n-l]*a,r+=a}e.push(o/r)}return e}function Mt(i,t){const e=[];for(let s=0;s<i.length;s++)if(s<t-1)e.push(NaN);else{let n=-1/0;for(let o=0;o<t;o++)isNaN(i[s-o])||(n=Math.max(n,i[s-o]));e.push(n===-1/0?NaN:n)}return e}function bt(i,t){const e=[];for(let s=0;s<i.length;s++)if(s<t-1)e.push(NaN);else{let n=1/0;for(let o=0;o<t;o++)isNaN(i[s-o])||(n=Math.min(n,i[s-o]));e.push(n===1/0?NaN:n)}return e}function Bn(i){const t=[];let e=0;for(let s=0;s<i.length;s++)e+=i[s],t.push(e);return t}function Yn(i,t){const e=[];for(let s=0;s<i.length;s++)if(s===0)e.push(!1);else{const n=i[s]>t[s]&&i[s-1]<=t[s-1],o=i[s]<t[s]&&i[s-1]>=t[s-1];e.push(n||o)}return e}function jn(i,t){const e=[];for(let s=0;s<i.length;s++)if(s<t)e.push(!1);else{let n=!0;for(let o=1;o<=t;o++)if(i[s-o+1]<=i[s-o]){n=!1;break}e.push(n)}return e}function qn(i,t){const e=[];for(let s=0;s<i.length;s++)if(s<t)e.push(!1);else{let n=!0;for(let o=1;o<=t;o++)if(i[s-o+1]>=i[s-o]){n=!1;break}e.push(n)}return e}function Hn(i,t){const e=[];for(let s=0;s<i.length;s++)if(s<t)e.push(NaN);else{const n=i[s-t];if(n===0||isNaN(n)||isNaN(i[s]))e.push(NaN);else{const o=i[s]-n;e.push(100*o/n)}}return e}function Un(i,t){const e=[];for(let s=0;s<i.length;s++)s<t?e.push(NaN):isNaN(i[s])||isNaN(i[s-t])?e.push(NaN):e.push(i[s]-i[s-t]);return e}function Jn(i,t){const e=[],s=it(i,t);for(let n=0;n<i.length;n++)if(n<t-1||isNaN(s[n]))e.push(NaN);else{let o=0;for(let r=0;r<t;r++)isNaN(i[n-r])||(o+=Math.abs(i[n-r]-s[n]));e.push(o/t)}return e}function Dh(i,t,e=!0){const s=[],n=it(i,t);for(let o=0;o<i.length;o++)if(o<t-1||isNaN(n[o]))s.push(NaN);else{let r=0,l=0;for(let h=0;h<t;h++)if(!isNaN(i[o-h])){const c=i[o-h]-n[o];r+=c*c,l++}const a=e?l:l-1;s.push(a>0?r/a:NaN)}return s}function Fh(i,t){const e=[];for(let s=0;s<i.length;s++)if(s<t-1)e.push(NaN);else{const n=[];for(let o=0;o<t;o++)isNaN(i[s-o])||n.push(i[s-o]);if(n.length===0)e.push(NaN);else{n.sort((r,l)=>r-l);const o=Math.floor(n.length/2);n.length%2===0?e.push((n[o-1]+n[o])/2):e.push(n[o])}}return e}function Rh(i){const t=[];for(let e=0;e<i.length;e++)if(e<3)t.push(NaN);else if(isNaN(i[e])||isNaN(i[e-1])||isNaN(i[e-2])||isNaN(i[e-3]))t.push(NaN);else{const s=i[e-3]*.16666666666666666+i[e-2]*.3333333333333333+i[e-1]*.3333333333333333+i[e]*.16666666666666666;t.push(s)}return t}function Qn(i,t,e){if(!e)throw new Error("ta.vwma() requires volume series. Either pass it explicitly or use createContext({ chart: { ..., volume } }) for implicit data.");const s=[];for(let l=0;l<i.length;l++)s.push(i[l]*e[l]);const n=it(s,t),o=it(e,t),r=[];for(let l=0;l<i.length;l++)o[l]===0||isNaN(o[l])?r.push(NaN):r.push(n[l]/o[l]);return r}function Gn(i,t,e=0){const s=[],n=Math.floor(t);for(let o=0;o<i.length;o++)if(o<n-1)s.push(NaN);else{let r=!1;for(let l=0;l<n;l++)if(isNaN(i[o-l])){r=!0;break}if(r)s.push(NaN);else{let l=0,a=0,h=0,c=0;for(let p=0;p<n;p++){const m=p,g=i[o-(n-1-p)];l+=m,a+=g,h+=m*g,c+=m*m}const u=(n*h-l*a)/(n*c-l*l),f=(a-u*l)/n,d=n-1-e;s.push(f+u*d)}}return s}function kh(i,t,e){const s=[];for(let n=0;n<i.length;n++)if(n<e-1)s.push(NaN);else{const o=[];for(let r=0;r<e;r++)!isNaN(i[n-r])&&!isNaN(t[n-r])&&o.push([i[n-r],t[n-r]]);if(o.length===0)s.push(NaN);else{let r=0,l=0;for(const[p,m]of o)r+=p,l+=m;const a=r/o.length,h=l/o.length;let c=0,u=0,f=0;for(const[p,m]of o){const g=p-a,v=m-h;c+=g*v,u+=g*g,f+=v*v}const d=Math.sqrt(u*f);d===0?s.push(NaN):s.push(c/d)}}return s}function zh(i,t){const e=[];for(let s=0;s<i.length;s++)if(s<t-1)e.push(NaN);else{let n=!1;for(let o=0;o<t;o++)if(isNaN(i[s-o])){n=!0;break}if(n)e.push(NaN);else{const o=i[s];let r=0;for(let a=0;a<t;a++)i[s-a]<=o&&r++;const l=(r-1)/(t-1)*100;e.push(l)}}return e}function Kn(i,t){const e=[],s=it(i,t),n=Jn(i,t);for(let o=0;o<i.length;o++)if(isNaN(s[o])||isNaN(n[o])||n[o]===0)e.push(NaN);else{const r=(i[o]-s[o])/(.015*n[o]);e.push(r)}return e}function Zn(i,t,e,s){const n=[],o=bt(e,s),r=Mt(t,s);for(let l=0;l<i.length;l++)if(isNaN(o[l])||isNaN(r[l]))n.push(NaN);else{const a=r[l]-o[l];if(a===0)n.push(NaN);else{const h=100*(i[l]-o[l])/a;n.push(h)}}return n}function Wh(i,t,e){if(!e)throw new Error("ta.mfi() requires volume series. Either pass it explicitly or use createContext({ chart: { ..., volume } }) for implicit data.");const s=[],n=[NaN];for(let l=1;l<i.length;l++)n.push(i[l]-i[l-1]);const o=[],r=[];for(let l=0;l<i.length;l++)l===0||isNaN(n[l])?(o.push(0),r.push(0)):n[l]>0?(o.push(e[l]*i[l]),r.push(0)):n[l]<0?(o.push(0),r.push(e[l]*i[l])):(o.push(0),r.push(0));for(let l=0;l<i.length;l++)if(l<t)s.push(NaN);else{let a=0,h=0;for(let c=0;c<t;c++)a+=o[l-c],h+=r[l-c];if(h===0)s.push(100);else{const u=100-100/(1+a/h);s.push(u)}}return s}function Oh(i,t){const e=Math.floor(t/2),s=Math.floor(Math.sqrt(t)),n=Et(i,e),o=Et(i,t),r=[];for(let l=0;l<i.length;l++)r.push(2*n[l]-o[l]);return Et(r,s)}function Xn(i,t,e,s,n,o){if(!s||!n||!o)throw new Error("ta.sar() requires high, low, and close series. Either pass them explicitly or use createContext({ chart: { high, low, close } }) for implicit data.");const r=[];let l=NaN,a=NaN,h=i,c=!1,u=!1;for(let f=0;f<o.length;f++){if(f===0){r.push(NaN);continue}f===1&&(o[f]>o[f-1]?(c=!0,a=s[f],l=n[f-1]):(c=!1,a=n[f],l=s[f-1]),u=!0,h=i),l=l+h*(a-l),c?l>n[f]&&(u=!0,c=!1,l=Math.max(s[f],a),a=n[f],h=i):l<s[f]&&(u=!0,c=!0,l=Math.min(n[f],a),a=s[f],h=i),u||(c?s[f]>a&&(a=s[f],h=Math.min(h+t,e)):n[f]<a&&(a=n[f],h=Math.min(h+t,e))),c?(l=Math.min(l,n[f-1]),f>1&&(l=Math.min(l,n[f-2]))):(l=Math.max(l,s[f-1]),f>1&&(l=Math.max(l,s[f-2]))),r.push(l),u=!1}return r}function Bh(i,t,e,s){let n,o,r;if(e===void 0){if(!s)throw new Error("ta.pivothigh() requires high series when using two-parameter version.");n=s,o=i,r=t}else n=i,o=t,r=e;const l=[];for(let a=0;a<n.length;a++){if(a<o||a+r>=n.length){l.push(NaN);continue}const h=n[a];let c=!0;for(let u=1;u<=o;u++)if(n[a-u]>=h){c=!1;break}if(c){for(let u=1;u<=r;u++)if(n[a+u]>=h){c=!1;break}}l.push(c?h:NaN)}return l}function Yh(i,t,e,s){let n,o,r;if(e===void 0){if(!s)throw new Error("ta.pivotlow() requires low series when using two-parameter version.");n=s,o=i,r=t}else n=i,o=t,r=e;const l=[];for(let a=0;a<n.length;a++){if(a<o||a+r>=n.length){l.push(NaN);continue}const h=n[a];let c=!0;for(let u=1;u<=o;u++)if(n[a-u]<=h){c=!1;break}if(c){for(let u=1;u<=r;u++)if(n[a+u]<=h){c=!1;break}}l.push(c?h:NaN)}return l}function jh(i){const t=[];let e=NaN;for(let s=0;s<i.length;s++)i[s]?e=0:isNaN(e)||e++,t.push(e);return t}function qh(i,t,e){const s=[];for(let n=0;n<i.length;n++){let o=0,r=NaN;for(let l=n;l>=0;l--)if(i[l]){if(o===e){r=t[l];break}o++}s.push(r)}return s}function Hh(i,t,e,s,n){const o=Math.max(e.length,s.length,n.length),r=[],l=[],a=kt(!1,e,s,n);for(let g=0;g<o;g++)if(g===0)r.push(0),l.push(0);else{const v=e[g]-e[g-1],w=s[g-1]-s[g];let N=0,x=0;v>w&&v>0&&(N=v),w>v&&w>0&&(x=w),r.push(N),l.push(x)}const h=et(r,i),c=et(l,i),u=et(a,i),f=[],d=[];for(let g=0;g<o;g++)u[g]===0?(f.push(0),d.push(0)):(f.push(h[g]/u[g]*100),d.push(c[g]/u[g]*100));const p=[];for(let g=0;g<o;g++){const v=f[g]+d[g];v===0?p.push(0):p.push(Math.abs(f[g]-d[g])/v*100)}const m=et(p,t);return[f,d,m]}function Uh(i,t,e){const s=[];for(let a=0;a<i.length;a++)a===0?s.push(0):s.push(i[a]-i[a-1]);const n=Q(Q(s,e),t),o=s.map(Math.abs),r=Q(Q(o,e),t),l=[];for(let a=0;a<i.length;a++)r[a]===0?l.push(0):l.push(n[a]/r[a]*100);return l}function Jh(i,t){const e=[];for(let s=0;s<i.length;s++){if(s<t){e.push(NaN);continue}let n=0,o=0;for(let l=0;l<t;l++){const a=i[s-l]-i[s-l-1];a>0?n+=a:o+=Math.abs(a)}const r=n+o;if(r===0)e.push(0);else{const l=(n-o)/r*100;e.push(l)}}return e}function to(i,t,e,s=!0,n,o,r){const l=Q(i,t);let a;if(s){if(!n||!o||!r)throw new Error("ta.kc() with useTrueRange=true requires high, low, and close data");a=kt(!1,n,o,r)}else{if(!n||!o)throw new Error("ta.kc() requires high and low data");a=[];for(let f=0;f<n.length;f++)a.push(n[f]-o[f])}const h=Q(a,t),c=[],u=[];for(let f=0;f<l.length;f++)c.push(l[f]+h[f]*e),u.push(l[f]-h[f]*e);return[l,c,u]}function Qh(i,t,e){const[s,n,o]=rs(i,t,e),r=[];for(let l=0;l<i.length;l++)if(s[l]===0)r.push(NaN);else{const a=(n[l]-o[l])/s[l]*100;r.push(a)}return r}function Gh(i,t,e,s=14){const n=[];for(let o=0;o<e.length;o++){if(o<s-1){n.push(NaN);continue}let r=i[o-s+1],l=t[o-s+1];for(let h=o-s+2;h<=o;h++)i[h]>r&&(r=i[h]),t[h]<l&&(l=t[h]);const a=r-l;if(a===0)n.push(NaN);else{const h=(r-e[o])/a*-100;n.push(h)}}return n}function eo(i,t){if(i.length!==t.length)throw new Error("ta.vwap: source and volume must have the same length");const e=[];let s=0,n=0;for(let o=0;o<i.length;o++){if(isNaN(i[o])||isNaN(t[o])){e.push(NaN);continue}s+=i[o]*t[o],n+=t[o],n===0?e.push(NaN):e.push(s/n)}return e}function io(i,t=9,e=.85,s=6,n=!1){const o=[],r=n?Math.floor(e*(t-1)):e*(t-1),l=t/s,a=[];let h=0;for(let c=0;c<t;c++){const u=Math.exp(-1*Math.pow(c-r,2)/(2*Math.pow(l,2)));a.push(u),h+=u}for(let c=0;c<t;c++)a[c]/=h;for(let c=0;c<i.length;c++){if(c<t-1){o.push(NaN);continue}let u=0;for(let f=0;f<t;f++)u+=i[c-t+1+f]*a[f];o.push(u)}return o}function Kh(i,t=20,e=2,s=!0,n,o,r){const[l,a,h]=to(i,t,e,s,n,o,r),c=[];for(let u=0;u<i.length;u++)if(isNaN(l[u])||l[u]===0)c.push(NaN);else{const f=(a[u]-h[u])/l[u]*100;c.push(f)}return c}function Zh(i,t){if(i.length!==t.length)throw new Error("ta.range: high and low must have the same length");const e=[];for(let s=0;s<i.length;s++)isNaN(i[s])||isNaN(t[s])?e.push(NaN):e.push(i[s]-t[s]);return e}function Xh(i,t){const e=[];for(let s=0;s<i.length;s++){if(s<t-1){e.push(NaN);continue}let n=i[s-t+1],o=t-1;for(let r=s-t+2;r<=s;r++)i[r]>n&&(n=i[r],o=s-r);e.push(o)}return e}function tc(i,t){const e=[];for(let s=0;s<i.length;s++){if(s<t-1){e.push(NaN);continue}let n=i[s-t+1],o=t-1;for(let r=s-t+2;r<=s;r++)i[r]<n&&(n=i[r],o=s-r);e.push(o)}return e}function ec(i,t){if(i.length!==t.length)throw new Error("ta.max: source1 and source2 must have the same length");const e=[];for(let s=0;s<i.length;s++)isNaN(i[s])||isNaN(t[s])?e.push(NaN):e.push(Math.max(i[s],t[s]));return e}function ic(i,t){if(i.length!==t.length)throw new Error("ta.min: source1 and source2 must have the same length");const e=[];for(let s=0;s<i.length;s++)isNaN(i[s])||isNaN(t[s])?e.push(NaN):e.push(Math.min(i[s],t[s]));return e}function sc(i,t=10){const e=[];for(let s=0;s<i.length;s++){if(s<t-1){e.push(NaN);continue}let n=0,o=0;for(let r=0;r<t;r++){const l=r+1,a=i[s-t+1+r];n+=l*a,o+=a}if(o===0)e.push(NaN);else{const r=-1*(n/o)+(t+1)/2;e.push(r)}}return e}function nc(i,t){const e=[];for(let s=0;s<i.length;s++){if(s<t-1){e.push(NaN);continue}const n=[];for(let a=0;a<t;a++){const h=i[s-a];isNaN(h)||n.push(h)}if(n.length===0){e.push(NaN);continue}const o=new Map;for(const a of n)o.set(a,(o.get(a)||0)+1);let r=0;o.forEach(a=>{a>r&&(r=a)});const l=[];o.forEach((a,h)=>{a===r&&l.push(h)}),e.push(Math.min(...l))}return e}function so(i,t,e){const s=[];for(let n=0;n<i.length;n++){if(n<t-1){s.push(NaN);continue}const o=[];for(let c=0;c<t;c++){const u=i[n-c];o.push(u)}if(o.some(c=>isNaN(c))){s.push(NaN);continue}const r=[...o].sort((c,u)=>c-u),l=e/100*(r.length-1),a=Math.floor(l),h=Math.ceil(l);if(a===h)s.push(r[a]);else{const c=l-a,u=r[a]+c*(r[h]-r[a]);s.push(u)}}return s}function no(i,t,e){const s=[];for(let n=0;n<i.length;n++){if(n<t-1){s.push(NaN);continue}const o=[];for(let h=0;h<t;h++){const c=i[n-h];isNaN(c)||o.push(c)}if(o.length===0){s.push(NaN);continue}const r=[...o].sort((h,c)=>h-c);if(e>=100){s.push(r[r.length-1]);continue}const l=Math.ceil(e/100*r.length),a=Math.max(0,l-1);s.push(r[a])}return s}function oc(i,t){const e=[];for(let s=0;s<i.length;s++){if(s<t-1){e.push(NaN);continue}const n=[];for(let f=0;f<t;f++)n.push(i[s-t+1+f]);if(n.some(f=>isNaN(f))){e.push(NaN);continue}const r=[...n.map((f,d)=>({value:f,index:d}))].sort((f,d)=>f.value-d.value),l=new Array(t).fill(0);let a=1;for(let f=0;f<r.length;f++){let d=1;for(;f+d<r.length&&r[f].value===r[f+d].value;)d++;const p=(a+(a+d-1))/2;for(let m=0;m<d;m++)l[r[f+m].index]=p;f+=d-1,a+=d}let h=0;for(let f=0;f<t;f++){const d=f+1,p=l[f],m=d-p;h+=m*m}const c=t,u=1-6*h/(c*(c*c-1));e.push(u*100)}return e}function rc(i,t,e=!1,s,n,o,r){const l=typeof i=="string"?i:String(i[0]),a=typeof e=="boolean"?e:e[0];if(l==="Woodie"&&a)throw new Error("ta.pivot_point_levels: Woodie type cannot use developing=true");const h=t.length;if(s&&s.length!==h)throw new Error("High series length mismatch");if(n&&n.length!==h)throw new Error("Low series length mismatch");if(o&&o.length!==h)throw new Error("Close series length mismatch");if(r&&r.length!==h)throw new Error("Open series length mismatch");const c=Array.from({length:11},()=>[]);let u=NaN,f=NaN,d=NaN,p=NaN,m=-1;for(let g=0;g<h;g++){t[g]&&(m=g,u=s?s[g]:NaN,f=n?n[g]:NaN,d=o?o[g]:NaN,p=r?r[g]:NaN);let v,w,N,x;a&&m>=0?(v=s?Math.max(...s.slice(m,g+1).filter(_=>!isNaN(_))):NaN,w=n?Math.min(...n.slice(m,g+1).filter(_=>!isNaN(_))):NaN,N=o?o[g]:NaN,x=r&&m>=0?r[m]:NaN):(v=u,w=f,N=d,x=p);const M=lc(l,v,w,N,x);for(let _=0;_<11;_++)c[_].push(M[_])}return c}function lc(i,t,e,s,n){if(isNaN(t)||isNaN(e)||isNaN(s))return Array(11).fill(NaN);const o=Array(11).fill(NaN);let r;switch(i){case"Traditional":case"Fibonacci":case"Classic":r=(t+e+s)/3;break;case"Woodie":r=(t+e+2*s)/4;break;case"DM":r=(t+e+s)/3;break;case"Camarilla":r=(t+e+s)/3;break;default:r=(t+e+s)/3}switch(o[0]=r,i){case"Traditional":case"Classic":o[1]=2*r-e,o[2]=2*r-t,o[3]=r+(t-e),o[4]=r-(t-e),o[5]=t+2*(r-e),o[6]=e-2*(t-r),o[7]=o[5]+(t-e),o[8]=o[6]-(t-e),o[9]=o[7]+(t-e),o[10]=o[8]-(t-e);break;case"Fibonacci":o[1]=r+.382*(t-e),o[2]=r-.382*(t-e),o[3]=r+.618*(t-e),o[4]=r-.618*(t-e),o[5]=r+(t-e),o[6]=r-(t-e),o[7]=o[5]+.618*(t-e),o[8]=o[6]-.618*(t-e),o[9]=o[7]+.382*(t-e),o[10]=o[8]-.382*(t-e);break;case"Woodie":o[1]=2*r-e,o[2]=2*r-t,o[3]=r+(t-e),o[4]=r-(t-e),o[5]=t+2*(r-e),o[6]=e-2*(t-r),o[7]=o[5]+(t-e),o[8]=o[6]-(t-e),o[9]=o[7]+(t-e),o[10]=o[8]-(t-e);break;case"DM":const l=t+e+s*2+(isNaN(n)?s:n),a=l/(isNaN(n)?4:5);o[0]=a,o[1]=l/2-e,o[2]=l/2-t;break;case"Camarilla":const h=t-e;o[1]=s+h*1.1/12,o[2]=s-h*1.1/12,o[3]=s+h*1.1/6,o[4]=s-h*1.1/6,o[5]=s+h*1.1/4,o[6]=s-h*1.1/4,o[7]=s+h*1.1/2,o[8]=s-h*1.1/2,o[9]=t,o[10]=e;break}return o}function oo(i,t,e,s,n,o,r){const l=n.length,a=Mt(n,i),h=bt(o,i),c=[];for(let N=0;N<l;N++)isNaN(a[N])||isNaN(h[N])?c.push(NaN):c.push((a[N]+h[N])/2);const u=Mt(n,t),f=bt(o,t),d=[];for(let N=0;N<l;N++)isNaN(u[N])||isNaN(f[N])?d.push(NaN):d.push((u[N]+f[N])/2);const p=[];for(let N=0;N<l;N++){const x=N-s;x<0||isNaN(c[x])||isNaN(d[x])?p.push(NaN):p.push((c[x]+d[x])/2)}const m=Mt(n,e),g=bt(o,e),v=[];for(let N=0;N<l;N++){const x=N-s;x<0||isNaN(m[x])||isNaN(g[x])?v.push(NaN):v.push((m[x]+g[x])/2)}const w=[];for(let N=0;N<l;N++){const x=N+s;x>=l||isNaN(r[x])?w.push(NaN):w.push(r[x])}return[c,d,p,v,w]}function ro(i=5,t=10,e=3,s,n,o){let r,l;if(n&&o)r=n,l=o;else if(s)r=s,l=s;else throw new Error("ta.zigzag() requires either source series or high/low series. Either pass them explicitly or use createContext({ chart: { high, low, close } }) for implicit data.");const a=r.length;if(l.length!==a)throw new Error("ta.zigzag: high and low must have the same length");const h=new Array(a).fill(NaN),c=new Array(a).fill(0),u=new Array(a).fill(!1),f=(P,R)=>Math.abs(P)<1e-10||isNaN(P)||isNaN(R)?0:Math.abs((R-P)/P)*100;let d=null,p=null,m=0;const g=[];let v=-1,w=-1/0,N=1/0,x=-1,M=-1;for(let P=0;P<Math.min(t,a);P++)!isNaN(r[P])&&r[P]>w&&(w=r[P],x=P),!isNaN(l[P])&&l[P]<N&&(N=l[P],M=P);x>=0&&M>=0?(M<=x?(d={index:M,price:N,type:"low"},m=1):(d={index:x,price:w,type:"high"},m=-1),g.push(d),v=d.index+1):v=t;for(let P=Math.max(v,t);P<a;P++){const R=r[P],q=l[P];if(isNaN(R)||isNaN(q)){c[P]=m;continue}let I=!0;for(let T=1;T<=e&&P-T>=0;T++)if(!isNaN(r[P-T])&&r[P-T]>=R){I=!1;break}let $=!0;for(let T=1;T<=e&&P-T>=0;T++)if(!isNaN(l[P-T])&&l[P-T]<=q){$=!1;break}m===1?(I&&(p===null||p.type!=="high"?d&&f(d.price,R)>=i&&(p={index:P,price:R,type:"high"}):R>p.price&&(p={index:P,price:R,type:"high"})),p&&p.type==="high"&&f(p.price,q)>=i&&P-p.index>=e&&(g.push(p),d=p,m=-1,p=null)):m===-1?($&&(p===null||p.type!=="low"?d&&f(d.price,q)>=i&&(p={index:P,price:q,type:"low"}):q<p.price&&(p={index:P,price:q,type:"low"})),p&&p.type==="low"&&f(p.price,R)>=i&&P-p.index>=e&&(g.push(p),d=p,m=1,p=null)):d&&(d.type==="low"&&f(d.price,R)>=i?m=1:d.type==="high"&&f(d.price,q)>=i&&(m=-1)),c[P]=m}const _=p!==null;p&&g.push(p);for(const P of g)h[P.index]=P.price,u[P.index]=!0;let C=0,A=0;const L=_?g.length-1:g.length;for(let P=0;P<a;P++){for(;A<L&&g[A].index<=P;)C=g[A].type==="low"?1:-1,A++;c[P]=C}return[h,c,u]}var ac={};j(ac,{abs:()=>hc,acos:()=>Sc,asin:()=>Cc,atan:()=>Ac,avg:()=>mc,ceil:()=>cc,cos:()=>xc,e:()=>Vc,exp:()=>yc,floor:()=>uc,log:()=>Nc,log10:()=>Mc,max:()=>dc,min:()=>pc,phi:()=>Dc,pi:()=>Ec,pow:()=>wc,random:()=>$c,round:()=>fc,round_to_mintick:()=>Lc,rphi:()=>Fc,sign:()=>Tc,sin:()=>bc,sqrt:()=>vc,sum:()=>gc,tan:()=>_c,todegrees:()=>Ic,toradians:()=>Pc});var nn=class lo{constructor(t=[]){V(this,"_bars");V(this,"_version",0);this._bars=t}get version(){return this._version}get bars(){return this._bars}get length(){return this._bars.length}push(t){this._bars.push(t),this._version++}pop(){const t=this._bars.pop();return t!==void 0&&this._version++,t}set(t,e){t>=0&&t<this._bars.length&&(this._bars[t]=e,this._version++)}updateLast(t){this._bars.length>0&&(this._bars[this._bars.length-1]=t,this._version++)}setAll(t){this._bars=t,this._version++}invalidate(){this._version++}at(t){return this._bars[t]}static from(t){return new lo(t)}},y=class D{constructor(t,e){V(this,"extractor");V(this,"dataSource");V(this,"cached",null);V(this,"cachedVersion",-1);this.dataSource=t instanceof nn?t:new nn(t),this.extractor=e}get bars(){return this.dataSource.bars}get barData(){return this.dataSource}static fromBars(t,e){return new D(t,s=>s[e]??NaN)}static constant(t,e){return new D(t,()=>e)}static fromArray(t,e){return new D(t,(s,n)=>e[n]??NaN)}add(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o+r})}sub(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o-r})}mul(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o*r})}div(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return r!==0?o/r:NaN})}mod(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return r!==0?o%r:NaN})}neg(){return new D(this.dataSource,(t,e,s)=>-this.extractor(t,e,s))}gt(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o>r?1:0})}gte(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o>=r?1:0})}lt(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o<r?1:0})}lte(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o<=r?1:0})}eq(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o===r?1:0})}neq(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o!==r?1:0})}and(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o&&r?1:0})}or(t){return new D(this.dataSource,(e,s,n)=>{const o=this.extractor(e,s,n),r=typeof t=="number"?t:t.extractor(e,s,n);return o||r?1:0})}not(){return new D(this.dataSource,(t,e,s)=>this.extractor(t,e,s)?0:1)}iff(t,e){return new D(this.dataSource,(s,n,o)=>{const r=this.extractor(s,n,o);return r!==0&&!Number.isNaN(r)?typeof t=="number"?t:t.extractor(s,n,o):typeof e=="number"?e:e.extractor(s,n,o)})}offset(t){return new D(this.dataSource,(e,s,n)=>{const o=s-t;return o<0||o>=n.length?NaN:this.extractor(n[o],o,n)})}toArray(){if(this.cached!==null&&this.cachedVersion===this.dataSource.version)return this.cached;const t=this.dataSource.bars;return this.cached=t.map((e,s)=>this.extractor(e,s,t)),this.cachedVersion=this.dataSource.version,this.cached}materialize(){const e=[...this.toArray()];return D.fromArray(this.dataSource,e)}_invalidate(){this.cached=null,this.cachedVersion=-1}_compute(){return this.toArray()}get(t){return this.toArray()[t]??NaN}last(){const t=this.toArray();return t[t.length-1]??NaN}length(){return this.dataSource.length}toTimeValuePairs(){const t=this.toArray();return this.dataSource.bars.map((s,n)=>({time:s.time,value:t[n]})).filter(s=>!Number.isNaN(s.value))}};function hc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.abs(r))}return y.fromArray(t,n)}return Math.abs(i)}function cc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.ceil(r))}return y.fromArray(t,n)}return Math.ceil(i)}function uc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.floor(r))}return y.fromArray(t,n)}return Math.floor(i)}function fc(i,t){if(i instanceof y){const s=i.bars,n=i.toArray(),o=s.length,r=[];if(t===void 0)for(let l=0;l<o;l++){const a=n[l]??NaN;r.push(Math.round(a))}else{const l=Math.pow(10,t);for(let a=0;a<o;a++){const h=n[a]??NaN;r.push(Math.round(h*l)/l)}}return y.fromArray(s,r)}if(t===void 0)return Math.round(i);const e=Math.pow(10,t);return Math.round(i*e)/e}function dc(...i){if(!i.some(l=>l instanceof y))return Math.max(...i);const s=i.find(l=>l instanceof y).bars,n=s.length,o=i.map(l=>l instanceof y?l.toArray():null),r=[];for(let l=0;l<n;l++){const a=i.map((h,c)=>o[c]?o[c][l]??NaN:h);r.push(Math.max(...a))}return y.fromArray(s,r)}function pc(...i){if(!i.some(l=>l instanceof y))return Math.min(...i);const s=i.find(l=>l instanceof y).bars,n=s.length,o=i.map(l=>l instanceof y?l.toArray():null),r=[];for(let l=0;l<n;l++){const a=i.map((h,c)=>o[c]?o[c][l]??NaN:h);r.push(Math.min(...a))}return y.fromArray(s,r)}function mc(...i){if(!i.some(l=>l instanceof y))return i.reduce((l,a)=>l+a,0)/i.length;const s=i.find(l=>l instanceof y).bars,n=s.length,o=i.map(l=>l instanceof y?l.toArray():null),r=[];for(let l=0;l<n;l++){const a=i.map((c,u)=>o[u]?o[u][l]??NaN:c),h=a.reduce((c,u)=>c+u,0);r.push(h/a.length)}return y.fromArray(s,r)}function gc(i,t){const e=i instanceof y?i.toArray():i,s=[];for(let n=0;n<e.length;n++)if(n<t-1)s.push(NaN);else{let o=0;for(let r=0;r<t;r++)o+=e[n-r];s.push(o)}return i instanceof y?y.fromArray(i.bars,s):s}function vc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.sqrt(r))}return y.fromArray(t,n)}return Math.sqrt(i)}function wc(i,t){const e=i instanceof y,s=t instanceof y;if(!e&&!s)return Math.pow(i,t);const n=e?i.bars:t.bars,o=e?i.toArray():null,r=s?t.toArray():null,l=n.length,a=[];for(let h=0;h<l;h++){const c=o?o[h]??NaN:i,u=r?r[h]??NaN:t;a.push(Math.pow(c,u))}return y.fromArray(n,a)}function yc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.exp(r))}return y.fromArray(t,n)}return Math.exp(i)}function Nc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.log(r))}return y.fromArray(t,n)}return Math.log(i)}function Mc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.log10(r))}return y.fromArray(t,n)}return Math.log10(i)}function bc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.sin(r))}return y.fromArray(t,n)}return Math.sin(i)}function xc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.cos(r))}return y.fromArray(t,n)}return Math.cos(i)}function _c(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.tan(r))}return y.fromArray(t,n)}return Math.tan(i)}function Cc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.asin(r))}return y.fromArray(t,n)}return Math.asin(i)}function Sc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.acos(r))}return y.fromArray(t,n)}return Math.acos(i)}function Ac(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(Math.atan(r))}return y.fromArray(t,n)}return Math.atan(i)}function Pc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(r*(Math.PI/180))}return y.fromArray(t,n)}return i*(Math.PI/180)}function Ic(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(r*(180/Math.PI))}return y.fromArray(t,n)}return i*(180/Math.PI)}function $c(i,t,e){const s=Math.random();return i!==void 0&&t!==void 0?i+s*(t-i):s}function Tc(i){if(i instanceof y){const t=i.bars,e=i.toArray(),s=t.length,n=[];for(let o=0;o<s;o++){const r=e[o]??NaN;n.push(r>0?1:r<0?-1:0)}return y.fromArray(t,n)}return i>0?1:i<0?-1:0}function Lc(i,t){if(i instanceof y){const e=i.bars,s=i.toArray(),n=e.length;if(t===void 0)throw new Error("math.round_to_mintick() requires mintick value. Either pass it explicitly or use createContext({ syminfo: { mintick } }) for implicit data.");const o=[];if(t===0)for(let r=0;r<n;r++)o.push(s[r]??NaN);else for(let r=0;r<n;r++){const l=s[r];l===void 0||isNaN(l)?o.push(NaN):o.push(Math.round(l/t)*t)}return y.fromArray(e,o)}if(isNaN(i))return NaN;if(t===void 0)throw new Error("math.round_to_mintick() requires mintick value. Either pass it explicitly or use createContext({ syminfo: { mintick } }) for implicit data.");return t===0?i:Math.round(i/t)*t}var Ec=Math.PI,Vc=Math.E,Dc=1.618033988749895,Fc=.618033988749895,Rc={};j(Rc,{abs:()=>yu,avg:()=>St,binary_search:()=>Mu,binary_search_leftmost:()=>bu,binary_search_rightmost:()=>xu,clear:()=>jc,concat:()=>Gc,copy:()=>ao,covariance:()=>_u,every:()=>hu,fill:()=>nu,first:()=>ru,from:()=>ou,get:()=>kc,includes:()=>Uc,indexof:()=>Jc,insert:()=>qc,join:()=>Kc,last:()=>lu,lastindexof:()=>Qc,max:()=>co,median:()=>eu,min:()=>ho,mode:()=>iu,new_array:()=>G,new_bool:()=>cu,new_box:()=>gu,new_color:()=>pu,new_float:()=>uu,new_int:()=>fu,new_label:()=>vu,new_line:()=>mu,new_linefill:()=>wu,new_string:()=>du,newtype:()=>$u,percentile_linear_interpolation:()=>Cu,percentile_nearest_rank:()=>Su,percentrank:()=>Au,pop:()=>Oc,push:()=>Wc,range:()=>Nu,remove:()=>Hc,reverse:()=>Zc,set:()=>zc,shift:()=>Yc,size:()=>xi,slice:()=>Xc,some:()=>au,sort:()=>tu,sort_indices:()=>Pu,standardize:()=>Iu,stdev:()=>uo,sum:()=>_i,unshift:()=>Bc,variance:()=>su});function G(i=0,t){const e=[];for(let s=0;s<i;s++)e.push(t);return e}function xi(i){return i.length}function kc(i,t){return i[t]}function zc(i,t,e){i[t]=e}function Wc(i,t){i.push(t)}function Oc(i){return i.pop()}function Bc(i,t){i.unshift(t)}function Yc(i){return i.shift()}function jc(i){i.length=0}function qc(i,t,e){i.splice(t,0,e)}function Hc(i,t){return i.splice(t,1)[0]}function Uc(i,t){return i.includes(t)}function Jc(i,t){return i.indexOf(t)}function Qc(i,t){return i.lastIndexOf(t)}function ao(i){return[...i]}function Gc(i,t){return[...i,...t]}function Kc(i,t=","){return i.join(t)}function Zc(i){i.reverse()}function Xc(i,t,e){return i.slice(t,e)}function tu(i,t="asc"){i.sort((e,s)=>t==="asc"?e-s:s-e)}function _i(i){return i.reduce((t,e)=>t+e,0)}function St(i){return _i(i)/xi(i)}function ho(i){return Math.min(...i)}function co(i){return Math.max(...i)}function eu(i){const t=[...i].sort((s,n)=>s-n),e=Math.floor(t.length/2);return t.length%2===0?(t[e-1]+t[e])/2:t[e]}function iu(i){const t=new Map;let e=0,s=i[0];for(const n of i){const o=(t.get(n)||0)+1;t.set(n,o),o>e&&(e=o,s=n)}return s}function uo(i){const t=St(i),e=i.map(n=>Math.pow(n-t,2)),s=_i(e)/xi(i);return Math.sqrt(s)}function su(i){const t=St(i),e=i.map(s=>Math.pow(s-t,2));return _i(e)/xi(i)}function nu(i,t,e=0,s){const n=s??i.length;for(let o=e;o<n;o++)i[o]=t}function ou(i){return ao(i)}function ru(i){return i[0]}function lu(i){return i[i.length-1]}function au(i,t){return i.some(t)}function hu(i,t){return i.every(t)}function cu(i=0,t=!1){return G(i,t)}function uu(i=0,t=NaN){return G(i,t)}function fu(i=0,t=NaN){return G(i,t)}function du(i=0,t){return G(i,t)}function pu(i=0,t){return G(i,t)}function mu(i=0,t){return G(i,t)}function gu(i=0,t){return G(i,t)}function vu(i=0,t){return G(i,t)}function wu(i=0,t){return G(i,t)}function yu(i){return i.map(t=>Math.abs(t))}function Nu(i){return i.length===0?NaN:co(i)-ho(i)}function Mu(i,t){let e=0,s=i.length-1;for(;e<=s;){const n=Math.floor((e+s)/2);if(i[n]===t)return n;i[n]<t?e=n+1:s=n-1}return-1}function bu(i,t){let e=0,s=i.length-1,n=-1,o=!1;for(;e<=s;){const r=Math.floor((e+s)/2);i[r]<t?(o||(n=r),e=r+1):(i[r]===t&&(n=r,o=!0),s=r-1)}return n}function xu(i,t){let e=0,s=i.length-1,n=-1,o=!1;for(;e<=s;){const r=Math.floor((e+s)/2);i[r]<=t?(i[r]===t&&(n=r,o=!0),e=r+1):(o||(n=r),s=r-1)}return n}function _u(i,t,e=!0){if(i.length===0||t.length===0)return NaN;if(i.length!==t.length)return NaN;const s=i.length,n=St(i),o=St(t);let r=0;for(let a=0;a<s;a++)r+=(i[a]-n)*(t[a]-o);const l=e?s:s-1;return r/l}function Cu(i,t){if(i.length===0)return NaN;const e=so(i,i.length,t);return e[e.length-1]}function Su(i,t){if(i.length===0)return NaN;const e=no(i,i.length,t);return e[e.length-1]}function Au(i,t){if(i.length===0||t<0||t>=i.length)return NaN;const e=i[t];if(isNaN(e))return NaN;let s=0;for(let n=0;n<i.length;n++)!isNaN(i[n])&&i[n]<=e&&s++;return s/i.length*100}function Pu(i,t="asc"){const e=Array.from({length:i.length},(s,n)=>n);return e.sort((s,n)=>t==="asc"?i[s]-i[n]:i[n]-i[s]),e}function Iu(i){if(i.length===0)return[];const t=St(i),e=uo(i);return e===0?i.map(()=>NaN):i.map(s=>(s-t)/e)}function $u(i=0,t){return G(i,t)}var Tu={};j(Tu,{charAt:()=>Uu,concat:()=>Yu,contains:()=>ku,endswith:()=>Hu,format:()=>ju,format_time:()=>Zu,length:()=>Lu,lower:()=>Ru,match:()=>Ku,pos:()=>zu,replace:()=>Wu,replace_all:()=>Ou,split:()=>Bu,startswith:()=>qu,substring:()=>Du,tonumber:()=>Vu,tostring:()=>Eu,trim:()=>Ju,trimLeft:()=>Qu,trimRight:()=>Gu,upper:()=>Fu});function Lu(i){return i.length}function Eu(i,t){var e;if(typeof i=="number"&&t){const s=((e=t.split(".")[1])==null?void 0:e.length)||0;return i.toFixed(s)}return String(i)}function Vu(i){const t=parseFloat(i);return isNaN(t)?null:t}function Du(i,t,e){return i.substring(t,e)}function Fu(i){return i.toUpperCase()}function Ru(i){return i.toLowerCase()}function ku(i,t){return i.includes(t)}function zu(i,t){return i.indexOf(t)}function Wu(i,t,e,s){return s===0?i.replace(t,e):i.replaceAll(t,e)}function Ou(i,t,e){return i.replaceAll(t,e)}function Bu(i,t){return i.split(t)}function Yu(...i){return i.join("")}function ju(i,...t){let e=i;return t.forEach((s,n)=>{e=e.replaceAll(`{${n}}`,String(s))}),e}function qu(i,t){return i.startsWith(t)}function Hu(i,t){return i.endsWith(t)}function Uu(i,t){return i.charAt(t)}function Ju(i){return i.trim()}function Qu(i){return i.trimStart()}function Gu(i){return i.trimEnd()}function Ku(i,t){return new RegExp(t).test(i)}function Zu(i,t){const e=new Date(i),s=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=e.getUTCFullYear(),r=e.getUTCMonth(),l=e.getUTCDate(),a=e.getUTCHours(),h=e.getUTCMinutes(),c=e.getUTCSeconds(),u=(v,w=2)=>v.toString().padStart(w,"0"),f=a%12||12,d=a<12?"AM":"PM",p=[[/yyyy/g,o.toString()],[/yy/g,o.toString().slice(-2)],[/MMMM/g,s[r]],[/MMM/g,n[r]],[/MM/g,u(r+1)],[/M/g,(r+1).toString()],[/dd/g,u(l)],[/d/g,l.toString()],[/HH/g,u(a)],[/H/g,a.toString()],[/hh/g,u(f)],[/h/g,f.toString()],[/mm/g,u(h)],[/m/g,h.toString()],[/ss/g,u(c)],[/s/g,c.toString()],[/a/g,d]];let m=t;const g=[];return p.forEach(([v,w],N)=>{const x=`￰${N}￱`;m=m.replace(v,x),g[N]=w}),g.forEach((v,w)=>{const N=`￰${w}￱`;m=m.replaceAll(N,v)}),m}var Xu={};j(Xu,{aqua:()=>rf,b:()=>nf,black:()=>lf,blue:()=>af,from_gradient:()=>xf,from_hex:()=>tf,fuchsia:()=>hf,g:()=>sf,gray:()=>cf,green:()=>uf,lime:()=>ff,maroon:()=>df,navy:()=>pf,new:()=>on,new_color:()=>on,olive:()=>mf,orange:()=>gf,purple:()=>vf,r:()=>ef,red:()=>wf,rgb:()=>hs,silver:()=>yf,t:()=>of,teal:()=>Nf,white:()=>Mf,yellow:()=>bf});function hs(i,t,e,s){const n=Math.max(0,Math.min(255,i)),o=Math.max(0,Math.min(255,t)),r=Math.max(0,Math.min(255,e)),l=s!==void 0?1-s/100:1;return l===1?`rgb(${n}, ${o}, ${r})`:`rgba(${n}, ${o}, ${r}, ${l})`}function tf(i,t){i=i.replace("#","");const e=parseInt(i.substring(0,2),16),s=parseInt(i.substring(2,4),16),n=parseInt(i.substring(4,6),16);return hs(e,s,n,t)}function on(i,t){const e=zt(i);return hs(e.r,e.g,e.b,t)}function ef(i){return zt(i).r}function sf(i){return zt(i).g}function nf(i){return zt(i).b}function of(i){return zt(i).t}function zt(i){if(typeof i=="string"){const t=i.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(t)return{r:parseInt(t[1]),g:parseInt(t[2]),b:parseInt(t[3]),t:t[4]?(1-parseFloat(t[4]))*100:0}}return{r:0,g:0,b:0,t:0}}var rf="#00FFFF",lf="#000000",af="#0000FF",hf="#FF00FF",cf="#808080",uf="#00FF00",ff="#00FF00",df="#800000",pf="#000080",mf="#808000",gf="#FFA500",vf="#800080",wf="#FF0000",yf="#C0C0C0",Nf="#008080",Mf="#FFFFFF",bf="#FFFF00";function xf(i,t,e,s,n){const o=N=>{if(typeof N=="string"){if(N.startsWith("#")){const M=N.slice(1),_=parseInt(M.slice(0,2),16),C=parseInt(M.slice(2,4),16),A=parseInt(M.slice(4,6),16);return[_,C,A,1]}const x=N.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(x)return[parseInt(x[1]),parseInt(x[2]),parseInt(x[3]),x[4]?parseFloat(x[4]):1]}return[0,0,0,1]},[r,l,a,h]=o(s),[c,u,f,d]=o(n);let p;i<=t?p=0:i>=e?p=1:p=(i-t)/(e-t);const m=Math.round(r+(c-r)*p),g=Math.round(l+(u-l)*p),v=Math.round(a+(f-a)*p),w=h+(d-h)*p;return w===1?`rgb(${m}, ${g}, ${v})`:`rgba(${m}, ${g}, ${v}, ${w})`}var _f={};j(_f,{now:()=>Cf,timestamp:()=>Sf});function Cf(){return Date.now()}function Sf(i,t,e,s,n,o){return new Date(i,t-1,e,s||0,n||0,o||0).getTime()}var Af={};j(Af,{add_col:()=>zf,add_row:()=>kf,avg:()=>Kf,col:()=>Vf,columns:()=>Tf,concat:()=>jf,copy:()=>fo,det:()=>ud,diff:()=>Gf,eigenvalues:()=>mo,eigenvectors:()=>gd,elements_count:()=>Lf,fill:()=>Df,get:()=>Pf,inv:()=>yt,is_antidiagonal:()=>ad,is_antisymmetric:()=>rd,is_binary:()=>Rf,is_diagonal:()=>sd,is_identity:()=>nd,is_square:()=>U,is_stochastic:()=>hd,is_symmetric:()=>od,is_triangular:()=>ld,is_zero:()=>Ff,kron:()=>yd,max:()=>Xf,median:()=>td,min:()=>Zf,mode:()=>ed,mult:()=>Z,new_matrix:()=>dt,newtype:()=>Nd,pinv:()=>fd,pow:()=>cd,rank:()=>dd,remove_col:()=>Of,remove_row:()=>Wf,reshape:()=>Hf,reverse:()=>Uf,row:()=>Ef,rows:()=>$f,set:()=>If,sort:()=>Jf,submatrix:()=>qf,sum:()=>Qf,swap_columns:()=>Yf,swap_rows:()=>Bf,trace:()=>id,transpose:()=>po});function dt(i,t,e){const s=[];for(let n=0;n<i;n++){const o=[];for(let r=0;r<t;r++)o.push(e);s.push(o)}return{rows:i,columns:t,data:s}}function Pf(i,t,e){if(t<0||t>=i.rows||e<0||e>=i.columns)throw new Error(`Matrix index out of bounds: [${t}, ${e}] for matrix of size [${i.rows}, ${i.columns}]`);return i.data[t][e]}function If(i,t,e,s){if(t<0||t>=i.rows||e<0||e>=i.columns)throw new Error(`Matrix index out of bounds: [${t}, ${e}] for matrix of size [${i.rows}, ${i.columns}]`);i.data[t][e]=s}function $f(i){return i.rows}function Tf(i){return i.columns}function Lf(i){return i.rows*i.columns}function Ef(i,t){if(t<0||t>=i.rows)throw new Error(`Row index out of bounds: ${t} for matrix with ${i.rows} rows`);return[...i.data[t]]}function Vf(i,t){if(t<0||t>=i.columns)throw new Error(`Column index out of bounds: ${t} for matrix with ${i.columns} columns`);return i.data.map(e=>e[t])}function fo(i){const t=i.data.map(e=>[...e]);return{rows:i.rows,columns:i.columns,data:t}}function Df(i,t,e=0,s,n=0,o){const r=s??i.rows,l=o??i.columns;for(let a=e;a<r;a++)for(let h=n;h<l;h++)i.data[a][h]=t}function U(i){return i.rows===i.columns}function Ff(i){for(let t=0;t<i.rows;t++)for(let e=0;e<i.columns;e++)if(i.data[t][e]!==0)return!1;return!0}function Rf(i){for(let t=0;t<i.rows;t++)for(let e=0;e<i.columns;e++){const s=i.data[t][e];if(s!==0&&s!==1)return!1}return!0}function kf(i,t,e){const s=t??i.rows;if(s<0||s>i.rows)throw new Error(`Row index out of bounds: ${s} for matrix with ${i.rows} rows`);let n;if(e!==void 0){if(i.columns>0&&e.length!==i.columns)throw new Error(`Array size ${e.length} does not match matrix columns ${i.columns}`);n=[...e],i.rows===0&&i.columns===0&&(i.columns=e.length)}else n=new Array(i.columns).fill(void 0);i.data.splice(s,0,n),i.rows++}function zf(i,t,e){const s=t??i.columns;if(s<0||s>i.columns)throw new Error(`Column index out of bounds: ${s} for matrix with ${i.columns} columns`);if(e!==void 0){if(i.rows>0&&e.length!==i.rows)throw new Error(`Array size ${e.length} does not match matrix rows ${i.rows}`);if(i.rows===0&&i.columns===0){i.rows=e.length;for(let n=0;n<e.length;n++)i.data.push([])}for(let n=0;n<i.rows;n++)i.data[n].splice(s,0,e[n])}else for(let n=0;n<i.rows;n++)i.data[n].splice(s,0,void 0);i.columns++}function Wf(i,t){const e=t??i.rows-1;if(e<0||e>=i.rows)throw new Error(`Row index out of bounds: ${e} for matrix with ${i.rows} rows`);const s=i.data.splice(e,1)[0];return i.rows--,s}function Of(i,t){const e=t??i.columns-1;if(e<0||e>=i.columns)throw new Error(`Column index out of bounds: ${e} for matrix with ${i.columns} columns`);const s=[];for(let n=0;n<i.rows;n++)s.push(i.data[n].splice(e,1)[0]);return i.columns--,s}function Bf(i,t,e){if(t<0||t>=i.rows)throw new Error(`Row1 index out of bounds: ${t} for matrix with ${i.rows} rows`);if(e<0||e>=i.rows)throw new Error(`Row2 index out of bounds: ${e} for matrix with ${i.rows} rows`);const s=i.data[t];i.data[t]=i.data[e],i.data[e]=s}function Yf(i,t,e){if(t<0||t>=i.columns)throw new Error(`Column1 index out of bounds: ${t} for matrix with ${i.columns} columns`);if(e<0||e>=i.columns)throw new Error(`Column2 index out of bounds: ${e} for matrix with ${i.columns} columns`);for(let s=0;s<i.rows;s++){const n=i.data[s][t];i.data[s][t]=i.data[s][e],i.data[s][e]=n}}function po(i){const t=[];for(let e=0;e<i.columns;e++){const s=[];for(let n=0;n<i.rows;n++)s.push(i.data[n][e]);t.push(s)}return{rows:i.columns,columns:i.rows,data:t}}function jf(i,t){if(i.columns!==t.columns)throw new Error(`Column count mismatch: ${i.columns} vs ${t.columns}`);for(let e=0;e<t.rows;e++)i.data.push([...t.data[e]]);return i.rows+=t.rows,i}function qf(i,t=0,e,s=0,n){const o=e??i.rows,r=n??i.columns;if(t<0||t>i.rows)throw new Error(`from_row index out of bounds: ${t}`);if(o<0||o>i.rows)throw new Error(`to_row index out of bounds: ${o}`);if(s<0||s>i.columns)throw new Error(`from_column index out of bounds: ${s}`);if(r<0||r>i.columns)throw new Error(`to_column index out of bounds: ${r}`);const l=o-t,a=r-s,h=[];for(let c=t;c<o;c++){const u=[];for(let f=s;f<r;f++)u.push(i.data[c][f]);h.push(u)}return{rows:l,columns:a,data:h}}function Hf(i,t,e){const s=i.rows*i.columns,n=t*e;if(s!==n)throw new Error(`Cannot reshape ${i.rows}x${i.columns} (${s} elements) to ${t}x${e} (${n} elements)`);const o=[];for(let a=0;a<i.rows;a++)for(let h=0;h<i.columns;h++)o.push(i.data[a][h]);const r=[];let l=0;for(let a=0;a<t;a++){const h=[];for(let c=0;c<e;c++)h.push(o[l++]);r.push(h)}i.rows=t,i.columns=e,i.data=r}function Uf(i){i.data.reverse();for(let t=0;t<i.rows;t++)i.data[t].reverse()}function Jf(i,t=0,e="ascending"){if(t<0||t>=i.columns)throw new Error(`Column index out of bounds: ${t} for matrix with ${i.columns} columns`);i.data.sort((s,n)=>{const o=s[t],r=n[t];return typeof o=="number"&&typeof r=="number"?e==="ascending"?o-r:r-o:e==="ascending"?o<r?-1:o>r?1:0:r<o?-1:r>o?1:0})}function Qf(i,t){const e=[];if(typeof t=="number"){for(let s=0;s<i.rows;s++){const n=[];for(let o=0;o<i.columns;o++)n.push(i.data[s][o]+t);e.push(n)}return{rows:i.rows,columns:i.columns,data:e}}else{if(i.rows!==t.rows||i.columns!==t.columns)throw new Error(`Matrix dimensions must match: ${i.rows}x${i.columns} vs ${t.rows}x${t.columns}`);for(let s=0;s<i.rows;s++){const n=[];for(let o=0;o<i.columns;o++)n.push(i.data[s][o]+t.data[s][o]);e.push(n)}return{rows:i.rows,columns:i.columns,data:e}}}function Gf(i,t){const e=[];if(typeof t=="number"){for(let s=0;s<i.rows;s++){const n=[];for(let o=0;o<i.columns;o++)n.push(i.data[s][o]-t);e.push(n)}return{rows:i.rows,columns:i.columns,data:e}}else{if(i.rows!==t.rows||i.columns!==t.columns)throw new Error(`Matrix dimensions must match: ${i.rows}x${i.columns} vs ${t.rows}x${t.columns}`);for(let s=0;s<i.rows;s++){const n=[];for(let o=0;o<i.columns;o++)n.push(i.data[s][o]-t.data[s][o]);e.push(n)}return{rows:i.rows,columns:i.columns,data:e}}}function Kf(i){if(i.rows===0||i.columns===0)return NaN;let t=0,e=0;for(let s=0;s<i.rows;s++)for(let n=0;n<i.columns;n++){const o=i.data[s][n];o!=null&&!isNaN(o)&&(t+=o,e++)}return e===0?NaN:t/e}function Zf(i){if(i.rows===0||i.columns===0)return NaN;let t=1/0;for(let e=0;e<i.rows;e++)for(let s=0;s<i.columns;s++){const n=i.data[e][s];n!=null&&!isNaN(n)&&n<t&&(t=n)}return t===1/0?NaN:t}function Xf(i){if(i.rows===0||i.columns===0)return NaN;let t=-1/0;for(let e=0;e<i.rows;e++)for(let s=0;s<i.columns;s++){const n=i.data[e][s];n!=null&&!isNaN(n)&&n>t&&(t=n)}return t===-1/0?NaN:t}function td(i){if(i.rows===0||i.columns===0)return NaN;const t=[];for(let s=0;s<i.rows;s++)for(let n=0;n<i.columns;n++){const o=i.data[s][n];o!=null&&!isNaN(o)&&t.push(o)}if(t.length===0)return NaN;t.sort((s,n)=>s-n);const e=Math.floor(t.length/2);return t.length%2===0?(t[e-1]+t[e])/2:t[e]}function ed(i){if(i.rows===0||i.columns===0)return NaN;const t=new Map;let e=0,s=NaN;for(let n=0;n<i.rows;n++)for(let o=0;o<i.columns;o++){const r=i.data[n][o];if(r!=null&&!isNaN(r)){const l=(t.get(r)||0)+1;t.set(r,l),(l>e||l===e&&r<s)&&(e=l,s=r)}}return s}function id(i){if(!U(i))throw new Error(`Matrix must be square for trace calculation: ${i.rows}x${i.columns}`);if(i.rows===0)return 0;let t=0;for(let e=0;e<i.rows;e++){const s=i.data[e][e];s!=null&&!isNaN(s)&&(t+=s)}return t}function sd(i){if(!U(i))return!1;for(let t=0;t<i.rows;t++)for(let e=0;e<i.columns;e++)if(t!==e&&i.data[t][e]!==0)return!1;return!0}function nd(i){if(!U(i))return!1;for(let t=0;t<i.rows;t++)for(let e=0;e<i.columns;e++){const s=i.data[t][e];if(t===e){if(s!==1)return!1}else if(s!==0)return!1}return!0}function od(i){if(!U(i))return!1;for(let t=0;t<i.rows;t++)for(let e=t+1;e<i.columns;e++)if(i.data[t][e]!==i.data[e][t])return!1;return!0}function rd(i){if(!U(i))return!1;for(let t=0;t<i.rows;t++){if(i.data[t][t]!==0)return!1;for(let e=t+1;e<i.columns;e++){const s=i.data[t][e],n=i.data[e][t];if(s!==-n)return!1}}return!0}function ld(i){if(!U(i))return!1;let t=!0;for(let s=1;s<i.rows&&t;s++)for(let n=0;n<s&&t;n++)i.data[s][n]!==0&&(t=!1);if(t)return!0;let e=!0;for(let s=0;s<i.rows-1&&e;s++)for(let n=s+1;n<i.columns&&e;n++)i.data[s][n]!==0&&(e=!1);return e}function ad(i){if(!U(i))return!1;const t=i.rows;for(let e=0;e<t;e++)for(let s=0;s<t;s++)if(!(e+s===t-1)&&i.data[e][s]!==0)return!1;return!0}function hd(i){if(i.rows===0||i.columns===0)return!1;const t=1e-10;for(let e=0;e<i.rows;e++){let s=0;for(let n=0;n<i.columns;n++){const o=i.data[e][n];if(o<0)return!1;s+=o}if(Math.abs(s-1)>t)return!1}return!0}var B=1e-10;function rn(i){const t=dt(i,i,0);for(let e=0;e<i;e++)t.data[e][e]=1;return t}function Z(i,t){if(typeof t=="number"){const r=[];for(let l=0;l<i.rows;l++){const a=[];for(let h=0;h<i.columns;h++)a.push(i.data[l][h]*t);r.push(a)}return{rows:i.rows,columns:i.columns,data:r}}if(Array.isArray(t)&&!("rows"in t)){const r=t;if(r.length!==i.columns)throw new Error(`Vector length ${r.length} must equal matrix columns ${i.columns}`);const l=[];for(let a=0;a<i.rows;a++){let h=0;for(let c=0;c<i.columns;c++)h+=i.data[a][c]*r[c];l.push(h)}return l}const e=t;if(i.columns!==e.rows)throw new Error(`Matrix multiplication dimension mismatch: ${i.rows}x${i.columns} × ${e.rows}x${e.columns}. First matrix columns (${i.columns}) must equal second matrix rows (${e.rows})`);const s=i.rows,n=e.columns,o=[];for(let r=0;r<s;r++){const l=[];for(let a=0;a<n;a++){let h=0;for(let c=0;c<i.columns;c++)h+=i.data[r][c]*e.data[c][a];l.push(h)}o.push(l)}return{rows:s,columns:n,data:o}}function cd(i,t){if(!U(i))throw new Error(`Matrix must be square for power calculation: ${i.rows}x${i.columns}`);const e=i.rows;if(t===0)return rn(e);let s,n=t;if(t<0){const r=yt(i);if(r===null)throw new Error("Cannot compute negative power of singular matrix");s=r,n=-t}else s=fo(i);let o=rn(e);for(;n>0;)n%2===1&&(o=Z(o,s)),s=Z(s,s),n=Math.floor(n/2);return o}function ud(i){if(!U(i))throw new Error(`Matrix must be square for determinant calculation: ${i.rows}x${i.columns}`);const t=i.rows;if(t===0)return 1;if(t===1)return i.data[0][0];if(t===2)return i.data[0][0]*i.data[1][1]-i.data[0][1]*i.data[1][0];const e=i.data.map(o=>[...o]);let s=1,n=0;for(let o=0;o<t;o++){let r=o,l=Math.abs(e[o][o]);for(let h=o+1;h<t;h++){const c=Math.abs(e[h][o]);c>l&&(l=c,r=h)}if(r!==o){const h=e[o];e[o]=e[r],e[r]=h,n++}const a=e[o][o];if(Math.abs(a)<B)return 0;s*=a;for(let h=o+1;h<t;h++){const c=e[h][o]/a;for(let u=o;u<t;u++)e[h][u]=e[h][u]-c*e[o][u]}}return n%2===1&&(s=-s),s}function yt(i){if(!U(i))throw new Error(`Matrix must be square for inverse calculation: ${i.rows}x${i.columns}`);const t=i.rows;if(t===0)return dt(0,0,0);const e=[];for(let n=0;n<t;n++){const o=[];for(let r=0;r<t;r++)o.push(i.data[n][r]);for(let r=0;r<t;r++)o.push(n===r?1:0);e.push(o)}for(let n=0;n<t;n++){let o=n,r=Math.abs(e[n][n]);for(let a=n+1;a<t;a++){const h=Math.abs(e[a][n]);h>r&&(r=h,o=a)}if(o!==n){const a=e[n];e[n]=e[o],e[o]=a}const l=e[n][n];if(Math.abs(l)<B)return null;for(let a=0;a<2*t;a++)e[n][a]=e[n][a]/l;for(let a=0;a<t;a++)if(a!==n){const h=e[a][n];for(let c=0;c<2*t;c++)e[a][c]=e[a][c]-h*e[n][c]}}const s=[];for(let n=0;n<t;n++){const o=[];for(let r=0;r<t;r++)o.push(e[n][t+r]);s.push(o)}return{rows:t,columns:t,data:s}}function fd(i){const t=i.rows,e=i.columns;if(t===0||e===0)return dt(e,t,0);if(t===e){const h=yt(i);if(h!==null)return h}const s=po(i);if(t>=e){const h=Z(s,i),c=yt(h);if(c!==null)return Z(c,s)}const n=Z(i,s),o=yt(n);if(o!==null)return Z(s,o);const r=1e-10,l=Z(s,i);for(let h=0;h<l.rows;h++)l.data[h][h]=l.data[h][h]+r;const a=yt(l);return a!==null?Z(a,s):dt(e,t,0)}function dd(i){if(i.rows===0||i.columns===0)return 0;const t=i.data.map(o=>[...o]),e=i.rows,s=i.columns;let n=0;for(let o=0;o<s&&n<e;o++){let r=n,l=Math.abs(t[n][o]);for(let h=n+1;h<e;h++){const c=Math.abs(t[h][o]);c>l&&(l=c,r=h)}if(l<B)continue;if(r!==n){const h=t[n];t[n]=t[r],t[r]=h}const a=t[n][o];for(let h=n+1;h<e;h++){const c=t[h][o]/a;for(let u=o;u<s;u++)t[h][u]=t[h][u]-c*t[n][u]}n++}return n}function mo(i){if(!U(i))throw new Error(`Matrix must be square for eigenvalue calculation: ${i.rows}x${i.columns}`);const t=i.rows;if(t===0)return[];if(t===1)return[i.data[0][0]];if(t===2){const n=i.data[0][0],o=i.data[0][1],r=i.data[1][0],l=i.data[1][1],a=n+l,h=n*l-o*r,c=a*a-4*h;if(c>=0){const u=Math.sqrt(c);return[(a+u)/2,(a-u)/2]}else return[a/2,a/2]}const e=pd(i);return md(e,100)}function pd(i){const t=i.rows,e=i.data.map(s=>[...s]);for(let s=0;s<t-2;s++){let n=0;for(let a=s+1;a<t;a++)n=Math.max(n,Math.abs(e[a][s]));if(n<B)continue;let o=0;for(let a=s+1;a<t;a++)o+=e[a][s]*e[a][s];o=Math.sqrt(o),e[s+1][s]<0&&(o=-o);const r=new Array(t).fill(0);r[s+1]=e[s+1][s]+o;for(let a=s+2;a<t;a++)r[a]=e[a][s];let l=0;for(let a=s+1;a<t;a++)l+=r[a]*r[a];if(!(l<B)){for(let a=s;a<t;a++){let h=0;for(let u=s+1;u<t;u++)h+=r[u]*e[u][a];const c=2*h/l;for(let u=s+1;u<t;u++)e[u][a]=e[u][a]-c*r[u]}for(let a=0;a<t;a++){let h=0;for(let u=s+1;u<t;u++)h+=e[a][u]*r[u];const c=2*h/l;for(let u=s+1;u<t;u++)e[a][u]=e[a][u]-c*r[u]}}}return{rows:t,columns:t,data:e}}function md(i,t){const e=i.rows,s=i.data.map(r=>[...r]),n=[];let o=e;for(let r=0;r<t&&o>1;r++){let l=!1;for(let d=o-1;d>=1;d--)if(Math.abs(s[d][d-1])<B*(Math.abs(s[d-1][d-1])+Math.abs(s[d][d]))&&(s[d][d-1]=0,d===o-1)){n.push(s[o-1][o-1]),o--,l=!0;break}if(l)continue;if(o<=1)break;const a=(s[o-2][o-2]-s[o-1][o-1])/2,h=a>=0?1:-1,c=s[o-1][o-1]-h*s[o-1][o-2]*s[o-1][o-2]/(Math.abs(a)+Math.sqrt(a*a+s[o-1][o-2]*s[o-1][o-2]));let u=s[0][0]-c,f=s[1][0];for(let d=0;d<o-1;d++){let p=Math.sqrt(u*u+f*f);p<B&&(p=B);const m=u/p,g=f/p;for(let v=Math.max(0,d-1);v<o;v++){const w=m*s[d][v]+g*s[d+1][v];s[d+1][v]=-g*s[d][v]+m*s[d+1][v],s[d][v]=w}for(let v=0;v<Math.min(d+3,o);v++){const w=m*s[v][d]+g*s[v][d+1];s[v][d+1]=-g*s[v][d]+m*s[v][d+1],s[v][d]=w}d<o-2&&(u=s[d+1][d],f=s[d+2][d])}}for(let r=0;r<o;r++)n.push(s[r][r]);return n.sort((r,l)=>Math.abs(l)-Math.abs(r)),n}function gd(i){if(!U(i))throw new Error(`Matrix must be square for eigenvector calculation: ${i.rows}x${i.columns}`);const t=i.rows;if(t===0)return dt(0,0,0);const e=mo(i),s=[];for(let o=0;o<t;o++){const r=e[o],l=vd(i,r);s.push(l)}const n=[];for(let o=0;o<t;o++){const r=[];for(let l=0;l<t;l++)r.push(s[l][o]);n.push(r)}return{rows:t,columns:t,data:n}}function vd(i,t){const e=i.rows,s=i.data.map((o,r)=>o.map((l,a)=>r===a?l-t:l));for(let o=0;o<e;o++)Math.abs(s[o][o])<B&&(s[o][o]=B);let n=new Array(e).fill(1);for(let o=0;o<50;o++){const r=wd(s,n);let l=0;for(let c=0;c<e;c++)l+=r[c]*r[c];if(l=Math.sqrt(l),l<B)return n;const a=[];for(let c=0;c<e;c++)a.push(r[c]/l);let h=0;for(let c=0;c<e;c++)h+=Math.abs(Math.abs(a[c])-Math.abs(n[c]));if(n=a,h<B)break}return n}function wd(i,t){const e=i.length,s=i.map((o,r)=>[...o,t[r]]);for(let o=0;o<e;o++){let r=o,l=Math.abs(s[o][o]);for(let h=o+1;h<e;h++){const c=Math.abs(s[h][o]);c>l&&(l=c,r=h)}if(r!==o){const h=s[o];s[o]=s[r],s[r]=h}const a=s[o][o];if(!(Math.abs(a)<B))for(let h=o+1;h<e;h++){const c=s[h][o]/a;for(let u=o;u<=e;u++)s[h][u]=s[h][u]-c*s[o][u]}}const n=new Array(e).fill(0);for(let o=e-1;o>=0;o--){let r=s[o][e];for(let a=o+1;a<e;a++)r-=s[o][a]*n[a];const l=s[o][o];n[o]=Math.abs(l)<B?0:r/l}return n}function yd(i,t){const e=i.rows,s=i.columns,n=t.rows,o=t.columns,r=e*n,l=s*o,a=[];for(let h=0;h<r;h++)a.push(new Array(l).fill(0));for(let h=0;h<e;h++)for(let c=0;c<s;c++){const u=i.data[h][c];for(let f=0;f<n;f++)for(let d=0;d<o;d++){const p=h*n+f,m=c*o+d;a[p][m]=u*t.data[f][d]}}return{rows:r,columns:l,data:a}}function Nd(i=0,t=0,e){return dt(i,t,e)}var Md={};j(Md,{copy:()=>Ad,delete_line:()=>zd,get_price:()=>bd,get_x1:()=>xd,get_x2:()=>_d,get_y1:()=>Cd,get_y2:()=>Sd,new:()=>ln,new_line:()=>ln,set_color:()=>Fd,set_extend:()=>Dd,set_style:()=>Rd,set_width:()=>kd,set_x1:()=>Pd,set_x2:()=>Id,set_xloc:()=>Vd,set_xy1:()=>Ld,set_xy2:()=>Ed,set_y1:()=>$d,set_y2:()=>Td});function ln(i,t,e,s,n="bar_index",o="none",r,l,a){return{x1:i,y1:t,x2:e,y2:s,xloc:n,extend:o,color:r,style:l||"solid",width:a||1}}function bd(i,t){const{x1:e,y1:s,x2:n,y2:o,extend:r,xloc:l}=i;if(l==="bar_time")throw new Error("line.get_price() only works with xloc.bar_index lines, not xloc.bar_time");if(n===e)return NaN;const a=(o-s)/(n-e),h=s+a*(t-e);if(r==="none"){if(t<Math.min(e,n)||t>Math.max(e,n))return NaN}else if(r==="left"){if(t>Math.max(e,n))return NaN}else if(r==="right"&&t<Math.min(e,n))return NaN;return h}function xd(i){return i.x1}function _d(i){return i.x2}function Cd(i){return i.y1}function Sd(i){return i.y2}function Ad(i){return{...i}}function Pd(i,t){return i.x1=t,i}function Id(i,t){return i.x2=t,i}function $d(i,t){return i.y1=t,i}function Td(i,t){return i.y2=t,i}function Ld(i,t,e){return i.x1=t,i.y1=e,i}function Ed(i,t,e){return i.x2=t,i.y2=e,i}function Vd(i,t,e,s){return i.x1=t,i.x2=e,i.xloc=s,i}function Dd(i,t){return i.extend=t,i}function Fd(i,t){return i.color=t,i}function Rd(i,t){return i.style=t,i}function kd(i,t){return i.width=t,i}function zd(i){}var Wd={};j(Wd,{copy:()=>qd,delete_box:()=>up,get_bottom:()=>jd,get_left:()=>Od,get_right:()=>Bd,get_top:()=>Yd,new:()=>an,new_box:()=>an,set_bgcolor:()=>sp,set_border_color:()=>tp,set_border_style:()=>ip,set_border_width:()=>ep,set_bottom:()=>Qd,set_extend:()=>Xd,set_left:()=>Hd,set_lefttop:()=>Gd,set_right:()=>Ud,set_rightbottom:()=>Kd,set_text:()=>np,set_text_color:()=>op,set_text_font_family:()=>cp,set_text_halign:()=>lp,set_text_size:()=>rp,set_text_valign:()=>ap,set_text_wrap:()=>hp,set_top:()=>Jd,set_xloc:()=>Zd});function an(i,t,e,s,n="bar_index",o="none",r,l,a,h,c,u,f,d,p,m,g){return{left:i,top:t,right:e,bottom:s,xloc:n,extend:o,border_color:r,border_width:l||1,border_style:a||"solid",bgcolor:h,text:c,text_size:u,text_color:f,text_halign:d,text_valign:p,text_wrap:m,text_font_family:g}}function Od(i){return i.left}function Bd(i){return i.right}function Yd(i){return i.top}function jd(i){return i.bottom}function qd(i){return{...i}}function Hd(i,t){return i.left=t,i}function Ud(i,t){return i.right=t,i}function Jd(i,t){return i.top=t,i}function Qd(i,t){return i.bottom=t,i}function Gd(i,t,e){return i.left=t,i.top=e,i}function Kd(i,t,e){return i.right=t,i.bottom=e,i}function Zd(i,t,e,s){return i.left=t,i.right=e,i.xloc=s,i}function Xd(i,t){return i.extend=t,i}function tp(i,t){return i.border_color=t,i}function ep(i,t){return i.border_width=t,i}function ip(i,t){return i.border_style=t,i}function sp(i,t){return i.bgcolor=t,i}function np(i,t){return i.text=t,i}function op(i,t){return i.text_color=t,i}function rp(i,t){return i.text_size=t,i}function lp(i,t){return i.text_halign=t,i}function ap(i,t){return i.text_valign=t,i}function hp(i,t){return i.text_wrap=t,i}function cp(i,t){return i.text_font_family=t,i}function up(i){}var fp={};j(fp,{copy:()=>gp,delete_label:()=>$p,get_text:()=>mp,get_x:()=>dp,get_y:()=>pp,new:()=>hn,new_label:()=>hn,set_color:()=>_p,set_size:()=>Ap,set_style:()=>Sp,set_text:()=>bp,set_text_font_family:()=>Ip,set_textalign:()=>Pp,set_textcolor:()=>Cp,set_tooltip:()=>xp,set_x:()=>vp,set_xloc:()=>Np,set_xy:()=>yp,set_y:()=>wp,set_yloc:()=>Mp});function hn(i,t,e,s="bar_index",n="price",o,r,l,a,h,c,u){return{x:i,y:t,xloc:s,yloc:n,text:e,tooltip:c,color:o,style:r,textcolor:l,size:a,textalign:h,text_font_family:u}}function dp(i){return i.x}function pp(i){return i.y}function mp(i){return i.text}function gp(i){return{...i}}function vp(i,t){return i.x=t,i}function wp(i,t){return i.y=t,i}function yp(i,t,e){return i.x=t,i.y=e,i}function Np(i,t,e){return i.x=t,i.xloc=e,i}function Mp(i,t,e){return i.y=t,i.yloc=e,i}function bp(i,t){return i.text=t,i}function xp(i,t){return i.tooltip=t,i}function _p(i,t){return i.color=t,i}function Cp(i,t){return i.textcolor=t,i}function Sp(i,t){return i.style=t,i}function Ap(i,t){return i.size=t,i}function Pp(i,t){return i.textalign=t,i}function Ip(i,t){return i.text_font_family=t,i}function $p(i){}var Tp={};j(Tp,{delete_linefill:()=>Dp,get_line1:()=>Lp,get_line2:()=>Ep,new:()=>cn,new_linefill:()=>cn,set_color:()=>Vp});function cn(i,t,e){return{line1:i,line2:t,color:e}}function Lp(i){return i.line1}function Ep(i){return i.line2}function Vp(i,t){return i.color=t,i}function Dp(i){}var Fp={};j(Fp,{copy:()=>zp,from_index:()=>kp,from_time:()=>Rp,new:()=>un,new_point:()=>un});function un(i,t,e){return{time:i,index:t,price:e}}function Rp(i,t){return{time:i,index:null,price:t}}function kp(i,t){return{time:null,index:i,price:t}}function zp(i){return{time:i.time,index:i.index,price:i.price}}var Wp={};j(Wp,{clear_all:()=>Yp,delete:()=>dn,delete_polyline:()=>dn,get_all:()=>Bp,new:()=>fn,new_polyline:()=>fn,reset_id_counter:()=>jp});var go=0,Ft=[];function Op(){return`polyline_${++go}`}function fn(i,t=!1,e=!1,s="bar_index",n="#2196F3",o=null,r="solid",l=1,a=!1){t&&console.warn("polyline.new(): curved polylines are not yet supported. Using straight-line connections."),l<1&&(console.warn("polyline.new(): line_width must be at least 1. Using 1."),l=1);const h={id:Op(),points:[...i],curved:t,closed:e,xloc:s,line_color:n,fill_color:o,line_style:r,line_width:l,force_overlay:a};return Ft.push(h),h}function dn(i){const t=Ft.findIndex(e=>e.id===i.id);t!==-1&&Ft.splice(t,1)}function Bp(){return[...Ft]}function Yp(){Ft.length=0}function jp(){go=0}var b={};j(b,{alma:()=>jo,atr:()=>Co,bb:()=>xo,cci:()=>Ho,change:()=>To,cross:()=>$o,crossover:()=>Po,crossunder:()=>Io,cum:()=>ko,ema:()=>wo,falling:()=>Ro,highest:()=>Vo,ichimoku:()=>Oo,linreg:()=>Yo,lowest:()=>Do,macd:()=>bo,mom:()=>Lo,rising:()=>Fo,rma:()=>No,roc:()=>Eo,rsi:()=>Mo,sar:()=>Uo,sma:()=>vo,stdev:()=>_o,stoch:()=>Ao,supertrend:()=>zo,ta:()=>qp,tr:()=>So,vwap:()=>Wo,vwma:()=>Bo,wma:()=>yo,zigzag:()=>qo});function vo(i,t){const e=i.bars,s=i.toArray(),n=it(s,t);return y.fromArray(e,n)}function wo(i,t){const e=i.bars,s=i.toArray(),n=Q(s,t);return y.fromArray(e,n)}function yo(i,t){const e=i.bars,s=i.toArray(),n=Et(s,t);return y.fromArray(e,n)}function No(i,t){const e=i.bars,s=i.toArray(),n=et(s,t);return y.fromArray(e,n)}function Mo(i,t){const e=i.bars,s=i.toArray(),n=Fn(s,t);return y.fromArray(e,n)}function bo(i,t,e,s){const n=i.bars,o=i.toArray(),[r,l,a]=Rn(o,t,e,s),h=y.fromArray(n,r),c=y.fromArray(n,l),u=y.fromArray(n,a);return[h,c,u]}function xo(i,t,e){const s=i.bars,n=i.toArray(),[o,r,l]=rs(n,t,e),a=y.fromArray(s,o),h=y.fromArray(s,r),c=y.fromArray(s,l);return[a,h,c]}function _o(i,t){const e=i.bars,s=i.toArray(),n=ls(s,t);return y.fromArray(e,n)}function Co(i,t){const e=i.map(r=>r.high),s=i.map(r=>r.low),n=i.map(r=>r.close),o=as(t,e,s,n);return y.fromArray(i,o)}function So(i,t=!1){const e=i.map(r=>r.high),s=i.map(r=>r.low),n=i.map(r=>r.close),o=kt(t,e,s,n);return y.fromArray(i,o)}function Ao(i,t,e,s){const n=i.bars,o=i.toArray(),r=t.toArray(),l=e.toArray(),a=Zn(o,r,l,s);return y.fromArray(n,a)}function Po(i,t){const e=i.bars,s=i.toArray(),n=typeof t=="number"?Array(e.length).fill(t):t.toArray(),r=kn(s,n).map(l=>l?1:0);return y.fromArray(e,r)}function Io(i,t){const e=i.bars,s=i.toArray(),n=typeof t=="number"?Array(e.length).fill(t):t.toArray(),r=zn(s,n).map(l=>l?1:0);return y.fromArray(e,r)}function $o(i,t){const e=i.bars,s=i.toArray(),n=typeof t=="number"?Array(e.length).fill(t):t.toArray(),r=Yn(s,n).map(l=>l?1:0);return y.fromArray(e,r)}function To(i,t=1){const e=i.bars,s=i.toArray(),n=Wn(s,t);return y.fromArray(e,n)}function Lo(i,t){const e=i.bars,s=i.toArray(),n=Un(s,t);return y.fromArray(e,n)}function Eo(i,t){const e=i.bars,s=i.toArray(),n=Hn(s,t);return y.fromArray(e,n)}function Vo(i,t){const e=i.bars,s=i.toArray(),n=Mt(s,t);return y.fromArray(e,n)}function Do(i,t){const e=i.bars,s=i.toArray(),n=bt(s,t);return y.fromArray(e,n)}function Fo(i,t){const e=i.bars,s=i.toArray(),o=jn(s,t).map(r=>r?1:0);return y.fromArray(e,o)}function Ro(i,t){const e=i.bars,s=i.toArray(),o=qn(s,t).map(r=>r?1:0);return y.fromArray(e,o)}function ko(i){const t=i.bars,e=i.toArray(),s=Bn(e);return y.fromArray(t,s)}function zo(i,t,e){const s=i.map(c=>c.high),n=i.map(c=>c.low),o=i.map(c=>c.close),[r,l]=On(t,e,s,n,o),a=y.fromArray(i,r),h=y.fromArray(i,l);return[a,h]}function Wo(i,t){const e=i.bars,s=i.toArray(),n=t.toArray(),o=eo(s,n);return y.fromArray(e,o)}function Oo(i,t,e,s,n){const o=i.map(d=>d.high),r=i.map(d=>d.low),l=i.map(d=>d.close),[a,h,c,u,f]=oo(t,e,s,n,o,r,l);return[y.fromArray(i,a),y.fromArray(i,h),y.fromArray(i,c),y.fromArray(i,u),y.fromArray(i,f)]}function Bo(i,t,e){const s=i.bars,n=i.toArray(),o=e.toArray(),r=Qn(n,t,o);return y.fromArray(s,r)}function Yo(i,t,e=0){const s=i.bars,n=i.toArray(),o=Gn(n,t,e);return y.fromArray(s,o)}function jo(i,t=9,e=.85,s=6,n=!1){const o=i.bars,r=i.toArray(),l=io(r,t,e,s,n);return y.fromArray(o,l)}function qo(i,t=5,e=10,s=3){const n=i.map(h=>h.high),o=i.map(h=>h.low),[r,l,a]=ro(t,e,s,void 0,n,o);return[y.fromArray(i,r),y.fromArray(i,l),y.fromArray(i,a.map(h=>h?1:0))]}function Ho(i,t){const e=i.bars,s=i.toArray(),n=Kn(s,t);return y.fromArray(e,n)}function Uo(i,t=.02,e=.02,s=.2){const n=i.map(a=>a.high),o=i.map(a=>a.low),r=i.map(a=>a.close),l=Xn(t,e,s,n,o,r);return y.fromArray(i,l)}var qp={sma:vo,ema:wo,wma:yo,vwma:Bo,rma:No,rsi:Mo,macd:bo,bb:xo,stdev:_o,atr:Co,tr:So,stoch:Ao,crossover:Po,crossunder:Io,cross:$o,change:To,mom:Lo,roc:Eo,highest:Vo,lowest:Do,rising:Fo,falling:Ro,cum:ko,supertrend:zo,vwap:Wo,ichimoku:Oo,linreg:Yo,alma:jo,zigzag:qo,cci:Ho,sar:Uo};function F(i,t="close"){const e=new y(i,r=>r.open),s=new y(i,r=>r.high),n=new y(i,r=>r.low),o=new y(i,r=>r.close);switch(t){case"open":return e;case"high":return s;case"low":return n;case"close":return o;case"hl2":return s.add(n).div(2);case"hlc3":return s.add(n).add(o).div(3);case"ohlc4":return e.add(s).add(n).add(o).div(4);case"hlcc4":return s.add(n).add(o).add(o).div(4);default:return o}}var Hp={devThreshold:5,depth:10,lineColor:"#2962FF",extendLast:!0,displayReversalPrice:!0,displayCumulativeVolume:!0,displayReversalPriceChange:!0,differencePriceMode:"Absolute",allowZigZagOnOneBar:!0},Up=class{constructor(i){V(this,"settings");V(this,"pivots",[]);V(this,"sumVol",0);V(this,"highBuffer",[]);V(this,"lowBuffer",[]);V(this,"timeBuffer",[]);V(this,"barCount",0);this.settings={...Hp,...i}}update(i,t){this.highBuffer.push(i.high),this.lowBuffer.push(i.low),this.timeBuffer.push(i.time),this.barCount++;const e=Math.max(2,Math.floor(this.settings.depth/2));if(this.sumVol+=i.volume??0,this.barCount<e*2+1)return!1;let s=this.tryFindPivot(!0,e,t);return s=this.tryFindPivot(!1,e,t,this.settings.allowZigZagOnOneBar||!s)||s,s}lastPivot(){if(this.pivots.length===0)return null;const i=this.pivots[this.pivots.length-1];return i!==void 0?i:null}getExtension(i,t){if(!this.settings.extendLast)return null;const e=this.lastPivot();if(!e)return null;const s=!e.isHigh,n=s?i.high:i.low;return{isHigh:s,volume:this.sumVol,start:e.end,end:{time:i.time,barIndex:t,price:n}}}tryFindPivot(i,t,e,s=!0){const n=this.findPivotPoint(i,t,e);return!n||!s?!1:this.newPivotPointFound(i,n)}findPivotPoint(i,t,e){const s=i?this.highBuffer:this.lowBuffer,n=s.length-1-t;if(n<t)return null;const o=s[n];if(o===void 0)return null;for(let a=n+1;a<s.length;a++){const h=s[a];if(h===void 0)return null;if(i){if(h>o)return null}else if(h<o)return null}for(let a=n-t;a<n;a++){const h=s[a];if(h===void 0)return null;if(i){if(h>=o)return null}else if(h<=o)return null}const r=e-t,l=this.timeBuffer[n];return l===void 0?null:{time:l,barIndex:r,price:o}}calcDev(i,t){return 100*(t-i)/Math.abs(i)}newPivotPointFound(i,t){const e=this.lastPivot();if(!e)return this.pivots.push({isHigh:i,volume:this.sumVol,start:t,end:t}),this.sumVol=0,!0;if(e.isHigh===i){if(i?t.price>e.end.price:t.price<e.end.price)return e.end=t,e.volume+=this.sumVol,this.sumVol=0,!0}else{const s=this.calcDev(e.end.price,t.price),n=this.settings.devThreshold;if(e.isHigh?s<=-n:s>=n)return this.pivots.push({isHigh:i,volume:this.sumVol,start:e.end,end:t}),this.sumVol=0,!0}return!1}};function Jp(i,t){if(i.length===0)return{pivots:[],extension:null};const e=new Up(t);for(let o=0;o<i.length;o++){const r=i[o];r!==void 0&&e.update(r,o)}const s=i[i.length-1];if(s===void 0)return{pivots:e.pivots,extension:null};const n=e.getExtension(s,i.length-1);return{pivots:e.pivots,extension:n}}const Jo={len:9,src:"close",offset:0},Qp=[{id:"len",type:"int",title:"Length",defval:9,min:1},{id:"src",type:"source",title:"Source",defval:"close"},{id:"offset",type:"int",title:"Offset",defval:0,min:-500,max:500}],Gp=[{id:"plot0",title:"MA",color:"#2962FF",lineWidth:2}],Gt={title:"Simple Moving Average",shortTitle:"SMA",overlay:!0};function Kp(i,t={}){const{len:e,src:s}={...Jo,...t},n=F(i,s),r=b.sma(n,e).toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:Gt.title,shorttitle:Gt.shortTitle,overlay:Gt.overlay},plots:{plot0:r}}}const Qo={lengthInput:14},Zp=[{id:"lengthInput",type:"int",title:"Length",defval:14,min:1}],Xp=[{id:"plot0",title:"ADR",color:"#2962FF",lineWidth:2}],Kt={title:"Average Day Range",shortTitle:"ADR",overlay:!1};function tm(i,t={}){const{lengthInput:e}={...Qo,...t},s=new y(i,a=>a.high),n=new y(i,a=>a.low),o=s.sub(n),l=b.sma(o,e).toArray().map((a,h)=>({time:i[h].time,value:a??NaN}));return{metadata:{title:Kt.title,shorttitle:Kt.shortTitle,overlay:Kt.overlay},plots:{plot0:l}}}const Go={lengthInput:9,offsetInput:.85,sigmaInput:6},em=[{id:"lengthInput",type:"int",title:"Length",defval:9,min:1},{id:"offsetInput",type:"float",title:"Offset",defval:.85,step:.01},{id:"sigmaInput",type:"float",title:"Sigma",defval:6}],im=[{id:"plot0",title:"ALMA",color:"#2962FF",lineWidth:2}],Zt={title:"Arnaud Legoux Moving Average",shortTitle:"ALMA",overlay:!0};function sm(i,t={}){const{lengthInput:e,offsetInput:s,sigmaInput:n}={...Go,...t},o=new y(i,a=>a.close),l=b.alma(o,e,s,n).toArray().map((a,h)=>({time:i[h].time,value:a??NaN}));return{metadata:{title:Zt.title,shorttitle:Zt.shortTitle,overlay:Zt.overlay},plots:{plot0:l}}}const Ko={length:14,smoothing:"RMA"},nm=[{id:"length",type:"int",title:"Length",defval:14,min:1},{id:"smoothing",type:"string",title:"Smoothing",defval:"RMA",options:["RMA","SMA","EMA","WMA"]}],om=[{id:"plot0",title:"ATR",color:"#2962FF",lineWidth:2}],Xt={title:"Average True Range",shortTitle:"ATR",overlay:!1};function rm(i,t={}){const{length:e,smoothing:s}={...Ko,...t},n=b.tr(i,!0);let o;switch(s){case"SMA":o=b.sma(n,e);break;case"EMA":o=b.ema(n,e);break;case"WMA":o=b.wma(n,e);break;case"RMA":default:o=b.rma(n,e);break}const r=o.toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:Xt.title,shorttitle:Xt.shortTitle,overlay:Xt.overlay},plots:{plot0:r}}}const Zo={length:20,maType:"SMA",src:"close",mult:2,offset:0},lm=[{id:"length",type:"int",title:"Length",defval:20,min:1},{id:"maType",type:"string",title:"Basis MA Type",defval:"SMA",options:["SMA","EMA","SMMA (RMA)","WMA","VWMA"]},{id:"src",type:"source",title:"Source",defval:"close"},{id:"mult",type:"float",title:"StdDev",defval:2,min:.001,max:50},{id:"offset",type:"int",title:"Offset",defval:0,min:-500,max:500}],am=[{id:"plot0",title:"Basis",color:"#2962FF",lineWidth:2},{id:"plot1",title:"Upper",color:"#F23645",lineWidth:2},{id:"plot2",title:"Lower",color:"#089981",lineWidth:2}],te={title:"Bollinger Bands",shortTitle:"BB",overlay:!0};function hm(i,t={}){const{length:e,maType:s,src:n,mult:o}={...Zo,...t},r=F(i,n),l=new y(i,m=>m.volume??0);let a;switch(s){case"EMA":a=b.ema(r,e);break;case"SMMA (RMA)":a=b.rma(r,e);break;case"WMA":a=b.wma(r,e);break;case"VWMA":a=b.vwma(r,e,l);break;case"SMA":default:a=b.sma(r,e);break}const h=b.stdev(r,e).mul(o),c=a.add(h),u=a.sub(h),f=a.toArray().map((m,g)=>({time:i[g].time,value:m??NaN})),d=c.toArray().map((m,g)=>({time:i[g].time,value:m??NaN})),p=u.toArray().map((m,g)=>({time:i[g].time,value:m??NaN}));return{metadata:{title:te.title,shorttitle:te.shortTitle,overlay:te.overlay},plots:{plot0:f,plot1:d,plot2:p}}}const cm={},um=[],fm=[{id:"plot0",title:"BOP",color:"#2962FF",lineWidth:2}],ee={title:"Balance of Power",shortTitle:"BOP",overlay:!1};function dm(i,t={}){const e=new y(i,a=>a.open),s=new y(i,a=>a.high),n=new y(i,a=>a.low),l=new y(i,a=>a.close).sub(e).div(s.sub(n)).toArray().map((a,h)=>({time:i[h].time,value:a??NaN}));return{metadata:{title:ee.title,shorttitle:ee.shortTitle,overlay:ee.overlay},plots:{plot0:l}}}const Xo={length:20,src:"hlc3"},pm=[{id:"length",type:"int",title:"Length",defval:20,min:1},{id:"src",type:"source",title:"Source",defval:"hlc3"}],mm=[{id:"plot0",title:"CCI",color:"#2962FF",lineWidth:2}],ie={title:"Commodity Channel Index",shortTitle:"CCI",overlay:!1};function gm(i,t={}){const{length:e,src:s}={...Xo,...t},n=F(i,s),r=b.cci(n,e).toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:ie.title,shorttitle:ie.shortTitle,overlay:ie.overlay},plots:{plot0:r}}}const tr={length:9,src:"close",offset:0},vm=[{id:"length",type:"int",title:"Length",defval:9,min:1},{id:"src",type:"source",title:"Source",defval:"close"},{id:"offset",type:"int",title:"Offset",defval:0,min:-500,max:500}],wm=[{id:"plot0",title:"DEMA",color:"#43A047",lineWidth:2}],se={title:"Double EMA",shortTitle:"DEMA",overlay:!0};function ym(i,t={}){const{length:e,src:s}={...tr,...t},n=F(i,s),o=b.ema(n,e),r=b.ema(o,e),a=o.mul(2).sub(r).toArray().map((h,c)=>({time:i[c].time,value:h??NaN}));return{metadata:{title:se.title,shorttitle:se.shortTitle,overlay:se.overlay},plots:{plot0:a}}}const er={length:20,offset:0},Nm=[{id:"length",type:"int",title:"Length",defval:20,min:1},{id:"offset",type:"int",title:"Offset",defval:0}],Mm=[{id:"plot0",title:"Basis",color:"#FF6D00",lineWidth:1},{id:"plot1",title:"Upper",color:"#2962FF",lineWidth:1},{id:"plot2",title:"Lower",color:"#2962FF",lineWidth:1}],ne={title:"Donchian Channels",shortTitle:"DC",overlay:!0};function bm(i,t={}){const{length:e,offset:s}={...er,...t},n=new y(i,m=>m.high),o=new y(i,m=>m.low),r=b.highest(n,e),l=b.lowest(o,e),h=r.add(l).div(2).toArray(),c=r.toArray(),u=l.toArray(),f=h.map((m,g)=>{const v=g+s;return{time:i[g].time,value:v>=0&&v<i.length?m??NaN:NaN}}),d=c.map((m,g)=>{const v=g+s;return{time:i[g].time,value:v>=0&&v<i.length?m??NaN:NaN}}),p=u.map((m,g)=>{const v=g+s;return{time:i[g].time,value:v>=0&&v<i.length?m??NaN:NaN}});return{metadata:{title:ne.title,shorttitle:ne.shortTitle,overlay:ne.overlay},plots:{plot0:f,plot1:d,plot2:p}}}const ir={length:9,src:"close",offset:0},xm=[{id:"length",type:"int",title:"Length",defval:9,min:1},{id:"src",type:"source",title:"Source",defval:"close"},{id:"offset",type:"int",title:"Offset",defval:0,min:-500,max:500}],_m=[{id:"plot0",title:"EMA",color:"#2962FF",lineWidth:2}],oe={title:"Moving Average Exponential",shortTitle:"EMA",overlay:!0};function Cm(i,t={}){const{length:e,src:s}={...ir,...t},n=F(i,s),r=b.ema(n,e).toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:oe.title,shorttitle:oe.shortTitle,overlay:oe.overlay},plots:{plot0:r}}}const sr={length:9,src:"close"},Sm=[{id:"length",type:"int",title:"Length",defval:9,min:1},{id:"src",type:"source",title:"Source",defval:"close"}],Am=[{id:"plot0",title:"HMA",color:"#00897B",lineWidth:2}],re={title:"Hull Moving Average",shortTitle:"HMA",overlay:!0};function Pm(i,t={}){const{length:e,src:s}={...sr,...t},n=F(i,s),o=Math.max(1,Math.floor(e/2)),r=Math.max(1,Math.floor(Math.sqrt(e))),l=b.wma(n,o),a=b.wma(n,e),h=l.mul(2).sub(a),u=b.wma(h,r).toArray().map((f,d)=>({time:i[d].time,value:f??NaN}));return{metadata:{title:re.title,shorttitle:re.shortTitle,overlay:re.overlay},plots:{plot0:u}}}const nr={conversionPeriods:9,basePeriods:26,laggingSpan2Periods:52,displacement:26},Im=[{id:"conversionPeriods",type:"int",title:"Conversion Line Length",defval:9,min:1},{id:"basePeriods",type:"int",title:"Base Line Length",defval:26,min:1},{id:"laggingSpan2Periods",type:"int",title:"Leading Span B Length",defval:52,min:1},{id:"displacement",type:"int",title:"Lagging Span",defval:26,min:1}],$m=[{id:"plot0",title:"Conversion Line",color:"#2962FF",lineWidth:1},{id:"plot1",title:"Base Line",color:"#B71C1C",lineWidth:1},{id:"plot2",title:"Lagging Span",color:"#43A047",lineWidth:1},{id:"plot3",title:"Leading Span A",color:"#A5D6A7",lineWidth:1},{id:"plot4",title:"Leading Span B",color:"#EF9A9A",lineWidth:1}],le={title:"Ichimoku Cloud",shortTitle:"Ichimoku",overlay:!0};function ji(i,t,e){const s=b.highest(i,e),n=b.lowest(t,e);return s.add(n).div(2)}function Tm(i,t={}){const{conversionPeriods:e,basePeriods:s,laggingSpan2Periods:n,displacement:o}={...nr,...t},r=new y(i,C=>C.high),l=new y(i,C=>C.low),a=new y(i,C=>C.close),h=ji(r,l,e),c=ji(r,l,s),u=h.add(c).div(2),f=ji(r,l,n),d=h.toArray(),p=c.toArray(),m=a.toArray(),g=u.toArray(),v=f.toArray(),w=d.map((C,A)=>({time:i[A].time,value:C??NaN})),N=p.map((C,A)=>({time:i[A].time,value:C??NaN})),x=i.map((C,A)=>{const L=A+(o-1),P=L<i.length?m[L]:NaN;return{time:C.time,value:P??NaN}}),M=i.map((C,A)=>{const L=A-(o-1),P=L>=0?g[L]:NaN;return{time:C.time,value:P??NaN}}),_=i.map((C,A)=>{const L=A-(o-1),P=L>=0?v[L]:NaN;return{time:C.time,value:P??NaN}});return{metadata:{title:le.title,shorttitle:le.shortTitle,overlay:le.overlay},plots:{plot0:w,plot1:N,plot2:x,plot3:M,plot4:_}}}const or={length:20,mult:2,src:"close",useEMA:!0,bandsStyle:"Average True Range",atrLength:10},Lm=[{id:"length",type:"int",title:"Length",defval:20,min:1},{id:"mult",type:"float",title:"Multiplier",defval:2,min:.001,max:50},{id:"src",type:"source",title:"Source",defval:"close"},{id:"useEMA",type:"bool",title:"Use Exponential MA",defval:!0},{id:"bandsStyle",type:"string",title:"Bands Style",defval:"Average True Range",options:["Average True Range","True Range","Range"]},{id:"atrLength",type:"int",title:"ATR Length",defval:10,min:1}],Em=[{id:"plot0",title:"Upper",color:"#2962FF",lineWidth:1},{id:"plot1",title:"Basis",color:"#2962FF",lineWidth:1},{id:"plot2",title:"Lower",color:"#2962FF",lineWidth:1}],ae={title:"Keltner Channels",shortTitle:"KC",overlay:!0};function Vm(i,t={}){const{length:e,mult:s,src:n,useEMA:o,bandsStyle:r,atrLength:l}={...or,...t},a=F(i,n),h=new y(i,w=>w.high),c=new y(i,w=>w.low),u=o?b.ema(a,e):b.sma(a,e);let f;switch(r){case"True Range":f=b.tr(i,!0);break;case"Range":f=b.rma(h.sub(c),e);break;case"Average True Range":default:f=b.atr(i,l);break}const d=u.add(f.mul(s)),p=u.sub(f.mul(s)),m=d.toArray().map((w,N)=>({time:i[N].time,value:w??NaN})),g=u.toArray().map((w,N)=>({time:i[N].time,value:w??NaN})),v=p.toArray().map((w,N)=>({time:i[N].time,value:w??NaN}));return{metadata:{title:ae.title,shorttitle:ae.shortTitle,overlay:ae.overlay},plots:{plot0:m,plot1:g,plot2:v}}}const rr={length:25,src:"close",offset:0},Dm=[{id:"length",type:"int",title:"Length",defval:25,min:1},{id:"src",type:"source",title:"Source",defval:"close"},{id:"offset",type:"int",title:"Offset",defval:0,min:-500,max:500}],Fm=[{id:"plot0",title:"LSMA",color:"#FF6D00",lineWidth:2}],he={title:"Least Squares Moving Average",shortTitle:"LSMA",overlay:!0};function Rm(i,t={}){const{length:e,src:s,offset:n}={...rr,...t},o=F(i,s),l=b.linreg(o,e,n).toArray().map((a,h)=>({time:i[h].time,value:a??NaN}));return{metadata:{title:he.title,shorttitle:he.shortTitle,overlay:he.overlay},plots:{plot0:l}}}const lr={fastLength:12,slowLength:26,signalLength:9,src:"close"},km=[{id:"fastLength",type:"int",title:"Fast Length",defval:12,min:1},{id:"slowLength",type:"int",title:"Slow Length",defval:26,min:1},{id:"signalLength",type:"int",title:"Signal Smoothing",defval:9,min:1},{id:"src",type:"source",title:"Source",defval:"close"}],zm=[{id:"plot0",title:"Histogram",color:"#26A69A",lineWidth:2},{id:"plot1",title:"MACD",color:"#2962FF",lineWidth:2},{id:"plot2",title:"Signal",color:"#FF6D00",lineWidth:2}],ce={title:"Moving Average Convergence Divergence",shortTitle:"MACD",overlay:!1};function Wm(i,t={}){const{fastLength:e,slowLength:s,signalLength:n,src:o}={...lr,...t},r=F(i,o),l=b.ema(r,e),a=b.ema(r,s),h=l.sub(a),c=b.ema(h,n),f=h.sub(c).toArray().map((m,g)=>({time:i[g].time,value:m??NaN})),d=h.toArray().map((m,g)=>({time:i[g].time,value:m??NaN})),p=c.toArray().map((m,g)=>({time:i[g].time,value:m??NaN}));return{metadata:{title:ce.title,shorttitle:ce.shortTitle,overlay:ce.overlay},plots:{plot0:f,plot1:d,plot2:p}}}const ar={showMa1:!0,ma1Type:"SMA",ma1Source:"close",ma1Length:20,showMa2:!0,ma2Type:"SMA",ma2Source:"close",ma2Length:50,showMa3:!0,ma3Type:"SMA",ma3Source:"close",ma3Length:100,showMa4:!0,ma4Type:"SMA",ma4Source:"close",ma4Length:200},Om=[{id:"showMa1",type:"bool",title:"Show MA 1",defval:!0},{id:"ma1Type",type:"string",title:"MA 1 Type",defval:"SMA",options:["SMA","EMA","SMMA (RMA)","WMA","VWMA"]},{id:"ma1Source",type:"source",title:"MA 1 Source",defval:"close"},{id:"ma1Length",type:"int",title:"MA 1 Length",defval:20,min:1},{id:"showMa2",type:"bool",title:"Show MA 2",defval:!0},{id:"ma2Type",type:"string",title:"MA 2 Type",defval:"SMA",options:["SMA","EMA","SMMA (RMA)","WMA","VWMA"]},{id:"ma2Source",type:"source",title:"MA 2 Source",defval:"close"},{id:"ma2Length",type:"int",title:"MA 2 Length",defval:50,min:1},{id:"showMa3",type:"bool",title:"Show MA 3",defval:!0},{id:"ma3Type",type:"string",title:"MA 3 Type",defval:"SMA",options:["SMA","EMA","SMMA (RMA)","WMA","VWMA"]},{id:"ma3Source",type:"source",title:"MA 3 Source",defval:"close"},{id:"ma3Length",type:"int",title:"MA 3 Length",defval:100,min:1},{id:"showMa4",type:"bool",title:"Show MA 4",defval:!0},{id:"ma4Type",type:"string",title:"MA 4 Type",defval:"SMA",options:["SMA","EMA","SMMA (RMA)","WMA","VWMA"]},{id:"ma4Source",type:"source",title:"MA 4 Source",defval:"close"},{id:"ma4Length",type:"int",title:"MA 4 Length",defval:200,min:1}],Bm=[{id:"plot0",title:"MA 1",color:"#FFEB3B",lineWidth:1},{id:"plot1",title:"MA 2",color:"#FF9800",lineWidth:1},{id:"plot2",title:"MA 3",color:"#2196F3",lineWidth:1},{id:"plot3",title:"MA 4",color:"#9C27B0",lineWidth:1}],ue={title:"Moving Average Ribbon",shortTitle:"MA Ribbon",overlay:!0};function Ym(i,t,e,s){const n=F(i,t),o=new y(i,r=>r.volume??0);switch(e){case"EMA":return b.ema(n,s);case"SMMA (RMA)":return b.rma(n,s);case"WMA":return b.wma(n,s);case"VWMA":return b.vwma(n,s,o);case"SMA":default:return b.sma(n,s)}}function jm(i,t={}){const{showMa1:e,ma1Type:s,ma1Source:n,ma1Length:o,showMa2:r,ma2Type:l,ma2Source:a,ma2Length:h,showMa3:c,ma3Type:u,ma3Source:f,ma3Length:d,showMa4:p,ma4Type:m,ma4Source:g,ma4Length:v}={...ar,...t},w={},N=[{show:e,type:s,source:n,length:o,plotId:"plot0"},{show:r,type:l,source:a,length:h,plotId:"plot1"},{show:c,type:u,source:f,length:d,plotId:"plot2"},{show:p,type:m,source:g,length:v,plotId:"plot3"}];for(const x of N)if(x.show){const M=Ym(i,x.source,x.type,x.length);w[x.plotId]=M.toArray().map((_,C)=>({time:i[C].time,value:_??NaN}))}else w[x.plotId]=i.map(M=>({time:M.time,value:NaN}));return{metadata:{title:ue.title,shorttitle:ue.shortTitle,overlay:ue.overlay},plots:w}}const hr={length:10},qm=[{id:"length",type:"int",title:"Length",defval:10,min:1}],Hm=[{id:"plot0",title:"Mass Index",color:"#E91E63",lineWidth:2}],fe={title:"Mass Index",shortTitle:"MI",overlay:!1};function Um(i,t={}){const{length:e}={...hr,...t},s=new y(i,f=>f.high),n=new y(i,f=>f.low),o=s.sub(n),r=b.ema(o,9),l=b.ema(r,9),h=r.div(l).toArray(),c=[];for(let f=0;f<i.length;f++)if(f<e-1)c.push(void 0);else{let d=0,p=0;for(let m=0;m<e;m++){const g=h[f-m];g!==void 0&&!isNaN(g)&&(d+=g,p++)}c.push(p===e?d:void 0)}const u=c.map((f,d)=>({time:i[d].time,value:f??NaN}));return{metadata:{title:fe.title,shorttitle:fe.shortTitle,overlay:fe.overlay},plots:{plot0:u}}}const cr={length:14,src:"close"},Jm=[{id:"length",type:"int",title:"Length",defval:14,min:1},{id:"src",type:"source",title:"Source",defval:"close"}],Qm=[{id:"plot0",title:"MD",color:"#2962FF",lineWidth:2}],de={title:"McGinley Dynamic",shortTitle:"MD",overlay:!0};function Gm(i,t={}){const{length:e,src:s}={...cr,...t},o=F(i,s).toArray(),r=[];for(let a=0;a<i.length;a++){const h=o[a]??0;if(a===0||r[a-1]===void 0||r[a-1]===0)r.push(h);else{const c=r[a-1],u=h/c,f=e*Math.pow(u,4),d=c+(h-c)/f;r.push(d)}}const l=r.map((a,h)=>({time:i[h].time,value:a}));return{metadata:{title:de.title,shorttitle:de.shortTitle,overlay:de.overlay},plots:{plot0:l}}}const ur={length:10,src:"close"},Km=[{id:"length",type:"int",title:"Length",defval:10,min:1},{id:"src",type:"source",title:"Source",defval:"close"}],Zm=[{id:"plot0",title:"Mom",color:"#2962FF",lineWidth:2}],pe={title:"Momentum",shortTitle:"Mom",overlay:!1};function Xm(i,t={}){const{length:e,src:s}={...ur,...t},n=F(i,s),r=b.mom(n,e).toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:pe.title,shorttitle:pe.shortTitle,overlay:pe.overlay},plots:{plot0:r}}}const tg={},eg=[],ig=[{id:"plot0",title:"OBV",color:"#2962FF",lineWidth:2}],me={title:"On Balance Volume",shortTitle:"OBV",overlay:!1};function sg(i,t={}){const e=new y(i,h=>h.close),s=new y(i,h=>h.volume??0),n=e.toArray(),o=s.toArray(),r=[];let l=0;for(let h=0;h<i.length;h++)if(h===0)r.push(0);else{const c=n[h]??0,u=n[h-1]??0,f=o[h]??0;c>u?l+=f:c<u&&(l-=f),r.push(l)}const a=r.map((h,c)=>({time:i[c].time,value:h}));return{metadata:{title:me.title,shorttitle:me.shortTitle,overlay:me.overlay},plots:{plot0:a}}}const fr={start:.02,increment:.02,maximum:.2},ng=[{id:"start",type:"float",title:"Start",defval:.02,min:1e-4,step:.01},{id:"increment",type:"float",title:"Increment",defval:.02,min:1e-4,step:.01},{id:"maximum",type:"float",title:"Max Value",defval:.2,min:.01,step:.01}],og=[{id:"plot0",title:"ParabolicSAR",color:"#2962FF",lineWidth:1}],ge={title:"Parabolic SAR",shortTitle:"SAR",overlay:!0};function rg(i,t={}){const{start:e,increment:s,maximum:n}={...fr,...t},l=b.sar(i,e,s,n).toArray().map((a,h)=>({time:i[h].time,value:a??NaN}));return{metadata:{title:ge.title,shorttitle:ge.shortTitle,overlay:ge.overlay},plots:{plot0:l}}}const dr={len:7,src:"close"},lg=[{id:"len",type:"int",title:"Length",defval:7,min:1},{id:"src",type:"source",title:"Source",defval:"close"}],ag=[{id:"plot0",title:"SMMA",color:"#673AB7",lineWidth:2}],ve={title:"Smoothed Moving Average",shortTitle:"SMMA",overlay:!0};function hg(i,t={}){const{len:e,src:s}={...dr,...t},n=F(i,s),o=n.toArray(),l=b.sma(n,e).toArray(),a=[];for(let c=0;c<i.length;c++){const u=c>0?a[c-1]:void 0,f=o[c];u===void 0||isNaN(u)?a.push(l[c]):a.push((u*(e-1)+(f??0))/e)}const h=a.map((c,u)=>({time:i[u].time,value:c??NaN}));return{metadata:{title:ve.title,shorttitle:ve.shortTitle,overlay:ve.overlay},plots:{plot0:h}}}const pr={length:9,src:"close"},cg=[{id:"length",type:"int",title:"Length",defval:9,min:1},{id:"src",type:"source",title:"Source",defval:"close"}],ug=[{id:"plot0",title:"ROC",color:"#2962FF",lineWidth:2}],we={title:"Rate Of Change",shortTitle:"ROC",overlay:!1};function fg(i,t={}){const{length:e,src:s}={...pr,...t},n=F(i,s),r=b.roc(n,e).toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:we.title,shorttitle:we.shortTitle,overlay:we.overlay},plots:{plot0:r}}}const mr={length:14,src:"close"},dg=[{id:"length",type:"int",title:"RSI Length",defval:14,min:1},{id:"src",type:"source",title:"Source",defval:"close"}],pg=[{id:"plot0",title:"RSI",color:"#7E57C2",lineWidth:2}],ye={title:"Relative Strength Index",shortTitle:"RSI",overlay:!1};function mg(i,t={}){const{length:e,src:s}={...mr,...t},n=F(i,s),r=b.rsi(n,e).toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:ye.title,shorttitle:ye.shortTitle,overlay:ye.overlay},plots:{plot0:r}}}const gr={periodK:14,smoothK:1,periodD:3},gg=[{id:"periodK",type:"int",title:"%K Length",defval:14,min:1},{id:"smoothK",type:"int",title:"%K Smoothing",defval:1,min:1},{id:"periodD",type:"int",title:"%D Smoothing",defval:3,min:1}],vg=[{id:"plot0",title:"%K",color:"#2962FF",lineWidth:2},{id:"plot1",title:"%D",color:"#FF6D00",lineWidth:2}],Ne={title:"Stochastic",shortTitle:"Stoch",overlay:!1};function wg(i,t={}){const{periodK:e,smoothK:s,periodD:n}={...gr,...t},o=new y(i,d=>d.close),r=new y(i,d=>d.high),l=new y(i,d=>d.low),a=b.stoch(o,r,l,e),h=b.sma(a,s),c=b.sma(h,n),u=h.toArray().map((d,p)=>({time:i[p].time,value:d??NaN})),f=c.toArray().map((d,p)=>({time:i[p].time,value:d??NaN}));return{metadata:{title:Ne.title,shorttitle:Ne.shortTitle,overlay:Ne.overlay},plots:{plot0:u,plot1:f}}}const vr={atrPeriod:10,factor:3},yg=[{id:"atrPeriod",type:"int",title:"ATR Length",defval:10,min:1},{id:"factor",type:"float",title:"Factor",defval:3,min:.01,step:.01}],Ng=[{id:"plot0",title:"Up Trend",color:"#26A69A",lineWidth:2},{id:"plot1",title:"Down Trend",color:"#EF5350",lineWidth:2}],Me={title:"Supertrend",shortTitle:"ST",overlay:!0};function Mg(i,t={}){const{atrPeriod:e,factor:s}={...vr,...t},[n,o]=b.supertrend(i,s,e),r=n.toArray(),l=o.toArray(),a=r.map((c,u)=>({time:i[u].time,value:u===0?NaN:(l[u]??1)<0?c??NaN:NaN})),h=r.map((c,u)=>({time:i[u].time,value:u===0?NaN:(l[u]??1)>=0?c??NaN:NaN}));return{metadata:{title:Me.title,shorttitle:Me.shortTitle,overlay:Me.overlay},plots:{plot0:a,plot1:h}}}const wr={adxSmoothing:14,diLength:14},bg=[{id:"adxSmoothing",type:"int",title:"ADX Smoothing",defval:14,min:1},{id:"diLength",type:"int",title:"DI Length",defval:14,min:1}],xg=[{id:"plot0",title:"ADX",color:"#FF9800",lineWidth:1}],be={title:"Average Directional Index",shortTitle:"ADX",overlay:!1};function _g(i,t={}){const{adxSmoothing:e,diLength:s}={...wr,...t},n=i.length,o=b.tr(i,!0),r=[],l=[];for(let C=0;C<n;C++)if(C===0)r.push(0),l.push(0);else{const A=i[C].high-i[C-1].high,L=i[C-1].low-i[C].low;let P=0,R=0;A>L&&A>0&&(P=A),L>A&&L>0&&(R=L),r.push(P),l.push(R)}const a=new y(i,(C,A)=>r[A]),h=new y(i,(C,A)=>l[A]),c=b.rma(a,s),u=b.rma(h,s),f=b.rma(o,s),d=c.toArray(),p=u.toArray(),m=f.toArray(),g=[],v=[];for(let C=0;C<n;C++){const A=m[C];A===0||A==null?(g.push(0),v.push(0)):(g.push((d[C]??0)/A*100),v.push((p[C]??0)/A*100))}const w=[];for(let C=0;C<n;C++){const A=g[C]+v[C];A===0?w.push(0):w.push(Math.abs(g[C]-v[C])/A*100)}const N=new y(i,(C,A)=>w[A]),_=b.rma(N,e).toArray().map((C,A)=>({time:i[A].time,value:C??NaN}));return{metadata:{title:be.title,shorttitle:be.shortTitle,overlay:be.overlay},plots:{plot0:_}}}const yr={fastPeriod:5,slowPeriod:34},Cg=[{id:"fastPeriod",type:"int",title:"Fast Period",defval:5,min:1},{id:"slowPeriod",type:"int",title:"Slow Period",defval:34,min:1}],Sg=[{id:"plot0",title:"AO",color:"#009688",lineWidth:1}],xe={title:"Awesome Oscillator",shortTitle:"AO",overlay:!1};function Ag(i,t={}){const{fastPeriod:e,slowPeriod:s}={...yr,...t},n=new y(i,f=>f.high),o=new y(i,f=>f.low),r=n.add(o).div(2),l=b.sma(r,e),a=b.sma(r,s),u=l.sub(a).toArray().map((f,d)=>({time:i[d].time,value:f??NaN}));return{metadata:{title:xe.title,shorttitle:xe.shortTitle,overlay:xe.overlay},plots:{plot0:u}}}const Nr={shortLength:20,longLength:50,stdDev:2},Pg=[{id:"shortLength",type:"int",title:"Short BB Length",defval:20,min:1},{id:"longLength",type:"int",title:"Long BB Length",defval:50,min:1},{id:"stdDev",type:"float",title:"StdDev",defval:2,min:.001}],Ig=[{id:"plot0",title:"BBTrend",color:"#089981",lineWidth:1}],_e={title:"BBTrend",shortTitle:"BBTrend",overlay:!1};function $g(i,t={}){const{shortLength:e,longLength:s,stdDev:n}={...Nr,...t},o=new y(i,x=>x.close),r=b.sma(o,e),l=b.stdev(o,e),a=r.add(l.mul(n)),h=r.sub(l.mul(n)),c=b.sma(o,s),u=b.stdev(o,s),f=c.add(u.mul(n)),d=c.sub(u.mul(n)),p=h.toArray(),m=a.toArray(),g=d.toArray(),v=f.toArray(),w=r.toArray(),N=i.map((x,M)=>{const _=p[M],C=m[M],A=g[M],L=v[M],P=w[M];if(_==null||C==null||A==null||L==null||P==null||P===0)return{time:x.time,value:NaN};const R=(Math.abs(_-A)-Math.abs(C-L))/P*100;return{time:x.time,value:R}});return{metadata:{title:_e.title,shorttitle:_e.shortTitle,overlay:_e.overlay},plots:{plot0:N}}}const Mr={length:13},Tg=[{id:"length",type:"int",title:"Length",defval:13,min:1}],Lg=[{id:"plot0",title:"BBPower",color:"#089981",lineWidth:1}],Ce={title:"Bull Bear Power",shortTitle:"BBP",overlay:!1};function Eg(i,t={}){const{length:e}={...Mr,...t},s=new y(i,f=>f.high),n=new y(i,f=>f.low),o=new y(i,f=>f.close),r=b.ema(o,e),l=s.sub(r),a=n.sub(r),u=l.add(a).toArray().map((f,d)=>({time:i[d].time,value:f??NaN}));return{metadata:{title:Ce.title,shorttitle:Ce.shortTitle,overlay:Ce.overlay},plots:{plot0:u}}}const br={length:9},Vg=[{id:"length",type:"int",title:"Length",defval:9,min:1}],Dg=[{id:"plot0",title:"Chande MO",color:"#2962FF",lineWidth:1}],Se={title:"Chande Momentum Oscillator",shortTitle:"ChandeMO",overlay:!1};function Fg(i,t={}){const{length:e}={...br,...t},s=i.map(h=>h.close),n=[NaN];for(let h=1;h<i.length;h++)n.push(s[h]-s[h-1]);const o=n.map(h=>h>=0?h:0),r=n.map(h=>h>=0?0:-h),l=[];for(let h=0;h<i.length;h++){if(h<e){l.push(NaN);continue}let c=0,u=0;for(let d=h-e+1;d<=h;d++)isNaN(o[d])||(c+=o[d]),isNaN(r[d])||(u+=r[d]);const f=c+u;f===0?l.push(0):l.push(100*(c-u)/f)}const a=l.map((h,c)=>({time:i[c].time,value:h??NaN}));return{metadata:{title:Se.title,shorttitle:Se.shortTitle,overlay:Se.overlay},plots:{plot0:a}}}const xr={length:21,centered:!1},Rg=[{id:"length",type:"int",title:"Length",defval:21,min:1},{id:"centered",type:"bool",title:"Centered",defval:!1}],kg=[{id:"plot0",title:"DPO",color:"#43A047",lineWidth:1}],Ae={title:"Detrended Price Oscillator",shortTitle:"DPO",overlay:!1};function zg(i,t={}){const{length:e,centered:s}={...xr,...t},n=new y(i,c=>c.close),r=b.sma(n,e).toArray(),l=n.toArray(),a=Math.floor(e/2)+1,h=i.map((c,u)=>{const f=u-a;if(s){const d=u+a;return d>=i.length||r[u]==null?{time:c.time,value:NaN}:{time:c.time,value:l[d]-r[u]}}else return f<0||r[f]==null?{time:c.time,value:NaN}:{time:c.time,value:l[u]-r[f]}});return{metadata:{title:Ae.title,shorttitle:Ae.shortTitle,overlay:Ae.overlay},plots:{plot0:h}}}const _r={length:13},Wg=[{id:"length",type:"int",title:"Length",defval:13,min:1}],Og=[{id:"plot0",title:"Elder Force Index",color:"#F44336",lineWidth:1}],Pe={title:"Elder Force Index",shortTitle:"EFI",overlay:!1};function Bg(i,t={}){const{length:e}={..._r,...t},s=[NaN];for(let a=1;a<i.length;a++){const h=i[a].close-i[a-1].close;s.push(h*(i[a].volume??0))}const n=new y(i,(a,h)=>s[h]),l=b.ema(n,e).toArray().map((a,h)=>({time:i[h].time,value:a??NaN}));return{metadata:{title:Pe.title,shorttitle:Pe.shortTitle,overlay:Pe.overlay},plots:{plot0:l}}}const Cr={length:10,annual:365,per:1},Yg=[{id:"length",type:"int",title:"Length",defval:10,min:1},{id:"annual",type:"int",title:"Annual",defval:365},{id:"per",type:"int",title:"Period",defval:1}],jg=[{id:"plot0",title:"HV",color:"#2962FF",lineWidth:1}],Ie={title:"Historical Volatility",shortTitle:"HV",overlay:!1};function qg(i,t={}){const{length:e,annual:s,per:n}={...Cr,...t},o=[NaN];for(let u=1;u<i.length;u++)o.push(Math.log(i[u].close/i[u-1].close));const r=new y(i,(u,f)=>o[f]),a=b.stdev(r,e).toArray(),h=100*Math.sqrt(s/n),c=a.map((u,f)=>({time:i[f].time,value:u!=null?u*h:NaN}));return{metadata:{title:Ie.title,shorttitle:Ie.shortTitle,overlay:Ie.overlay},plots:{plot0:c}}}const Sr={shortLength:9,longLength:21},Hg=[{id:"shortLength",type:"int",title:"Short Length",defval:9,min:1},{id:"longLength",type:"int",title:"Long Length",defval:21,min:1}],Ug=[{id:"plot0",title:"Short MA",color:"#2962FF",lineWidth:1},{id:"plot1",title:"Long MA",color:"#E91E63",lineWidth:1}],$e={title:"MA Cross",shortTitle:"MA Cross",overlay:!0};function Jg(i,t={}){const{shortLength:e,longLength:s}={...Sr,...t},n=new y(i,u=>u.close),o=b.sma(n,e),r=b.sma(n,s),l=o.toArray(),a=r.toArray(),h=l.map((u,f)=>({time:i[f].time,value:u??NaN})),c=a.map((u,f)=>({time:i[f].time,value:u??NaN}));return{metadata:{title:$e.title,shorttitle:$e.shortTitle,overlay:$e.overlay},plots:{plot0:h,plot1:c}}}const Ar={length:3,atrLength:14,atrMult:2},Qg=[{id:"length",type:"int",title:"Median Length",defval:3,min:1},{id:"atrLength",type:"int",title:"ATR Length",defval:14,min:1},{id:"atrMult",type:"float",title:"ATR Multiplier",defval:2,min:0}],Gg=[{id:"plot0",title:"Median",color:"#FF0000",lineWidth:3},{id:"plot1",title:"Upper Band",color:"#00FF00",lineWidth:1},{id:"plot2",title:"Lower Band",color:"#FF00FF",lineWidth:1},{id:"plot3",title:"Median EMA",color:"#0000FF",lineWidth:1}],Te={title:"Median",shortTitle:"Median",overlay:!0};function Kg(i,t){if(i.length===0)return NaN;const e=[...i].sort((n,o)=>n-o),s=Math.ceil(t/100*e.length)-1;return e[Math.max(0,s)]}function Zg(i,t={}){const{length:e,atrLength:s,atrMult:n}={...Ar,...t},o=i.map(w=>(w.high+w.low)/2),r=[];for(let w=0;w<i.length;w++){if(w<e-1){r.push(NaN);continue}const N=o.slice(w-e+1,w+1);r.push(Kg(N,50))}const a=b.atr(i,s).toArray(),h=r.map((w,N)=>{const x=a[N];return isNaN(w)||x==null?NaN:w+n*x}),c=r.map((w,N)=>{const x=a[N];return isNaN(w)||x==null?NaN:w-n*x}),u=new y(i,(w,N)=>r[N]),d=b.ema(u,e).toArray(),p=r.map((w,N)=>({time:i[N].time,value:w??NaN})),m=h.map((w,N)=>({time:i[N].time,value:w??NaN})),g=c.map((w,N)=>({time:i[N].time,value:w??NaN})),v=d.map((w,N)=>({time:i[N].time,value:w??NaN}));return{metadata:{title:Te.title,shorttitle:Te.shortTitle,overlay:Te.overlay},plots:{plot0:p,plot1:m,plot2:g,plot3:v}}}const Pr={length:14},Xg=[{id:"length",type:"int",title:"Length",defval:14,min:1,max:2e3}],tv=[{id:"plot0",title:"MF",color:"#7E57C2",lineWidth:1}],Le={title:"Money Flow Index",shortTitle:"MFI",overlay:!1};function ev(i,t={}){const{length:e}={...Pr,...t},s=i.map(l=>(l.high+l.low+l.close)/3),n=s.map((l,a)=>l*(i[a].volume??0)),o=[];for(let l=0;l<i.length;l++){if(l<e){o.push(NaN);continue}let a=0,h=0;for(let c=l-e+1;c<=l;c++)c!==0&&(s[c]>s[c-1]?a+=n[c]:s[c]<s[c-1]&&(h+=n[c]));if(h===0)o.push(100);else{const u=100-100/(1+a/h);o.push(u)}}const r=o.map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:Le.title,shorttitle:Le.shortTitle,overlay:Le.overlay},plots:{plot0:r}}}const iv={},sv=[],nv=[{id:"plot0",title:"PVT",color:"#2962FF",lineWidth:1}],Ee={title:"Price Volume Trend",shortTitle:"PVT",overlay:!1};function ov(i,t={}){const e=[];let s=0;for(let o=0;o<i.length;o++){if(o===0){e.push(0);continue}const r=i[o-1].close;if(r===0){e.push(s);continue}const a=(i[o].close-r)/r*(i[o].volume??0);s+=a,e.push(s)}const n=e.map((o,r)=>({time:i[r].time,value:o}));return{metadata:{title:Ee.title,shorttitle:Ee.shortTitle,overlay:Ee.overlay},plots:{plot0:n}}}const Ir={length:10},rv=[{id:"length",type:"int",title:"Length",defval:10,min:1}],lv=[{id:"plot0",title:"RVGI",color:"#008000",lineWidth:1},{id:"plot1",title:"Signal",color:"#FF0000",lineWidth:1}],Ve={title:"Relative Vigor Index",shortTitle:"RVGI",overlay:!1};function qi(i){const t=[];for(let e=0;e<i.length;e++){if(e<3){t.push(NaN);continue}const s=(i[e-3]+2*i[e-2]+2*i[e-1]+i[e])/6;t.push(s)}return t}function av(i,t={}){const{length:e}={...Ir,...t},s=i.map(u=>u.close-u.open),n=i.map(u=>u.high-u.low),o=qi(s),r=qi(n),l=[];for(let u=0;u<i.length;u++){if(u<e+2){l.push(NaN);continue}let f=0,d=0;for(let p=u-e+1;p<=u;p++)isNaN(o[p])||(f+=o[p]),isNaN(r[p])||(d+=r[p]);d===0?l.push(0):l.push(f/d)}const a=qi(l),h=l.map((u,f)=>({time:i[f].time,value:u??NaN})),c=a.map((u,f)=>({time:i[f].time,value:u??NaN}));return{metadata:{title:Ve.title,shorttitle:Ve.shortTitle,overlay:Ve.overlay},plots:{plot0:h,plot1:c}}}const $r={longLength:20,shortLength:5,signalLength:5},hv=[{id:"longLength",type:"int",title:"Long Length",defval:20,min:1},{id:"shortLength",type:"int",title:"Short Length",defval:5,min:1},{id:"signalLength",type:"int",title:"Signal Length",defval:5,min:1}],cv=[{id:"plot0",title:"SMI",color:"#2962FF",lineWidth:1},{id:"plot1",title:"Signal",color:"#FF6D00",lineWidth:1}],De={title:"SMI Ergodic Indicator",shortTitle:"SMII",overlay:!1};function uv(i,t={}){const{longLength:e,shortLength:s,signalLength:n}={...$r,...t},o=[NaN];for(let M=1;M<i.length;M++)o.push(i[M].close-i[M-1].close);const r=o.map(M=>isNaN(M)?NaN:Math.abs(M)),l=new y(i,(M,_)=>o[_]),a=b.ema(l,s),c=b.ema(a,e).toArray(),u=new y(i,(M,_)=>r[_]),f=b.ema(u,s),p=b.ema(f,e).toArray(),m=[];for(let M=0;M<i.length;M++){const _=c[M],C=p[M];_==null||C==null||C===0?m.push(NaN):m.push(100*_/C)}const g=new y(i,(M,_)=>m[_]),w=b.ema(g,n).toArray(),N=m.map((M,_)=>({time:i[_].time,value:M??NaN})),x=w.map((M,_)=>({time:i[_].time,value:M??NaN}));return{metadata:{title:De.title,shorttitle:De.shortTitle,overlay:De.overlay},plots:{plot0:N,plot1:x}}}const Tr={longLength:20,shortLength:5,signalLength:5},fv=[{id:"longLength",type:"int",title:"Long Length",defval:20,min:1},{id:"shortLength",type:"int",title:"Short Length",defval:5,min:1},{id:"signalLength",type:"int",title:"Signal Length",defval:5,min:1}],dv=[{id:"plot0",title:"Oscillator",color:"#26A69A",lineWidth:1}],Fe={title:"SMI Ergodic Oscillator",shortTitle:"SMIO",overlay:!1};function pv(i,t={}){const{longLength:e,shortLength:s,signalLength:n}={...Tr,...t},o=[NaN];for(let M=1;M<i.length;M++)o.push(i[M].close-i[M-1].close);const r=o.map(M=>isNaN(M)?NaN:Math.abs(M)),l=new y(i,(M,_)=>o[_]),a=b.ema(l,s),c=b.ema(a,e).toArray(),u=new y(i,(M,_)=>r[_]),f=b.ema(u,s),p=b.ema(f,e).toArray(),m=[];for(let M=0;M<i.length;M++){const _=c[M],C=p[M];_==null||C==null||C===0?m.push(NaN):m.push(100*_/C)}const g=new y(i,(M,_)=>m[_]),w=b.ema(g,n).toArray(),x=m.map((M,_)=>{const C=w[_];return isNaN(M)||C==null||isNaN(C)?NaN:M-C}).map((M,_)=>({time:i[_].time,value:M??NaN}));return{metadata:{title:Fe.title,shorttitle:Fe.shortTitle,overlay:Fe.overlay},plots:{plot0:x}}}const Lr={length:7},mv=[{id:"length",type:"int",title:"Length",defval:7,min:1}],gv=[{id:"plot0",title:"SMMA",color:"#2962FF",lineWidth:1}],Re={title:"Smoothed Moving Average",shortTitle:"SMMA",overlay:!0};function vv(i,t={}){const{length:e}={...Lr,...t},s=new y(i,l=>l.close),r=b.rma(s,e).toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:Re.title,shorttitle:Re.shortTitle,overlay:Re.overlay},plots:{plot0:r}}}const Er={length:20},wv=[{id:"length",type:"int",title:"Length",defval:20,min:1}],yv=[{id:"plot0",title:"StDev",color:"#2962FF",lineWidth:1}],ke={title:"Standard Deviation",shortTitle:"StDev",overlay:!1};function Nv(i,t={}){const{length:e}={...Er,...t},s=new y(i,l=>l.close),r=b.stdev(s,e).toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:ke.title,shorttitle:ke.shortTitle,overlay:ke.overlay},plots:{plot0:r}}}const Vr={smoothK:3,smoothD:3,lengthRSI:14,lengthStoch:14},Mv=[{id:"smoothK",type:"int",title:"K",defval:3,min:1},{id:"smoothD",type:"int",title:"D",defval:3,min:1},{id:"lengthRSI",type:"int",title:"RSI Length",defval:14,min:1},{id:"lengthStoch",type:"int",title:"Stochastic Length",defval:14,min:1}],bv=[{id:"plot0",title:"K",color:"#2962FF",lineWidth:1},{id:"plot1",title:"D",color:"#FF6D00",lineWidth:1}],ze={title:"Stochastic RSI",shortTitle:"Stoch RSI",overlay:!1};function xv(i,t={}){const{smoothK:e,smoothD:s,lengthRSI:n,lengthStoch:o}={...Vr,...t},r=new y(i,m=>m.close),l=b.rsi(r,n),a=b.stoch(l,l,l,o),h=b.sma(a,e),c=b.sma(h,s),u=h.toArray(),f=c.toArray(),d=u.map((m,g)=>({time:i[g].time,value:m??NaN})),p=f.map((m,g)=>({time:i[g].time,value:m??NaN}));return{metadata:{title:ze.title,shorttitle:ze.shortTitle,overlay:ze.overlay},plots:{plot0:d,plot1:p}}}const Dr={length:14},_v=[{id:"length",type:"int",title:"Length",defval:14,min:1}],Cv=[{id:"plot0",title:"Trend Strength Index",color:"#2962FF",lineWidth:1}],We={title:"Trend Strength Index",shortTitle:"TSI",overlay:!1};function Sv(i,t){const e=i.length;if(e===0)return NaN;let s=0,n=0;for(let u=0;u<e;u++)s+=i[u],n+=t[u];const o=s/e,r=n/e;let l=0,a=0,h=0;for(let u=0;u<e;u++){const f=i[u]-o,d=t[u]-r;l+=f*d,a+=f*f,h+=d*d}const c=Math.sqrt(a*h);return c===0?0:l/c}function Av(i,t={}){const{length:e}={...Dr,...t},s=i.map(r=>r.close),n=[];for(let r=0;r<i.length;r++){if(r<e-1){n.push(NaN);continue}const l=s.slice(r-e+1,r+1),a=Array.from({length:e},(c,u)=>u),h=Sv(l,a);n.push(h)}const o=n.map((r,l)=>({time:i[l].time,value:r??NaN}));return{metadata:{title:We.title,shorttitle:We.shortTitle,overlay:We.overlay},plots:{plot0:o}}}const Fr={longLength:25,shortLength:13,signalLength:13},Pv=[{id:"longLength",type:"int",title:"Long Length",defval:25,min:1},{id:"shortLength",type:"int",title:"Short Length",defval:13,min:1},{id:"signalLength",type:"int",title:"Signal Length",defval:13,min:1}],Iv=[{id:"plot0",title:"True Strength Index",color:"#2962FF",lineWidth:1},{id:"plot1",title:"Signal",color:"#E91E63",lineWidth:1}],Oe={title:"True Strength Index",shortTitle:"TSI",overlay:!1};function $v(i,t={}){const{longLength:e,shortLength:s,signalLength:n}={...Fr,...t},o=[NaN];for(let M=1;M<i.length;M++)o.push(i[M].close-i[M-1].close);const r=o.map(M=>isNaN(M)?NaN:Math.abs(M)),l=new y(i,(M,_)=>o[_]),a=b.ema(l,e),c=b.ema(a,s).toArray(),u=new y(i,(M,_)=>r[_]),f=b.ema(u,e),p=b.ema(f,s).toArray(),m=[];for(let M=0;M<i.length;M++){const _=c[M],C=p[M];_==null||C==null||C===0?m.push(NaN):m.push(100*_/C)}const g=new y(i,(M,_)=>m[_]),w=b.ema(g,n).toArray(),N=m.map((M,_)=>({time:i[_].time,value:M??NaN})),x=w.map((M,_)=>({time:i[_].time,value:M??NaN}));return{metadata:{title:Oe.title,shorttitle:Oe.shortTitle,overlay:Oe.overlay},plots:{plot0:N,plot1:x}}}const Rr={shortLength:5,longLength:10},Tv=[{id:"shortLength",type:"int",title:"Short Length",defval:5,min:1},{id:"longLength",type:"int",title:"Long Length",defval:10,min:1}],Lv=[{id:"plot0",title:"Volume Osc",color:"#2962FF",lineWidth:1}],Be={title:"Volume Oscillator",shortTitle:"Vol Osc",overlay:!1};function Ev(i,t={}){const{shortLength:e,longLength:s}={...Rr,...t},n=new y(i,u=>u.volume??0),o=b.ema(n,e),r=b.ema(n,s),l=o.toArray(),a=r.toArray(),h=[];for(let u=0;u<i.length;u++){const f=l[u],d=a[u];f==null||d==null||d===0?h.push(NaN):h.push(100*(f-d)/d)}const c=h.map((u,f)=>({time:i[f].time,value:u??NaN}));return{metadata:{title:Be.title,shorttitle:Be.shortTitle,overlay:Be.overlay},plots:{plot0:c}}}const kr={length:14},Vv=[{id:"length",type:"int",title:"Length",defval:14,min:1}],Dv=[{id:"plot0",title:"VI +",color:"#2962FF",lineWidth:1},{id:"plot1",title:"VI -",color:"#E91E63",lineWidth:1}],Ye={title:"Vortex Indicator",shortTitle:"VI",overlay:!1};function Fv(i,t={}){const{length:e}={...kr,...t},s=[NaN],n=[NaN],o=[NaN];for(let c=1;c<i.length;c++){const u=i[c].high,f=i[c].low,d=i[c-1].high,p=i[c-1].low,m=i[c-1].close;s.push(Math.abs(u-p)),n.push(Math.abs(f-d));const g=Math.max(u-f,Math.abs(u-m),Math.abs(f-m));o.push(g)}const r=[],l=[];for(let c=0;c<i.length;c++){if(c<e){r.push(NaN),l.push(NaN);continue}let u=0,f=0,d=0;for(let p=c-e+1;p<=c;p++)isNaN(s[p])||(u+=s[p]),isNaN(n[p])||(f+=n[p]),isNaN(o[p])||(d+=o[p]);d===0?(r.push(NaN),l.push(NaN)):(r.push(u/d),l.push(f/d))}const a=r.map((c,u)=>({time:i[u].time,value:c??NaN})),h=l.map((c,u)=>({time:i[u].time,value:c??NaN}));return{metadata:{title:Ye.title,shorttitle:Ye.shortTitle,overlay:Ye.overlay},plots:{plot0:a,plot1:h}}}const zr={jawLength:13,jawOffset:8,teethLength:8,teethOffset:5,lipsLength:5,lipsOffset:3},Rv=[{id:"jawLength",type:"int",title:"Jaw Length",defval:13,min:1},{id:"jawOffset",type:"int",title:"Jaw Offset",defval:8,min:0},{id:"teethLength",type:"int",title:"Teeth Length",defval:8,min:1},{id:"teethOffset",type:"int",title:"Teeth Offset",defval:5,min:0},{id:"lipsLength",type:"int",title:"Lips Length",defval:5,min:1},{id:"lipsOffset",type:"int",title:"Lips Offset",defval:3,min:0}],kv=[{id:"plot0",title:"Jaw",color:"#2962FF",lineWidth:1,offset:8},{id:"plot1",title:"Teeth",color:"#E91E63",lineWidth:1,offset:5},{id:"plot2",title:"Lips",color:"#4CAF50",lineWidth:1,offset:3}],je={title:"Williams Alligator",shortTitle:"Alligator",overlay:!0};function Hi(i,t){const e=[];let s=0,n=0;for(let o=0;o<i.length;o++)if(o<t-1)s+=i[o],n++,e.push(NaN);else if(o===t-1){s+=i[o],n++;const r=s/n;e.push(r)}else{const r=e[o-1];isNaN(r)?e.push(NaN):e.push((r*(t-1)+i[o])/t)}return e}function zv(i,t={}){const{jawLength:e,jawOffset:s,teethLength:n,teethOffset:o,lipsLength:r,lipsOffset:l}={...zr,...t},a=i.map(N=>(N.high+N.low)/2),h=Hi(a,e),c=Hi(a,n),u=Hi(a,r),f=(N,x)=>{const M=new Array(N.length).fill(NaN);for(let _=0;_<N.length-x;_++)M[_+x]=N[_];return M},d=f(h,s),p=f(c,o),m=f(u,l),g=d.map((N,x)=>({time:i[x].time,value:N??NaN})),v=p.map((N,x)=>({time:i[x].time,value:N??NaN})),w=m.map((N,x)=>({time:i[x].time,value:N??NaN}));return{metadata:{title:je.title,shorttitle:je.shortTitle,overlay:je.overlay},plots:{plot0:g,plot1:v,plot2:w}}}const Wr={length:14},Wv=[{id:"length",type:"int",title:"Length",defval:14,min:1}],Ov=[{id:"plot0",title:"%R",color:"#FF6D00",lineWidth:1}],qe={title:"Williams %R",shortTitle:"%R",overlay:!1};function Bv(i,t={}){const{length:e}={...Wr,...t},s=new y(i,u=>u.high),n=new y(i,u=>u.low),o=b.highest(s,e),r=b.lowest(n,e),l=o.toArray(),a=r.toArray(),h=[];for(let u=0;u<i.length;u++){const f=l[u],d=a[u];if(f==null||d==null){h.push(NaN);continue}const p=f-d;p===0?h.push(-50):h.push(-100*(f-i[u].close)/p)}const c=h.map((u,f)=>({time:i[f].time,value:u??NaN}));return{metadata:{title:qe.title,shorttitle:qe.shortTitle,overlay:qe.overlay},plots:{plot0:c}}}const Or={turboLength:6,cciLength:14},Yv=[{id:"turboLength",type:"int",title:"Turbo CCI Length",defval:6,min:1},{id:"cciLength",type:"int",title:"CCI Length",defval:14,min:1}],jv=[{id:"plot0",title:"CCI Turbo Histogram",color:"#26A69A",lineWidth:1},{id:"plot1",title:"CCI Turbo",color:"#FF9800",lineWidth:1},{id:"plot2",title:"CCI 14",color:"#787B86",lineWidth:1}],He={title:"Woodies CCI",shortTitle:"WCCI",overlay:!1};function pn(i,t){const e=[];for(let s=0;s<i.length;s++){if(s<t-1){e.push(NaN);continue}let n=0;for(let a=s-t+1;a<=s;a++)n+=i[a];const o=n/t;let r=0;for(let a=s-t+1;a<=s;a++)r+=Math.abs(i[a]-o);const l=r/t;l===0?e.push(0):e.push((i[s]-o)/(.015*l))}return e}function qv(i,t={}){const{turboLength:e,cciLength:s}={...Or,...t},n=i.map(c=>c.close),o=pn(n,e),r=pn(n,s),l=r.map((c,u)=>({time:i[u].time,value:c??NaN})),a=o.map((c,u)=>({time:i[u].time,value:c??NaN})),h=r.map((c,u)=>({time:i[u].time,value:c??NaN}));return{metadata:{title:He.title,shorttitle:He.shortTitle,overlay:He.overlay},plots:{plot0:l,plot1:a,plot2:h}}}const Br={length:20,src:"close",mult:2},Hv=[{id:"length",type:"int",title:"Length",defval:20,min:1},{id:"src",type:"source",title:"Source",defval:"close"},{id:"mult",type:"float",title:"StdDev",defval:2,min:.001,max:50}],Uv=[{id:"plot0",title:"Bollinger Bands %b",color:"#2962FF",lineWidth:1}],Ue={title:"Bollinger Bands %b",shortTitle:"BB %b",overlay:!1};function Jv(i,t={}){const{length:e,src:s,mult:n}={...Br,...t},o=F(i,s),r=b.sma(o,e),l=b.stdev(o,e).mul(n),a=r.add(l),h=r.sub(l);r.toArray();const c=a.toArray(),u=h.toArray(),f=o.toArray(),d=[];for(let m=0;m<i.length;m++){const g=c[m],v=u[m],w=f[m];g==null||v==null||w==null||g===v?d.push(NaN):d.push((w-v)/(g-v))}const p=d.map((m,g)=>({time:i[g].time,value:m}));return{metadata:{title:Ue.title,shorttitle:Ue.shortTitle,overlay:Ue.overlay},plots:{plot0:p}}}const Yr={length:20,src:"close",mult:2,expansionLength:125,contractionLength:125},Qv=[{id:"length",type:"int",title:"Length",defval:20,min:1},{id:"src",type:"source",title:"Source",defval:"close"},{id:"mult",type:"float",title:"StdDev",defval:2,min:.001,max:50},{id:"expansionLength",type:"int",title:"Highest Expansion Length",defval:125,min:1},{id:"contractionLength",type:"int",title:"Lowest Contraction Length",defval:125,min:1}],Gv=[{id:"plot0",title:"Bollinger BandWidth",color:"#2962FF",lineWidth:1},{id:"plot1",title:"Highest Expansion",color:"#F23645",lineWidth:1},{id:"plot2",title:"Lowest Contraction",color:"#089981",lineWidth:1}],Je={title:"Bollinger BandWidth",shortTitle:"BBW",overlay:!1};function Kv(i,t={}){const{length:e,src:s,mult:n,expansionLength:o,contractionLength:r}={...Yr,...t},l=F(i,s),a=b.sma(l,e),h=b.stdev(l,e).mul(n),c=a.add(h),u=a.sub(h),f=a.toArray(),d=c.toArray(),p=u.toArray(),m=[];for(let M=0;M<i.length;M++){const _=d[M],C=p[M],A=f[M];_==null||C==null||A==null||A===0?m.push(NaN):m.push((_-C)/A*100)}const g=[],v=[];for(let M=0;M<i.length;M++){let _=-1/0;for(let A=Math.max(0,M-o+1);A<=M;A++)!isNaN(m[A])&&m[A]>_&&(_=m[A]);g.push(_===-1/0?NaN:_);let C=1/0;for(let A=Math.max(0,M-r+1);A<=M;A++)!isNaN(m[A])&&m[A]<C&&(C=m[A]);v.push(C===1/0?NaN:C)}const w=m.map((M,_)=>({time:i[_].time,value:M})),N=g.map((M,_)=>({time:i[_].time,value:M})),x=v.map((M,_)=>({time:i[_].time,value:M}));return{metadata:{title:Je.title,shorttitle:Je.shortTitle,overlay:Je.overlay},plots:{plot0:w,plot1:N,plot2:x}}}const jr={length:20},Zv=[{id:"length",type:"int",title:"Length",defval:20,min:1}],Xv=[{id:"plot0",title:"CMF",color:"#43A047",lineWidth:1}],Qe={title:"Chaikin Money Flow",shortTitle:"CMF",overlay:!1};function t0(i,t={}){const{length:e}={...jr,...t},s=[],n=[];for(let l=0;l<i.length;l++){const{high:a,low:h,close:c,volume:u}=i[l],f=u??0;n.push(f),c===a&&c===h||a===h?s.push(0):s.push((2*c-h-a)/(a-h)*f)}const o=[];for(let l=0;l<i.length;l++){if(l<e-1){o.push(NaN);continue}let a=0,h=0;for(let c=l-e+1;c<=l;c++)a+=s[c],h+=n[c];h===0?o.push(0):o.push(a/h)}const r=o.map((l,a)=>({time:i[a].time,value:l}));return{metadata:{title:Qe.title,shorttitle:Qe.shortTitle,overlay:Qe.overlay},plots:{plot0:r}}}const qr={length:20,percent:10,src:"close",exponential:!1},e0=[{id:"length",type:"int",title:"Length",defval:20,min:1},{id:"percent",type:"float",title:"Percent",defval:10,min:.001},{id:"src",type:"source",title:"Source",defval:"close"},{id:"exponential",type:"bool",title:"Exponential",defval:!1}],i0=[{id:"plot0",title:"Basis",color:"#FF6D00",lineWidth:1},{id:"plot1",title:"Upper",color:"#2962FF",lineWidth:1},{id:"plot2",title:"Lower",color:"#2962FF",lineWidth:1}],Ge={title:"Envelope",shortTitle:"Env",overlay:!0};function s0(i,t={}){const{length:e,percent:s,src:n,exponential:o}={...qr,...t},r=F(i,n),l=o?b.ema(r,e):b.sma(r,e),a=s/100,h=l.mul(1+a),c=l.mul(1-a),u=l.toArray().map((p,m)=>({time:i[m].time,value:p??NaN})),f=h.toArray().map((p,m)=>({time:i[m].time,value:p??NaN})),d=c.toArray().map((p,m)=>({time:i[m].time,value:p??NaN}));return{metadata:{title:Ge.title,shorttitle:Ge.shortTitle,overlay:Ge.overlay},plots:{plot0:u,plot1:f,plot2:d}}}const Hr={shortLength:12,longLength:26,signalLength:9,src:"close",exponential:!0},n0=[{id:"shortLength",type:"int",title:"Short Length",defval:12,min:1},{id:"longLength",type:"int",title:"Long Length",defval:26,min:1},{id:"signalLength",type:"int",title:"Signal Length",defval:9,min:1},{id:"src",type:"source",title:"Source",defval:"close"},{id:"exponential",type:"bool",title:"Use Exponential MA",defval:!0}],o0=[{id:"plot0",title:"Histogram",color:"#26A69A",lineWidth:1},{id:"plot1",title:"PPO",color:"#009688",lineWidth:1},{id:"plot2",title:"Signal Line",color:"#FF9800",lineWidth:1}],Ke={title:"Price Oscillator",shortTitle:"PPO",overlay:!1};function r0(i,t={}){const{shortLength:e,longLength:s,signalLength:n,src:o,exponential:r}={...Hr,...t},l=F(i,o),a=r?b.ema(l,e):b.sma(l,e),h=r?b.ema(l,s):b.sma(l,s),c=a.toArray(),u=h.toArray(),f=[];for(let x=0;x<i.length;x++){const M=c[x],_=u[x];M==null||_==null||_===0?f.push(NaN):f.push((M-_)/_*100)}const d=new y(i,(x,M)=>f[M]),m=(r?b.ema(d,n):b.sma(d,n)).toArray(),g=[];for(let x=0;x<i.length;x++){const M=f[x],_=m[x];isNaN(M)||_==null?g.push(NaN):g.push(M-_)}const v=g.map((x,M)=>({time:i[M].time,value:x})),w=f.map((x,M)=>({time:i[M].time,value:x})),N=m.map((x,M)=>({time:i[M].time,value:x??NaN}));return{metadata:{title:Ke.title,shorttitle:Ke.shortTitle,overlay:Ke.overlay},plots:{plot0:v,plot1:w,plot2:N}}}const Ur={length:14},l0=[{id:"length",type:"int",title:"Length",defval:14,min:1}],a0=[{id:"plot0",title:"Aroon Up",color:"#FB8C00",lineWidth:1},{id:"plot1",title:"Aroon Down",color:"#2962FF",lineWidth:1}],Ze={title:"Aroon",shortTitle:"Aroon",overlay:!1};function h0(i,t={}){const{length:e}={...Ur,...t},s=[],n=[];for(let l=0;l<i.length;l++){if(l<e){s.push(NaN),n.push(NaN);continue}let a=l,h=l,c=-1/0,u=1/0;for(let p=l-e;p<=l;p++)i[p].high>c&&(c=i[p].high,a=p),i[p].low<u&&(u=i[p].low,h=p);const f=l-a,d=l-h;s.push(100*(e-f)/e),n.push(100*(e-d)/e)}const o=s.map((l,a)=>({time:i[a].time,value:l})),r=n.map((l,a)=>({time:i[a].time,value:l}));return{metadata:{title:Ze.title,shorttitle:Ze.shortTitle,overlay:Ze.overlay},plots:{plot0:o,plot1:r}}}const Jr={wmaLength:10,longRocLength:14,shortRocLength:11},c0=[{id:"wmaLength",type:"int",title:"WMA Length",defval:10,min:1},{id:"longRocLength",type:"int",title:"Long RoC Length",defval:14,min:1},{id:"shortRocLength",type:"int",title:"Short RoC Length",defval:11,min:1}],u0=[{id:"plot0",title:"Coppock Curve",color:"#2962FF",lineWidth:1}],Xe={title:"Coppock Curve",shortTitle:"Coppock",overlay:!1};function f0(i,t={}){const{wmaLength:e,longRocLength:s,shortRocLength:n}={...Jr,...t},o=new y(i,p=>p.close),r=b.roc(o,s),l=b.roc(o,n),a=r.toArray(),h=l.toArray(),c=[];for(let p=0;p<i.length;p++){const m=a[p],g=h[p];m==null||g==null?c.push(NaN):c.push(m+g)}const u=new y(i,(p,m)=>c[m]),d=b.wma(u,e).toArray().map((p,m)=>({time:i[m].time,value:p??NaN}));return{metadata:{title:Xe.title,shorttitle:Xe.shortTitle,overlay:Xe.overlay},plots:{plot0:d}}}const Qr={length:14},d0=[{id:"length",type:"int",title:"Length",defval:14,min:1}],p0=[{id:"plot0",title:"CHOP",color:"#2962FF",lineWidth:1}],ti={title:"Choppiness Index",shortTitle:"CHOP",overlay:!1};function m0(i,t={}){const{length:e}={...Qr,...t},n=b.atr(i,1).toArray(),o=new y(i,d=>d.high),r=new y(i,d=>d.low),l=b.highest(o,e),a=b.lowest(r,e),h=l.toArray(),c=a.toArray(),u=[];for(let d=0;d<i.length;d++){if(d<e-1){u.push(NaN);continue}let p=0;for(let v=d-e+1;v<=d;v++){const w=n[v];w!=null&&!isNaN(w)&&(p+=w)}const m=h[d],g=c[d];if(m==null||g==null||m===g)u.push(NaN);else{const v=m-g,w=100*Math.log10(p/v)/Math.log10(e);u.push(w)}}const f=u.map((d,p)=>({time:i[p].time,value:d}));return{metadata:{title:ti.title,shorttitle:ti.shortTitle,overlay:ti.overlay},plots:{plot0:f}}}const Gr={length:14,divisor:1e4},g0=[{id:"length",type:"int",title:"Length",defval:14,min:1},{id:"divisor",type:"int",title:"Divisor",defval:1e4,min:1}],v0=[{id:"plot0",title:"EOM",color:"#2962FF",lineWidth:1}],ei={title:"Ease of Movement",shortTitle:"EOM",overlay:!1};function w0(i,t={}){const{length:e,divisor:s}={...Gr,...t},n=new y(i,d=>(d.high+d.low)/2),o=b.change(n,1),r=new y(i,d=>(d.high-d.low)/((d.volume??0)/s)),l=o.toArray(),a=r.toArray(),h=[];for(let d=0;d<i.length;d++){const p=l[d],m=a[d];p==null||m==null||!isFinite(m)?h.push(NaN):h.push(p*m)}const c=new y(i,(d,p)=>h[p]),f=b.sma(c,e).toArray().map((d,p)=>({time:i[p].time,value:d??NaN}));return{metadata:{title:ei.title,shorttitle:ei.shortTitle,overlay:ei.overlay},plots:{plot0:f}}}const Kr={fast:3,slow:10},y0=[{id:"fast",type:"int",title:"Fast Length",defval:3,min:1},{id:"slow",type:"int",title:"Slow Length",defval:10,min:1}],N0=[{id:"plot0",title:"Chaikin Osc",color:"#2962FF",lineWidth:1}],ii={title:"Chaikin Oscillator",shortTitle:"Chaikin Osc",overlay:!1};function M0(i,t={}){const{fast:e,slow:s}={...Kr,...t},n=[];let o=0;for(let d=0;d<i.length;d++){const p=i[d],m=p.high,g=p.low,v=p.close,w=p.volume??0;if(m===g)n.push(o);else{const N=(v-g-(m-v))/(m-g);o+=N*w,n.push(o)}}const r=new y(i,(d,p)=>n[p]),l=b.ema(r,e),a=b.ema(r,s),h=l.toArray(),c=a.toArray(),u=[];for(let d=0;d<i.length;d++){const p=h[d],m=c[d];p==null||m==null?u.push(NaN):u.push(p-m)}const f=u.map((d,p)=>({time:i[p].time,value:d}));return{metadata:{title:ii.title,shorttitle:ii.shortTitle,overlay:ii.overlay},plots:{plot0:f}}}const Zr={length:9,src:"close",offset:0},b0=[{id:"length",type:"int",title:"Length",defval:9,min:1},{id:"src",type:"source",title:"Source",defval:"close"},{id:"offset",type:"int",title:"Offset",defval:0,min:-500,max:500}],x0=[{id:"plot0",title:"TEMA",color:"#7B1FA2",lineWidth:2}],si={title:"Triple EMA",shortTitle:"TEMA",overlay:!0};function _0(i,t={}){const{length:e,src:s}={...Zr,...t},n=F(i,s),o=b.ema(n,e),r=b.ema(o,e),l=b.ema(r,e),h=o.mul(3).sub(r.mul(3)).add(l).toArray().map((c,u)=>({time:i[u].time,value:c??NaN}));return{metadata:{title:si.title,shorttitle:si.shortTitle,overlay:si.overlay},plots:{plot0:h}}}const Xr={deviation:5,depth:10,extendLast:!0},C0=[{id:"deviation",type:"float",title:"Price deviation for reversals (%)",defval:5,min:1e-5,max:100},{id:"depth",type:"int",title:"Pivot legs",defval:10,min:2},{id:"extendLast",type:"bool",title:"Extend to last bar",defval:!0}],S0=[{id:"plot0",title:"Zig Zag",color:"#2962FF",lineWidth:2}],lt={title:"Zig Zag",shortTitle:"ZigZag",overlay:!0};function A0(i,t={}){const e={...Xr,...t};if(i.length===0)return{metadata:{title:lt.title,shorttitle:lt.shortTitle,overlay:lt.overlay},plots:{plot0:[]},pivots:[],extension:null};const s={devThreshold:e.deviation,depth:e.depth,extendLast:e.extendLast},n=Jp(i,s),o=i.map(r=>({time:r.time,value:NaN}));for(const r of n.pivots){const l=r.end.barIndex;l>=0&&l<o.length&&(o[l].value=r.end.price)}if(n.extension){const r=n.extension.end.barIndex;r>=0&&r<o.length&&(o[r].value=n.extension.end.price)}return{metadata:{title:lt.title,shorttitle:lt.shortTitle,overlay:lt.overlay},plots:{plot0:o},pivots:n.pivots,extension:n.extension}}const tl={length:9},P0=[{id:"length",type:"int",title:"Length",defval:9,min:1}],I0=[{id:"plot0",title:"Fisher",color:"#2962FF",lineWidth:2},{id:"plot1",title:"Trigger",color:"#FF6D00",lineWidth:1}],ni={title:"Fisher Transform",shortTitle:"Fisher",overlay:!1};function $0(i,t={}){const{length:e}={...tl,...t},s=[],n=[];let o=0,r=0;for(let h=0;h<i.length;h++){const c=i[h],u=(c.high+c.low)/2;let f=u,d=u;const p=Math.min(h+1,e);for(let N=0;N<p;N++){const x=i[h-N],M=(x.high+x.low)/2;M>f&&(f=M),M<d&&(d=M)}const m=f-d,v=.66*(m!==0?(u-d)/m-.5:0)+.67*o;o=v>.99?.999:v<-.99?-.999:v;const w=r;r=.5*Math.log((1+o)/(1-o))+.5*w,s.push(r),n.push(w)}const l=s.map((h,c)=>({time:i[c].time,value:c<e-1?NaN:h})),a=n.map((h,c)=>({time:i[c].time,value:c<e?NaN:h}));return{metadata:{title:ni.title,shorttitle:ni.shortTitle,overlay:ni.overlay},plots:{plot0:l,plot1:a}}}const el={length:18},T0=[{id:"length",type:"int",title:"Length",defval:18,min:1}],L0=[{id:"plot0",title:"TRIX",color:"#F44336",lineWidth:2}],oi={title:"TRIX",shortTitle:"TRIX",overlay:!1};function E0(i,t={}){const{length:e}={...el,...t},s=i.map(u=>Math.log(u.close)),n=new y(i,(u,f)=>s[f]),o=b.ema(n,e),r=b.ema(o,e),l=b.ema(r,e),c=b.change(l,1).toArray().map((u,f)=>({time:i[f].time,value:u!==null?u*1e4:NaN}));return{metadata:{title:oi.title,shorttitle:oi.shortTitle,overlay:oi.overlay},plots:{plot0:c}}}const il={adxSmoothing:14,diLength:14},V0=[{id:"adxSmoothing",type:"int",title:"ADX Smoothing",defval:14,min:1},{id:"diLength",type:"int",title:"DI Length",defval:14,min:1}],D0=[{id:"plot0",title:"ADX",color:"#F50057",lineWidth:2},{id:"plot1",title:"+DI",color:"#2962FF",lineWidth:1},{id:"plot2",title:"-DI",color:"#FF6D00",lineWidth:1}],ri={title:"Directional Movement Index",shortTitle:"DMI",overlay:!1};function F0(i,t={}){const{adxSmoothing:e,diLength:s}={...il,...t},n=y.fromBars(i,"high"),o=y.fromBars(i,"low"),l=b.change(n,1).toArray(),a=b.change(o,1).toArray().map(I=>I!==null?-I:null),h=[],c=[];for(let I=0;I<i.length;I++){const $=l[I],T=a[I];$===null?h.push(null):$>(T??0)&&$>0?h.push($):h.push(0),T===null?c.push(null):T>($??0)&&T>0?c.push(T):c.push(0)}const u=b.tr(i,!0),d=b.rma(u,s).toArray(),p=new y(i,(I,$)=>h[$]??NaN),m=new y(i,(I,$)=>c[$]??NaN),g=b.rma(p,s).toArray(),v=b.rma(m,s).toArray(),w=[],N=[];let x=0,M=0;for(let I=0;I<i.length;I++){const $=d[I],T=g[I],st=v[I];if($===null||$===0||T===null)w.push(x);else{const J=100*T/$;w.push(J),x=J}if($===null||$===0||st===null)N.push(M);else{const J=100*st/$;N.push(J),M=J}}const _=[];for(let I=0;I<i.length;I++){const $=w[I],T=N[I],st=$+T;_.push(st===0?0:100*Math.abs($-T)/st)}const C=new y(i,(I,$)=>_[$]),P=b.rma(C,e).toArray().map((I,$)=>({time:i[$].time,value:I??NaN})),R=w.map((I,$)=>({time:i[$].time,value:I})),q=N.map((I,$)=>({time:i[$].time,value:I}));return{metadata:{title:ri.title,shorttitle:ri.shortTitle,overlay:ri.overlay},plots:{plot0:P,plot1:R,plot2:q}}}const sl={fastLength:34,slowLength:55,signalLength:13},R0=[{id:"fastLength",type:"int",title:"Fast Length",defval:34,min:1},{id:"slowLength",type:"int",title:"Slow Length",defval:55,min:1},{id:"signalLength",type:"int",title:"Signal Length",defval:13,min:1}],k0=[{id:"plot0",title:"Klinger Oscillator",color:"#2962FF",lineWidth:2},{id:"plot1",title:"Signal",color:"#43A047",lineWidth:1}],li={title:"Klinger Oscillator",shortTitle:"KVO",overlay:!1};function z0(i,t={}){const{fastLength:e,slowLength:s,signalLength:n}={...sl,...t},o=i.map(v=>(v.high+v.low+v.close)/3),r=new y(i,(v,w)=>o[w]),l=b.change(r,1).toArray(),a=[];for(let v=0;v<i.length;v++){const w=l[v],N=i[v].volume??0;w===null?a.push(N):a.push(w>=0?N:-N)}const h=new y(i,(v,w)=>a[w]),c=b.ema(h,e).toArray(),u=b.ema(h,s).toArray(),f=[];for(let v=0;v<i.length;v++){const w=c[v],N=u[v];w===null||N===null?f.push(null):f.push(w-N)}const d=new y(i,(v,w)=>f[w]??NaN),p=b.ema(d,n).toArray(),m=f.map((v,w)=>({time:i[w].time,value:v??NaN})),g=p.map((v,w)=>({time:i[w].time,value:v??NaN}));return{metadata:{title:li.title,shorttitle:li.shortTitle,overlay:li.overlay},plots:{plot0:m,plot1:g}}}const nl={length1:7,length2:14,length3:28},W0=[{id:"length1",type:"int",title:"Fast Length",defval:7,min:1},{id:"length2",type:"int",title:"Middle Length",defval:14,min:1},{id:"length3",type:"int",title:"Slow Length",defval:28,min:1}],O0=[{id:"plot0",title:"UO",color:"#F44336",lineWidth:2}],ai={title:"Ultimate Oscillator",shortTitle:"UO",overlay:!1};function gt(i,t,e){let s=0;const n=Math.max(0,t-e+1);for(let o=n;o<=t;o++)s+=i[o];return s}function B0(i,t={}){const{length1:e,length2:s,length3:n}={...nl,...t},o=[],r=[];for(let c=0;c<i.length;c++)if(c===0)o.push(0),r.push(i[c].high-i[c].low);else{const u=i[c-1].close,f=Math.max(i[c].high,u),d=Math.min(i[c].low,u);o.push(i[c].close-d),r.push(f-d)}const l=[];for(let c=0;c<i.length;c++){const u=gt(o,c,e),f=gt(r,c,e),d=gt(o,c,s),p=gt(r,c,s),m=gt(o,c,n),g=gt(r,c,n),v=f!==0?u/f:0,w=p!==0?d/p:0,N=g!==0?m/g:0,x=100*(4*v+2*w+N)/7;l.push(x)}const a=n,h=l.map((c,u)=>({time:i[u].time,value:u<a?NaN:c}));return{metadata:{title:ai.title,shorttitle:ai.shortTitle,overlay:ai.overlay},plots:{plot0:h}}}const ol={atrLength:10,atrCoeff:1,stopLength:9},Y0=[{id:"atrLength",type:"int",title:"ATR Length (p)",defval:10,min:1},{id:"atrCoeff",type:"int",title:"ATR Coefficient (x)",defval:1,min:1},{id:"stopLength",type:"int",title:"Stop Length (q)",defval:9,min:1}],j0=[{id:"plot0",title:"Stop Long",color:"#2962FF",lineWidth:2},{id:"plot1",title:"Stop Short",color:"#FF6D00",lineWidth:2}],hi={title:"Chande Kroll Stop",shortTitle:"CKS",overlay:!0};function q0(i,t={}){const{atrLength:e,atrCoeff:s,stopLength:n}={...ol,...t},o=y.fromBars(i,"high"),r=y.fromBars(i,"low"),l=b.highest(o,e).toArray(),a=b.lowest(r,e).toArray(),h=b.atr(i,e).toArray(),c=[],u=[];for(let w=0;w<i.length;w++){const N=l[w],x=a[w],M=h[w];N===null||M===null?c.push(null):c.push(N-s*M),x===null||M===null?u.push(null):u.push(x+s*M)}const f=new y(i,(w,N)=>c[N]??NaN),d=new y(i,(w,N)=>u[N]??NaN),p=b.highest(f,n).toArray(),g=b.lowest(d,n).toArray().map((w,N)=>({time:i[N].time,value:w??NaN})),v=p.map((w,N)=>({time:i[N].time,value:w??NaN}));return{metadata:{title:hi.title,shorttitle:hi.shortTitle,overlay:hi.overlay},plots:{plot0:g,plot1:v}}}const rl={length:20,src:"close"},H0=[{id:"length",type:"int",title:"Length",defval:20,min:1},{id:"src",type:"source",title:"Source",defval:"close"}],U0=[{id:"plot0",title:"VWMA",color:"#2962FF",lineWidth:2}],ci={title:"Volume Weighted Moving Average",shortTitle:"VWMA",overlay:!0};function J0(i,t={}){const{length:e,src:s}={...rl,...t},n=F(i,s),o=new y(i,a=>a.volume??0),l=b.vwma(n,e,o).toArray().map((a,h)=>({time:i[h].time,value:a??NaN}));return{metadata:{title:ci.title,shorttitle:ci.shortTitle,overlay:ci.overlay},plots:{plot0:l}}}const ll={length:9,src:"close"},Q0=[{id:"length",type:"int",title:"Length",defval:9,min:1},{id:"src",type:"source",title:"Source",defval:"close"}],G0=[{id:"plot0",title:"WMA",color:"#2962FF",lineWidth:2}],ui={title:"Moving Average Weighted",shortTitle:"WMA",overlay:!0};function K0(i,t={}){const{length:e,src:s}={...ll,...t},n=F(i,s),r=b.wma(n,e).toArray().map((l,a)=>({time:i[a].time,value:l??NaN}));return{metadata:{title:ui.title,shorttitle:ui.shortTitle,overlay:ui.overlay},plots:{plot0:r}}}const Z0=[{id:"sma",name:"Simple Moving Average (SMA)",shortName:"SMA",description:"A simple moving average that smooths price data by calculating the arithmetic mean over a specified period.",category:"Moving Averages",overlay:!0,metadata:Gt,inputConfig:Qp,plotConfig:Gp,defaultInputs:{...Jo},calculate:Kp},{id:"adr",name:"Average Day Range (ADR)",shortName:"ADR",description:"Calculates the average of the daily price range (high - low) over a specified period.",category:"Volatility",overlay:!1,metadata:Kt,inputConfig:Zp,plotConfig:Xp,defaultInputs:{...Qo},calculate:tm},{id:"alma",name:"Arnaud Legoux Moving Average (ALMA)",shortName:"ALMA",description:"A moving average using a Gaussian distribution to reduce lag while maintaining smoothness.",category:"Moving Averages",overlay:!0,metadata:Zt,inputConfig:em,plotConfig:im,defaultInputs:{...Go},calculate:sm},{id:"atr",name:"Average True Range (ATR)",shortName:"ATR",description:"Measures market volatility by calculating the average range between high and low prices.",category:"Volatility",overlay:!1,metadata:Xt,inputConfig:nm,plotConfig:om,defaultInputs:{...Ko},calculate:rm},{id:"bb",name:"Bollinger Bands (BB)",shortName:"BB",description:"Volatility bands placed above and below a moving average, using standard deviation.",category:"Channels & Bands",overlay:!0,metadata:te,inputConfig:lm,plotConfig:am,defaultInputs:{...Zo},calculate:hm},{id:"bop",name:"Balance of Power (BOP)",shortName:"BOP",description:"Measures the strength of buyers vs sellers by comparing close-open to high-low range.",category:"Momentum",overlay:!1,metadata:ee,inputConfig:um,plotConfig:fm,defaultInputs:{...cm},calculate:dm},{id:"cci",name:"Commodity Channel Index (CCI)",shortName:"CCI",description:"Measures the variation of a security's price from its statistical mean.",category:"Oscillators",overlay:!1,metadata:ie,inputConfig:pm,plotConfig:mm,defaultInputs:{...Xo},calculate:gm},{id:"dema",name:"Double EMA (DEMA)",shortName:"DEMA",description:"Reduces lag by applying EMA twice.",category:"Moving Averages",overlay:!0,metadata:se,inputConfig:vm,plotConfig:wm,defaultInputs:{...tr},calculate:ym},{id:"ema",name:"Exponential Moving Average (EMA)",shortName:"EMA",description:"A weighted moving average giving more weight to recent prices.",category:"Moving Averages",overlay:!0,metadata:oe,inputConfig:xm,plotConfig:_m,defaultInputs:{...ir},calculate:Cm},{id:"hma",name:"Hull Moving Average (HMA)",shortName:"HMA",description:"Reduces lag while maintaining smoothness using weighted moving averages.",category:"Moving Averages",overlay:!0,metadata:re,inputConfig:Sm,plotConfig:Am,defaultInputs:{...sr},calculate:Pm},{id:"ichimoku",name:"Ichimoku Cloud",shortName:"Ichimoku",description:"Comprehensive trend system showing support/resistance and momentum.",category:"Trend",overlay:!0,metadata:le,inputConfig:Im,plotConfig:$m,defaultInputs:{...nr},calculate:Tm},{id:"keltner",name:"Keltner Channels (KC)",shortName:"KC",description:"Volatility-based envelope using EMA and ATR.",category:"Channels & Bands",overlay:!0,metadata:ae,inputConfig:Lm,plotConfig:Em,defaultInputs:{...or},calculate:Vm},{id:"lsma",name:"Least Squares Moving Average (LSMA)",shortName:"LSMA",description:"Uses linear regression to fit a line through recent prices.",category:"Moving Averages",overlay:!0,metadata:he,inputConfig:Dm,plotConfig:Fm,defaultInputs:{...rr},calculate:Rm},{id:"macd",name:"MACD",shortName:"MACD",description:"Trend-following momentum indicator showing relationship between two EMAs.",category:"Momentum",overlay:!1,metadata:ce,inputConfig:km,plotConfig:zm,defaultInputs:{...lr},calculate:Wm},{id:"mass-index",name:"Mass Index",shortName:"MI",description:"Identifies trend reversals by examining range between high and low.",category:"Trend",overlay:!1,metadata:fe,inputConfig:qm,plotConfig:Hm,defaultInputs:{...hr},calculate:Um},{id:"mc-ginley-dynamic",name:"McGinley Dynamic",shortName:"MD",description:"An adaptive moving average that adjusts to market speed.",category:"Moving Averages",overlay:!0,metadata:de,inputConfig:Jm,plotConfig:Qm,defaultInputs:{...cr},calculate:Gm},{id:"momentum",name:"Momentum",shortName:"Mom",description:"Measures the rate of change of price over a specified period.",category:"Momentum",overlay:!1,metadata:pe,inputConfig:Km,plotConfig:Zm,defaultInputs:{...ur},calculate:Xm},{id:"obv",name:"On Balance Volume (OBV)",shortName:"OBV",description:"Cumulative volume indicator based on price direction.",category:"Volume",overlay:!1,metadata:me,inputConfig:eg,plotConfig:ig,defaultInputs:{...tg},calculate:sg},{id:"rma",name:"Smoothed Moving Average (RMA)",shortName:"RMA",description:"Wilder smoothing with alpha = 1/length.",category:"Moving Averages",overlay:!0,metadata:ve,inputConfig:lg,plotConfig:ag,defaultInputs:{...dr},calculate:hg},{id:"roc",name:"Rate of Change (ROC)",shortName:"ROC",description:"Measures percentage change in price over a specified period.",category:"Momentum",overlay:!1,metadata:we,inputConfig:cg,plotConfig:ug,defaultInputs:{...pr},calculate:fg},{id:"rsi",name:"Relative Strength Index (RSI)",shortName:"RSI",description:"Momentum oscillator measuring speed and magnitude of price changes.",category:"Oscillators",overlay:!1,metadata:ye,inputConfig:dg,plotConfig:pg,defaultInputs:{...mr},calculate:mg},{id:"stoch",name:"Stochastic",shortName:"Stoch",description:"Compares closing price to its price range over a given period.",category:"Oscillators",overlay:!1,metadata:Ne,inputConfig:gg,plotConfig:vg,defaultInputs:{...gr},calculate:wg},{id:"tema",name:"Triple EMA (TEMA)",shortName:"TEMA",description:"Further reduces lag with triple exponential smoothing.",category:"Moving Averages",overlay:!0,metadata:si,inputConfig:b0,plotConfig:x0,defaultInputs:{...Zr},calculate:_0},{id:"vwma",name:"Volume Weighted Moving Average (VWMA)",shortName:"VWMA",description:"A moving average weighted by volume.",category:"Moving Averages",overlay:!0,metadata:ci,inputConfig:H0,plotConfig:U0,defaultInputs:{...rl},calculate:J0},{id:"wma",name:"Weighted Moving Average (WMA)",shortName:"WMA",description:"A moving average with linearly increasing weights.",category:"Moving Averages",overlay:!0,metadata:ui,inputConfig:Q0,plotConfig:G0,defaultInputs:{...ll},calculate:K0},{id:"donchian",name:"Donchian Channels (DC)",shortName:"DC",description:"Shows the highest high and lowest low over a period, used for breakout trading.",category:"Channels & Bands",overlay:!0,metadata:ne,inputConfig:Nm,plotConfig:Mm,defaultInputs:{...er},calculate:bm},{id:"parabolic-sar",name:"Parabolic SAR",shortName:"SAR",description:"A trend-following indicator that provides potential entry and exit points.",category:"Trend",overlay:!0,metadata:ge,inputConfig:ng,plotConfig:og,defaultInputs:{...fr},calculate:rg},{id:"supertrend",name:"Supertrend",shortName:"ST",description:"A trend-following overlay that uses ATR to calculate dynamic support/resistance.",category:"Trend",overlay:!0,metadata:Me,inputConfig:yg,plotConfig:Ng,defaultInputs:{...vr},calculate:Mg},{id:"adx",name:"Average Directional Index (ADX)",shortName:"ADX",description:"Measures trend strength regardless of direction.",category:"Trend",overlay:!1,metadata:be,inputConfig:bg,plotConfig:xg,defaultInputs:{...wr},calculate:_g},{id:"awesome-oscillator",name:"Awesome Oscillator",shortName:"AO",description:"Shows market momentum using SMA difference.",category:"Oscillators",overlay:!1,metadata:xe,inputConfig:Cg,plotConfig:Sg,defaultInputs:{...yr},calculate:Ag},{id:"bbtrend",name:"BBTrend",shortName:"BBT",description:"Measures trend using Bollinger Bands.",category:"Trend",overlay:!1,metadata:_e,inputConfig:Pg,plotConfig:Ig,defaultInputs:{...Nr},calculate:$g},{id:"bull-bear-power",name:"Bull Bear Power",shortName:"BBP",description:"Measures buying/selling pressure relative to EMA.",category:"Momentum",overlay:!1,metadata:Ce,inputConfig:Tg,plotConfig:Lg,defaultInputs:{...Mr},calculate:Eg},{id:"chande-mo",name:"Chande Momentum Oscillator",shortName:"CMO",description:"Measures momentum on a scale of -100 to +100.",category:"Oscillators",overlay:!1,metadata:Se,inputConfig:Vg,plotConfig:Dg,defaultInputs:{...br},calculate:Fg},{id:"dpo",name:"Detrended Price Oscillator",shortName:"DPO",description:"Removes trend to identify cycles.",category:"Oscillators",overlay:!1,metadata:Ae,inputConfig:Rg,plotConfig:kg,defaultInputs:{...xr},calculate:zg},{id:"elder-force",name:"Elder Force Index",shortName:"EFI",description:"Combines price and volume for force measurement.",category:"Momentum",overlay:!1,metadata:Pe,inputConfig:Wg,plotConfig:Og,defaultInputs:{..._r},calculate:Bg},{id:"hist-volatility",name:"Historical Volatility",shortName:"HV",description:"Annualized standard deviation of log returns.",category:"Volatility",overlay:!1,metadata:Ie,inputConfig:Yg,plotConfig:jg,defaultInputs:{...Cr},calculate:qg},{id:"ma-cross",name:"MA Cross",shortName:"MAC",description:"Two moving averages for crossover signals.",category:"Moving Averages",overlay:!0,metadata:$e,inputConfig:Hg,plotConfig:Ug,defaultInputs:{...Sr},calculate:Jg},{id:"ma-ribbon",name:"Moving Average Ribbon",shortName:"MA Ribbon",description:"Multiple moving averages showing trend direction and momentum.",category:"Moving Averages",overlay:!0,metadata:ue,inputConfig:Om,plotConfig:Bm,defaultInputs:{...ar},calculate:jm},{id:"median",name:"Median",shortName:"MED",description:"Median price with ATR bands.",category:"Channels & Bands",overlay:!0,metadata:Te,inputConfig:Qg,plotConfig:Gg,defaultInputs:{...Ar},calculate:Zg},{id:"mfi",name:"Money Flow Index",shortName:"MFI",description:"Volume-weighted RSI measuring buying/selling pressure.",category:"Volume",overlay:!1,metadata:Le,inputConfig:Xg,plotConfig:tv,defaultInputs:{...Pr},calculate:ev},{id:"pvt",name:"Price Volume Trend",shortName:"PVT",description:"Cumulative volume weighted by price changes.",category:"Volume",overlay:!1,metadata:Ee,inputConfig:sv,plotConfig:nv,defaultInputs:{...iv},calculate:ov},{id:"rvi",name:"Relative Vigor Index",shortName:"RVI",description:"Measures conviction of price action.",category:"Oscillators",overlay:!1,metadata:Ve,inputConfig:rv,plotConfig:lv,defaultInputs:{...Ir},calculate:av},{id:"smi-ergodic",name:"SMI Ergodic Indicator",shortName:"SMII",description:"TSI-based momentum oscillator with signal line.",category:"Oscillators",overlay:!1,metadata:De,inputConfig:hv,plotConfig:cv,defaultInputs:{...$r},calculate:uv},{id:"smi-ergodic-osc",name:"SMI Ergodic Oscillator",shortName:"SMIO",description:"Difference between SMI and signal as histogram.",category:"Oscillators",overlay:!1,metadata:Fe,inputConfig:fv,plotConfig:dv,defaultInputs:{...Tr},calculate:pv},{id:"smma",name:"Smoothed Moving Average",shortName:"SMMA",description:"Wilder smoothing moving average.",category:"Moving Averages",overlay:!0,metadata:Re,inputConfig:mv,plotConfig:gv,defaultInputs:{...Lr},calculate:vv},{id:"stdev",name:"Standard Deviation",shortName:"StDev",description:"Measures price volatility.",category:"Volatility",overlay:!1,metadata:ke,inputConfig:wv,plotConfig:yv,defaultInputs:{...Er},calculate:Nv},{id:"stoch-rsi",name:"Stochastic RSI",shortName:"StochRSI",description:"Stochastic applied to RSI values.",category:"Oscillators",overlay:!1,metadata:ze,inputConfig:Mv,plotConfig:bv,defaultInputs:{...Vr},calculate:xv},{id:"trend-strength",name:"Trend Strength Index",shortName:"TSI",description:"Measures trend strength based on directional movement.",category:"Trend",overlay:!1,metadata:We,inputConfig:_v,plotConfig:Cv,defaultInputs:{...Dr},calculate:Av},{id:"tsi",name:"True Strength Index",shortName:"TSI",description:"Double-smoothed momentum oscillator.",category:"Oscillators",overlay:!1,metadata:Oe,inputConfig:Pv,plotConfig:Iv,defaultInputs:{...Fr},calculate:$v},{id:"volume-osc",name:"Volume Oscillator",shortName:"VO",description:"Percentage difference between volume EMAs.",category:"Volume",overlay:!1,metadata:Be,inputConfig:Tv,plotConfig:Lv,defaultInputs:{...Rr},calculate:Ev},{id:"vortex",name:"Vortex Indicator",shortName:"VI",description:"Identifies trend start and direction.",category:"Trend",overlay:!1,metadata:Ye,inputConfig:Vv,plotConfig:Dv,defaultInputs:{...kr},calculate:Fv},{id:"williams-alligator",name:"Williams Alligator",shortName:"Alligator",description:"Three smoothed moving averages for trend detection.",category:"Trend",overlay:!0,metadata:je,inputConfig:Rv,plotConfig:kv,defaultInputs:{...zr},calculate:zv},{id:"williams-r",name:"Williams %R",shortName:"%R",description:"Momentum indicator showing overbought/oversold levels.",category:"Oscillators",overlay:!1,metadata:qe,inputConfig:Wv,plotConfig:Ov,defaultInputs:{...Wr},calculate:Bv},{id:"woodies-cci",name:"Woodies CCI",shortName:"WCCI",description:"CCI with turbo for faster signals.",category:"Oscillators",overlay:!1,metadata:He,inputConfig:Yv,plotConfig:jv,defaultInputs:{...Or},calculate:qv},{id:"bb-percent-b",name:"Bollinger Bands %B",shortName:"BB%B",description:"Shows where price is relative to Bollinger Bands (0 = lower, 1 = upper).",category:"Oscillators",overlay:!1,metadata:Ue,inputConfig:Hv,plotConfig:Uv,defaultInputs:{...Br},calculate:Jv},{id:"bb-bandwidth",name:"Bollinger BandWidth",shortName:"BBW",description:"Measures the width of Bollinger Bands as a percentage.",category:"Volatility",overlay:!1,metadata:Je,inputConfig:Qv,plotConfig:Gv,defaultInputs:{...Yr},calculate:Kv},{id:"chaikin-mf",name:"Chaikin Money Flow",shortName:"CMF",description:"Measures buying/selling pressure using price and volume.",category:"Volume",overlay:!1,metadata:Qe,inputConfig:Zv,plotConfig:Xv,defaultInputs:{...jr},calculate:t0},{id:"envelope",name:"Envelope",shortName:"Env",description:"Moving average with fixed percentage bands.",category:"Channels & Bands",overlay:!0,metadata:Ge,inputConfig:e0,plotConfig:i0,defaultInputs:{...qr},calculate:s0},{id:"price-oscillator",name:"Price Oscillator (PPO)",shortName:"PPO",description:"MACD expressed as a percentage for cross-security comparison.",category:"Momentum",overlay:!1,metadata:Ke,inputConfig:n0,plotConfig:o0,defaultInputs:{...Hr},calculate:r0},{id:"aroon",name:"Aroon",shortName:"Aroon",description:"Identifies trend strength by measuring time since highest/lowest.",category:"Trend",overlay:!1,metadata:Ze,inputConfig:l0,plotConfig:a0,defaultInputs:{...Ur},calculate:h0},{id:"coppock-curve",name:"Coppock Curve",shortName:"Coppock",description:"Long-term momentum indicator using ROC and WMA.",category:"Momentum",overlay:!1,metadata:Xe,inputConfig:c0,plotConfig:u0,defaultInputs:{...Jr},calculate:f0},{id:"choppiness",name:"Choppiness Index",shortName:"CHOP",description:"Measures market choppiness vs trending (high = choppy).",category:"Trend",overlay:!1,metadata:ti,inputConfig:d0,plotConfig:p0,defaultInputs:{...Qr},calculate:m0},{id:"eom",name:"Ease of Movement",shortName:"EOM",description:"Relates price change to volume, showing ease of price movement.",category:"Volume",overlay:!1,metadata:ei,inputConfig:g0,plotConfig:v0,defaultInputs:{...Gr},calculate:w0},{id:"chaikin-osc",name:"Chaikin Oscillator",shortName:"Chaikin",description:"Momentum of the Accumulation/Distribution line.",category:"Volume",overlay:!1,metadata:ii,inputConfig:y0,plotConfig:N0,defaultInputs:{...Kr},calculate:M0},{id:"zigzag",name:"Zig Zag",shortName:"ZigZag",description:"Identifies trend reversals by connecting pivot highs and lows.",category:"Trend",overlay:!0,metadata:lt,inputConfig:C0,plotConfig:S0,defaultInputs:{...Xr},calculate:A0},{id:"fisher-transform",name:"Fisher Transform",shortName:"Fisher",description:"Converts prices into a Gaussian normal distribution for clearer turning points.",category:"Oscillators",overlay:!1,metadata:ni,inputConfig:P0,plotConfig:I0,defaultInputs:{...tl},calculate:$0},{id:"trix",name:"TRIX",shortName:"TRIX",description:"Triple exponential average rate of change, filters out noise.",category:"Momentum",overlay:!1,metadata:oi,inputConfig:T0,plotConfig:L0,defaultInputs:{...el},calculate:E0},{id:"dmi",name:"Directional Movement Index",shortName:"DMI",description:"Shows trend direction and strength with +DI, -DI, and ADX.",category:"Trend",overlay:!1,metadata:ri,inputConfig:V0,plotConfig:D0,defaultInputs:{...il},calculate:F0},{id:"klinger",name:"Klinger Oscillator",shortName:"KVO",description:"Volume-based oscillator measuring long-term money flow.",category:"Volume",overlay:!1,metadata:li,inputConfig:R0,plotConfig:k0,defaultInputs:{...sl},calculate:z0},{id:"ultimate-osc",name:"Ultimate Oscillator",shortName:"UO",description:"Multi-timeframe momentum oscillator using weighted averages.",category:"Oscillators",overlay:!1,metadata:ai,inputConfig:W0,plotConfig:O0,defaultInputs:{...nl},calculate:B0},{id:"chande-kroll-stop",name:"Chande Kroll Stop",shortName:"CKS",description:"ATR-based trailing stop system for long and short positions.",category:"Trend",overlay:!0,metadata:hi,inputConfig:Y0,plotConfig:j0,defaultInputs:{...ol},calculate:q0}],Ui=Z0,X0=["Moving Averages","Momentum","Oscillators","Trend","Volatility","Volume","Channels & Bands"];function tw(i){const t=new Map;for(const e of X0)t.set(e,[]);for(const e of i){const s=e.category,n=t.get(s);n&&n.push(e)}for(const[,e]of t)e.sort((s,n)=>s.name.localeCompare(n.name));return t}class ew{constructor(t,e){V(this,"bars",[]);V(this,"chartManager");V(this,"container");V(this,"currentIndicatorId",null);V(this,"currentInputs",{});this.container=t,this.chartManager=e,this.render()}setData(t){this.bars=t,this.recalculate()}render(){const t=tw(Ui),e=Array.from(t.entries()).filter(([,n])=>n.length>0).map(([n,o])=>`
        <optgroup label="${n}">
          ${o.map(r=>`<option value="${r.id}">${r.name}</option>`).join("")}
        </optgroup>
      `).join("");this.container.innerHTML=`
      <div class="indicator-panel">
        <h3>Indicators</h3>
        <div class="indicator-select-container">
          <label for="indicator-select">Select Indicator:</label>
          <select id="indicator-select">
            <option value="">-- None --</option>
            ${e}
          </select>
        </div>
        <div id="indicator-inputs" class="indicator-inputs"></div>
      </div>
    `;const s=this.container.querySelector("#indicator-select");s.addEventListener("change",()=>{this.selectIndicator(s.value||null)})}selectIndicator(t){console.log("[IndicatorUI] selectIndicator:",t),this.chartManager.clearIndicators(),this.currentIndicatorId=t,this.currentInputs={};const e=this.container.querySelector("#indicator-inputs");if(!t){e.innerHTML="";return}const s=Ui.find(n=>n.id===t);if(console.log("[IndicatorUI] indicator found:",s),console.log("[IndicatorUI] inputConfig:",s==null?void 0:s.inputConfig),console.log("[IndicatorUI] defaultInputs:",s==null?void 0:s.defaultInputs),!s){e.innerHTML="";return}this.currentInputs={...s.defaultInputs},this.renderInputs(s,e),this.recalculate()}renderInputs(t,e){const s=Array.isArray(t.inputConfig)?t.inputConfig:[];console.log("[IndicatorUI] renderInputs - inputConfigArray:",s);const n=s.map(o=>{const r=this.currentInputs[o.id]??o.defval;switch(o.type){case"int":case"float":return`
            <div class="input-group">
              <label for="input-${o.id}">${o.title}:</label>
              <input
                type="number"
                id="input-${o.id}"
                data-input-id="${o.id}"
                value="${r}"
                min="${o.min??""}"
                max="${o.max??""}"
                step="${o.step??(o.type==="float"?.1:1)}"
              />
            </div>
          `;case"source":const l=o.options||["open","high","low","close","hl2","hlc3","ohlc4","hlcc4"];return console.log("[IndicatorUI] source input options:",o.options),`
            <div class="input-group">
              <label for="input-${o.id}">${o.title}:</label>
              <select id="input-${o.id}" data-input-id="${o.id}">
                ${l.map(a=>`<option value="${a}" ${a===r?"selected":""}>${a}</option>`).join("")}
              </select>
            </div>
          `;case"bool":return`
            <div class="input-group">
              <label for="input-${o.id}">${o.title}:</label>
              <input
                type="checkbox"
                id="input-${o.id}"
                data-input-id="${o.id}"
                ${r?"checked":""}
              />
            </div>
          `;case"string":return o.options?`
              <div class="input-group">
                <label for="input-${o.id}">${o.title}:</label>
                <select id="input-${o.id}" data-input-id="${o.id}">
                  ${o.options.map(a=>`<option value="${a}" ${a===r?"selected":""}>${a}</option>`).join("")}
                </select>
              </div>
            `:`
            <div class="input-group">
              <label for="input-${o.id}">${o.title}:</label>
              <input
                type="text"
                id="input-${o.id}"
                data-input-id="${o.id}"
                value="${r}"
              />
            </div>
          `;default:return""}}).join("");e.innerHTML=`
      <h4>${t.metadata.title} Settings</h4>
      ${n}
    `,e.querySelectorAll("[data-input-id]").forEach(o=>{const r=o.getAttribute("data-input-id"),l=s.find(a=>a.id===r);if(o.tagName==="SELECT")o.addEventListener("change",a=>{const h=a.target;this.currentInputs[r]=h.value,this.recalculate()});else if(o.tagName==="INPUT"){const a=o;a.type==="checkbox"?o.addEventListener("change",()=>{this.currentInputs[r]=a.checked,this.recalculate()}):a.type==="number"?o.addEventListener("input",()=>{const h=(l==null?void 0:l.type)==="int"?parseInt(a.value,10):parseFloat(a.value);isNaN(h)||(this.currentInputs[r]=h,this.recalculate())}):o.addEventListener("input",()=>{this.currentInputs[r]=a.value,this.recalculate()})}})}recalculate(){if(console.log("[IndicatorUI] recalculate - bars count:",this.bars.length),console.log("[IndicatorUI] recalculate - currentInputs:",this.currentInputs),!this.currentIndicatorId||this.bars.length===0)return;const t=Ui.find(e=>e.id===this.currentIndicatorId);if(t)try{const e=t.calculate(this.bars,this.currentInputs);if(console.log("[IndicatorUI] recalculate - result:",e),console.log("[IndicatorUI] recalculate - result.plots:",e==null?void 0:e.plots),console.log("[IndicatorUI] recalculate - plotConfig:",t==null?void 0:t.plotConfig),e!=null&&e.plots)for(const[n,o]of Object.entries(e.plots))Array.isArray(o)&&o.length>0&&console.log(`[IndicatorUI] ${n} first 3 values:`,o.slice(0,3));this.chartManager.clearIndicators();const s=t.overlay?0:1;for(const n of t.plotConfig){const o=e.plots[n.id];console.log("[IndicatorUI] plotDef:",n),console.log("[IndicatorUI] plotData:",o),console.log("[IndicatorUI] plotData length:",o==null?void 0:o.length);const r=this.evaluatePlotVisibility(n,e);o&&o.length>0&&r&&this.chartManager.setIndicatorData(n.id,o,{color:n.color,lineWidth:n.lineWidth,overlay:t.overlay,paneIndex:s})}}catch(e){console.error("Error calculating indicator:",e)}}evaluatePlotVisibility(t,e){if(t.display==="none")return!1;if(t.visible===void 0)return!0;if(typeof t.visible=="boolean")return t.visible;if(typeof t.visible=="string"){const s=t.visible;if(this.currentInputs[s]!==void 0)return!!this.currentInputs[s];if(e.visibility&&e.visibility[s]!==void 0)return!!e.visibility[s];const n=e.plots[t.id];if(n&&Array.isArray(n)){const o=n.some(r=>r.value!==void 0&&r.value!==null&&!Number.isNaN(r.value));return console.log(`[IndicatorUI] Plot ${t.id} visibility fallback (hasValidData): ${o}`),o}}return!0}}async function iw(){const i=document.getElementById("chart-container"),t=document.getElementById("indicator-panel");if(!i||!t){console.error("Required container elements not found");return}i.innerHTML='<div class="loading">Loading chart data...</div>';try{i.innerHTML="";const e=new Lh(i),s=new ew(t,e),n=await dl("./data/SPX.csv");if(n.length===0){i.innerHTML='<div class="error">No data loaded</div>';return}console.log(`Loaded ${n.length} bars of SPX data`),e.setCandlestickData(n),s.setData(n)}catch(e){console.error("Failed to initialize:",e),i.innerHTML=`<div class="error">Failed to load data: ${e}</div>`}}document.addEventListener("DOMContentLoaded",iw);
